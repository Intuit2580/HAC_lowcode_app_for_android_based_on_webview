var Forguncy;(function(n){var t;(function(t){t.LocalizationResource={};var i=function(){function t(){}return t.clearCache=function(){this._localizationResourceCache.clear()},t.getLocalizationResourceByCellType=function(t){return this.getLocalizationResource(n.Plugin.CellTypeHelper.getIdentifierByCellType(t))},t.getLocalizationResourceByCommand=function(t){return this.getLocalizationResource(n.Plugin.CommandFactory.getCommandTypeByCommand(t))},t.getLocalizationResource=function(t){var i=n.ModuleLoader.nameModuleMap[t];return this.getPluginResource(i)},t.getPluginResource=function(t){if(!this._localizationResourceCache.has(t)){var i=n.Plugin.LocalizationResource[t],r=new Proxy(i,{get:function(n,t){return n[t.toString()]}});this._localizationResourceCache.set(t,r)}return this._localizationResourceCache.get(t)},t.getApplicationResource=function(t){for(var r,u=[],i=1;i<arguments.length;i++)u[i-1]=arguments[i];return n.Common.IsEmpty(t)?t:(r=n.Common.getMultiLanguageWord(t),typeof t=="string"&&t.startsWith("~"))?n.Common.formatResource(r,u):r},t.getApplicationResources=function(){return n.Resource.PublicResource},t._localizationResourceCache=new Map,t}();t.LocalizationResourceHelper=i})(t=n.Plugin||(n.Plugin={}))})(Forguncy||(Forguncy={}))
;
;
;var Forguncy;(function(n){var t,i;(function(n){n[n.Left=0]="Left";n[n.Center=1]="Center";n[n.Right=2]="Right";n[n.General=3]="General";n[n.Distributed=4]="Distributed"})(t=n.CellHorizontalAlignment||(n.CellHorizontalAlignment={})),function(n){n[n.Top=0]="Top";n[n.Center=1]="Center";n[n.Bottom=2]="Bottom"}(i=n.CellVerticalAlignment||(n.CellVerticalAlignment={}))})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var t;(function(t){var r=function(){function t(){}return t.requestRSAPublicKey=function(t){n.Common.forguncyPost("Account/GetRSAPublicKey",null,function(i){(i===null||i===void 0?void 0:i.Result)?t(i.Result):alert(n.RS.Failed)},null,function(){alert(n.RS.Failed)})},t}(),i;t.SecurityManager=r;i=function(){function t(){}return t.encrypt=function(t,i,r){return n.ModuleLoader.LoadModels(["jsencrypt"],n.ForguncyData.ForguncyRoot).done(function(){var u=new JSEncrypt({}),n;if(u.setPublicKey(i),n=u.encrypt(t),n!==!1)r(n);else throw new Error("Can't encrypt password");})},t}();t.Encrypter=i})(t=n.Security||(n.Security={}))})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var t;(function(n){var t=function(){function n(n,t){n===void 0&&(n=0);t===void 0&&(t=0);this.x=n;this.y=t}return Object.defineProperty(n,"Zero",{get:function(){return new n(0,0)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"length",{get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"sqrtLength",{get:function(){return this.x*this.x+this.y*this.y},enumerable:!1,configurable:!0}),n.prototype.clone=function(){return new n(this.x,this.y)},n.prototype.normalize=function(){var t=1/this.length;return new n(this.x*t,this.y*t)},n.prototype.negate=function(){return new n(-this.x,-this.y)},n.prototype.add=function(t){return new n(this.x+t.x,this.y+t.y)},n.prototype.subtract=function(t){return new n(this.x-t.x,this.y-t.y)},n.prototype.multiply=function(t){return new n(this.x*t,this.y*t)},n.prototype.divide=function(t){var i=1/t;return new n(this.x*i,this.y*i)},n.prototype.dot=function(n){return this.x*n.x+this.y*n.y},n.prototype.rotate=function(t){var i=Math.sin(t),r=Math.cos(t);return new n(this.x*r-this.y*i,this.y*r+this.x*i)},n.prototype.setLength=function(n){var t=this.length;t>0&&(this.x=this.x*n/t,this.y=this.y*n/t)},n.prototype.limitLength=function(n){var t=this.length;t>n&&this.setLength(n)},n.prototype.cos=function(n){return this.dot(n)/(this.length*n.length)},n}();n.Vector2=t})(t=n.Numerics||(n.Numerics={}))})(Forguncy||(Forguncy={}))
;var __spreadArray=this&&this.__spreadArray||function(n,t,i){if(i||arguments.length===2)for(var r=0,f=t.length,u;r<f;r++)!u&&r in t||(u||(u=Array.prototype.slice.call(t,0,r)),u[r]=t[r]);return n.concat(u||Array.prototype.slice.call(t))},Forguncy;(function(n){var t=function(){function n(){this._events=[]}return n.prototype.bind=function(n,t,i){arguments.length===2&&(i=t,t=undefined);this._events.push({eventType:n,data:t,fn:i})},n.prototype.unbind=function(n,t){for(var r,u=arguments.length===1||t===undefined,f=this._events.length,i=f-1;i>=0;i--)r=this._events[i],r.eventType===n&&(u||r.fn===t)&&this._events.splice(i,1)},n.prototype.unbindAll=function(){this._events=[]},n.prototype.isEventHasBeenBinding=function(n){for(var i,r=this._events.length,t=0;t<r;t++)if(i=this._events[t],i.eventType===n)return!0;return!1},n.prototype.trigger=function(n){for(var i,r=this,u=[],t=1;t<arguments.length;t++)u[t-1]=arguments[t];i=[];this._events.forEach(function(t){var u,f;r.isFunction((u=t.eventType)===null||u===void 0?void 0:u.toLowerCase)&&r.isFunction(n===null||n===void 0?void 0:n.toLowerCase)&&((f=t.eventType)===null||f===void 0?void 0:f.toLowerCase())===(n===null||n===void 0?void 0:n.toLowerCase())&&i.push(t)});i.forEach(function(n){n.fn.apply(n,__spreadArray([{data:n.data===undefined?null:n.data}],u,!1))})},n.prototype.isFunction=function(n){return Object.prototype.toString.call(n)==="[object Function]"},n}();n.EventClassBase=t})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var u=function(){function n(){}return n.InnerID="innerid",n.NeedImplementException="Need Implement.",n.isInListview="isInListview",n.conditionalForeColor="conditionalForeColor",n.FontStyle_Italic="Italic",n.Font_Normal="Normal",n.FontWeight_Bold="Bold",n.RunTimeNormalPagePrefix="p",n.RunTimeMasterPagePrefix="m",n.DefaultFontSizeInPx=14.67,n}(),i,r,t;n.StaticValues=u;i=function(){function n(){}return n.toArray=function(){return[n.CreateBy,n.CreateDate,n.LastModifyBy,n.LastModifyDate,n.Status,n.AssignTo,]},n.CreateBy="FGC_Creator",n.CreateDate="FGC_CreateDate",n.LastModifyBy="FGC_LastModifier",n.LastModifyDate="FGC_LastModifyDate",n.AssignTo="FGC_AssignTo",n.Status="FGC_State",n}();n.GUIDColumnName=i;r=function(i){function r(){return i!==null&&i.apply(this,arguments)||this}return __extends(r,i),r.IsKeyWord=function(n){if(n&&typeof n=="string"){var t=n;if(t===r.PageName||t===r.PageTitle||t===r.ViewportWidth||t===r.ViewportHeight||t===r.CurrentUserStr||t===r.ActiveLanguage||t.length>r.CurrentUserPrefix.length+1&&t.startsWith(r.CurrentUserPrefix)&&t.endsWith("%"))return!0}return!1},r.updatePageNameAndTitle=function(){r._keyWordsObj.trigger("pageloaded")},r.onKeyWordValueChanged=function(t,i,u){var f,e;return t===r.PageName||t===r.PageTitle?(f=function(){var f=r.GetKeyWordValue(t,i);(f===n.ForguncyData.pageInfo.pageName||f===n.ForguncyData.pageInfo.pageTitle)&&u(f)},r._keyWordsObj.bind("pageloaded",f),function(){return r._keyWordsObj.unbind("pageloaded",f)}):t===r.ViewportWidth||t===r.ViewportHeight?(e=function(){var n=r.GetKeyWordValue(t,i);u(n)},$(window).resize(e),function(){return $(window).off("resize",e)}):null},r.GetKeyWordValue=function(i,u){var e,f,o,s;if(!r.IsKeyWord(i))return i;if(i===r.PageName||i===r.PageTitle)return u&&(e=n.PageManager.getContainerCell(u),e&&e.cellType instanceof n.UserControlPageCellType)?this.GetKeyWordValue(i,e.runTimePageName):i===r.PageName?n.PageManager.getDesignerPageName(u,!0):n.Common.getMultiLanguageWord(n.PageManager.getDesignerPageTitle(u));if(i===r.ActiveLanguage)return localStorage.getItem(n.Resource.ActiveLanguageKey);if(i===r.ViewportWidth)return Math.max(document.documentElement.clientWidth||0,window.innerWidth||0);if(i===r.ViewportHeight)return Math.max(document.documentElement.clientHeight||0,window.innerHeight||0);f=0;o=null;switch(i){case r.CurrentUserStr:case r.CurrentUserUserName:f=0;break;case r.CurrentUserEmail:f=2;break;case r.CurrentUserFullName:f=1;break;case r.CurrentUserRole:f=3;break;case r.CurrentUserOrganizationSuperior:f=6;break;default:s=i.length;o=i.substr(r.CurrentUserPrefix.length,s-r.CurrentUserPrefix.length-1);f=7}return t.getUserInfo({PropertyType:f,UserProperty:o})},r._keyWordsObj=new r,r.Null="%Null%",r.CurrentUserStr="%CurrentUser%",r.CurrentUserPrefix="%CurrentUser.",r.CurrentUserEmail="%CurrentUser.Email%",r.CurrentUserFullName="%CurrentUser.FullName%",r.CurrentUserRole="%CurrentUser.Role%",r.CurrentUserUserName="%CurrentUser.UserName%",r.CurrentUserOrganizationSuperior="%CurrentUser.OrganizationSuperior%",r.PageName="%PageName%",r.PageTitle="%PageTitle%",r.ViewportWidth="%ViewportWidth%",r.ViewportHeight="%ViewportHeight%",r.ActiveLanguage="%ActiveLanguage%",r}(n.EventClassBase);n.KeyWords=r;t=function(){function t(){}return t.getUserInfo=function(i){var r=n.ForguncyData.userInfo,u;switch(i.PropertyType){case 2:return r.Email;case 1:return r.FullName;case 6:return r.OrganizationSuperior;case 3:return r.Role;case 0:return r.UserName;case 4:return t.getCustomPropertyValue(i.UserProperty).Value;case 5:return t.getOrganizationLevelValue(i.UserProperty);case 7:return u=t.getCustomPropertyValue(i.UserProperty),u.Find?u.Value:t.getOrganizationLevelValue(i.UserProperty);default:return null}},t.getCustomPropertyValue=function(t){var i=n.ForguncyData.userInfo,r,u;if(i.GetCustomPropertyValue)return i.GetCustomPropertyValue(t);if(i.Properties)for(r=0;r<i.Properties.length;r++)if(u=i.Properties[r],u.PropertyName===t)return{Find:!0,Value:u.Value};return{Find:!1,Value:null}},t.isOrganizationLevel=function(t){var r=n.ForguncyData.userInfo,i,u;if(r.OrganizationLevelValues)for(i=0;i<r.OrganizationLevelValues.length;i++)if(u=r.OrganizationLevelValues[i],u.OrganizationLevelName===t)return!0;return!1},t.getOrganizationLevelValue=function(t){var r=n.ForguncyData.userInfo,i,u;if(r.OrganizationLevelValues)for(i=0;i<r.OrganizationLevelValues.length;i++)if(u=r.OrganizationLevelValues[i],u.OrganizationLevelName===t)return u.Value;return null},t.getUserPropertyValue=function(t,i){if(t.Properties){var r=n.ArrayHelper.firstOrDefault(t.Properties,function(t){return n.Common.IsEmpty(i)||n.Common.IsEmpty(t.PropertyName)?!1:t.PropertyName.toLowerCase()===i.toLowerCase()});return r?r.Value:""}return""},t}();n.UserInfoHelper=t})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var t=function(){function t(){}return t.isValidCompressImageExtension=function(t){if(typeof t!="string"||n.Common.IsEmpty(t))return!1;var i=t.substr(t.lastIndexOf(".")+1).toLowerCase();return i==="gif"?!1:!0},t.getCompressedImageFormData=function(n,t,i){var f=this,r=document.createElement("img"),u,e;r.src=n.src;u=document.createElement("canvas");e=u.getContext("2d");r.onerror=function(n){i(n)};r.onload=function(){var o,i,h,s;if(n.width=r.width,n.height=r.height,n.width<=n.maxWidth&&n.height<=n.maxHeight){o=new FormData;o.append("file",n.file);o.append("uploadLimitId",n.uploadLimitId);t(o);return}i=f.getCompressImageSize(n);u.width=i.width;u.height=i.height;e.drawImage(r,0,0,i.width,i.height);h=u.toDataURL(n.file.type);s=new FormData;s.append("file",f.convertBase64ToFile(h),n.file.name);s.append("uploadLimitId",n.uploadLimitId);t(s)}},t.getCompressImageSize=function(t){return n.Common.IsEmpty(t.maxWidth)||n.Common.IsEmpty(t.maxHeight)?t:(t.width>t.maxWidth&&(t.height=t.height*(t.maxWidth/t.width),t.width=t.maxWidth),t.height>t.maxHeight&&(t.width=t.width*(t.maxHeight/t.height),t.height=t.maxHeight),t)},t.convertBase64ToFile=function(n){for(var i=n.split(","),f=i[0].match(/:(.*?);/)[1],r=atob(i[1]),t=r.length,u=new Uint8Array(t);t--;)u[t]=r.charCodeAt(t);return new Blob([u],{type:f})},t}();n.ImageCompressHelper=t})(Forguncy||(Forguncy={}))
;var __spreadArray=this&&this.__spreadArray||function(n,t,i){if(i||arguments.length===2)for(var r=0,f=t.length,u;r<f;r++)!u&&r in t||(u||(u=Array.prototype.slice.call(t,0,r)),u[r]=t[r]);return n.concat(u||Array.prototype.slice.call(t))},Forguncy;(function(n){var t,f,i,e,o,r,u,s,h,c;typeof String.prototype.endsWith!="function"&&(String.prototype.endsWith=function(n){return this.indexOf(n,this.length-n.length)!==-1});t=jQuery;f=function(){function n(){}return n.dateTimeDefaultFormattingString="yyyy/M/d h:mm:ss",n.timeDefaultFormattingString="h:mm; @",n}();n.StaticFormatString=f;i=function(){function i(){}return i.isForguncyFile=function(n){return/^[0-9a-f]{8}-?[0-9a-f]{4}-?[1-5][0-9a-f]{3}-?[89ab][0-9a-f]{3}-?[0-9a-f]{12}_.+$/i.test(n)},i.enumAllCommandsMetaData=function(n){var t=[],r,u,o,f,e,s;if(n)for(r=0;r<n.length;r++){if(u=n[r],u.$type==="Forguncy.Model.ConditionCommand, ServerDesignerCommon"&&(o=u,f=o.ConditionAndCommandPairList,f))for(e=0;e<f.length;e++)s=i.enumAllCommandsMetaData(f[e].CommandList),t=t.concat(s);t.push(u)}return t},i.isBindingInfoEquals=function(n,t){return i.IsEmpty(n)||i.IsEmpty(t)?!1:n.TableName===t.TableName&&n.ColumnName===t.ColumnName&&(i.IsEmpty(n.AttachType)&&i.IsEmpty(t.AttachType)||JSON.stringify(n.AttachType)===JSON.stringify(t.AttachType))&&this.isRelationBindinInfoEquals(n.RelationBinding,t.RelationBinding)},i.isRelationBindinInfoEquals=function(n,t){return i.IsEmpty(n)&&i.IsEmpty(t)?!0:i.IsEmpty(n)||i.IsEmpty(t)?!1:n.RelatedTable===t.RelatedTable&&n.RelatedColumn===t.RelatedColumn&&n.DisplayColumn===t.DisplayColumn&&this.isRelationBindinInfoEquals(n.NextRelationBinding,t.NextRelationBinding)},i.needShowNoItemImage=function(n,t){return t<=0&&n&&(!!n.ImageForNoItem||!!n.TextForNoItem)},i.updateNoItemSettingToDom=function(i,r,u,f,e,o,s,h,c,l){var p,a,y,b,w,v;return h||(a=n.DomUtilities.createJqueryDomElement("label"),y=t('<div class="listview-nodata-indicator"><\/div>'),s?(b=s.Value,s.Value=e,y=n.CellDomCreateHelper.createTextElement(s,a,u),w=y.children()[0],w&&(w.style.height="unset"),n.DomUtilities.setPropertyToDom(s,y,u,[0]),s.Value=b):(a.text(e),y.append(a)),a.attr("id",f),a.attr("name",f),a.addClass("repeater-no-item-label"),a.css("-webkit-user-select","initial"),a.css("overflow-wrap","break-word"),a.css("word-break","break-all"),a.css("white-space","pre-wrap"),l&&a.css("color",n.ColorHelper.Convert(l)),v=n.ImageDataHelper.CreateImage(i.ImageForNoItem,i.NoItemImageSize,function(n){n.removeClass("fgc-container-absolute")}),v&&(v.insertBefore(a),v.css("display","inline-block"),v.css("flex-shrink","0"),a.css("display","inline-block"),i.Orientation===1?(t(document.createElement("br")).insertBefore(a),v.css("margin-bottom",5),v.css("margin-left",a.css("padding-left"))):(v.css("margin-right",5),a.css("vertical-align","middle")),l&&((p=i===null||i===void 0?void 0:i.ImageForNoItem)===null||p===void 0?void 0:p.UseCellTypeForeColor)&&v.css("color",n.ColorHelper.Convert(l))),y.attr("id",o+"_NoItem"),y.css("padding",20),h=y),r.append(h),h===null||h===void 0?void 0:h.css("display","flex"),h===null||h===void 0?void 0:h.css("justify-content","center"),h===null||h===void 0?void 0:h.css("align-items","center"),h===null||h===void 0?void 0:h.css("flex-direction",i.Orientation===1?"column":"row"),c===null||c===void 0?void 0:c.css("display","none"),{_noItemPart:h,_itemsPart:c}},i.cannotEditedBindingInfo=function(t){return!t||!t.ColumnName||!t.TableName||t.RelationBinding?!0:t.AttachType?!0:n.GUIDColumnName.toArray().indexOf(t.ColumnName)!==-1?!0:!1},i.getMousePosition=function(n){return n.pageX||n.pageY?{x:n.pageX,y:n.pageY}:{x:n.clientX+document.body.scrollLeft-document.body.clientLeft,y:n.clientY+document.body.scrollTop-document.body.clientTop}},i.GetUrlQuery=function(n){for(var r=window.location.search.substring(1),i=r.split("&"),t=0;t<i.length;t++)if(i[t].indexOf(n)===0)try{return decodeURIComponent(i[t].substring(n.length+1))}catch(u){return null}},i.getIdStr=function(n,t,i){return"r"+n+"c"+t+i},i.parseIDStr=function(n){var t,u,f,r,e;if(!i.IsEmpty(n)&&(t=n.substring(1),u=t.indexOf("c"),!(u<0))&&(f=Number(t.substring(0,u)),!isNaN(f))){for(r=u+1;r<t.length;r++)if(t[r]>"9"||t[r]<"0")break;if(e=Number(t.substring(u+1,r)),!isNaN(e))return{suffix:t.substring(r),row:f,col:e}}},i.back=function(){history.go(n.ForguncyData.enterHistoryCount-history.length-1)},i.openWindow=function(t){var i=window.open(t);!i&&(n.Platform.isMobile()||n.Platform.isIpad())&&(window.location.href=t)},i.trimStr=function(n){var t,i;if(typeof n!="string"||n.length===0)return n;if(n.trim)return n.trim();for(t=0;t<n.length;t++)if(n[t]!==" ")break;for(i=n.length-1;i>=0;)if(n[i]!==" ")break;else i--;return t<n.length&&i>=0&&t<i?n.substring(t,i):""},i.JsonUrlSwitch=function(n){for(var r,u,f,t,i="",e=0;e<n.length;e++){for(r=n[e],u=!1,f=0;f<this.JsonUrlSwitchKeyWords.length;f++)if(t=this.JsonUrlSwitchKeyWords[f],r===t[0]){i+=t[1];u=!0;break}else if(r===t[1]){i+=t[0];u=!0;break}u||(i+=r)}return i},i.getPageContext=function(){var t=n.Common.GetUrlQuery("pageContext"),r,f,u;return(i.IsEmpty(t)&&(n.SessionStorageManager.isInIframe||(t=n.SessionStorageManager.pageContext)),t)?(t=this.JsonUrlSwitch(t),JSON.parse(t,i.dateReviver)):(r=n.Common.GetUrlQuery("currentRowInfoList"),r)?(r=decodeURIComponent(r),f=JSON.parse(r),u={},u.currentRowInfoList=f,u.loadBindingDataOption=1,u):null},i.dateReviver=function(n,t){var i;return typeof t=="string"&&(i=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)Z$/.exec(t),i)?new Date(Date.UTC(+i[1],+i[2]-1,+i[3],+i[4],+i[5],+i[6])):t},i.format=function(n){for(var u,t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return t=t.map(function(n){return i.IsEmpty(n)?"":n}),t.length===0?n:t.length===1&&typeof t[0]=="object"?(u=/{([^{}]+)}/gm,n.replace(u,function(n,i){return t[0][i]})):(u=/{(\d+)}/gm,n.replace(u,function(n,i){return t[~~i]}))},i.formatResource=function(t,r){return n.ForguncyData.GlobalSettings.MultipleLanguageSettings.EnableMultipleLanguage?i.IsEmpty(t)?t:i.format.apply(i,__spreadArray([t],r,!1)):t},i.initalTimeStamp=function(){return n.ForguncyData.timeStamp=i.getUniqueNumber(),i.postOrder={},n.Common.getTimeStamp()},i.checkTimeStamp=function(t){return t===n.ForguncyData.timeStamp?!0:!1},i.getTimeStamp=function(){return n.ForguncyData.timeStamp},i.forguncyGET=function(r,u,f){var s=n.Common.getTimeStamp(),o,e;return r=encodeURI(n.ForguncyData.ForguncyRoot+r),o=i.getUniqueNumber(),f&&(i.postOrder[f]=o),e=this.createAjaxSettingGET(r),e.success=function(t,r,e){f&&i.postOrder[f]!==o||n.Common.checkTimeStamp(s)&&(u===null||u===void 0?void 0:u(t,r,e))},e.error=function(t){n.MetadataLoader.loggedError(r,t)},t.ajax(r,e)},i.forguncyPost=function(r,u,f,e,o,s,h){var l,a,p=n.Common.getTimeStamp(),v,y,c;return r=encodeURI(n.ForguncyData.ForguncyRoot+r),v=i.getUniqueNumber(),e&&(i.postOrder[e]=v),((a=(l=n.ForguncyData===null||n.ForguncyData===void 0?void 0:n.ForguncyData.GlobalSettings)===null||l===void 0?void 0:l.MultipleLanguageSettings)===null||a===void 0?void 0:a.EnableMultipleLanguage)&&(y=localStorage.getItem(n.Resource.ActiveLanguageKey),y&&(h=h!==null&&h!==void 0?h:{},h["Fgc-Lang"]=i.toBase64(y))),n.ForguncyData.isDebugMode()&&(h=h!==null&&h!==void 0?h:{},h.AcceptWrapResponse="True"),c=this.createAjaxSetting(r,u,h),c.success=function(t,r,u){if(e&&i.postOrder[e]!==v){s===null||s===void 0?void 0:s(t,r,u);return}if(!n.Common.checkTimeStamp(p)){s===null||s===void 0?void 0:s(t,r,u);return}t&&t.Fgc_WrapResponse&&(t=t.ResponseResult);f===null||f===void 0?void 0:f(t,r,u)},c.error=function(t,u,f){if(u==="parsererror"&&n.ForguncyData.isDebugMode()){var e=i.format(n.RS.RequestAPIException,r+","+u+","+f),s=n.RS.RequestAPIParsererror;console.warn("%c"+e+" %c"+s,"color:red;font-weight:600","color:black;");n.ForguncyData.pageInfo.dataModel.debugWarningInfoDataModel.push({message:"".concat(e).concat(s)})}o===null||o===void 0?void 0:o(t,u,f);n.MetadataLoader.loggedError(r,t)},t.ajax(r,c)},i.forguncyGETAsync=function(r,u){var o=n.Common.getTimeStamp(),e,f;return r=encodeURI(n.ForguncyData.ForguncyRoot+r),e=i.getUniqueNumber(),u&&(i.postOrder[u]=e),f=this.createAjaxSettingGET(r),new Promise(function(s,h){f.success=function(t){u&&i.postOrder[u]!==e||n.Common.checkTimeStamp(o)&&s(t)};f.error=function(t,i){var u;n.MetadataLoader.loggedError(r,t);h((u=t.responseText)!==null&&u!==void 0?u:i)};t.ajax(r,f)})},i.forguncyPOSTAsync=function(r,u,f){var s=n.Common.getTimeStamp(),o,e;return r=encodeURI(n.ForguncyData.ForguncyRoot+r),o=i.getUniqueNumber(),f&&(i.postOrder[f]=o),e=this.createAjaxSetting(r,u),new Promise(function(u,h){e.success=function(t){f&&i.postOrder[f]!==o||n.Common.checkTimeStamp(s)&&u(t)};e.error=function(t,i){var u;n.MetadataLoader.loggedError(r,t);h((u=t.responseText)!==null&&u!==void 0?u:i)};t.ajax(r,e)})},i.adjustDate=function(n){if(n instanceof Date)return u.adjustDateWith485Timezone(n);if(!i.IsEmpty(n)&&typeof n=="object")for(var t in n)n[t]=this.adjustDate(n[t]);return n},i.createAjaxSetting=function(t,r,u){var e=this,f={};return f.type="POST",f.url=t,i.IsEmpty(r)||(r=i.adjustDate(r),typeof r=="object"&&t&&t.toLowerCase().indexOf("customapi")<0?(f.contentType="application/json",f.data=JSON.stringify(r)):f.data=r),f.beforeSend=function(t,i){e.addProcessHeader(t,i);n.TraceContextHelper.instance.addContextToAjaxInstance(t)},f.headers=u,f},i.addProcessHeader=function(t){var u,f=(u=n.ForguncyData.pageInfo)===null||u===void 0?void 0:u.currentRowInfoCollection,i,r;f&&(i=f.getTaskId(),i&&t.setRequestHeader("fgc-task-id",i.toString()),r=f.getProcessInstanceId(),r&&t.setRequestHeader("fgc-process-instance-id",r.toString()),(i||r)&&t.setRequestHeader("fgc-ignore-row-permission","true"))},i.createAjaxSettingGET=function(t){var r=this,i={};return i.type="GET",i.url=t,i.beforeSend=function(t,i){r.addProcessHeader(t,i);n.TraceContextHelper.instance.addContextToAjaxInstance(t)},i},i.forguncyPostSync=function(i,r,u,f){var e;return f===void 0&&(f=null),i=encodeURI(n.ForguncyData.ForguncyRoot+i),e=this.createAjaxSetting(i,r),e.success=function(n,t,i){n&&n.Fgc_WrapResponse&&(n=n.ResponseResult);u===null||u===void 0?void 0:u(n,t,i)},e.error=function(t){n.MetadataLoader.loggedError(i,t);f&&f()},e.async=!1,t.ajax(i,e)},i.getColumnIndex=function(n,t){if(i.IsEmpty(n))return-1;var r=i.getColumnIndexByColumnName(n,t);return r===-1&&n[0]==="="&&(r=i.getColumnIndexByFormula(n,t)),r},i.getColumnIndexByColumnName=function(n,t){return t.getColIndexOfNamedColumn(n,!1)},i.getColumnIndexByFormula=function(n,t){var f=i.parseCellReferenceFormulaToCellLocation(n),u,r;return!f||f.length<=0?-1:(u=t.getContentRangeInfo(),r=f[0].Column-u.Column,(r<0||r>=u.Column+u.ColumnCount)&&(r=-1),r)},i.typeContains=function(n,t){if(n){var i=n.$type;return typeof i=="string"&&i.indexOf(t)!==-1}return!1},i.updateFile=function(r,u,f,e,o,s,h,c){o===void 0&&(o=null);s===void 0&&(s=null);h===void 0&&(h=null);c===void 0&&(c=!1);var a=u&&(!o||o.MaxUploadFileCount!==1)?"multiple":"",l=t("#FGC_UploadFile_Input");l.length>0&&l.remove();l=t("<input type='file' name='file' ' id='FGC_UploadFile_Input' "+a+"><\/input>");n.Platform.isAndroid()&&n.Platform.isWeChatOrQQBrowser()&&(r=null);l.attr("accept",r);l.hide();l.appendTo("body");c&&l.attr(n.StaticValues.isInListview,!0);l.on("change",function(){var r,u,t,c;if(l.val())for(r=l[0],u=r.files.length,t=0;t<u;t++)h&&h(u,t),c=r.files[t],c.size===0?e(n.RS.cantAddEmptyFile):i.uploadFileByHTML5(c,function(n){f(n)},e,o,s)});n.ForguncyData.IsAutoTest||l.trigger("click")},i.uploadImageByFileSelector=function(i,r,u,f,e,o,s){var c=this,h;s===void 0&&(s=!1);h=t("#FGC_UploadImage_Input");h.length>0&&h.remove();h=t("<input type='file' name='file' accept='image/*' id='FGC_UploadImage_Input'><\/input>");h.hide();h.appendTo("body");s&&h.attr(n.StaticValues.isInListview,!0);h.on("change",function(){var n,t,s,l;if(h.val()){if(n=h[0],t=n.files.length,t===0)return;if(s=n.files[t-1],l=c.checkFileExtension(i===null||i===void 0?void 0:i.AllowExtensions,s.name,function(n){alert(n)}),!l)return;c.uploadImageToServer(s,i,r,u,e,o,f)}});n.ForguncyData.IsAutoTest||h.trigger("click")},i.uploadImageToServer=function(t,r,u,f,e,o,s){s===void 0&&(s=null);u=u!==null&&u!==void 0?u:".art, .bmp, .cmx, .cod, .dib, .gif, .ico, .ief, .jfif, .jpe, .jpeg, .jpg, .pbm, .pgm, .png, .pnm, .pnz, .ppm, .ras, .rf, .rgb, .svg, .tif, .tiff, .wbmp, .xbm, .xpm, .xwd";var h=this.checkFileExtension(u,t.name,function(n){e(n)});if(h){if(t.size===0){e(n.RS.cantAddEmptyFile);return}o&&o();!i.IsEmpty(r)&&r.IsCompressImage&&n.ImageCompressHelper.isValidCompressImageExtension(t.name)?EXIF.getData(t,function(){EXIF.getAllTags(this);var o=EXIF.getTag(this,"Orientation"),u=new FileReader;u.onload=function(){var u={src:this.result,file:t,maxWidth:r.MaxWidth,maxHeight:r.MaxHeight,orientation:o,uploadLimitId:s};n.ImageCompressHelper.getCompressedImageFormData(u,function(n){i.uploadFileWithAjax(i.uploadImageUrl,n,f,e)},function(){i.uploadFileDirectly(t,f,e,s)})};u.readAsDataURL(t)}):i.uploadFileDirectly(t,f,e,s)}},i.uploadFileDirectly=function(n,t,r,u){u===void 0&&(u=null);var f=new FormData;f.append("file",n);f.append("uploadLimitId",u);i.uploadFileWithAjax(i.uploadImageUrl,f,t,r)},i.uploadFileByHTML5=function(t,r,u,f,e){var s,o;if(f===void 0&&(f=null),e===void 0&&(e=null),f){if(s=this.checkFileExtension(f.ExtensionFilter,t.name,u),!s)return;if(f.SizeLimit&&f.SizeLimit*1048576<t.size){u(i.format(n.RS.uploadFileBiggerThanMaxSize,t.name,f.SizeLimit));return}}o=new FormData;o.append("file",t);o.append("uploadLimitId",e);i.uploadFileWithAjax(i.uploadUrl,o,r,u)},i.checkFileExtension=function(t,r,u){var e,o,f,s;if(t){for(e=t.split(","),o=!1,f=0;f<e.length;f++)if(s=e[f].trim().toLowerCase(),s!==""&&r.trim().toLowerCase().endsWith(s)){o=!0;break}if(!o)return u(i.format(n.RS.uploadFileNotMatchExtension,r)),!1}return!0},i.uploadFileWithAjax=function(n,i,r,u){t.ajax({url:n,type:"POST",success:function(n,t,i){r&&r(i.responseText)},error:function(n,t,i){u&&u(i,n)},data:i,cache:!1,contentType:!1,processData:!1,headers:{Accept:"application/json"}})},i.getiframeDocument=function(n){var i=n[0],t=i.contentWindow||i.contentDocument;return t.document&&(t=t.document),t},i.clone=function(n){var i,r,t,u;if(n===null||typeof n!="object")return n;if(n instanceof Array){for(i=[],t=0;t<n.length;t++)i[t]=this.clone(n[t]);return i}if(n instanceof Date)return new Date(n.getTime());if(n instanceof GC.Spread.CalcEngine.CalcError)return new GC.Spread.CalcEngine.CalcError(n.toString());r={};for(t in n)(u=n[t],typeof u!="function")&&(r[t]=this.clone(u));return r},i.getPageConver=function(t,i){var r=n.Common.getCover(t,i);return r.addClass("fgc-page-cover"),r},i.getCover=function(i,r){var u=t('<div style="filter:alpha(opacity:1);"/>');return u.css("background",n.ColorHelper.Convert(i)),u.css("opacity",r),u.addClass("disableSelect"),u},i.equals=function(n,t){return n===t?!0:n instanceof Date&&t instanceof Date?n.valueOf()===t.valueOf():!1},i.getA1ReferenceString=function(t,i,r,u){return n.FormulaHelper.unparse(n.FormulaHelper.createCellExpression(null,null,t,i,r,u))},i.parseCellReferenceFormulaToCellLocation=function(t){var u,h,c,i,r,o,s,l;if(!t)return[];var f=[],e=t.split(","),a=e.length;for(u=0;u<a;u++)if(h=void 0,c=e[u].indexOf("!"),h=c>0?e[u].split("!")[1]:e[u],i=n.FormulaHelper.parse(h),i.type===GC.Spread.CalcEngine.ExpressionType.reference)if(r=i.getRange(0,0),n.FormulaHelper.isCellExpression(i))f.push({Row:r.row,Column:r.col,ColumnRelative:i.columnRelative,RowRelative:i.rowRelative});else for(o=r.row;o<r.row+r.rowCount;o++)for(s=r.col;s<r.col+r.colCount;s++)f.push({Row:o,Column:s,ColumnRelative:i.columnRelative,RowRelative:i.rowRelative});else i.type===GC.Spread.CalcEngine.ExpressionType.name&&(l=i,f.push({Name:l.value}));return f},i.returnArrayFormulaItems=function(t){if(i.IsEmpty(t))return null;try{var r=n.FormulaHelper.parse(t);return r.type===GC.Spread.CalcEngine.ExpressionType.array?r.value.array[0]:null}catch(u){return null}},i.parseCellReferenceFormula=function(t,i){for(var u,f=n.Common.parseCellReferenceFormulaToCellLocation(t),e=[],o=f.length,r=0;r<o;r++)u=f[r],e.push(n.Common.getIdStr(u.Row,u.Column,i));return e},i.IsEmpty=function(n){return n===null||n===""||n===undefined?!0:!1},i.isObjEmpty=function(n){if(typeof n!="object")return!1;for(var t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0},i.IsString=function(n){return typeof n=="string"?!0:!1},i.deepEqual=function(n,t){if(n===t)return!0;if(typeof n=="object"&&n!==null&&typeof t=="object"&&t!==null){if(Object.keys(n).length!==Object.keys(t).length)return!1;for(var r in n)if(t.hasOwnProperty(r)){if(!i.deepEqual(n[r],t[r]))return!1}else return!1;return!0}return!1},i.getLocatedListview=function(t,i,r){var u=n.ListviewBase.getAllListviews([t]).filter(function(n){var t=n.getContentRangeInfo();return i>=t.Row&&i<t.Row+t.RowCount&&r>=t.Column&&r<t.Column+t.ColumnCount});return u.length>0?u[0]:null},i.AdjustCellRange=function(n){typeof n.Row=="undefined"&&(n.Row=0);typeof n.Column=="undefined"&&(n.Column=0);typeof n.RowCount=="undefined"&&(n.RowCount=0);typeof n.ColumnCount=="undefined"&&(n.ColumnCount=0)},i.GetLastBindingInfoColumnName=function(n){if(!n)return null;var t=n.RelationBinding;if(i.IsEmpty(t))return n.ColumnName;while(!i.IsEmpty(t.NextRelationBinding))t=t.NextRelationBinding;return t.DisplayColumn},i.rgbToHex=function(n,t,i){return"#"+(16777216+(n<<16)+(t<<8)+i).toString(16).slice(1)},i.hexToRgb=function(n){var t;return n=n.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(n,t,i,r){return t+t+i+i+r+r}),t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n),t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null},i.isEquals=function(n,t){return i.IsEmpty(n)||i.IsEmpty(t)?i.IsEmpty(n)&&i.IsEmpty(t):n===!0&&(t===1||t==="1")||t===!0&&(n===1||n==="1")||n===!1&&(t===0||t==="0")||t===!1&&(n===0||n==="0")?!1:i.isFuzzyEquals(n,t)},i.isFuzzyEquals=function(n,t){return n==t},i.isQueryEqual=function(t,r){if(n.Common.IsEmpty(t)||n.Common.IsEmpty(r))return!1;try{for(var u in t)if(!i.isFuzzyEquals(t[u],r[u]))return!1}catch(f){return!1}return!0},i.getUniqueNumber=function(){return(new Date).valueOf()},i.isValidateTime=function(n){return/^(?:[01]\d|2[0-3]):[0-5]\d(:[0-5]\d(\.\d{3})?)?$/.test(n)?!0:!1},i.isProcessView=function(n){return n==="ACT_RU_TASK_View"||n==="ACT_HI_TASKINST_View"||n==="ACT_HI_PROCINST_View"},i.isPageContainsTableBinding=function(t,i){if(n.ForguncyData.PageBindingTables){var r=n.ForguncyData.PageBindingTables[t];if(r&&r.length>0)return r.indexOf(i)>=0}return!1},i.htmlEncode=function(n){var t=document.createElement("div"),i=document.createTextNode(n);return t.appendChild(i),t.innerHTML},i.download=function(t,i){try{n.PageBuilder.isDownloading=!0;var r=document.createElement("a");i&&r.setAttribute("download",i);r.href=t;document.body.appendChild(r);r.click();document.body.removeChild(r)}finally{n.PageBuilder.isDownloading=!1}},i.getElementContentSize=function(n){var t=n.clone(),i;return t.css("display","inline"),t.appendTo("body"),i={width:t.width(),height:t.height()},t.remove(),i},i.isBuiltInDataBaseView=function(t){return n.ForguncyData.GlobalSettings.ViewInfoList.some(function(n){return n.ViewName===t&&n.IsBuiltin})},i.isView=function(t){return n.ForguncyData.GlobalSettings.ViewInfoList.some(function(n){return n.ViewName===t})},i.openTab=function(t){var r=n.PageManager.getContainerCell(t),u;r&&(r.cellType instanceof n.TabControlCellType&&(u=r.cellType,u.showTab(u.getTabIndex(t))),i.openTab(r.runTimePageName))},i.scrollToElement=function(n,t){i.openTab(t);var r=n.parents("#placeHolderDiv");r.length>0?(i._scrollPlaceHolderToElement(n,r),i._scrollWindowToElement(n)):i._scrollWindowToElement(n)},i._scrollWindowToElement=function(r){var c=t(window).width(),l=t(window).height(),u=r[0].getBoundingClientRect(),f=u.top<0||u.bottom>l,e=u.left<0||u.right>c;if(f||e){var o=r.offset(),s=f?o.top-i._scrollBufferDistance:undefined,h=e?o.left-i._scrollBufferDistance:undefined;n.DelayRefresh.NeedDelayRun?t("html, body").animate({scrollTop:s,scrollLeft:h},400):window.scrollTo({top:s,left:h})}},i._scrollPlaceHolderToElement=function(n,t){var f;if(t.css("overflow-x")==="auto"){var r=n.offset(),u=t.offset(),e=t.width(),o=r.left<u.left||r.left>=u.left+e;o&&(f=r.left+t.scrollLeft()-u.left-i._scrollBufferDistance,t.scrollLeft(f))}},i.operateODataPost=function(t,r,u,f,e,o){var l;e===void 0&&(e=!0);o===void 0&&(o=null);var h=r,c=function(n){n.Success?u&&(n.Data&&n.Data.$values?u(n.Data.$values):(n.Data===undefined&&(n.Data=null),u(n.Data))):f&&f(n.ErrorMessage)},s=null;f&&(s=function(n){f(n.responseText)});e?i.IsEmpty(o)?n.Common.forguncyPost(t,h,c,null,s):(l="GetOData:"+o,n.Common.forguncyPost(t,h,c,l,s)):n.Common.forguncyPostSync(t,h,c,s)},i.convertMetaDataDefaultValue=function(t,i){return t=n.KeyWords.GetKeyWordValue(t,i),t===undefined?null:t},i.getRunTimePageNameFromFormulaCalcContext=function(t){if(t)if(i.IsEmpty(t.PageID)){if(t.IsInMasterPage)return n.ForguncyData.pageInfo.runTimeMasterPage}else return t.PageID;return n.ForguncyData.pageInfo.runTimeNormalPage},i.remove=function(n,t){if(!n)return!1;var i=n.indexOf(t);return i>=0?(n.splice(i,1),!0):!1},i.setCookie=function(n){document.cookie=n},i.removeCookie=function(n){var t=new Date;t.setTime(t.getTime()-1);document.cookie=n+";expires="+t.toUTCString()},i.isShouldLoadMoreContent=function(n,t,i){var r=n.target.scrollTop,u=n.target.scrollHeight;return Math.ceil(r)+Math.ceil(t)+i>=u},i.generateID=function(n){return n===void 0&&(n=""),"".concat(n,"-").concat((new Date).getTime().toString(36),"-").concat(Math.random().toString(36).slice(2))},i.isMultiLanguageKeyWord=function(t){if(typeof t=="string"&&t.startsWith("'~"))return t.substring(1);if(typeof t=="string"&&t[0]==="~"){var i=t.substring(1);return n.Resource.PublicResource[i]}},i.getMultiLanguageWord=function(t,i){if(i===void 0&&(i=!0),!n.ForguncyData.GlobalSettings.MultipleLanguageSettings.EnableMultipleLanguage||!t)return t;var r;return r=i?this.isMultiLanguageKeyWord(t):n.Resource.PublicResource[t],r||t},i.toBase64=function(n){return btoa(encodeURIComponent(n).replace(/%([0-9A-F]{2})/g,function(n,t){return String.fromCharCode("0x"+t)}))},i.JsonUrlSwitchKeyWords=[["{","A"],['"',"B"],["[","C"],["}","D"],["]","E"],[":","F"],[",","G"],],i.postOrder={},i.uploadUrl=n.ForguncyData.ForguncyRoot+"FileDownloadUpload/Upload",i.uploadImageUrl=n.ForguncyData.ForguncyRoot+"FileDownloadUpload/UploadImage",i.getLowerCaseString=function(n){return n=String(n),n.toLowerCase()},i._scrollBufferDistance=100,i}();n.Common=i;e=function(){function t(){}return t.getMultipleLanguageFontFamily=function(){var t,r,i;return n.ForguncyData.GlobalSettings.MultipleLanguageSettings.EnableMultipleLanguage&&(r=localStorage.getItem(n.Resource.ActiveLanguageKey),i=(t=n.ForguncyData.GlobalSettings.MultipleLanguageSettings.Languages.find(function(n){return n.Name==r}))===null||t===void 0?void 0:t.FontFamily,i)?i:null},t}();n.MultipleLanguageHelper=e;o=function(){function n(){}return n.getBorderWidth=function(n){switch(n){case GC.Spread.Sheets.LineStyle.hair:case GC.Spread.Sheets.LineStyle.thin:case GC.Spread.Sheets.LineStyle.dashDot:case GC.Spread.Sheets.LineStyle.dashDotDot:case GC.Spread.Sheets.LineStyle.dashed:case GC.Spread.Sheets.LineStyle.dotted:return 1;case GC.Spread.Sheets.LineStyle.medium:case GC.Spread.Sheets.LineStyle.mediumDashDot:case GC.Spread.Sheets.LineStyle.mediumDashDotDot:case GC.Spread.Sheets.LineStyle.mediumDashed:case GC.Spread.Sheets.LineStyle.slantedDashDot:return 2;case GC.Spread.Sheets.LineStyle.thick:case GC.Spread.Sheets.LineStyle.double:return 3;default:return 0}},n}();n.SpreadJSHelper=o;r=function(){function t(){}return t.fromDateToOADate=function(t){return n.SpreadJSHelpMethods._DateTimeHelper.___toOADate(t)},t.fromOADateToDate=function(t){return n.SpreadJSHelpMethods._DateTimeHelper._fromOADate(t)},t}();n.Convertor=r;u=function(){function n(){}return n.getToday=function(){var n=new Date;return n.setHours(0),n.setMinutes(0),n.setSeconds(0),n.setMilliseconds(0),n},n.isValidDateValue=function(t){return this.isValidDate(t)?!0:typeof t=="number"?n.isValidDateValue(r.fromOADateToDate(t)):!1},n.isValidDate=function(n){return n instanceof Date&&!isNaN(n.valueOf())},n.adjustDateWith485Timezone=function(n){var t=n.getTimezoneOffset();return t===-485?r.fromDateToOADate(n):n},n}();n.DateHelper=u;s=function(){function t(){}return t.isFormatSetted=function(n){return!i.IsEmpty(n)&&n!=="General"},t.isDateOrTimeFormat=function(n){var f,i,r,e,o,s;if(!t.isFormatSetted(n))return!1;for(f=["#","?","E","%"],i=0,r=f;i<r.length;i++)if(e=r[i],n.indexOf(e)>=0)return!1;return o=new GC.Spread.Formatter.GeneralFormatter(n,null),s=o.parse("2020/1/30"),u.isValidDate(s)},t.isTimeFormat=function(n){var u,i,r,f;if(!t.isDateOrTimeFormat(n))return!1;for(u=["h","s",":","時","分","秒","时","시","분","초"],i=0,r=u;i<r.length;i++)if(f=r[i],n.indexOf(f)>=0)return!0;return!1},t.format=function(n,t){var r=new GC.Spread.Formatter.GeneralFormatter(n,null),i={},u=r.format(t,i);return{text:u,color:i.conditionalForeColor}},t.getValueFromText=function(n,t){if(t===void 0&&(t=null),typeof n!="string")return n;var i={value:null};try{new GC.Spread.Formatter.GeneralFormatter(t,null).getPreferredDisplayFormatter(n,i)}catch(r){return n}return i.value!==null?i.value:n},t.getTextFromValue=function(n,t){var r,u,f;return n instanceof Date?(r=new GC.Spread.Formatter.GeneralFormatter("",null),u=r.getPreferredEditingFormatter(n),n=u.format(n,{})):this.isPercentageFormat(t)&&!i.IsEmpty(n)&&(f=new GC.Spread.Formatter.GeneralFormatter(t,null),n=f.format(n,{})),i.IsEmpty(n)&&(n=""),n},t.isPercentageFormat=function(n){if(n&&n[n.length-1]==="%"){var t=n.substr(0,n.length-1);if(Number(t)===0)return!0}return!1},t.formatValue=function(t,r,u){if(n.Common.IsEmpty(t))return"";if(i.IsEmpty(r)&&t instanceof Date&&(r=n.StaticFormatString.dateTimeDefaultFormattingString),i.IsEmpty(r)||typeof r!="string")return t+"";var f=new GC.Spread.Formatter.GeneralFormatter(r,null);return f.format(t,u)},t}();n.FormatHelper=s;h=function(){function t(){}return t.printJavascriptAIPError=function(i,r,u){try{var f=n.Common.format(n.RS.ForguncyApiExceptionString,"ForguncyApiException",i,r,u);throw new Error(f);}catch(e){t.printError(e)}},t.printError=function(i){var f="",u,o,r;if(i instanceof Error){var h=n.ForguncyData.ForguncyRoot+"Resources/JS.js?v=",s=i.stack+"",e="\n";for(s.indexOf("\r\n")>=0&&(e="\r\n"),u=s.split(e),o=[],r=0;r<u.length;r++)u[r].indexOf(h)===-1&&o.push(u[r]);f=o.join(e)}else f=i+"";t.printErrorStr(f)},t.printErrorStr=function(n){console.error(n)},t}();n.ErrorHelper=h;c=function(){function t(){}return t.getHeight=function(n,t,i,r,u,f){return u===void 0&&(u="国"),f===void 0&&(f=1),this.getWidth(n,t,i,r,u)*f},t.getWidth=function(n,i,r,u,f){var h=t.getFontString(n,i,r,u),e=f+":"+h,c,o,s;return this._cachedSize[e]?this._cachedSize[e]:(this._cachedContext||(c=document.createElement("canvas"),this._cachedContext=c.getContext("2d")),o=this._cachedContext,o.font=h,s=o.measureText(f).width,this._cachedSize[e]=s,s)},t.getFontString=function(t,i,r,u){return[t?t:"normal",i?i:"normal",r+"px",u?u:n.LocaleFonts.default].join(" ")},t._cachedSize={},t}();n.MeasureHelper=c})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var t=function(){function t(){}return t.addCSSRules=function(t,i){t.forEach(function(t){n.CellTypeStyleTemplateUtils.AddCSSTextToDocument(t,i)})},t.getCssFontInfoFromCssFontString=function(n){var t=$("<span />"),i,r;return t.css("font",n),i=t.css("lineHeight"),r=t.css("fontVariant"),{fontStyle:t.css("fontStyle"),fontWeight:t.css("fontWeight"),fontSize:t.css("fontSize"),fontFamily:t.css("fontFamily"),lineHeight:i==="normal"?"":i,fontVariant:r==="normal"?"":r}},t.getCssFontStringFromCssFontInfo=function(n){var t="";return Object.keys(n).forEach(function(i){n[i]&&n[i].length&&(t+=n[i]+" ")}),t.trim()},t.getClassName=function(t){var s=Object.keys(t),u,f,h,e,o,i,r,c;if(s.length===0)return null;for(s.sort(),u={},f=0,h=s;f<h.length;f++)e=h[f],t[e]!==undefined&&(u[e]=t[e]);if(o=JSON.stringify(u),this._classCache[o])return this._classCache[o];i="";r="Fgc_"+this._index;this._index++;for(c in u)i+=this.convertCssPropertyName(c)+":"+t[c]+";";return i="."+r+"{"+i+"}",n.CellTypeStyleTemplateUtils.AddCSSTextToDocument(i,r),this._classCache[o]=r,r},t.convertCssPropertyName=function(n){var t,i,u,r,f,e;if(n.toLowerCase()===n)return n;if(this._cssPropertyNameCache[n])return this._cssPropertyNameCache[n];for(t=[],i=0,u=n;i<u.length;i++)r=u[i],f=r.toLowerCase(),f===r?t.push(r):t.push("-"+f);return e=t.join(""),this._cssPropertyNameCache[n]=e,e},t._classCache={},t._index=0,t._cssPropertyNameCache={},t}(),i;n.CSSHelper=t;i=function(){function i(){}return i.getClassName=function(r){var u,f;return n.Common.IsEmpty(r)?"":(u=i.classPrefix+r.toLowerCase(),this._addedClassList.indexOf(u)===-1&&(f="."+u+"{ color: "+r+" !important}",t.addCSSRules([f],u),this._addedClassList.push(u)),u)},i.classPrefix="useFormatColor_",i._addedClassList=["useFormatColor_red"],i}();n.FormatColorClassManager=i})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var t=function(){function t(){}return t.isRelationCondition=function(t){return!n.Common.IsEmpty(t.SubConditions)},t.enumAllConditions=function(n){var i,u,r,f,e;if(n){if(t.isRelationCondition(n)){if(i=[],u=n.SubConditions,u)for(r=0,f=u;r<f.length;r++)e=f[r],i=i.concat(t.enumAllConditions(e));return i}return[n]}return[]},t.getConditionResult=function(n,i,r){var u=t.handlingConditionValue(n,i,r);return t.executeConditionResult(u,r)},t.handlingConditionValue=function(i,r,u){var f,e,o,s;if(!i)return i;if(t.isRelationCondition(i))return{SubConditions:i.SubConditions.map(function(n){return t.handlingConditionValue(n,r,u)}),RelationType:i.RelationType};if(f=n.Common.clone(i),f.value=t.calcValue(f.value,r,u.needUnparseValue2(f)),f.value instanceof Date&&n.DateHelper.isValidDateValue(f.value)){if(e=f.value,t.isDateHaveTimePart(e))return f;if(o=null,s=null,f.compareType){if(f.compareType===1)return o=n.Common.clone(f),s=n.Common.clone(f),o.compareType=4,s.compareType=2,o.value=t.getFirstMomentOfDay(e),s.value=t.getLastMomentOfDay(e),{SubConditions:[o,s],RelationType:1};f.compareType===2?f.value=t.getLastMomentOfDay(e):f.compareType===3?f.value=t.getFirstMomentOfDay(e):f.compareType===4?f.value=t.getFirstMomentOfDay(e):f.compareType===5&&(f.value=t.getLastMomentOfDay(e))}else return o=n.Common.clone(f),s=n.Common.clone(f),o.compareType=3,s.compareType=5,o.value=t.getFirstMomentOfDay(e),s.value=t.getLastMomentOfDay(e),{SubConditions:[o,s],RelationType:0}}return f},t.calcValue=function(i,r,u){return n.Common.IsEmpty(i)?"":i===t.NullValueKeyWord?null:n.KeyWords.IsKeyWord(i)?n.KeyWords.GetKeyWordValue(i,r.runTimePageName):n.FormulaManager.shouldEvaluateFormula(i)?n.ForguncyData.pageInfo.formulaManager.evaluateFormula(i,r):u?n.FormatHelper.getValueFromText(i):i},t.isDateHaveTimePart=function(n){return n.getHours()!==0||n.getMinutes()!==0||n.getSeconds()!==0||n.getMilliseconds()!==0},t.getLastMomentOfDay=function(n){return new Date(n.getFullYear(),n.getMonth(),n.getDate(),23,59,59,999)},t.getFirstMomentOfDay=function(n){return new Date(n.getFullYear(),n.getMonth(),n.getDate(),0,0,0,0)},t.executeConditionResult=function(i,r){var o,h,s;if(i===null||i===undefined)return!0;if(t.isRelationCondition(i))return i.RelationType?i.SubConditions.some(function(n){return t.executeConditionResult(n,r)}):i.SubConditions.every(function(n){return t.executeConditionResult(n,r)});var u=i,f=u.value,e=r.calc(u);if(!u.compareType||u.compareType<6)return t.getNonStringCompareResult(e,u.compareType,f,r);if(u.compareType===12||u.compareType===13){if((f===null||f===undefined)&&(f=""),(e===null||e===undefined)&&(e=""),o=void 0,n.Common.IsString(f))for(o=!1,h=f.split(",").filter(function(t){return!n.Common.IsEmpty(t)}),s=0;s<h.length;s++)o=o||t.getNonStringCompareResult(e,0,h[s],r);else o=t.getNonStringCompareResult(e,0,f,r);return u.compareType===12?o:!o}return t.getStringCompareResult(e,u.compareType,f)},t.getStringCompareResult=function(n,t,i){var u,r,f,e;return((n===null||n===undefined)&&(n=""),(i===null||i===undefined)&&(i=""),u=n.toString(),r=i.toString(),t===6)?u.indexOf(r)===0:t===7?u.indexOf(r)!==0:t===8?(f=u.lastIndexOf(r),f>=0&&f+r.length===u.length):t===9?(f=u.lastIndexOf(r),!(f>=0&&f+r.length===u.length)):t===10?(f=u.lastIndexOf(r),f!==-1):t===11?(f=u.lastIndexOf(r),f===-1):t===14?(r=this.ReplaceRegexKeywords(r),e=new RegExp("^"+r.replaceAll("%","((.|\\n)*)").replaceAll("_",".")+"$","i"),e.exec(u)!==null):!1},t.ReplaceRegexKeywords=function(n){for(var r,t=0,i=this.REGEX_KEY_WORDS;t<i.length;t++)r=i[t],n=n.replaceAll(r,"\\"+r);return n},t.getNonStringCompareResult=function(i,r,u,f){if(typeof u=="number"&&typeof i=="string"&&!n.Common.IsEmpty(i)){var e=Number(i);isNaN(e)||(i=e)}if(i instanceof Date&&(i=n.Convertor.fromDateToOADate(i)),u instanceof Date&&(u=n.Convertor.fromDateToOADate(u)),i=n.FormulaHelper.adjustNumberPrecision(i),u=n.FormulaHelper.adjustNumberPrecision(u),r){if(r===1)return t.ExceptedValueAndParamValueEmptyEquals(u,i)?!1:!f.equals(i,u);if(r===2)return i>u;if(r===3)return i>=u;if(r===4)return i<u;if(r===5)return i<=u}else return t.ExceptedValueAndParamValueEmptyEquals(u,i)?!0:f.equals(i,u);return!1},t.getComputedSqlConditionFormula=function(i,r,u,f,e,o,s){if(f===void 0&&(f=0),e===void 0&&(e=0),o===void 0&&(o=null),s===void 0&&(s=!1),!i)return null;var c={runTimePageName:r,nullAsException:!0,listInfo:o,rowOffset:f,columnOffset:e,isCommand:s},h=n.Common.clone(i);return t.computeSqlConditionFormula(h,c,u),h},t.computeSqlConditionFormula=function(i,r,u){var e,f;if(typeof i=="undefined"||i===null)return null;e=i;e.SubConditions&&e.SubConditions.forEach(function(n){return t.computeSqlConditionFormula(n,r,u)});f=i;f.Value!==null&&(""+f.Value).search("=")===0&&(f.Value=n.ForguncyData.pageInfo.formulaManager.evaluateFormula(f.Value,r),n.Common.IsEmpty(f.Value)&&(u===n.NullFormulaValueQueryPolicy.EmptyDatas?f.Value="D212D897-53A6-4450-BBC3-9EB6523B527F":u===n.NullFormulaValueQueryPolicy.GetEmptyValueItems&&(f.Value="%Null%")))},t.NullValueKeyWord="%Null%",t.REGEX_KEY_WORDS=["\\","*",".","?","+","$","^","[","]","(",")","{","}","|","/","-"],t.ExceptedValueAndParamValueEmptyEquals=function(t,i){return n.Common.IsEmpty(t)&&n.Common.IsEmpty(i)?!0:!1},t}();n.ConditionHelper=t})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var t=function(){function t(n){this._func=n;this._refreshing=!1}return t.prototype.execute=function(){for(var i=this,r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];this._refreshing||(this._refreshing=!0,n.DelayOperateHelper.Push(null,function(){i._refreshing=!1;i._func.apply(i,r)},2))},t}(),i;n.Throttle=t;i=function(){function i(){}return i.listenFormulaRefChanged=function(t,r,u,f,e){var s=this,o;(f===void 0&&(f=!1),e===void 0&&(e=!1),t=t===null||t===void 0?void 0:t.filter(function(t){return!n.Common.IsEmpty(t)}),t&&t.length!==0)&&(t=t.map(function(n){return i.removeNowFunction(n)}),o=n.ForguncyData.pageInfo.formulaManager.getCalcSource(u),o?this.listenFormulaRefChangedInCalcSource(t,r,o,u,f):n.ForguncyData.pageInfo.formulaManager.addCalcSourceCreatedCallback(u,function(n){s.listenFormulaRefChangedInCalcSource(t,r,n,u,f,e)}))},i.removeNowFunction=function(t){return n.FormulaHelper.translateFormula(t,new n.ReplaceNowVisitor,0,0)},i.listenFormulaRefChangedInCalcSource=function(i,r,u,f,e,o){var l,s,h,c,a;if(o===void 0&&(o=!1),e&&r(!1),u instanceof n.PageCalcSource&&i.length>0)for(l=new t(r),s=n.PageManager.getUserControlCellType(f),h=0,c=i;h<c.length;h++)a=c[h],u.listenFormula(a,function(n,t){l.execute(t)},s===null||s===void 0?void 0:s.DefinedPropertyNames,undefined,o)},i}();n.DependenceCellValueChangeHelper=i})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var t=function(){function t(){}return t.register=function(t,i,r){r===void 0&&(r=!0);var u="opacity",e=t.css(u),s="0.5",f="background-color",o=t.css(f),h="gray";t.on("drop",function(){for(var s,l,c=event.dataTransfer.files,h=0;h<c.length;h++){if(s=c[h],s&&s.size===0){alert(n.RS.cantAddEmptyFile);continue}if(l=i(s),!l)break;if(!r)break}return t.css(u,e),t.css(f,o),!1});t.on("dragenter",function(){t.css(u,s);t.css(f,h)});t.on("dragleave",function(){t.css(u,e);t.css(f,o)});t.on("dragover",function(){return!1},!1)},t.unRegister=function(n){n.off("drop");n.off("dragenter");n.off("dragleave");n.off("dragover")},t}();n.DragFileToUploadHelper=t})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var t=null,i=function(){function i(){}return i.isChrome=function(){return!this.isOldEdge()&&navigator.userAgent.indexOf("Chrome/")!==-1},i.isOldEdge=function(){return navigator.userAgent.indexOf("Edge/")!==-1},i.isEdge=function(){return navigator.userAgent.indexOf("Edg/")!==-1},i.isIpad=function(){return navigator.userAgent.toLowerCase().indexOf("ipad")!==-1||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1},i.isIOSDevice=function(){return/iPad|iPhone|iPod/.test(navigator.platform)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1},i.isMac=function(){return new RegExp("Mac").test(navigator.userAgent)},i.isIE=function(){return!!window.ActiveXObject||"ActiveXObject"in window?!0:!1},i.isMobile=function(i){return(i===void 0&&(i=!1),!i&&n.ForguncyData.forceMobileChild)?!0:(t===null&&(t=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4))),t)},i.isAndroid=function(){var n=navigator.userAgent.toLowerCase();return n.indexOf("android")>-1||n.indexOf("adr")>-1},i.isQqBrowser=function(){var n=navigator.userAgent.toLowerCase();return n.indexOf("qqbrowser")>-1},i.isWechatBrowser=function(){var n=navigator.userAgent.toLowerCase();return n.indexOf("micromessenger")>-1},i.isWeChatOrQQBrowser=function(){var n=navigator.userAgent.toLowerCase();return n.indexOf("micromessenger")>-1||n.indexOf("qqbrowser")>-1},i}(),r;n.Platform=i;i.isAndroid()&&i.isQqBrowser()&&(r=String.prototype.localeCompare,String.prototype.localeCompare=function(n){return r.apply(this,[n])})})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var t=function(){function t(){}return t.init=function(){t._operationList=[]},t.Push=function(n,i,u){var f=new r,e;return f.obj=n,f.functions={f:i},e=t.getPriority(u),t._operationList[e]||(t._operationList[e]=[]),t._operationList[e].push(f),t.doOperation(),f},t.getPriority=function(n){return n===0?0:1},t.doOperation=function(){i.setTimeout(function(){var n,i;if(t.haveNoActiveAjaxCall())if(n=t.getNextOperation(),n){if(i=n.functions.f.apply(n.obj),i instanceof Promise){i.then(function(){t.doOperation()});return}}else return;t.doOperation()})},t.getNextOperation=function(){for(var n=t._operationList.length-1;n>=0;n--)if(t._operationList[n]&&t._operationList[n].length>0)return t._operationList[n].shift();return null},t.haveNoActiveAjaxCall=function(){return jQuery.active===0&&n.ModuleLoader.active===0},t}(),i,r;n.DelayOperateHelper=t;i=function(){function i(){}return i.Init=function(){i._refreshing=!1;i._objectMethods=[]},i.Push=function(n,t,r,u){var o,f,e;for(u===void 0&&(u=!1),o=!1,f=0;f<i._objectMethods.length;f++)if(i._objectMethods[f].obj===n){i._objectMethods[f].functions[r]=t;o=!0;break}o===!1&&(e={obj:n,functions:{}},e.functions[r]=t,u?i._objectMethods=[e].concat(i._objectMethods):i._objectMethods.push(e));i.Refresh()},i.Refresh=function(){i._refreshing||(i._refreshing=!0,i.DelayRun())},i.DelayRun=function(){if(!i.NeedDelayRun||i._isUnitTest){t.haveNoActiveAjaxCall()?i.RunNow():i.setTimeout(function(){i.DelayRun()},0);return}i.setTimeout(function(){t.haveNoActiveAjaxCall()?i.RunNow():i.DelayRun()},50)},i.DisableDelayRun=function(){i.NeedDelayRun=!1;i.DelayRun()},i.HasDelayRunItem=function(){return i._refreshing===!0||i._objectMethods&&i._objectMethods.length!==0},i.RunNow=function(){try{while(i.HasDelayRunItem())i.Run()}finally{i._refreshing=!1}},i.Run=function(){var r=i._objectMethods,n,t,u;for(i._objectMethods=[],i._refreshing=!1,n=0;n<r.length;n++){t=r[n];for(u in t.functions)t.functions[u].apply(t.obj)}},i.setTimeout=function(n,t){var r=setTimeout(function(){n();i._executingSetTimeouts.delete(r)},t);return i._executingSetTimeouts.add(r),r},i.clearTimeout=function(n){i._executingSetTimeouts.delete(n)&&clearTimeout(n)},i.HasExecutingSetTimeout=function(){return i._executingSetTimeouts.size>0||n.ModuleLoader.active>0||jQuery.active>0},i._objectMethods=[],i._refreshing=!1,i.NeedDelayRun=!0,i._isUnitTest=!1,i._executingSetTimeouts=new Set,i}();n.DelayRefresh=i;r=function(){function n(){}return n}();n.objectMethod=r})(Forguncy||(Forguncy={}))
;
;var Forguncy;(function(n){var i=function(){function n(){}return n.firstOrDefault=function(n,t){for(var i=0;i<n.length;i++)if(t(n[i]))return n[i];return null},n}(),t;n.ArrayHelper=i;t=function(){function n(n,t){var i,r;for(n===void 0&&(n=1),t===void 0&&(t=1),this.width=n,this.height=t,this.data=[],i=0;i<n;i++)for(this.data.push([]),r=0;r<t;r++)this.data[i][r]=undefined}return n.prototype.set=function(n,t,i){return this.data[n][t]=i,this.data[n][t]},n.prototype.get=function(n,t){var i;if((i=this.data[n])!==null&&i!==void 0)return i[t]},n.prototype.forEach=function(n){this.data.forEach(function(t,i){t&&t.forEach(function(t,r){n&&n(t,i,r)})})},n}();n.Array2=t})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var i=function(){function n(){}return n.Convert=function(n){var t;if(n&&this.ColorCache[n])return this.ColorCache[n];if(t=n,this.IsThemeColor(n)?t=this.GetThemeColor(n):this.IsGradient(n)&&(t=this.GetGradient(n)),t&&t.charAt(0)==="#"&&t.length===9)if(t.indexOf("#FF")===0)t="#"+t.substring(3);else{var i=parseInt(t.substring(1,3),16),r=parseInt(t.substring(3,5),16),u=parseInt(t.substring(5,7),16),f=parseInt(t.substring(7,9),16);t="rgba("+r+","+u+","+f+","+(i/255).toFixed(2)+")"}return n&&(this.ColorCache[n]=t),t},n.isTransparent=function(n){if(!n)return!1;if(n=n.toLowerCase(),n==="transparent"||n.length===9&&n.startsWith("#00"))return!0;if(n.startsWith("rgba(")||n.startsWith("hsla(")){var t=n.split(",");if(t.length===4&&t[3].length>1)return 0===Number.parseFloat(t[3].substring(0,t[3].length-1))}return!1},n.ConvertBorder=function(n){return this.ReplaceCombineCssColor(n)},n.ConvertShadow=function(n){return this.ReplaceCombineCssColor(n)},n.GetRGBNumberString=function(n){var t=this.stringToARGB(n);if(!t)return null;var i=t[0],r=t[1],u=t[2];return"".concat(i,",").concat(r,",").concat(u)},n.ReplaceCombineCssColor=function(t){return t.replace(/((Background|Text)_[12]|Accent_[123456])(_-?[\.\d]{1,3}(_\d{1,3})?)?|#[a-fA-F0-9]+/g,function(t){return n.Convert(t.replace(/_/g," "))})},n.IsGradient=function(n){return n?n.indexOf("linear-gradient")===0||n.indexOf("radial-gradient")===0:!1},n.GetGradient=function(n){return this.ReplaceCombineCssColor(n)},n.GetThemeColor=function(t){var r,i,u,f,e;return t?(r=-1,i=t.split(" "),i&&(i.length>1&&(i[0]==="Background"?(u=Number(i[1]),r=u-1):i[0]==="Text"?(u=Number(i[1]),r=u+1):i[0]==="Accent"&&(u=Number(i[1]),r=u+3)),f=0,i.length>2&&(f=Number(i[2])),e=255,i.length>3&&(e=Number(i[3])),r>-1))?n.UpdateTint(this.Convert(this.Colors[r]),f/100,e):"":""},n.UpdateTint=function(n,t,i){var u,r,e,h,f,o,s;return t===0&&i===255?n:(u="".concat(n," ").concat(t," ").concat(i),u&&this.ColorCache[u])?this.ColorCache[u]:(r=this._getHLSColor(n),t>0?(h=240-r._luminosity,f=h*t,e=r._luminosity+f):(f=r._luminosity*-t,e=r._luminosity-f),o=this._fromHLS(r._hue,e,r._saturation),o.a=i,s=this._toString(o),this.ColorCache[u]=s,s)},n.IsThemeColor=function(n){var t,i;if(!n)return!1;t=this.ThemeColorPrefix;for(i in t)if(n.indexOf(t[i])===0)return!0;return!1},n._toString=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];var i=n[0],r=i.a,u=i.r,f=i.g,e=i.b;return(n.length===3&&(r=255,u=n[0],f=n[1],e=n[2]),n.length===4&&(r=n[0],u=n[1],f=n[2],e=n[3]),r===255)?"#"+this._toHexString(u)+this._toHexString(f)+this._toHexString(e):"rgba("+u+","+f+","+e+","+r/255+")"},n._hueToRGB=function(n,t,i){return(i<0&&(i+=240),i>240&&(i-=240),i<40)?n+((t-n)*i+20)/40:i<120?t:i<160?n+((t-n)*(160-i)+20)/40:n},n.saturate=function(n,t,i){return Math.min(parseInt(((this._hueToRGB(n,t,i)*255+120)/240).toString()),255)},n._fromHLS=function(n,t,i){var f,e,o,r,u;return i===0?f=e=o=parseInt((t*255/240).toString(),10):(r=t<=120?parseInt(((t*(240+i)+120)/240).toString()):t+i-parseInt(((t*i+120)/240).toString()),u=2*t-r,f=this.saturate(u,r,n+80),e=this.saturate(u,r,n),o=this.saturate(u,r,n-80)),{a:255,r:f,g:e,b:o}},n.stringToARGB=function(n){var t=this._ctx,i,r;return(t||(i=document.createElement("canvas"),i&&i.getContext&&(t=this._ctx=i.getContext("2d",{willReadFrequently:!0}))),!t)?n:(t.clearRect(1,1,1,1),t.fillStyle=n,t.fillRect(1,1,1,1),r=t.getImageData(1,1,1,1),r)?r.data:null},n._fromString=function(n){var i=0,r=0,u=0,f=0,t;return n&&(t=this.stringToARGB(n),t&&(r=t[0],u=t[1],f=t[2],i=t[3])),{a:i,r:r,g:u,b:f}},n._getHLSColor=function(n){var i=this._fromString(n);return new t(i)},n._toHexString=function(n){var t=n.toString(16);return t.length%2&&(t="0"+t),t},n.Colors=["#FFFFFF","#000000","#EEECE1","#1F497D","#4F81BD","#C0504D","#9BBB59","#8064A2","#4BACC6","#F79646"],n.ThemeColorPrefix=["Background 1","Text 1","Background 2","Text 2","Accent 1","Accent 2","Accent 3","Accent 4","Accent 5","Accent 6"],n.ColorCache={},n}(),t;n.ColorHelper=i;t=function(){function n(n){var t=this,f=n.r,e=n.g,o=n.b,r=Math.max(Math.max(f,e),o),s=Math.min(Math.min(f,e),o),u=r+s,i;if(t._luminosity=parseInt(((u*240+255)/510).toString(),10),i=r-s,i===0)t._saturation=0,t._hue=160;else{t._saturation=t._luminosity<=120?parseInt(((i*240+u/2)/u).toString(),10):parseInt(((i*240+(510-u)/2)/(510-u)).toString(),10);var h=((r-f)*40+i/2)/i,c=((r-e)*40+i/2)/i,l=((r-o)*40+i/2)/i;t._hue=f===r?parseInt((l-c).toString(),10):e===r?parseInt((80+h-l).toString(),10):parseInt((160+c-h).toString(),10);t._hue<0&&(t._hue+=240);t._hue>240&&(t._hue-=240)}}return n}()})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var u=function(){function n(n){this.ruleArr=n}return n.prototype.FeedStyle=function(n,t){this.ruleArr.push("".concat(n,":").concat(t,";"))},n.prototype.Digest=function(){this.resultString="{ ".concat(this.ruleArr.join("")," }")},n.prototype.GetResultString=function(){return this.Digest(),this.resultString},n}(),r;n.NormalStyleFeeder=u;var i=function(){function n(n){this.Dom=n}return n.prototype.FeedStyle=function(n,t){this.Dom.css(n,t)},n.prototype.Digest=function(){},n}(),f=function(){function t(n,t,i){this.styleArr=t;this.className=i;this.Dom=n}return t.prototype.FeedStyle=function(n,t){this.styleArr.push("".concat(n,":").concat(t,";"))},t.prototype.Digest=function(){var t=".".concat(this.className," { ").concat(this.styleArr.join("")," }");n.CellTypeStyleTemplateUtils.AddCSSTextToDocument(t,this.className);this.Dom.addClass(this.className)},t}(),t=function(){function t(){}return t.setPropertyToDom=function(n,i,r,u){t._init();for(var f=0;f<u.length;f++)t.funcs[u[f]](n,i,r)},t.setPropertyToClass=function(n,i,r,u){t._initClassMethods();for(var f=0;f<u.length;f++)t.classMethods[u[f]](n,i,r);i.Digest()},t.addCustomCommand=function(t,i,r,u){t.css("cursor","pointer");t.on("click",function(){return u.isDisabled()||n.ForguncyData.commandExecutor.executeCommand(i,{runTimePageName:u.runTimePageName,commandTrigger:u,commandID:r,eventType:"click"}),!1})},t.measureElementSizes=function(n){var i=n.map(function(n){return n.clone()}),t=$(document.createElement("div")),r;return t.append.apply(t,i),$("#".concat("fgc-page-measure-container")).append(t),r=i.map(function(n){var t=n[0].getBoundingClientRect(),i=t.width+1,r=t.height+1;return{width:i,height:r}}),t.remove(),r},t.measureBrowserScrollbarWidth=function(){var n,t;return this.browserScrollbarWidthCache>=0?this.browserScrollbarWidthCache:(n=document.createElement("div"),n.className="scrollbar-measure",document.body.appendChild(n),t=n.offsetWidth-n.clientWidth,document.body.removeChild(n),this.browserScrollbarWidthCache=t,t)},t.createJqueryDomElement=function(n){return $(document.createElement(n))},t.createAlignmentContainer=function(n,i,r){n.addClass("fgc-align__inner");n.addClass(t.getHorizontalAlignmentClass(i));n.addClass(t.getVerticalAlignmentClass(r));var u=t.createJqueryDomElement("div");return u.addClass("fgc-align"),u.append(n),u},t.createTableContainer=function(n,t){for(var i,r,u=$(document.createElement("table")).append(document.createElement("tbody")).addClass("fgc-table"),e=u.find("tbody"),o=Math.ceil(n/t),f=0;f<o;f++)for(i=$(document.createElement("tr")),e.append(i),r=0;r<t;r++)i.append($(document.createElement("td")));return u},t.createGridContainer=function(n){var t=this.createGridContainerInternal().addClass("fgc-grid"),i=this.repeat("1fr ",n);return t.css("grid-template-columns",i),t},t.setGridRowAndColumn=function(n,t,i){var r=Math.floor(i/t+1).toString(),u=(i%t+1).toString();n[0].style.gridRow=r;n[0].style.gridColumn=u},t.repeat=function(n,t){for(var i="",r=0;r<t;r++)i+=n;return i},t.createGridContainerEx=function(n,t){var r,u,i;return n&&(r=n.join(" ")),t&&(u=t.join(" ")),i=this.createGridContainerInternal(),u?i.css("grid-template-columns",u):i.css("grid-template-columns","100%"),r?i.css("grid-template-rows",r):i.css("grid-template-rows","100%"),i},t.setGridItemPos=function(n,t,i,r,u){r===void 0&&(r=1);u===void 0&&(u=1);n.css("grid-column-start",i+"");n.css("grid-row-start",t+"");r>1&&n.css("grid-row-end",t+r);u>1&&n.css("grid-column-end",i+u)},t.createGridContainerInternal=function(){var n=this.createJqueryDomElement("div");return n.css("display","grid"),n},t.createDropDownListForFormUser=function(i,r,u){var s=t.createDropDownContainer(r,u),f=t.createDropDownList(i),e,o,h;return n.ForguncyData.AuthenticationType===3&&(e=$("<li><a style='text-decoration:none' href='#' id = 'FGX_ChangeProfile' ignoreInMoveFocus='true'>"+n.RS.CurrentUserCell_ChangeProfile+"<\/a><\/li>"),t.createNavigateCommand(e,n.BuiltInPageManager.builtInPages[n.BuiltInPageType.ChangeUserSettings],"FGX_ChangeProfile",u),f.append(e),o=$("<li><a style='text-decoration:none' href='#' id = 'FGX_ChangePassword' ignoreInMoveFocus='true'>"+n.RS.CurrentUserCell_ChangePassword+"<\/a><\/li>"),t.createNavigateCommand(o,n.BuiltInPageManager.builtInPages[n.BuiltInPageType.ChangePassword],"FGX_ChangePassword",u),f.append(o),n.ForguncyData.AllowUserChangeMFAStatus&&t.appendMfaDropdownMenuItem(f)),h=$("<li><a style='text-decoration:none' href='#' forguncyattr='Logout:"+u.ID+"' ignoreInMoveFocus='true'>"+n.RS.CurrentUserCell_Logout+"<\/a><\/li>"),f.append(h),n.Platform.isMobile()&&f.find("a").css("padding-top",10).css("padding-bottom",10),s.append(f),s},t.createDropDownContainer=function(n,i){var u=t.createRelativeContainerDiv(),r=t.createRelativeContainerDiv();return r.append(n),r.attr("data-toggle","_dropdown"),r.attr("id",i.ID+"_dropdown"),u.append(r),u},t.createDropDownList=function(i){var r=t.createJqueryDomElement("ul");return i.StyleInfo.HorizontalAlignment===n.CellHorizontalAlignment.Right?r.attr("class","dropdown-menu pull-right"):r.attr("class","dropdown-menu"),r.attr("role","menu"),r},t.appendMfaDropdownMenuItem=function(t){n.Common.forguncyPostSync("Account/GetMFASettingInfo",null,function(i){if(i.Result){var r=i.Properties.isEnabled,u=r?n.RS.ChangeCurrentUserMFA_Disable:n.RS.ChangeCurrentUserMFA_Enable,f=r?"MFA_Disable":"MFA_Enable",e=$("<li><a style='text-decoration:none' href='#' forguncyattr='"+f+"' id = 'FGX_SwitchMFA' ignoreInMoveFocus='true'>"+u+"<\/a><\/li>");t.append(e)}})},t.createNavigateCommand=function(n,i,r,u){var f=[{$type:"Forguncy.Model.NavigateCommand, ServerDesignerCommon",PageName:i,navigateType:"normal"}];t.addCustomCommand(n,f,r,u)},t.createAbsoluteContainerDiv=function(){var n=t.createJqueryDomElement("div");return n.addClass("fgc-container-absolute"),n},t.createRelativeContainerDiv=function(){var n=t.createJqueryDomElement("div");return n.addClass("fgc-container-relative"),n},t.createLoadingIndicator=function(){var i=t.createAbsoluteContainerDiv().addClass("indicator").css("display","none").css("top",0),r=t.createAbsoluteContainerDiv().css("background-color","gray").css("opacity",.2).css("top",0),u=t.createAbsoluteContainerDiv().css("background-repeat","no-repeat").css("background-position","center").css("background-image",'url("'+n.ForguncyData.ForguncyRoot+'Resources/Images/SiteBuiltInImages/fgc_loading.gif")').css("top",0);return i.append(r),i.append(u),i},t._init=function(){t.inited||(t.funcs[0]=t._initalFont,t.funcs[1]=t._initalIndent,t.funcs[3]=t._initalCommand,t.funcs[4]=t._initalFormatString,t.funcs[2]=t._initalId,t.funcs[5]=t._initalForguncyAttribute,t.inited=!0)},t._initClassMethods=function(){t.classMethodsInited||(t.classMethods[0]=t._initalFontClass,t.classMethods[1]=t._initalIndentClass,t.classMethods[3]=t._initalCommandClass,t.classMethods[4]=t._initalFormatStringClass,t.classMethods[2]=t._initalIdClass,t.classMethods[5]=t._initalForguncyAttributeClass,t.classMethodsInited=!0)},t._initalFontClass=function(n,i){t.setFontStyleClass(n.StyleInfo,i)},t._initalFont=function(n,i){t.setFontStyle(n.StyleInfo,i)},t.setFontStyle=function(n,r){var u=new i(r);t.setFontStyleClass(n,u)},t._initalIndent=function(n,r,u){var f=new i(r);t._initalIndentClass(n,f,u)},t._initalFormatString=function(n,r,u){var f=new i(r);t._initalFormatStringClass(n,f,u)},t._initalCommand=function(n,r,u){var f=new i(r);t._initalCommandClass(n,f,u)},t._initalForguncyAttribute=function(n,r,u){var f=new i(r);t._initalForguncyAttributeClass(n,f,u)},t._initalId=function(n,t,i){t.attr("id",i.id);t.attr("name",i.id)},t.getFontFamily=function(t){return t&&!n.Common.IsEmpty(t.FontFamily)?t.FontFamily:n.LocaleFonts.default?n.LocaleFonts.default:null},t.setFontStyleClass=function(i,r,u){if(u===void 0&&(u=!0),i&&(!u||r.Dom)){var f=t.getFontFamily(i);f&&r.FeedStyle("font-family",'"'+f+'"');i.FontSize!==-1&&(isNaN(i.FontSize)?r.FeedStyle("font-size",i.FontSize):r.FeedStyle("font-size",i.FontSize+"px"));r.FeedStyle("color",n.ColorHelper.Convert(i.Foreground));i.WordWrap?(r.FeedStyle("word-wrap","break-word"),r.FeedStyle("word-break","break-word"),r.FeedStyle("white-space","pre-wrap")):r.FeedStyle("white-space","pre");n.Common.IsEmpty(i.Underline)&&n.Common.IsEmpty(i.Strikethrough)?r.FeedStyle("text-decoration",""):i.Underline&&i.Strikethrough?r.FeedStyle("text-decoration","underline line-through"):i.Underline?r.FeedStyle("text-decoration","underline"):i.Strikethrough?r.FeedStyle("text-decoration","line-through"):r.FeedStyle("text-decoration","");n.Common.IsEmpty(i.FontWeight)?r.FeedStyle("font-weight",""):r.FeedStyle("font-weight",t.getFontWeightText(i.FontWeight));n.Common.IsEmpty(i.FontStyle)?r.FeedStyle("font-style",""):r.FeedStyle("font-style",t.getFontStyleText(i.FontStyle))}},t._initalIndentClass=function(n,i){var r=n.StyleInfo;r&&t.setTextIndent(r,i)},t.setTextIndent=function(t,i){t.TextIndent&&(t.HorizontalAlignment===n.CellHorizontalAlignment.Left?i.FeedStyle("padding-left",t.TextIndent):t.HorizontalAlignment===n.CellHorizontalAlignment.Right?i.FeedStyle("padding-right",t.TextIndent):t.HorizontalAlignment===n.CellHorizontalAlignment.Distributed&&(i.FeedStyle("padding-right",t.TextIndent),i.FeedStyle("padding-left",t.TextIndent)))},t._initalFormatStringClass=function(n,t){var i=n.StyleInfo;i&&typeof i.Formatter!="undefined"&&t.Dom.attr("formatString",i.Formatter)},t._initalCommandClass=function(n,t){n.CellType&&n.CellType.CommandList&&t.FeedStyle("cursor","pointer")},t._initalForguncyAttributeClass=function(n,t,i){!i.isInListview&&n.CellType&&n.CellType.ForguncyAttribute&&t.Dom.attr("forguncyattr",n.CellType.ForguncyAttribute)},t._initalIdClass=function(n,t,i){t.Dom.attr("id",i.id);t.Dom.attr("name",i.id)},t.getHorizontalAlignmentText=function(t){switch(t){case n.CellHorizontalAlignment.Left:return"left";case n.CellHorizontalAlignment.Distributed:return"left";case n.CellHorizontalAlignment.Center:return"center";case n.CellHorizontalAlignment.Right:default:return"right"}},t.getHorizontalAlignmentClass=function(t){switch(t){case n.CellHorizontalAlignment.Left:return"fgc-textalign-left";case n.CellHorizontalAlignment.Center:return"fgc-textalign-center";case n.CellHorizontalAlignment.Distributed:return"fgc-distributed";case n.CellHorizontalAlignment.Right:default:return"fgc-textalign-right"}},t.getFlexHorizontalAlignmentClass=function(t){switch(t){case n.CellHorizontalAlignment.Left:return"fgc-flex-justify-start";case n.CellHorizontalAlignment.Distributed:return"fgc-distributed";case n.CellHorizontalAlignment.Center:return"fgc-flex-justify-center";case n.CellHorizontalAlignment.Right:default:return"fgc-flex-justify-end"}},t.getVerticalAlignmentText=function(t){switch(t){case n.CellVerticalAlignment.Top:return"top";case n.CellVerticalAlignment.Center:return"middle";case n.CellVerticalAlignment.Bottom:default:return"bottom"}},t.getVerticalAlignmentClass=function(t){switch(t){case n.CellVerticalAlignment.Top:return"fgc-verticalalign-top";case n.CellVerticalAlignment.Center:return"fgc-verticalalign-middle";case n.CellVerticalAlignment.Bottom:default:return"fgc-verticalalign-bottom"}},t.getFlexVerticalAlignmentClass=function(t){switch(t){case n.CellVerticalAlignment.Top:return"fgc-flex-items-start";case n.CellVerticalAlignment.Center:return"fgc-flex-items-center";case n.CellVerticalAlignment.Bottom:default:return"fgc-flex-items-end"}},t.getFontStyleText=function(t){return n.Common.IsEmpty(t)?"":t.toLowerCase()},t.getFontWeightText=function(t){return n.Common.IsEmpty(t)?"":t.toLowerCase()},t.setContainerOverFlow=function(t,i){t.css("overflow",i);(i==="scroll"||i==="auto")&&n.Platform.isIOSDevice()&&t.css("-webkit-overflow-scrolling","touch")},t.applySimpleBar=function(t){return n.MetadataLoader.IsMobile()||n.Platform.isIpad()?null:new SimpleBar(t[0])},t.applyPentrableEvent=function(){$(document).on("click dblclick",function(n){var f,i,r,u;if(n.clientX&&n.clientY&&!t.isClickable(n.target)&&(f=document.elementsFromPoint||document.msElementsFromPoint,i=f.call(document,n.clientX,n.clientY),i))for(r=0;r<i.length;r++)if(u=$(i[r]),t.isClickable(u[0])){u.closest(".fgc-clickHandler").triggerHandler(n.type==="click"?"click":"dblclick");break}})},t.isClickable=function(n){return $(n).closest(".fgc-penetrable").length===0},t.SetTextEllipsis=function(n,t,i){i===void 0&&(i=null);t>0&&(n.css({display:"inline-block",overflow:"hidden","max-width":t+"px","text-overflow":"ellipsis","white-space":"pre"}),i!==null&&i())},t.ClearTextEllipsis=function(n,t){t===void 0&&(t=null);n.css({display:"",overflow:"","max-width":"","text-overflow":"","white-space":""});t!==null&&t()},t.setTabIndex=function(n,t){n&&(t===0?n.removeAttr("tabindex"):n.attr("tabindex",t))},t.funcs={},t.classMethods={},t.inited=!1,t.classMethodsInited=!1,t}();n.DomUtilities=t;r=function(){function i(){}return i.createTextElement=function(i,r,u,f,e,o){var s,c,h;return(f===void 0&&(f=!0),e===void 0&&(e=!0),o===void 0&&(o=!1),s=[1,4,2,3],o||s.push(0),t.setPropertyToDom(i,r,u,s),r.addClass("fgc-whitespace-pre"),e&&i.Value!==undefined&&i.Value!==null&&(c=i.Value,r.append(document.createTextNode(c))),n.Common.typeContains(i.CellType,"HyperlinkCellType")&&(i.IsRightOverflow||i.IsLeftOverflow)||r.css("display","block"),f)?(h=t.createJqueryDomElement("div"),h.append(r),t.createAlignmentContainer(h,i.StyleInfo.HorizontalAlignment,i.StyleInfo.VerticalAlignment)):r},i.createCantSelectLabel=function(){return $("<label style='-moz-user-select: none; -webkit-user-select: none; -ms-user-select:none; user-select:none;' unselectable='on' onselectstart='return false;' onmousedown='return false;'><\/label>")},i.createControlContainer=function(){var n=t.createJqueryDomElement("div");return n.css("width","100%"),n.css("height","100%"),n},i.initalInputBox=function(i,r,u){r.addClass("fgc-inputbox");i.StyleInfo.Background&&r.css("background-color",n.ColorHelper.Convert(i.StyleInfo.Background));t.setPropertyToDom(i,r,u,[0,2,5])},i.GenerateInputClassName=function(){var n=(new Date).getTime()+"_"+Math.floor(Math.random()*1e3);return"input_"+n},i.AllInputClassName={},i}();n.CellDomCreateHelper=r})(Forguncy||(Forguncy={}))
;var __awaiter=this&&this.__awaiter||function(n,t,i,r){function u(n){return n instanceof i?n:new i(function(t){t(n)})}return new(i||(i=Promise))(function(i,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?i(n.value):u(n.value).then(o,s)}e((r=r.apply(n,t||[])).next())})},__generator=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=e[0]&2?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[e[0]&2,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i,e;return e={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e},Forguncy;(function(n){var t=function(){function t(){}return Object.defineProperty(t,"emptyImageUrl",{get:function(){return n.ForguncyData.ForguncyRoot+"Resources/Images/SiteBuiltInImages/no_image.png"},enumerable:!1,configurable:!0}),Object.defineProperty(t,"emptyUploadImageUrl",{get:function(){return n.ForguncyData.ForguncyRoot+"Resources/Images/SiteBuiltInImages/upload_no_image.png"},enumerable:!1,configurable:!0}),t.encodeImageUrl=function(t){var i,r;if(!n.Common.IsEmpty(t)&&typeof t=="string"&&!this.isBase64StringUrl(t)){i=t.indexOf("?");r=void 0;r=i===-1?t.lastIndexOf("/"):t.lastIndexOf("/",i);var u=t.slice(0,r===-1?0:r+1),f=t.slice(r+1,i===-1?undefined:i),e=i===-1?"":t.slice(i);return u+encodeURIComponent(f)+e}return t},t.encodeImageUrlAndUpdateQuery=function(t,r,u){if(!n.Common.IsEmpty(t)&&typeof t=="string"){var c=n.ForguncyData.ForguncyRoot+"Upload/",o=t.toString().indexOf(c)===0,f=t.indexOf("?"),e=f===-1?t.lastIndexOf("/"):t.lastIndexOf("/",f);var l=t.slice(0,e===-1?0:e+1),s=t.slice(e+1,f===-1?undefined:f),a=f===-1?"":t.slice(f),h=o?i.getImageQueryString(r,u):a;return o&&window.Forguncy.StaticData.CloudAttachCdnDomain.indexOf("http")===0?window.Forguncy.StaticData.CloudAttachCdnDomain+encodeURIComponent(s)+h:l+encodeURIComponent(s)+h}return t},t.getImageSrcFromCellContentElement=function(i,r,u){var f=null;return f=n.Common.IsEmpty(i.Value)?t.getImageSrcFromElementImagePath(i):t.getImageSrcFromElementValue(i,u),n.Common.isForguncyFile(f)&&(f=t.getUploadImageSrc(f)),f},t.getImageUrlFromImagePath=function(t,i,r){r===void 0&&(r=!1);var u=n.PictureSourceType.Custom;return t&&(u=r?n.PictureSourceType.Theme:n.PictureSourceType.BuiltInIcon),this.getImageUrlBySourceType(u,i)},t.getImageUrlBySourceType=function(t,i){var r="";if(t===n.PictureSourceType.BuiltInIcon)r="Resources/Images/CellTypeBuiltInImage/";else if(t===n.PictureSourceType.Theme)r="Resources/Themes/"+n.ForguncyData.GlobalSettings.ThemeBasePath+"/Images/";else if(t===n.PictureSourceType.BuiltInBackground)r="Resources/Images/BackgroundBuiltInImage/";else return r="GeneratedResources/Images/GenerateImages/ImageCellType/",n.ForguncyData.ForguncyRoot+r+i+"?v="+n.StaticData.MetaDataVersion;return n.ForguncyData.ForguncyRoot+r+i},t.setImageSource=function(i,r){var u,f,e;r||(u=n.ForguncyData.pageInfo.pageElementManager.cells.getCell(i.attr("id")),r=!n.Common.IsEmpty(u)&&u.cellType instanceof n.ImageCellType?t.getImageSrcFromElementImagePath(u.cellType.CellElement):t.emptyImageUrl);i.attr("forguncyImage")?(f=t.getImageUrl(r),i.css("background-image",'url("'+f+'")'),i.css("font-size","0"),t.appendInnerImage(i,f)):(e=t.encodeImageUrl(r),i.attr("src",n.Helper.preProcessImageSrc(e)))},t.getImageUrl=function(i){var r=n.Common.isForguncyFile(i)?t.getUploadImageSrc(i):i,u=t.encodeImageUrl(r);return n.Helper.preProcessImageSrc(u)},t.appendInnerImage=function(n,t){var i=$("<img><\/img>").attr("src",t);i.css("opacity","0");i.addClass("fgc-container-absolute");n.append(i)},t.convertPathToFileName=function(t){if(!n.Common.IsEmpty(t)&&t.toString().indexOf(n.ForguncyData.ForguncyRoot+"Upload/")!==-1){var i=t.toString(),u=i.lastIndexOf("/"),r=i.lastIndexOf("?");return i.slice(u+1,r===-1?undefined:r)}return t},t.convertFileNameToPath=function(t){return n.Common.IsEmpty(t)?null:n.Common.isForguncyFile(t)?n.ForguncyData.ForguncyRoot+"Upload/"+t:t},t.getImageSrcFromElementValue=function(t,r){var u=null,f;return n.Common.isForguncyFile(t.Value)?(f=r?i.getImageQueryString(t.FullWidth,t.FullHeight,t.Value):"",u=t.Value+f):u=t.Value,u},t.getImageSrcFromElementImagePath=function(i){var r=i.CellType,u=r.ImagePath;return n.Common.IsEmpty(u)?r.$type==="Forguncy.ImageCellType, ServerDesignerCommon"?this.emptyImageUrl:this.emptyUploadImageUrl:t.getImageUrlFromImagePath(r.BuiltIn,r.ImagePath,!1)},t.getUploadImageSrc=function(t){return window.Forguncy.StaticData.CloudAttachCdnDomain.indexOf("http")===0?window.Forguncy.StaticData.CloudAttachCdnDomain+t:n.ForguncyData.ForguncyRoot+"Upload/"+t},t.isBase64StringUrl=function(n){return n.indexOf("data:")===0?!0:!1},t.preHandleSvg=function(i,r){var b,k,v,c,g,o,u,y,l,e,a,nt,p,tt,it,w,rt,f,s;i.css("width","100%");i.css("height","100%");b=Number(i.attr("width"));k=Number(i.attr("height"));b&&k&&!i.attr("viewBox")&&(i.attr("width","100%"),i.attr("height","100%"),i.attr("viewBox","0 0 "+b+" "+k));r&&($("*",i).attr("fill",n.ColorHelper.Convert(r)),$("*",i).css("fill",n.ColorHelper.Convert(r)));var d=$("[id]",i),h={},et="_"+Math.random().toString().substring(2);for(o=0;o<d.length;o++)v=d[o].getAttribute("id"),c=h[v],c||(c=v+et,h[v]=c),d[o].setAttribute("id",c);for(g=$("*",i),o=0;o<g.length;o++){for(u=g[o],y=u.attributes,l=0;l<y.length;l++)e=y[l].value,a=y[l].name,(a==="xlink:href"||a==="href")&&e&&e[0]==="#"?(s=h[e.substring(1)],s&&u.setAttribute(a,"#"+s)):e&&e.toLowerCase().indexOf("url(#")===0&&e[e.length-1]===")"&&(s=h[e.substring(5,e.length-1)],s&&u.setAttribute(a,"url(#"+s+")"));if(u.tagName==="style"){var ot=$(u),ut=ot.clone()[0],ft=u.parentElement;if(ft.removeChild(u),nt=new CSSStyleSheet,nt.replaceSync(u.innerHTML),p=t.updateIdsInStyleSheet(nt,h),p){for(tt=p.cssRules||p.rules,it="",w=0;w<tt.length;w++)it+=tt[w].cssText+"\n";ut.textContent=it;ft.appendChild(ut)}}for(rt in u.style)f=u.style[rt],f&&typeof f=="string"&&(f.toLowerCase().indexOf("url('#")===0&&f[f.length-1]===")"||f.toLowerCase().indexOf('url("#')===0&&f[f.length-1]===")")&&(s=h[f.substring(6,f.length-2)],s&&(u.style[rt]="url('#"+s+"')"))}},t.updateIdsInStyleSheet=function(n,t){for(var r,e,o,u,s,i,h,c=n.cssRules,f=0;f<c.length;f++){if(r=c[f],e=r.styleMap,!e)return;for(o=e.keys(),u=o.next();u.done===!1;)s=u.value,i=r.styleMap.get(s).toString(),(i.toLowerCase().indexOf("url('#")===0&&i[i.length-1]===")"||i.toLowerCase().indexOf('url("#')===0&&i[i.length-1]===")")&&(h=t[i.substring(6,i.length-2)],h&&r.styleMap.set(s,"url('#"+h+"')")),u=o.next()}return n},t.requestSvg=function(n,i,r){return r===void 0&&(r=!1),__awaiter(this,void 0,void 0,function(){return __generator(this,function(){return i?t.svgCache[n]?(i(t.svgCache[n].cloneNode(!0)),[2]):(r&&(t.placeHolderSvg||(t.placeHolderSvg=$('<svg width="64px" height="64px" viewBox="0 0 64 64" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><\/svg>')[0]),i(t.placeHolderSvg.cloneNode())),t.requestSvgAsync(n,i),[2]):[2]})})},t.requestSvgAsync=function(n,i){return __awaiter(this,void 0,void 0,function(){var f,r,u,e;return __generator(this,function(o){switch(o.label){case 0:return t.requestCache[n]||(t.requestCache[n]=$.get(n)),f=t.requestCache[n],[4,f];case 1:return(r=o.sent(),t.svgCache[n])?(i(t.svgCache[n].cloneNode(!0)),[2]):(u=typeof r=="string"?r:r.documentElement,e=$(u),t.svgCache[n]=e[0],i(t.svgCache[n].cloneNode(!0)),[2])}})})},t.requestCache={},t.svgCache={},t}(),i,r,u;n.ImageHelper=t;i=function(){function n(){}return n.getImageQueryString=function(n,t,i){i===void 0&&(i=null);var r="?";return i&&i.toString().indexOf("?")>-1&&(r="&"),r+"imageSize="+this.getSuitableImageMode(n,t)},n.getSuitableImageMode=function(n,t){return n<150&&t<150?1:n<400&&t<400?2:0},n}();n.ImageQueryHelper=i;r=function(){function r(){}return r.registerDragFile=function(t,i){n.DragFileToUploadHelper.register(t,function(u){if(!i.isDisabled()&&!i.isReadOnly()){var f=i.CellElement.CellType.UploadImageLimit;n.Common.uploadImageToServer(u,f,f===null||f===void 0?void 0:f.AllowExtensions,function(n){i.hideUploadingIndicator();r.uploadSuccess(n,t,i)},function(t,r){if(i.hideUploadingIndicator(),t){var u=(r===null||r===void 0?void 0:r.status)===401?n.RS.UnauthorizedUpload:t;alert(u)}},function(){i.showUploadingIndicator()},i.CellElement.ServerPropertiesId.UploadLimit)}},!1)},r.uploadSuccess=function(r,u,f){var e,o;u.empty();r?(u.attr("imagename",r),n.Common.isForguncyFile(r)&&(e=f.CellElement,r=r+i.getImageQueryString(e.FullWidth,e.FullHeight,r)),o=n.ForguncyData.ForguncyRoot+"Upload/"+r,t.setImageSource(u,o)):(u.attr("imagename",""),t.setImageSource(u,null));f.commitValue();f.validate()},r}();n.ImageUploadHelper=r;u=function(){function i(){}return i.CreateImage=function(r,u,f,e){var o,s,h;return(e===void 0&&(e=!0),r&&r.Name)?(o=void 0,i.IsSvg(r.Name)?(o=n.DomUtilities.createJqueryDomElement("div"),s=t.getImageUrlFromImagePath(r.BuiltIn,r.Name),h=t.encodeImageUrl(s),this.AppendSvg(o,h,r.Color,r.UseCellTypeForeColor,null,f,e)):(o=n.DomUtilities.createJqueryDomElement("img"),s=t.getImageUrlFromImagePath(r.BuiltIn,r.Name),h=t.encodeImageUrl(s),o.attr("src",h)),o.addClass(n.CSSHelper.getClassName({verticalAlign:"middle",width:u+"px",height:u+"px"})),o):null},i.AppendSvg=function(i,r,u,f,e,o,s){s===void 0&&(s=!0);t.requestSvg(r,function(s){var h=$(s),c=u;(u||f)&&(c=f?"currentColor":n.ColorHelper.Convert(u));t.preHandleSvg(h,c);h.attr("focusable",!1);e&&e(r)||(i.empty(),i.append(h),i.css("position","relative"),n.StaticData.IsCellTypeExporting||h.addClass("fgc-container-absolute"),o&&o(h,i))},s)},i.GetColoredSvgRectInfo=function(t,r){var e=t+r,o=i.coloredSvgRectInfoCache[e],f,u;return o?o:(u={},u.type="GET",u.url=t,u.async=!1,t.startsWith("data:image")||(u.data={_t:(new Date).valueOf()}),u.success=function(t){var u=$(t.documentElement),o={width:0,height:0},s,h,c;r&&($("*",u).attr("fill",n.ColorHelper.Convert(r)),$("*",u).css("fill",n.ColorHelper.Convert(r)));s=$("<div/>").append(u.clone()).html();h="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(s)));u.width()&&u.height()||(c=i.getSvgBBoxSize(t),o=c||o);f={value:h,width:u.width()||o.width,height:u.height()||o.height};i.coloredSvgRectInfoCache[e]=f},$.ajax(u),f)},i.IsSvg=function(n){return n&&n.length>4&&(n.substr(n.length-4,4).toLowerCase()===".svg"||n.toLowerCase().indexOf(".svg?")>0)||i.IsBase64Svg(n)},i.getSvgBBoxSize=function(n){var i=document.getElementById("fgc-page-measure-container"),t,r;return i?(t=n.documentElement,i.appendChild(t),r=t.getBBox(),i.removeChild(t),r):undefined},i.IsBase64Svg=function(n){return typeof n=="string"?/^data:image\/svg\+xml;base64,/.test(n.trim()):!1},i.coloredSvgRectInfoCache={},i}();n.ImageDataHelper=u})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var t=function(){function t(){}return t.AllowMoveFocusByEnterKey=function(i,r){n.ForguncyData.pageInfo&&n.ForguncyData.pageInfo.moveFocusByEnter&&i&&!r&&i.keydown(function(i){if(!i.altKey&&!i.ctrlKey&&i.keyCode===13&&!n.PageBuilder.pageIsLoading&&!n.PageBuilder.isLoadingConverShow()){var r=this;n.DelayRefresh.setTimeout(function(){i.shiftKey?t.MoveFocusToPreviousControl(r):t.MoveFocusToNextControl(r)})}})},t.MoveFocusToNextControl=function(n){t.MoveFocus(n,t.getNextIndex)},t.MoveFocusToPreviousControl=function(n){t.MoveFocus(n,t.getPreviousIndex)},t.MoveFocusToFirstElement=function(){var n=t.GetSortedElements();return n.length<=0?!1:(t.SetElementFocus(n[0]),!0)},t.MoveFocus=function(n,i){var r,f,u,e;if(n&&(r=t.GetSortedElements(),!(r.length<2))){for(f=-1,u=0;u<r.length;u++)if(n===r[u].ElementObj){f=u;break}f!==-1&&(e=i(f,r.length),t.SetElementFocus(r[e]))}},t.getNextIndex=function(n,t){return n===t-1?0:n+1},t.getPreviousIndex=function(n,t){return n===0?t-1:n-1},t.GetSortedElements=function(){var i,r,u;return(n.ForguncyData.pageInfo.hasExtraDialog?(i=$(".".concat("FUI-dialog")).not(":hidden").last(),r=!1):(i=$("#".concat("centerDiv_"+n.ForguncyData.pageInfo.pageID)),r=!0),u=t.GetElements(i,r),this.shouldSortElements())?t.SortElements(u):u},t.shouldSortElements=function(){var t,i;if(!((t=n.ForguncyData.pageInfo)===null||t===void 0?void 0:t.enableTabIndex))return!1;for(i in n.ForguncyData.pageInfo.enableTabIndex)return!0;return!1},t.GetElements=function(t,i){var e,o,s,u,r,f,h;for(i===void 0&&(i=!0),o=[],s=t.find("button,input,a,select,textarea,div[gcuielement='gcSheetFocusElementForTab'],div[tabindex]"),u=0;u<s.length;u++)if(r=s[u],!r.disabled&&!$(r).attr("disabled")&&!$(r).attr("ignoreInMoveFocus")&&r.style.visibility!=="hidden"&&r.style.display!=="none"&&!(r.tabIndex<=-1)&&!$(r).is(":hidden")){if(r.tagName==="DIV"){if(r.getAttribute("gcuielement")==="gcSheetFocusElementForTab"){if(f=(e=n.SpreadJSView.getWorkBookByHost($(r).parent()))===null||e===void 0?void 0:e.getActiveSheet(),!f||f.getRowCount()===0||f.getColumnCount()===0)continue}else if(i)continue}else if(r.tagName==="A"){if($(r).attr("href")===undefined)continue}else if(h=r.getAttribute("isCalculatorButton"),h==="true")continue;(n.Common.IsEmpty(r.id)||r.id[0]!=="a")&&(typeof r.id!="string"||r.id.indexOf("wijspread_toolstrip_")!==0)&&o.push({ElementObj:r,ID:r.id,TabIndex:r.tabIndex})}return o},t.SortElements=function(n){var i,r,f,t,u;if(!n||n.length===0)return n;for(i=[],t=0;t<n.length;t++)r=n[t].TabIndex,i[r]===undefined&&(i[r]=[]),i[r].push(n[t]);for(f=[],t=0;t<i.length;t++)if(i[t]!==undefined)for(u=0;u<i[t].length;u++)f.push(i[t][u]);return f},t.SetElementFocus=function(t){try{if(t.ElementObj.tagName==="DIV"&&t.ElementObj.getAttribute("gcuielement")==="gcSheetFocusElementForTab"){var i=n.SpreadJSView.getWorkBookByHost($(t.ElementObj).parents("[gcuielement='gcSpread']"));i.focus(!0)}else t.ElementObj.focus()}catch(r){}},t}();n.FocusMoveHelper=t})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var t=function(){function t(){var t=this;this.autoIDInfos={};n.ForguncyData.pageInfo.dataModel.bind("valuechanged",function(n,i){t.onValueChanged(i.arg)})}return t.prototype.getAutoIDInfo=function(n,t){var r=this.autoIDInfos[n],i;return r?(i=r[t],(i===null||i===void 0?void 0:i.isEnabled)?i:null):null},t.prototype.setAutoGeneratedIDsFromMetaData=function(n){var t,i;if(n)for(t in n){this.autoIDInfos[t]||(this.autoIDInfos[t]={});for(i in n[t])this.autoIDInfos[t][i]={isEnabled:!0,id:n[t][i].ID,fields:n[t][i].Fields}}},t.prototype.getBindingInfoGuidAndPageName=function(t,i){for(var r,f=n.ForguncyData.pageInfo.normalCellBindingManager.getRelatedCellIdsByBindingInfo({TableName:t,ColumnName:i}),u=0;u<f.length;u++)if(r=n.ForguncyData.pageInfo.pageElementManager.cells.getCell(f[u]),r===null||r===void 0?void 0:r.bindingInfo)return{guid:r.bindingInfo.GUID,pageName:r.designerPageName};return null},t.prototype.cacheFieldCells=function(){var i=function(i){var f,r,u,e;for(f in t.autoIDInfos[i]){if(r=t.autoIDInfos[i][f],u=t.getBindingInfoGuidAndPageName(i,f),u)r.isEnabled=!0,r.bindingInfoGuid=u.guid,r.pageName=u.pageName;else{r.isEnabled=!1;r.cells=null;continue}(e=r.fields,e)&&(r.cells=e.map(function(t){var u={TableName:i,ColumnName:t},r=n.ForguncyData.pageInfo.normalCellBindingManager.getRelatedCellIdsByBindingInfo(u);return r.length>0?r[0]:null}))}},t=this;for(var r in this.autoIDInfos)i(r)},t.prototype.initAutoGeneratedID=function(t){var i,u,r,f;for(i in this.autoIDInfos)for(u in this.autoIDInfos[i])(r=this.autoIDInfos[i][u],r.isEnabled&&!n.Common.IsEmpty(r.id))&&(f={TableName:i,ColumnName:u},n.ForguncyData.pageInfo.normalCellBindingManager.setValueToBindingCell(f,r.id,t))},t.prototype.onValueChanged=function(t){var u,i,f,r;if(t&&t.id&&!n.Common.IsEmpty(t.newValue)&&!n.Common.IsEmpty(t.newValue)){u=!1;for(i in this.autoIDInfos){if(u)break;for(f in this.autoIDInfos[i])r=this.autoIDInfos[i][f],r.isEnabled&&r.cells&&r.cells.indexOf(t.id)>=0&&(this.updateAutoIdCell(i,f),u=!0)}}},t.prototype.updateAutoIdCell=function(t,i){var r=this,f={TableName:t,ColumnName:i},u=n.ForguncyData.pageInfo.normalCellBindingManager.getRelatedCellIdsByBindingInfo(f).filter(function(n){return r.shouldUpdateAutoId(n)});u.length!==0&&this.getAutoGeneratedID(t,i,!0,function(t){n.Common.IsEmpty(t)||u.forEach(function(i){r.shouldUpdateAutoId(i)&&n.ForguncyData.pageInfo.dataModel.normalCellDataModel.setValue(i,{newValue:t},7)})})},t.prototype.shouldUpdateAutoId=function(t){var i=n.ForguncyData.pageInfo.dataModel.normalCellDataModel;return i.getValueType(t)===2?!1:!0},t.prototype.getAutoGeneratedID=function(t,i,r,u){var l=this.getFieldsValue(t,i),e,o,f,s,h,c,a;if(this.containEmptyField(l)){u(null);return}if(f=this.getAutoIDInfo(t,i),f?(e=f.bindingInfoGuid,o=f.pageName):(s=this.getBindingInfoGuidAndPageName(t,i),e=s.guid,o=s.pageName),!e||!o){u(null);return}h={bindingInfo:e,pageName:o,values:l};c=function(n){f&&(f.id=n);u&&u(n)};r?(a="GetAutoGeneratedID,"+t+"->"+i,n.Common.forguncyPost("Home/GetAutoGeneratedID",h,c,a)):n.Common.forguncyPostSync("Home/GetAutoGeneratedID",h,c)},t.prototype.containEmptyField=function(t){if(!t)return!1;for(var i in t)if(n.Common.IsEmpty(t[i]))return!0;return!1},t.prototype.getFieldsValue=function(t,i){var u={},r=this.getAutoIDInfo(t,i);return!r||!r.fields||r.fields.length===0?null:(r.fields.forEach(function(t,i){var f=r.cells[i],e=null;n.Common.IsEmpty(f)||(e=n.ForguncyData.pageInfo.dataModel.normalCellDataModel.getValue(f));u[t]=e}),u)},t.prototype.updateAutoIDCache=function(n,t,i){var r=this.getAutoIDInfo(n,t);r&&(r.id=i)},t.prototype.getAutoIDByBindingInfo=function(n){if(!n||n.RelationBinding||!this.autoIDInfos[n.TableName])return null;var t=this.autoIDInfos[n.TableName][n.ColumnName];return(t===null||t===void 0?void 0:t.isEnabled)?{id:t.id}:null},t}();n.AutoIDManager=t})(Forguncy||(Forguncy={}))
;var __assign=this&&this.__assign||function(){return __assign=Object.assign||function(n){for(var t,r,i=1,u=arguments.length;i<u;i++){t=arguments[i];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},__assign.apply(this,arguments)},Forguncy;(function(n){var t=function(){function t(){}return t.detectCircularReferences=function(n,t,i){var e;if(!n.some(function(n){return n[i]!==undefined}))return[];var r=[],u=n.reduce(function(n,r){var e,o,u=(e=r[t])===null||e===void 0?void 0:e.toString(),f=(o=r[i])===null||o===void 0?void 0:o.toString();return n[u]||(n[u]={value:u,children:[]}),n[f]||(n[f]={value:f,children:[]}),n[u].parent=n[f],n[f].children.push(n[u]),n},{}),f=[];for(e in u)f.push(u[e]);return f.forEach(function(n){function f(n){var e;if(u.has(n)){r.push((e={},e[t]=n.value,e[i]=n.parent?n.parent.value:null,e));return}u.add(n);n.children.forEach(f);u.delete(n)}var u=new Set;f(n)}),r},t.hasCircularReference=function(t,i,r,u){u===void 0&&(u=!0);var f=this.detectCircularReferences(t,i,r);return f.length?(u&&(console.error(n.RS.CircularlyReferencingErrorMessages,f),n.Helper.addDebugWarning(n.RS.CircularlyReferencingErrorMessages)),!0):!1},t.buildTree=function(n,t,i){var r=new Map,u=[];return n.forEach(function(n){var i,u;r.set((u=(i=n[t])===null||i===void 0?void 0:i.toString())!==null&&u!==void 0?u:null,__assign(__assign({},n),{children:[]}))}),n.forEach(function(n){var f,e,o,s=r.get((e=(f=n[t])===null||f===void 0?void 0:f.toString())!==null&&e!==void 0?e:null),h=(o=s[i])===null||o===void 0?void 0:o.toString();r.has(h)?r.get(h).children.push(s):u.push(s)}),u},t.flattenTree=function(n,t){function r(n){var e,u,f,o;if(i.push(n),n[t])for(e=n[t],u=0,f=e;u<f.length;u++)o=f[u],r(o)}var i=[];return n.forEach(r),i},t}();n.TreeHelper=t})(Forguncy||(Forguncy={}))
;var __spreadArray=this&&this.__spreadArray||function(n,t,i){if(i||arguments.length===2)for(var r=0,f=t.length,u;r<f;r++)!u&&r in t||(u||(u=Array.prototype.slice.call(t,0,r)),u[r]=t[r]);return n.concat(u||Array.prototype.slice.call(t))},Forguncy;(function(n){var r=function(){function t(){}return t.syncProperties=function(n,t){n.IsHiddenByLayout||t.ColumnWidth!==-1&&(n.Width=t.ColumnWidth);n.Order=t.Order;n.IsHiddenByColumnOptions=t.IsHiddenByColumnOptions;n.IsHiddenByUIResizeColumn=t.IsHiddenByUIResizeColumn},t.syncListviewColumnsMetadataFromCache=function(i,r){var u={},f,e;i.OriginalColumns.forEach(function(i){var f=n.Common.clone(i),e=n.ColumnInfoHelper.getColumnUniqueLocationKey(f),o=r.find(function(n){return n.ColumnName===e});o&&t.syncProperties(f,o);u[e]=f});i.ColumnOptionCommandsColumns.forEach(function(i,f){var e=n.Common.clone(i),o,s;n.ColumnOptionsListviewMetadataHelper.initDefaultValueForColumnMetadata(e,f+1e6);o=n.ColumnInfoHelper.getColumnUniqueLocationKey(e);s=r.find(function(n){return n.ColumnName===o});s&&(t.syncProperties(e,s),u[o]||(u[o]=e))});f=Object.keys(u).map(function(n){return u[n]}).sort(function(n,t){return n.Order-t.Order});i.Columns=__spreadArray([],f,!0);e=__spreadArray([],f,!0).sort(function(n,t){return n.Index-t.Index});e.forEach(function(t,r){t.IsExternal&&(n.ColumnOptionsListviewMetadataHelper.recalcColumnIndex(t,r,e),n.ColumnOptionsListviewMetadataHelper.recalcColumnHeaderRowColumnInfo(t,i))});n.ColumnOptionsListviewMetadataHelper.recalcColumnCount(i)},t.getMetadataCacheDataForListviewCreate=function(t,i){var f={PageName:t,ListviewName:i,CustomName:null},r=null,u;return n.Common.forguncyPostSync("Home/GetListviewStatusCacheData",f,function(n){n.Success?r=n.StatusCacheData:n.ErrorMessage&&console.log(n.ErrorMessage)}),u={},r&&(r.Settings?u=JSON.parse(r.Settings):r.Columns&&(u.columns=JSON.parse(r.Columns))),u},t.getMetadataCacheDataAsync=function(t,i,r,u){r===void 0&&(r=null);u===void 0&&(u=null);var f={PageName:t,ListviewName:i,CustomName:r};n.Common.forguncyPost("Home/GetListviewStatusCacheData",f,function(n){u(n)})},t.autoSaveMetadataCacheDataAsync=function(i,r){var u,f,o=i.listviewData.metadata,s,e;o.CacheListviewStatus&&r.columns===undefined&&(s=i.getClonedListviewMetadataAfterAdjustColumnWidth(),r.columns=t.getCacheDataFromListviewMatadata(s));o.CacheColumnFilterAndSort&&(e=i.getLocationString(),r.columnFilter===undefined&&(r.columnFilter=(u=n.ForguncyData.pageInfo.columnFilterQueryCache[e])!==null&&u!==void 0?u:[]),r.sort===undefined&&(r.sort=(f=n.ForguncyData.pageInfo.sortInfoCache[e])!==null&&f!==void 0?f:{}));t.setMetadataCacheDataAsync(i,r)},t.setMetadataCacheDataAsync=function(t,i,r,u){r===void 0&&(r=null);u===void 0&&(u=null);var f={Settings:JSON.stringify(i)},e={PageName:t.designerPageName,ListviewName:t.getListviewName(),CustomName:r,StatusCacheData:f};n.Common.forguncyPost("Home/SetListviewStatusCacheData",e,function(t){t.Success?n.UpdateTableByCommandHelper.clearCacheWhenTableDataChanged(t.TableName):t.ErrorMessage&&console.error(t.ErrorMessage);u&&u(t)})},t.getCacheDataFromListviewMatadata=function(t){return t.Columns.map(function(t,i){return{ColumnName:n.ColumnInfoHelper.getColumnUniqueLocationKey(t),ColumnWidth:t.IsHiddenByLayout?-1:t.Width,Order:i,IsHiddenByColumnOptions:t.IsHiddenByColumnOptions,IsHiddenByUIResizeColumn:t.IsHiddenByUIResizeColumn}})},t.filterListviewColumnFilterFromCache=function(t,i){if(!i||i.length===0)return i;var r=t.metadata.Columns.map(function(i){var r;return{columnName:n.ColumnInfoHelper.getColumnUniqueLocationKey(i),columnIndex:i.Index,columnBindingInfoID:(r=n.ColumnInfoHelper.getFilterActualBindingInfo(i))===null||r===void 0?void 0:r.GUID,pageName:t.designerPageName}});return i.filter(function(n){var t=r.find(function(t){return t.columnName===n.ColumnName});return t?(n.ColumnIndex=t.columnIndex,n.ColumnBindingInfoID=t.columnBindingInfoID,n.pageName=t.pageName,!0):!1})},t.filterListviewColumnSortFromCache=function(t,i){if(!i||!i.sortInfo||i.sortInfo.length===0)return i;var r=t.metadata.Columns.map(function(t){return{columnName:n.ColumnInfoHelper.getColumnUniqueLocationKey(t),columnIndex:t.Index,columnBindingInfo:n.ColumnInfoHelper.getFilterActualBindingInfo(t)}});return i.sortInfo=i.sortInfo.filter(function(n){var t=r.find(function(t){return t.columnName===n.ColumnName});return t&&(n.ColumnIndex=t.columnIndex,n.ColumnBindingInfo=t.columnBindingInfo),!0}),i},t}(),t,i;n.ListviewStatusCacheHelper=r;t=function(){function t(){}return t.getCellLocationKey=function(t,i){var u=t.Name,r="",f;return u&&u.length>0?r=u[0]:(f=n.FormulaHelper.createCellExpression(null,null,t.Row,t.Column,!0,!0),r=n.FormulaHelper.unparse(f)),i?"".concat(i,",").concat(r):r},t.getMetadataCacheDataForCreateCell=function(t,i){var u={PageName:t,CellName:i},r=null;return n.Common.forguncyPostSync("Home/GetCellStatusCacheData",u,function(n){n.Success?r=n.StatusCacheData:n.ErrorMessage&&console.log(n.ErrorMessage)}),r},t.setMetadataCacheDataAsync=function(t,i,r,u){u===void 0&&(u=null);var f={PageName:t,CellName:i,StatusCacheData:r};n.Common.forguncyPost("Home/SetCellStatusCacheData",f,function(t){t.Success?n.UpdateTableByCommandHelper.clearCacheWhenTableDataChanged(t.TableName):t.ErrorMessage&&console.error(t.ErrorMessage);u&&u(t)})},t}();n.CellStatusCacheHelper=t;i=function(){function t(){}return t.setMultipleLanguageCacheDataAsync=function(t,i){i===void 0&&(i=null);var r={Language:t};n.Common.forguncyPost("Home/SetMultipleLanguageStatusCacheData",r,function(r){var u="";u=r.Success?r.Language:t;localStorage.setItem(n.Resource.ActiveLanguageKey,u!==null&&u!==void 0?u:"");i&&i(r)})},t.getMultipleLanguageCacheDataAsync=function(t){t===void 0&&(t=null);n.Common.forguncyPostSync("Home/GetMultipleLanguageStatusCacheData",null,function(n){if(n.Success)var i=n.Language;else n.ErrorMessage&&console.error(n.ErrorMessage);t&&t(n)})},t}();n.MultipleLanguageStatusCacheHelper=i})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var t=function(){function t(){this.pageDirtyInfos={};this.cellDirtyInfo={};this.listviewDirtyInfo={};this.valueChangedHanlders={};this._hasLoaded=!1}return Object.defineProperty(t.prototype,"dataModel",{get:function(){return n.ForguncyData.pageInfo.dataModel.normalCellDataModel},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"listviews",{get:function(){return n.ForguncyData.pageInfo.pageElementManager.listviewCollection.listviews},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cells",{get:function(){return n.ForguncyData.pageInfo.pageElementManager.cells.getAllCells()},enumerable:!1,configurable:!0}),t.prototype.getCellDirtyInfo=function(n,t,i){if(i===void 0&&(i=!1),!this.cellDirtyInfo[n])if(i)this.cellDirtyInfo[n]={};else return null;if(!this.cellDirtyInfo[n][t])if(i)this.cellDirtyInfo[n][t]={id:t,defaultValue:null};else return null;return this.cellDirtyInfo[n][t]},t.prototype.setDirtyInfoFromMetaData=function(n){this.setDirtyInfoFromPageSetting(n.PageSettings)},t.prototype.setDirtyInfoFromPageSetting=function(n){var t,i;this.pageDirtyInfos[n.Name]||(this.pageDirtyInfos[n.Name]={shouldCheck:n.ShouldCheckPageDirty,ignoredCells:(t=n.IgnoredDirtyCells)!==null&&t!==void 0?t:[],ignoredListviews:(i=n.IgnoredDirtyListviews)!==null&&i!==void 0?i:[]})},t.prototype.removeDirtyStatus=function(){this.removeCellDirtyStatus();this.removeListviewDirtyStatus();var n=this.getPageDirtyCheckManagerInIframe(!1);n.forEach(function(n){n.removeCellDirtyStatus();n.removeListviewDirtyStatus()})},t.prototype.removeCellDirtyStatus=function(){var i,t,r,n;this.cacheCellDefaultValue();for(i in this.cellDirtyInfo)if(t=this.cellDirtyInfo[i],t)for(r in t)n=t[r],n&&(n.defaultValue=n.currentValue,n.isDirty=!1,n.cellType.ignoreDirty({defaultValue:n.defaultValue,currentValue:n.currentValue}))},t.prototype.removeListviewDirtyStatus=function(){var i=this,r=function(r){var f,e,u;if(n.ForguncyData.pageInfo.pageID+""===r)t.listviewDirtyInfo[r]={},t.listviews.forEach(function(n){i.listviewDirtyInfo[r][n.getCalcSheetName()]={ignoreDirty:!0,ignoreChanges:n.buildDetailListviewValues(!1)}});else{if(f=t.listviewDirtyInfo[r],!f)return"continue";for(e in f)u=f[e],u&&(u.ignoreChanges=u.editedValues,u.ignoreDirty=!0)}},t=this;for(var u in this.listviewDirtyInfo)r(u)},t.prototype.boforePageCreate=function(n){switch(n){case 0:this._hasLoaded=!1;this.onNavigate();break;case 2:this.onClosePopup();break;case 1:this.onShowPopup()}},t.prototype.onNavigate=function(){var t,n;this.cellDirtyInfo={};this.listviewDirtyInfo={};for(t in this.valueChangedHanlders)n=this.valueChangedHanlders[t],n&&n.dataModel.unbind("valuechanged",n.handler);this.valueChangedHanlders={}},t.prototype.onClosePopup=function(){var t=n.ForguncyData.pageInfo.pageID,i;t&&(delete this.cellDirtyInfo[t],delete this.listviewDirtyInfo[t],i=this.valueChangedHanlders[t],i&&i.dataModel.unbind("valuechanged",i.handler),delete this.valueChangedHanlders[t])},t.prototype.onShowPopup=function(){this.clearNonexistentCellInfo();this.cacheNormalCellsInfo();this.clearNonexistentListviewInfo();this.cacheListviewInfo()},t.prototype.clearNonexistentCellInfo=function(){var f=this,e=n.ForguncyData.pageInfo.pageElementManager.cells,i=n.ForguncyData.pageInfo.pageID,r=[],u=this.cellDirtyInfo[i],t;if(u){for(t in u)e.getCell(t)||r.push(t);r.forEach(function(n){return delete f.cellDirtyInfo[i][n]})}},t.prototype.cacheNormalCellsInfo=function(){var n=this;this.cells.forEach(function(t){return n.cacheSingleNormalCellInfo(t)})},t.prototype.cacheSingleNormalCellInfo=function(t){var r,i,u;this.shouldCheckNormalCell(t)&&(r=n.ForguncyData.pageInfo.pageID,i=this.getCellDirtyInfo(r,t.id,!0),i.currentValue=this.getCellValue(t.id),i.isDirty=t.cellType.isDirty({currentValue:i.currentValue,defaultValue:i.defaultValue}),i.isDirty&&(u=n.Common.parseIDStr(t.id),i.pageName=n.PageManager.getDesignerPageName(u.suffix,!1),i.id=t.id))},t.prototype.clearNonexistentListviewInfo=function(){var u=n.ForguncyData.pageInfo.pageID,r=[],t=this.listviewDirtyInfo[u],i;if(t){for(i in t)n.ListviewBase.getListviewByCalcSheetName(i)||r.push(i);r.forEach(function(n){return delete t[n]})}},t.prototype.cacheListviewInfo=function(){var n=this;return this.listviews.forEach(function(t){return n.cacheSingleListviewInfo(t)})},t.prototype.cacheSingleListviewInfo=function(t){var i,u,r;this.shouldCheckListview(t)&&(i=n.ForguncyData.pageInfo.pageID,u=t.getCalcSheetName(),this.listviewDirtyInfo[i]||(this.listviewDirtyInfo[i]={}),this.listviewDirtyInfo[i][u]||(this.listviewDirtyInfo[i][u]={}),r=this.listviewDirtyInfo[i][u],r.editedValues=t.buildDetailListviewValues(!1),r.editedValues&&(r.listviewName=t.getListviewName(),r.pageName=n.PageManager.getDesignerPageName(t.runTimePageName,!1)))},t.prototype.onPageLoaded=function(){var r=this,i=function(t,i){if(t.data===n.ForguncyData.pageInfo.pageID)r.onNormalCellValueChanged(i)},t=n.ForguncyData.pageInfo.pageID;this.valueChangedHanlders[t]={dataModel:this.dataModel,handler:i};this.cacheCellDefaultValue();this.listviewDirtyInfo[t]={};this.dataModel.bind("valueortypechanged",t,i);this._hasLoaded=!0},t.prototype.onSubPageLoaded=function(n){this.cacheCellDefaultValue(n)},t.prototype.cacheCellDefaultValue=function(t){var r=this,i;if(t===void 0&&(t=null),i=n.ForguncyData.pageInfo.pageID,t){if(!this.cellDirtyInfo[i])return}else this.cellDirtyInfo[i]={};n.ForguncyData.pageInfo.pageElementManager.cells.getAllCells(t).forEach(function(n){if(r.shouldCheckNormalCell(n)){var t=r.getCellValue(n.id);r.cellDirtyInfo[i][n.id]={id:n.id,defaultValue:t,currentValue:t,cellType:n.cellType}}})},t.prototype.getCellValue=function(t){var r=this.getCellValueFromDataModel(t),i;return r===0&&(i=n.ForguncyData.pageInfo.pageElementManager.cells.getCell(t),(i===null||i===void 0?void 0:i.cellType)instanceof n.CheckBoxCellType)?null:r},t.prototype.getCellValueFromDataModel=function(t){var i=this.dataModel.getValue(t);return n.Common.IsEmpty(i)?null:i===!0?1:i===!1?0:i instanceof Date?n.Convertor.fromDateToOADate(i):i},t.prototype.onNormalCellValueChanged=function(t){var r=n.ForguncyData.pageInfo.pageID,i=this.getCellDirtyInfo(r,t.id);i&&this.shouldUpdateDefaultValue(t)&&(i.defaultValue=this.getCellValue(t.id))},t.prototype.shouldUpdateDefaultValue=function(t){var i,r;return[2,4,1].indexOf(t.valueType)>=0?!0:(i=n.ForguncyData.pageInfo.pageElementManager.cells.getCell(t.id),r=n.ForguncyData.pageInfo.autoIDManager.getAutoIDByBindingInfo(i===null||i===void 0?void 0:i.bindingInfo),r&&t.newValue===r.id?!0:void 0)},t.prototype.shouldCancelByPageDirty=function(t,i,r,u,f){var s,e,o;return(r===void 0&&(r=null),u===void 0&&(u=null),f===void 0&&(f=!0),e=n.ForguncyData.pageDirtyCheckManager.getDirtyElement(t,i),e)?(o=confirm(n.RS.LeaveSiteConfirm),r&&n.ForguncyData.pageDirtyCheckManager.consoleWithNewLog(e,r,o),u&&n.ForguncyData.pageDirtyCheckManager.consoleLog(e,u,o),o?(f&&n.ForguncyData.pageDirtyCheckManager.removeDirtyStatus(),!1):(((s=window.LoadingCommand)===null||s===void 0?void 0:s.LoadingCommon)&&window.LoadingCommand.EndLoading&&(new window.LoadingCommand.EndLoading).execute(),!0)):!1},t.prototype.getDirtyElement=function(n,t){var f,r,u,e,i;if(!this._hasLoaded)return null;for(f=this.getPageIDs(n),r=0,u=f;r<u.length;r++)if(e=u[r],i=this.getDirtyElementInSinglePage(e),i)return i;return t&&(i=this.getDirtyElementInTabManager(n),i)?i:null},t.prototype.getDirtyElementInTabManager=function(n){for(var u,i,f=this.getPageDirtyCheckManagerInIframe(n),t=0,r=f;t<r.length;t++)if(u=r[t],i=u.getDirtyElement(!1,!1),i)return i;return null},t.prototype.getPageDirtyCheckManagerInIframe=function(t){for(var i,e,r,u,h=t?$("#centerDiv_"+n.ForguncyData.pageInfo.pageID):n.PageBuilder.pagesContainer,o=h.find("iframe"),s=[],f=0;f<o.length;f++)try{i=o[f].contentWindow;e=(u=(r=i===null||i===void 0?void 0:i.Forguncy)===null||r===void 0?void 0:r.ForguncyData)===null||u===void 0?void 0:u.pageDirtyCheckManager;e&&s.push(e)}catch(c){}return s},t.prototype.getPageIDs=function(t){var i=t?[]:n.ForguncyData.pageInfoStack.map(function(n){return n.pageID});return i.push(n.ForguncyData.pageInfo.pageID),i},t.prototype.getDirtyElementInSinglePage=function(n){return this.getDirtyCell(n)||this.getDirtyListview(n)},t.prototype.getDirtyCell=function(t){return n.ForguncyData.pageInfo.pageID===t?this.getDirtyCellOfCurrentPage(t):this.getDirtyCellOfParentPage(t)},t.prototype.getDirtyCellOfCurrentPage=function(n){for(var t,u=this.cells,i=0,r=u;i<r.length;i++)if(t=r[i],this.cacheSingleNormalCellInfo(t),this.isCellDirty(n,t.id))return this.cellDirtyInfo[n][t.id];return null},t.prototype.getDirtyCellOfParentPage=function(n){var t=this.cellDirtyInfo[n],i;if(!t)return null;for(i in t)if(this.isCellDirty(n,i))return t[i];return null},t.prototype.isCellDirty=function(n,t){var i,r=this.getCellDirtyInfo(n,t);return(i=r===null||r===void 0?void 0:r.isDirty)!==null&&i!==void 0?i:!1},t.prototype.getDirtyListview=function(t){return n.ForguncyData.pageInfo.pageID===t?this.getDirtyListviewOfCurrentPage(t):this.getDirtyListviewOfParentPage(t)},t.prototype.getDirtyListviewOfCurrentPage=function(n){var f,t,i,r,u;if(this.listviewDirtyInfo[n]){for(f=this.listviews,t=0,i=f;t<i.length;t++)if(r=i[t],this.cacheSingleListviewInfo(r),u=this.listviewDirtyInfo[n][r.getCalcSheetName()],this.isListviewDirty(u))return u;return null}},t.prototype.getDirtyListviewOfParentPage=function(n){var t=this.listviewDirtyInfo[n],r,i;if(!t)return null;for(r in t)if(i=t[r],this.isListviewDirty(i))return i;return null},t.prototype.isListviewDirty=function(n){return(n===null||n===void 0?void 0:n.editedValues)?n.ignoreDirty&&n.ignoreChanges&&JSON.stringify(n.editedValues)===JSON.stringify(n.ignoreChanges)?!1:!0:!1},t.prototype.shouldCheckListview=function(t){var i,r=n.PageManager.getDesignerPageName(t.runTimePageName,!1);return((i=this.pageDirtyInfos[r])===null||i===void 0?void 0:i.shouldCheck)&&this.pageDirtyInfos[r].ignoredListviews.indexOf(t.getListviewName())===-1},t.prototype.shouldCheckNormalCell=function(t){var r,u,i,f,e;return((r=t===null||t===void 0?void 0:t.cellType)===null||r===void 0?void 0:r.shouldCheckDirtyWhenLeavePage())?(i=n.Common.parseIDStr(t.id),f=n.PageManager.getDesignerPageName(i.suffix,!1),!((u=this.pageDirtyInfos[f])===null||u===void 0?void 0:u.shouldCheck))?!1:(e=this.pageDirtyInfos[f].ignoredCells.some(function(n){return n.Row===i.row&&n.Column===i.col}),e)?!1:!0:!1},t.prototype.consoleWithNewLog=function(t,i,r){if(n.ForguncyData.isDebugMode()&&t){var u=new n.CommandLogHelper;u.tryStartNewRoot();u.log(i);u.startChild();this.consoleLog(t,u,r);u.endChild();u.consoleLog()}},t.prototype.consoleLog=function(t,i,r){var f,e,o;if(n.ForguncyData.isDebugMode()&&t){if(f="",r!==null&&(f=" "+(r?n.RS.Boolean_True:n.RS.Boolean_False)),i.log(n.RS.LeaveSiteConfirm+f),i.startChild(),e=t,e.listviewName)o=n.Common.format(n.RS.LeaveSiteConsoleMessage_Listview,t.pageName+"->"+e.listviewName),i.log(o);else{var u=t,s=n.FormulaHelper.getReferenceStringByID(u.id),h=n.Common.format(n.RS.LeaveSiteConsoleMessage_Cell,u.pageName+"->"+s);i.log(h);i.startChild();i.log(n.Common.format(n.RS.LeaveSiteConsoleMessage_Cell_DefaultValue,u.defaultValue));i.log(n.Common.format(n.RS.LeaveSiteConsoleMessage_Cell_CurrentValue,u.currentValue));i.endChild()}i.endChild()}},t}();n.PageDirtyCheckManager=t})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var t;(function(n){var t=null,i=undefined,r=function(){function n(){}return n.___toOADate=function(r){return r===i||r===t?0:(typeof r=="number"&&(r=new Date(r)),(r.getTime()*1440+3181192704e6-n._getTimezoneOffset(r)*864e5)/124416e6)},n._fromOADate=function(t){if(t instanceof Date)return t;var r=t-25569,u=new Date(r*864e5),f=r>=0?1:-1,i=new Date((t*124416e6+f-3181192704e6+n._getTimezoneOffset(u)*864e5)/1440);return i.getMilliseconds()===999?new Date(i.valueOf()+1):i},n._getTimezoneOffset=function(n){var t=n.getTimezoneOffset();return t===-485&&(t=-485-43/60),t===-321&&(t=-321-10/60),t===-507&&(t=-507-52/60),t},n}();n._DateTimeHelper=r})(t=n.SpreadJSHelpMethods||(n.SpreadJSHelpMethods={}))})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var t;(function(n){var p="undefined",s="number",h="string",e="boolean",w="TRUE",b="FALSE",i=null,u=undefined,k=Math.abs,f="InvalidCastException",o=function(){function n(){}return n.getReg=function(t){var i=n.regDict[t];return i||(i=n.regDict[t]=new RegExp(t,"g")),i.lastIndex=0,i},n.getRegIgnoreCase=function(t){var i=n.regDictIgnoreCase[t];return i||(i=n.regDictIgnoreCase[t]=new RegExp(t,"gi")),i.lastIndex=0,i},n.getWildcardCriteria=function(i){if(n.wildcardParseRecord[i])return n.wildcardParseResultBuffer[i];if(n.getReg("[~?*]+").test(i)){var r=i,u=n.getReplaceSymbol("asterisk",r),f=n.getReplaceSymbol("question",r),e=n.getReplaceSymbol("tilde",r);return r=t.replace(r,"~~",e),r=t.replace(r,"~*",u),r=t.replace(r,"~?",f),r=r.replace(n.getReg("([.+$^\\[\\](){}|/])"),"\\$1"),r=t.replace(r,"*",".*"),r=t.replace(r,"?","."),r=t.replace(r,u,"\\*"),r=t.replace(r,f,"\\?"),r=t.replace(r,e,"~"),n.wildcardParseResultBuffer[i]=r,n.wildcardParseRecord[i]=!0,r}return null},n.getWildcardCriteriaFullMatch=function(t){var i=n.getWildcardCriteria(t);return i&&(i="^"+i+"$"),i},n.getReplaceSymbol=function(n,i){for(var r="#"+n+"0#",u=1;u<1e4;u++){if(i.indexOf(r)>0){r=t.replace(r,"#"+n+(u-1)+"#","#"+n+u+"#");continue}return r}},n.regDict={},n.regDictIgnoreCase={},n.wildcardParseRecord={},n.wildcardParseResultBuffer={},n}(),t,r,c,l,a,v,y;n.RegUtil=o;t=function(){function n(){}return n.replace=function(n,t,i){return n.split(t).join(i)},n}();n.StringUtil=t;r=function(){function t(){}return t.num=function(n,t){return typeof n===s||n instanceof Date||!t&&(typeof n===e||!isNaN(n)&&!isNaN(parseFloat(n)))},t._isNaNOrInfinite=function(n){return isNaN(n)||!isFinite(n)},t.I=function(n){var i=t.D(n);if(k(i)<1e21)return parseInt(i,10);throw f;},t.D=function(n){var i={value:0};if(t.rD(n,i))return i.value;throw f;},t.rD=function(r,u){var f=i,o,a,c,l;if(!r)return u.value=0,!0;o=typeof r;try{if(o===s)f=r;else if(o===h){if(r=r.trim(),r.length===0)return u.value=0,!0;if(a=!1,r.charAt(r.length-1)==="%"&&(a=!0,r=r.substr(0,r.length-1)),r.length>=2&&r[0]==="0"&&r[1]==="x")return!1;if(f=Number(r),t._isNaNOrInfinite(f)){if((c=r.charCodeAt(0),c|=32,r.length>4&&c>=96&&c<=122&&(l=r[0]+r[1]+r[2],l=l.toUpperCase(),!t.monthStrings[l]))||r[0]==="/"||r[r.length-1]==="/"||(f=new Date(r),t._isNaNOrInfinite(f.valueOf())))return!1;f=n._DateTimeHelper.___toOADate(f)}a&&(f/=100)}else if(o===e)f=r?1:0;else if(r instanceof Date)f=n._DateTimeHelper.___toOADate(r);else return!1}catch(v){return!1}return u.value=f,!0},t.arr=function(n){return n instanceof GC.Spread.CalcEngine.CalcArray},t.S=function(r){try{if(typeof r===p||r===i)return"";if(typeof r===e)return r?w:b;if(typeof r===h)return r;if(r instanceof Date)return n._DateTimeHelper.___toOADate(r).toString();if(t.arr(r))throw f;else return r.toString()}catch(u){throw f;}},t.monthStrings={JAN:1,FEB:2,MAR:3,APR:4,MAY:5,JUN:6,JUL:7,AUG:8,SEP:9,OCT:10,NOV:11,DEC:12},t}();n.Convert=r;c=function(){function n(){}return n._argumentExists=function(t,i){return t&&i<t.length&&t[i]!==n.missingArgument},n.missingArgument={},n}();n._Helper=c;l=function(){function n(){}return n._buildCriteria=function(n,t){var f,l,e,s,a,c,h,v;switch(n){case 0:f=function(n,t){return n<=t};e=function(n,t){return n<=t};break;case 1:f=function(n,t){return n>=t};e=function(n,t){return n>=t};break;case 2:f=function(n,t){return n!==t};e=function(n,t){return n!==t};break;case 3:f=function(n,t){return n<t};e=function(n,t){return n<t};break;case 4:f=function(n,t){return n===t};e=function(n,t){return n===t};s=o.getWildcardCriteriaFullMatch(t);s&&(a=o.getRegIgnoreCase(s),l=function(n){return a.lastIndex=0,a.test(n)});break;case 5:f=function(n,t){return n>t};e=function(n,t){return n>t};break;default:return function(){return!1}}c=-1;h=!0;try{v={value:0};t===u||t===i?c=0:s?h=!1:r.rD(t.toString(),v)?c=v.value:h=!1}catch(y){h=!1}return function(n){if((n===u||n===i)&&(n=""),h)try{var o={value:0};if(r.rD(n,o))return e(o.value,c)}catch(a){}return s&&l?l(n.toString()):f(n.toString().toUpperCase(),t!==u&&t!==i?t.toString().toUpperCase():"")}},n._parseCriteria=function(t){var s=t,e=n.criteriaCaches,f,c,l;if(e||(n.criteriaCaches=e={}),f=e[s],f)return f;if(r.num(t))return e[s]=n._buildCriteria(4,t);var o=t!==u&&t!==i?t.toString().toUpperCase():"",h='\0';for(c=0;c<2&&c<o.length;c++)if(l=o[c],"=><".indexOf(l)!==-1){if(l==="="){switch(h){case"<":f=n._buildCriteria(0,o.substring(2));break;case">":f=n._buildCriteria(1,o.substring(2));break;default:f=n._buildCriteria(4,h==='\0'?o.substring(1):t)}return e[s]=f,f}if(h==='\0'){h=l;continue}if(h==="<")return f=l===">"?n._buildCriteria(2,o.substring(2)):n._buildCriteria(3,o.substring(1)),e[s]=f,f;if(h===">")return e[s]=f=n._buildCriteria(5,o.substring(1)),f}else switch(h){case"<":return e[s]=f=n._buildCriteria(3,o.substring(1)),f;case">":return e[s]=f=n._buildCriteria(5,o.substring(1)),f}return f=n._buildCriteria(4,t),e[s]=f,f},n}();n._MathHelper=l;a=function(){function n(){}return n.getPreferredZIndex=function(n){for(var t=n,i,r;t&&t.parentElement&&t.parentElement!==document.body;)t=t.parentElement;return i=1e3,t&&t.parentElement===document.body&&(r=parseInt($(t).css("z-index")),isNaN(r)||(i+=r)),i},n.getLinearGradientColors=function(n){var s,u,h,t,c;if(!n)return[];var y=n.indexOf("("),p=n.lastIndexOf(")"),i=n.substring(y+1,p);if(!i)return[];for(var e=[],o=0,l="";0<i.length;)s=i.indexOf("rgb",o),u=i.indexOf("rgb",o+1),u===-1&&(u=i.length),l=i.substring(s,u),e.push(l),o=s=u;for(h=[],t=0,c=e.length;t<c;t++){var f=e[t],a=f.indexOf(")"),v=f.substring(0,a+1),r=parseFloat(f.substring(a+1,f.length));(isNaN(r)&&(t===c-1?r=100:t<=1&&(r=0)),v||t!==0)&&(r=r/100,h.push({color:v,point:r}))}return h},n}();n.util=a;v=function(){function n(){}return n.paintBackground=function(t,i,r,u,f,e,o,s,h,c,l,a){(c===void 0&&(c=0),l===void 0&&(l=0),a===void 0&&(a=null),e||o)&&(t.save(),t.beginPath(),e&&(t.fillStyle!==e&&(t.fillStyle=e),t.fillRect(i,r,u,f)),a&&(i=a.x,r=a.y,u=a.width,f=a.height),n.paintBackgroundImage(t,i,r,u,f,o,s,h,c,l),t.restore())},n.paintBackgroundImage=function(n,t,i,r,u,f,e,o,s,h){if(s===void 0&&(s=0),h===void 0&&(h=0),f&&f!=="none"&&o)try{if(o.getState(f)){var w=o.getImage(f),c=w.width||s,l=w.height||h,a=c,v=l,y=r,p=u,b=t,k=i;e===1?(a=r>=c?c:r,v=u>=l?l:u,b=r>c&&c>0?Math.ceil(t+r/2-c/2):t,k=u>l&&l>0?Math.ceil(i+u/2-l/2):i,y=a,p=v):e===2?u>0&&l>0&&r/u>c/l?(y=c/l*u,b=t+r/2-y/2):r>0&&c>0&&u/r>l/c&&(p=l/c*r,k=i+u/2-p/2):e===3&&(a=r>=c?c:r,v=u>=l?l:u,y=a,p=v);n.drawImage(w,0,0,a,v,b,k,y,p)}else o.addImage(f)}catch(d){}},n.paintHeaderCellGridline=function(n,t,i,r,u,f,e,o,s,h,c){var l;s===1?(n.beginPath(),l=n.createLinearGradient(t,i+1,t,i+u-2),l.addColorStop(0,o.borderLeftColor),l.addColorStop(1,o.borderRightColor),n.strokeStyle!==l&&(n.strokeStyle=l),f.borderLeft||(n.moveTo(t+.5,i),n.lineTo(t+.5,i+u)),f.borderRight||(n.moveTo(t+r-.5,i),n.lineTo(t+r-.5,i+u)),h&&!f.borderTop&&(n.moveTo(t,i+.5),n.lineTo(t+r,i+.5)),n.stroke(),o.borderBottomWidth&&!f.borderBottom&&(n.beginPath(),n.strokeStyle!==o.borderBottomColor&&(n.strokeStyle=o.borderBottomColor),n.moveTo(t+1,i+u-.5),n.lineTo(t+r,i+u-.5),n.stroke())):(n.beginPath(),l=n.createLinearGradient(t,i,t+r-2,i),l.addColorStop(0,o.borderTopColor),l.addColorStop(1,o.borderBottomColor),n.strokeStyle!==l&&(n.strokeStyle=l),f.borderTop||(n.moveTo(t,i+.5),n.lineTo(t+r,i+.5)),f.borderBottom||(n.moveTo(t,i+u-.5),n.lineTo(t+r,i+u-.5)),c&&!f.borderLeft&&(n.moveTo(t+.5,i),n.lineTo(t+.5,i+u)),n.stroke(),o.borderRightWidth&&!f.borderRight&&(n.beginPath(),n.strokeStyle!==o.borderRightColor&&(n.strokeStyle=o.borderRightColor),n.moveTo(t+r-.5,i+1),n.lineTo(t+r-.5,i+u),n.stroke()))},n}();n.CellTypeContext=v;y=function(){function n(){}return n.getVisualStateName=function(n){for(var t in GC.Spread.Sheets.VisualState)if(GC.Spread.Sheets.VisualState[t]===n)return t.toLowerCase();return null},n}();n.HelpMethods=y})(t=n.SpreadJSHelpMethods||(n.SpreadJSHelpMethods={}))})(Forguncy||(Forguncy={}))
;(function(){function u(n){return!!n.exifdata}function v(n,t){var i;t=t||n.match(/^data\:([^\;]+)\;base64,/mi)[1]||"";n=n.replace(/^data\:([^\;]+)\;base64,/gmi,"");var r=atob(n),u=r.length,f=new ArrayBuffer(u),e=new Uint8Array(f);for(i=0;i<u;i++)e[i]=r.charCodeAt(i);return f}function y(n,t){var i=new XMLHttpRequest;i.open("GET",n,!0);i.responseType="blob";i.onload=function(){(this.status==200||this.status===0)&&t(this.response)};i.send()}function p(n,t){function f(i){var r=s(i),u=w(i);n.exifdata=r||{};n.iptcdata=u||{};t&&t.call(n)}var e,r,u;n.src?/^data\:/i.test(n.src)?(e=v(n.src),f(e)):/^blob\:/i.test(n.src)?(u=new FileReader,u.onload=function(n){f(n.target.result)},y(n.src,function(n){u.readAsArrayBuffer(n)})):(r=new XMLHttpRequest,r.onload=function(){if(this.status==200||this.status===0)f(r.response);else throw"Could not load image";r=null},r.open("GET",n.src,!0),r.responseType="arraybuffer",r.send(null)):window.FileReader&&(n instanceof window.Blob||n instanceof window.File)&&(u=new FileReader,u.onload=function(n){i&&console.log("Got file of length "+n.target.result.byteLength);f(n.target.result)},u.readAsArrayBuffer(n))}function s(n){var r=new DataView(n),t,f,u;if(i&&console.log("Got file of length "+n.byteLength),r.getUint8(0)!=255||r.getUint8(1)!=216)return i&&console.log("Not a valid JPEG"),!1;for(t=2,f=n.byteLength;t<f;){if(r.getUint8(t)!=255)return i&&console.log("Not a valid marker at offset "+t+", found: "+r.getUint8(t)),!1;if(u=r.getUint8(t+1),i&&console.log(u),u==225)return i&&console.log("Found 0xFFE1 marker"),d(r,t+4,r.getUint16(t+2)-2);t+=2+r.getUint16(t+2)}}function w(n){var u=new DataView(n),t,f,e;if(i&&console.log("Got file of length "+n.byteLength),u.getUint8(0)!=255||u.getUint8(1)!=216)return i&&console.log("Not a valid JPEG"),!1;for(var r=2,o=n.byteLength,s=function(n,t){return n.getUint8(t)===56&&n.getUint8(t+1)===66&&n.getUint8(t+2)===73&&n.getUint8(t+3)===77&&n.getUint8(t+4)===4&&n.getUint8(t+5)===4};r<o;){if(s(u,r))return t=u.getUint8(r+7),t%2!=0&&(t+=1),t===0&&(t=4),f=r+8+t,e=u.getUint16(r+6+t),b(n,f,e);r++}}function b(n,t,i){for(var s=new DataView(n),r={},h,u,c,l,a,o=t;o<t+i;)s.getUint8(o)===28&&s.getUint8(o+1)===2&&(l=s.getUint8(o+2),l in e&&(c=s.getInt16(o+3),a=c+5,u=e[l],h=f(s,o+5,c),r.hasOwnProperty(u)?r[u]instanceof Array?r[u].push(h):r[u]=[r[u],h]:r[u]=h)),o++;return r}function o(n,t,r,u,f){for(var c=n.getUint16(r,!f),h={},e,s,o=0;o<c;o++)e=r+o*12+2,s=u[n.getUint16(e,!f)],!s&&i&&console.log("Unknown tag: "+n.getUint16(e,!f)),h[s]=k(n,e,t,r,f);return h}function k(n,t,i,r,u){var y=n.getUint16(t+2,!u),s=n.getUint32(t+4,!u),h=n.getUint32(t+8,!u)+i,c,o,v,e,l,a;switch(y){case 1:case 7:if(s==1)return n.getUint8(t+8,!u);for(c=s>4?h:t+8,o=[],e=0;e<s;e++)o[e]=n.getUint8(c+e);return o;case 2:return c=s>4?h:t+8,f(n,c,s-1);case 3:if(s==1)return n.getUint16(t+8,!u);for(c=s>2?h:t+8,o=[],e=0;e<s;e++)o[e]=n.getUint16(c+2*e,!u);return o;case 4:if(s==1)return n.getUint32(t+8,!u);for(o=[],e=0;e<s;e++)o[e]=n.getUint32(h+4*e,!u);return o;case 5:if(s==1)return l=n.getUint32(h,!u),a=n.getUint32(h+4,!u),v=new Number(l/a),v.numerator=l,v.denominator=a,v;for(o=[],e=0;e<s;e++)l=n.getUint32(h+8*e,!u),a=n.getUint32(h+4+8*e,!u),o[e]=new Number(l/a),o[e].numerator=l,o[e].denominator=a;return o;case 9:if(s==1)return n.getInt32(t+8,!u);for(o=[],e=0;e<s;e++)o[e]=n.getInt32(h+4*e,!u);return o;case 10:if(s==1)return n.getInt32(h,!u)/n.getInt32(h+4,!u);for(o=[],e=0;e<s;e++)o[e]=n.getInt32(h+8*e,!u)/n.getInt32(h+4+8*e,!u);return o}}function f(t,i,r){var u="";for(n=i;n<i+r;n++)u+=String.fromCharCode(t.getUint8(n));return u}function d(n,t){var h,v,u,e,y,s,p;if(f(n,t,4)!="Exif")return i&&console.log("Not valid EXIF data! "+f(n,t,4)),!1;if(s=t+6,n.getUint16(s)==18761)h=!1;else if(n.getUint16(s)==19789)h=!0;else return i&&console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)"),!1;if(n.getUint16(s+2,!h)!=42)return i&&console.log("Not valid TIFF data! (no 0x002A)"),!1;if(p=n.getUint32(s+4,!h),p<8)return i&&console.log("Not valid TIFF data! (First offset less than 8)",n.getUint32(s+4,!h)),!1;if(v=o(n,s,s+p,l,h),v.ExifIFDPointer){e=o(n,s,s+v.ExifIFDPointer,c,h);for(u in e){switch(u){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":e[u]=r[u][e[u]];break;case"ExifVersion":case"FlashpixVersion":e[u]=String.fromCharCode(e[u][0],e[u][1],e[u][2],e[u][3]);break;case"ComponentsConfiguration":e[u]=r.Components[e[u][0]]+r.Components[e[u][1]]+r.Components[e[u][2]]+r.Components[e[u][3]]}v[u]=e[u]}}if(v.GPSInfoIFDPointer){y=o(n,s,s+v.GPSInfoIFDPointer,a,h);for(u in y){switch(u){case"GPSVersionID":y[u]=y[u][0]+"."+y[u][1]+"."+y[u][2]+"."+y[u][3]}v[u]=y[u]}}return v}var i=!1,h=this,t=function(n){if(n instanceof t)return n;if(!(this instanceof t))return new t(n);this.EXIFwrapped=n},e;typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=t),exports.EXIF=t):h.EXIF=t;var c=t.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},l=t.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},a=t.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},r=t.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}};e={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"};t.getData=function(n,t){return(n instanceof Image||n instanceof HTMLImageElement)&&!n.complete?!1:(u(n)?t&&t.call(n):p(n,t),!0)};t.getTag=function(n,t){if(u(n))return n.exifdata[t]};t.getAllTags=function(n){if(!u(n))return{};var t,i=n.exifdata,r={};for(t in i)i.hasOwnProperty(t)&&(r[t]=i[t]);return r};t.pretty=function(n){if(!u(n))return"";var t,i=n.exifdata,r="";for(t in i)i.hasOwnProperty(t)&&(r+=typeof i[t]=="object"?i[t]instanceof Number?t+" : "+i[t]+" ["+i[t].numerator+"/"+i[t].denominator+"]\r\n":t+" : ["+i[t].length+" values]\r\n":t+" : "+i[t]+"\r\n");return r};t.readFromBinaryFile=function(n){return s(n)};typeof define=="function"&&define.amd&&define("exif-js",[],function(){return t})}).call(this)
;var Forguncy;(function(n){var f,e,o,s,h,t,i,r,u,c,l;(function(n){n.MasterPage="MasterPage";n.ChangePassword="ChangePassword";n.ForgetPassword="ForgetPassword";n.ChangeUserSettings="ChangeUserSettings";n.Login="Login";n.ResetPasswordMailSended="ResetPasswordMailSended";n.ResetPassword="ResetPassword";n.Pag401="Pag401";n.MaintenancePage="MaintenancePage";n.MailSubscriptPage="MailSubscriptPage";n.MFA_ScanBarcodePage="MFA_ScanBarcodePage";n.MFA_VerifyCodePage="MFA_VerifyCodePage";n.Disconnected="Disconnected"})(f=n.BuiltInPageType||(n.BuiltInPageType={})),function(n){n[n.ParamNamePreferred=0]="ParamNamePreferred";n[n.CellNamePreferred=1]="CellNamePreferred"}(e=n.NameConflictPolicy||(n.NameConflictPolicy={})),function(n){n[n.CSSAnimation=0]="CSSAnimation";n[n.LocalImage=1]="LocalImage";n[n.RemoteImage=2]="RemoteImage"}(o=n.LoadingType||(n.LoadingType={})),function(n){n[n.FlowerLoading=0]="FlowerLoading";n[n.PixelLoading=1]="PixelLoading";n[n.OrbitLoading=4]="OrbitLoading";n[n.RadarLoading=5]="RadarLoading";n[n.HalfCircleLoading=7]="HalfCircleLoading";n[n.FulfillingSquareLoading=9]="FulfillingSquareLoading";n[n.SwappingSquaresLoading=13]="SwappingSquaresLoading";n[n.FulfillingBouncingCircleLoading=14]="FulfillingBouncingCircleLoading";n[n.SpringLoading=16]="SpringLoading";n[n.AtomLoading=17]="AtomLoading";n[n.BreedingRhombusLoading=19]="BreedingRhombusLoading";n[n.DefaultLoading=20]="DefaultLoading"}(s=n.LoadingAnimation||(n.LoadingAnimation={})),function(n){n[n.None=0]="None";n[n.Custom=1]="Custom";n[n.Insert=2]="Insert";n[n.Delete=3]="Delete";n[n.Duplicate=4]="Duplicate"}(h=n.ContextMenuOperationType||(n.ContextMenuOperationType={}));t=function(){function n(){}return n}();n.DataValidationInfo=t;i=function(){function n(){}return n}();n.TableDataCache=i;r=function(){function n(){}return n}();n.ValueAndFormatPair=r;u=function(){function n(){}return n}();n.OffsetConditionInfo=u,function(n){n[n.None=0]="None";n[n.MouseWheel=1]="MouseWheel";n[n.SpinButton=2]="SpinButton";n[n.UpDownKeys=4]="UpDownKeys";n[n.All=7]="All"}(c=n.SpinType||(n.SpinType={})),function(n){n[n.Custom=0]="Custom";n[n.BuiltInIcon=1]="BuiltInIcon";n[n.Theme=2]="Theme";n[n.BuiltInBackground=3]="BuiltInBackground"}(l=n.PictureSourceType||(n.PictureSourceType={}))})(Forguncy||(Forguncy={}))
;var __assign=this&&this.__assign||function(){return __assign=Object.assign||function(n){for(var t,r,i=1,u=arguments.length;i<u;i++){t=arguments[i];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},__assign.apply(this,arguments)},Forguncy;(function(n){var e=function(){function i(){this.paramStack=[];this.paramToReference=[];this.paramStack.push({});this.paramToReference.push({})}return i.prototype.setValue=function(i,r,u){var f,e;if(u===void 0&&(u=t.commandLogHelper),r=r!==null&&r!==void 0?r:null,f=r+"",typeof r=="object")try{f=JSON.stringify(r)}catch(o){}u&&(e=n.Common.format(n.RS.ServerCommandLog_CreateParam,i,f),u.isRootActive?u.log(e):console.log(e));this.getCurrent()[i]=r},i.prototype.getValue=function(n){return this.getCurrent()[n]},i.prototype.clearCommandParams=function(){this.paramStack=[{}];this.paramToReference=[{}]},i.prototype.push=function(){this.paramStack.push({});this.paramToReference.push({})},i.prototype.pop=function(){this.paramStack.pop();this.paramToReference.pop()},i.prototype.getCurrent=function(){return this.paramStack[this.paramStack.length-1]},i.prototype.ParamToReference=function(t){var r=t,o=!1,f,u,e,i;if((r===null||r===void 0?void 0:r.startsWith("="))&&(r=r.substring(1),o=!0),f=this.getCurrentParamToExpression(),f&&t)try{if(u=n.FormulaHelper.parse(t),e=new n.UpdateParamReferVisitor(f),u=e.visit(u,0,0),e.Updated&&(i=n.FormulaHelper.unparse(u),i))return i[0]!=="="&&o&&(i="="+i),i}catch(s){return t}return t},i.prototype.SetParamToReference=function(n,i){var r,u=this.getCurrentParamToExpression(),f;u&&((r=u[n])===null||r===void 0?void 0:r.original)!==i&&this.IsReference(i)&&(f=t.parameterManager.ParamToReference(i),u[n]={original:i,"new":f})},i.prototype.IsReference=function(t){if(n.Common.IsEmpty(t)||typeof t!="string")return!1;try{var i=n.FormulaHelper.parse(t);return this.IsReferenceExpr(i)}catch(r){return!1}},i.prototype.IsReferenceExpr=function(n){if(n.type===GC.Spread.CalcEngine.ExpressionType.name||n.type===GC.Spread.CalcEngine.ExpressionType.reference)return!0;if(n.type===GC.Spread.CalcEngine.ExpressionType.operator){var t=n;if(t.operatorType===16)return this.IsReferenceExpr(t.value)&&this.IsReferenceExpr(t.value2)}return!1},i.prototype.NeedUpdateReference=function(t){var i,u,r;if((t===null||t===void 0?void 0:t.startsWith("="))&&(t=t.substring(1)),!t)return!1;if(i=this.getCurrentParamToExpression(),i&&t)try{return u=n.FormulaHelper.parse(t),r=new n.UpdateParamReferVisitor(i),r.visit(u,0,0),r.Updated}catch(f){return!1}return!1},i.prototype.getCurrentParamToExpression=function(){return this.paramToReference.length===0?null:this.paramToReference[this.paramToReference.length-1]},i}(),i,r,t,u,f,o,s,h;n.ParameterManager=e;i=function(){function n(){this.children=[]}return n.prototype.initStartTime=function(){return this.startTime=new Date,this},n}();r=function(){function r(){this.logRootStack=[];this.suspendCount=0;this.isRootActive=!1}return r.prototype.tryStartNewRoot=function(){this.isRootActive||(this.logRootStack=[(new i).initStartTime()],this.isRootActive=!0)},r.prototype.getStackLength=function(){return this.logRootStack.length},r.prototype.suspend=function(){this.suspendCount+=1},r.prototype.resume=function(){this.suspendCount-=1},r.prototype.startChild=function(){if(t.isDebugMode()){var n=this.getCurrentLogRoot().children;return this.logRootStack.push(n[n.length-1].initStartTime()),this.logRootStack.length-1}},r.prototype.endChild=function(){t.isDebugMode()&&this.logRootStack.pop()},r.prototype.log=function(n){var r,u;t.isDebugMode()&&(r=this.getCurrentLogRoot(),r&&(u=new i,u.logText=n,r.children.push(u)))},r.prototype.logAdditionalText=function(n,i){if(t.isDebugMode()&&!(n<0)&&!(n>=this.logRootStack.length)){var r=this.logRootStack[n];r&&(r.logText+=" "+i)}},r.prototype.logDuring=function(){var n=this.getCurrentLogRoot();n&&(n.logText+=this.getDuring())},r.prototype.logGroupedText=function(n){for(var l,h,u,f=n.trim().split("\r\n"),a=f.length,e=0,t=0;t<a;t++){var c=f[t],o=c.trim(),s=f[t+1],i=c.search(/\S/),r=(u=s===null||s===void 0?void 0:s.search(/\S/))!==null&&u!==void 0?u:0;if(t===0||r>i)this.log(o),this.startChild(),e++;else if(r===i)this.log(o);else if(r<i)for(this.log(o),l=(i-r)/4,h=0;h<l;h++)this.endChild(),e--}while(e-->0)this.endChild()},r.prototype.consoleLog=function(i){(i===void 0&&(i=!0),t.isDebugMode())&&(this.suspendCount>0||(n.Platform.isChrome()&&!n.MetadataLoader.loadVConsole()?this.consoleGroupedLog(this.logRootStack[0],0):this.consolePlainTextLog(this.logRootStack[0],""),i&&console.log(""),this.logRootStack=[],this.isRootActive=!1))},r.prototype.consoleGroupedLog=function(n,t){var u,f,i,r;for(n!==this.logRootStack[0]&&(t<=2?console.group((u=n.logText)!==null&&u!==void 0?u:""):console.groupCollapsed((f=n.logText)!==null&&f!==void 0?f:"")),i=0;i<n.children.length;i++)r=n.children[i],r.children.length===0?console.log(r.logText):this.consoleGroupedLog(r,t+1);n!==this.logRootStack[0]&&console.groupEnd()},r.prototype.consolePlainTextLog=function(n,t){n!==this.logRootStack[0]&&(console.log(t+n.logText),t=t+"    ");for(var i=0;i<n.children.length;i++)this.consolePlainTextLog(n.children[i],t)},r.prototype.getCurrentLogRoot=function(){return this.logRootStack[this.logRootStack.length-1]},r.prototype.getDuring=function(){var t=this.getCurrentLogRoot().startTime,i=new Date,r=i.getTime()-t.getTime();return" "+n.Common.format(n.RS.UseTime,r)},r}();n.CommandLogHelper=r;t=function(){function t(){}return Object.defineProperty(t,"commandExcutor",{get:function(){return this.commandExecutor},enumerable:!1,configurable:!0}),t.Init=function(){n.ForguncyData.forceMobileChild||(n.ForguncyData.forceMobileChild=n.Common.GetUrlQuery("mobileChild")==="true"||n.MetadataLoader.IsInMobileSimulatorFrame());n.ForguncyData.pageInfo=new f;n.ForguncyData.userInfo=new u;n.ForguncyData.commandExecutor=new n.CommandExecutor;n.ForguncyData.pageInfoStack=[];n.DelayOperateHelper.init();n.ForguncyData.pageingInfoList=new n.PageingInfoList;n.ListviewBase.init();n.PageBuilder.init();t.pageDirtyCheckManager=new n.PageDirtyCheckManager;"scrollRestoration"in history&&(history.scrollRestoration="manual")},t.initGlobalSettings=function(i){var u,r,f;t.IsAutoTest=i.IsAutoTest;t.AuthenticationType=i.AuthenticationType;t.SecurityProviderValidateType=i.SecurityProviderValidateType;t.PageBindingTables=JSON.parse(i.PageBindingTables||null)||{};r=JSON.parse(i.ThemeData);n.ColorHelper.Colors=r.Colors;n.ColorHelper.ColorCache={};t.GlobalSettings=JSON.parse(i.GlobalSetting);t.GlobalSettings.ThemeFont=r.EnFontFamily;t.GlobalSettings.ThemeBasePath=r.ThemeBasePath;t.GlobalSettings.ListViewTemplates=JSON.parse(i.ListViewStyleTemplates);this.fillDefaultValuesOfListviewTemplate();t.GlobalSettings.CellTypeStyleTemplates=JSON.parse(i.CellTypeStyleTemplates);t.GlobalSettings.HasWorkflow=i.HasWorkflow;t.GlobalSettings.HasProcess=i.HasProcess;t.GlobalSettings.PageUIPermissions=t.parsePageUIPermissions(i.PageUIPermissions);t.GlobalSettings.CellPermissionDataContext=t.parseCellPermissionDataContext(i.CellPermissionDataContext);t.GlobalSettings.CommandsDependenceModels=JSON.parse(i.CommandsDependenceModels);n.BuiltInPageManager.builtInPages=JSON.parse(i.BuiltInPages);t.GlobalSettings.HasNotification=i.HasNotification;f=n.StaticData.ForguncyRoot.replace(/\/$/,"");t.GlobalSettings.ListviewLoadingIndicatorContentDom=(u=i.ListviewLoadingIndicatorContentDom)===null||u===void 0?void 0:u.replace("#PathBase#",f);t.GlobalSettings.MultipleLanguageSettings=JSON.parse(i.MultipleLanguageSettings+"");n.HubManager.Init()},t.getPageLayout=function(n,i){return t.pageInfo.pageID==n?t.pageInfo.pageLayouts[i]:t.pageInfoStack.filter(function(t){return t.pageID==n})[0].pageLayouts[i]},t.parsePageUIPermissions=function(t){if(n.Common.IsEmpty(t))return null;var i=JSON.parse(t).PageUIPermissions;return!i||Object.getOwnPropertyNames(i).length===0?null:i},t.parseCellPermissionDataContext=function(t){if(n.Common.IsEmpty(t))return null;var i=JSON.parse(t);return!i||Object.getOwnPropertyNames(i).length===0?null:i},t.fillDefaultValuesOfListviewTemplate=function(){var r=new n.ListViewStyleTemplate,i;if(t.GlobalSettings.ListViewTemplates)for(i=0;i<t.GlobalSettings.ListViewTemplates.length;i++)t.GlobalSettings.ListViewTemplates[i]=__assign(__assign({},r),t.GlobalSettings.ListViewTemplates[i])},t.updatePopupCoverVisbility=function(n){var i,r,u;if(n)i=this.pageInfo.dialogUI,i&&i.target.displayMode!==1&&t.pageInfoStack.forEach(function(n){var t;(t=n.dialogUI)===null||t===void 0?void 0:t.cover.css("opacity","0")});else if(i=this.pageInfo.dialogUI,i)if(i.target.displayMode!==1)i.cover.css("opacity","");else for(r=t.pageInfoStack.length-1;r>=0;r--)if(u=t.pageInfoStack[r],u.dialogUI&&u.dialogUI.target.displayMode!==1){u.dialogUI.cover.css("opacity","");break}},t.getRelatedTableWithForeignKey=function(n){var i=[];return t.getRelatedTablesWithForeignKeyInternal(n,i),i},t.initListviewPaginationInfo=function(i,r,u){var f=n.ListviewBase.getLocationString(i,r);t.pageingInfoList.Init(f,u)},t.getRelatedTablesWithForeignKeyInternal=function(i,r){if(!n.Common.IsEmpty(n.ForguncyData.pageInfo.PrimaryTableForeignKeyInfo)&&!n.Common.IsEmpty(n.ForguncyData.pageInfo.PrimaryTableForeignKeyInfo[i])){var u=n.ForguncyData.pageInfo.PrimaryTableForeignKeyInfo[i];u.forEach(function(n){r.indexOf(n)===-1&&(r.push(n),t.getRelatedTablesWithForeignKeyInternal(n,r))})}},t.getPageInfo=function(n){var i,r,u;if(t.pageInfo.pageID===n)return t.pageInfo;if(t.pageInfoStack)for(i=0,r=t.pageInfoStack;i<r.length;i++)if(u=r[i],u.pageID===n)return u;return null},t.isDebugMode=function(){return this.IsDebugModeOnServer||n.StaticData.IsDebugMode},t.alwaysUsePAsRunTimePageName=function(){return n.StaticData.IsDesignerPreview||!t.GlobalSettings.KeepMasterPage},t.isMobileCoverPage=function(){var t,i;return((i=(t=n.ForguncyData.pageInfo.dialogUI)===null||t===void 0?void 0:t.target)===null||i===void 0?void 0:i.displayMode)===4&&n.Platform.isMobile()},t.getParentPages=function(){var n,i,r=(i=(n=t.pageInfoStack)===null||n===void 0?void 0:n.map(function(n){return n.pageName}))!==null&&i!==void 0?i:[];return r.push(t.pageInfo.pageName),r.join("|")},t.ForguncyRoot=n.StaticData.ForguncyRoot,t.UserProfileAvatorVersion="",t.parameterManager=new e,t.commandLogHelper=new r,t}();n.ForguncyData=t;u=function(){function t(){this._requestPropertyValueCache={}}return Object.defineProperty(t.prototype,"UserName",{get:function(){return this._userName},set:function(t){this._userName=t;n.HubManager.UpdateUserName()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"OrganizationSuperior",{get:function(){return this._organizationSuperiorSet||this.RequestOrganizationSuperiorAsync(),this._organizationSuperior},set:function(n){this._organizationSuperior=n;this._organizationSuperiorSet=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Properties",{get:function(){return this._propertiesSet||this.RequestCustomProps(),this._properties},set:function(n){this._properties=n;this._propertiesSet=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"OrganizationLevelValues",{get:function(){return this._organizationLevelValuesSet||this.GetOrgLevelProps(),this._organizationLevelValues},set:function(n){this._organizationLevelValues=n;this._organizationLevelValuesSet=!0},enumerable:!1,configurable:!0}),t.prototype.RequestOrganizationSuperiorAsync=function(){var t=this;this.UserName&&n.Common.forguncyPostSync("Account/GetCurrentUserOrganizationSuperior",null,function(n){t.OrganizationSuperior=n})},t.prototype.GetOrgLevelProps=function(){var t=this;this.UserName&&n.Common.forguncyPostSync("Account/GetOrgLevelProps",null,function(n){t.OrganizationLevelValues=n})},t.prototype.RequestCustomProps=function(){var t=this;this.UserName&&n.Common.forguncyPostSync("Account/GetCustomProps",null,function(n){t.Properties=n})},t.prototype.GetCustomPropertyValue=function(t){var f=this,i,r,u;if(!this.UserName)return{Find:!1,Value:null};if(this._requestPropertyValueCache[t])return this._requestPropertyValueCache[t];if(this._propertiesSet){if(this._properties)for(i=0;i<this._properties.length;i++)if(r=this._properties[i],r.PropertyName===t)return{Find:!0,Value:r.Value};return{Find:!1,Value:null}}return n.Common.forguncyPostSync("Account/GetCustomPropertyValue",{propertyName:t},function(n){u=n;f._requestPropertyValueCache[t]=n}),u},t}();n.UserInfoImp=u;f=function(){function i(){this.columnFilterQueryCache={};this.runtimeQueryConditionDataCache={};this.pageLayouts={};this.allowZoomScreen=!1;this.moveFocusByEnter=!1;this.runTimeNormalPage=n.StaticValues.RunTimeNormalPagePrefix;this.runTimeMasterPage=n.StaticValues.RunTimeMasterPagePrefix;this.extraDialogCount=0}return Object.defineProperty(i.prototype,"hasExtraDialog",{get:function(){return this.extraDialogCount&&this.extraDialogCount>0},enumerable:!1,configurable:!0}),i.getCurrentPageInfo=function(){var r=n.ForguncyData.pageInfo,t=new i;return t.pageElementManager=r.pageElementManager,t.commandQuerys=r.commandQuerys,t.sortInfoCache=r.sortInfoCache,t.columnFilterQueryCache=r.columnFilterQueryCache,t.runtimeQueryConditionDataCache=r.runtimeQueryConditionDataCache,t.formulaManager=r.formulaManager,t.dataModel=r.dataModel,t.currentRowInfoCollection=r.currentRowInfoCollection,t.normalCellBindingManager=r.normalCellBindingManager,t.pageName=r.pageName,t.pageTitle=r.pageTitle,t.masterPageName=r.masterPageName,t.pageID=r.pageID,t.enableTabIndex=__assign({},r.enableTabIndex||{}),t.ReturnUrl=r.ReturnUrl,t.noPermissionPage=r.noPermissionPage,t.PrimaryTableForeignKeyInfo=r.PrimaryTableForeignKeyInfo,t.pageStretchInfos=r.pageStretchInfos,t.pageLayouts=r.pageLayouts,t.defaultFormulaManager=r.defaultFormulaManager,t.dependenceCellValueChangedEventHandlers=r.dependenceCellValueChangedEventHandlers,t.dialogUI=r.dialogUI,t.extraDialogCount=r.extraDialogCount,t.isPopup=r.isPopup,t.allowZoomScreen=r.allowZoomScreen,t.autoIDManager=r.autoIDManager,t.runTimeNormalPage=r.runTimeNormalPage,t.runTimeMasterPage=r.runTimeMasterPage,t.ConditionalFormattingMetadata=r.ConditionalFormattingMetadata,t},i.setCurrentPageInfo=function(t){var i=n.ForguncyData.pageInfo;i.pageElementManager=t.pageElementManager;i.commandQuerys=t.commandQuerys;i.sortInfoCache=t.sortInfoCache;i.columnFilterQueryCache=t.columnFilterQueryCache;i.runtimeQueryConditionDataCache=t.runtimeQueryConditionDataCache;i.formulaManager=t.formulaManager;i.dataModel=t.dataModel;i.currentRowInfoCollection=t.currentRowInfoCollection;i.normalCellBindingManager=t.normalCellBindingManager;i.pageName=t.pageName;i.pageTitle=t.pageTitle;i.masterPageName=t.masterPageName;i.pageID=t.pageID;i.enableTabIndex=__assign({},t.enableTabIndex||{});i.ReturnUrl=t.ReturnUrl;i.noPermissionPage=t.noPermissionPage;i.PrimaryTableForeignKeyInfo=t.PrimaryTableForeignKeyInfo;i.pageStretchInfos=t.pageStretchInfos;i.pageLayouts=t.pageLayouts;i.defaultFormulaManager=t.defaultFormulaManager;i.dependenceCellValueChangedEventHandlers=t.dependenceCellValueChangedEventHandlers;i.dialogUI=t.dialogUI;i.extraDialogCount=t.extraDialogCount;i.isPopup=t.isPopup;i.allowZoomScreen=t.allowZoomScreen;i.autoIDManager=t.autoIDManager;i.runTimeNormalPage=t.runTimeNormalPage;i.runTimeMasterPage=t.runTimeMasterPage;i.ConditionalFormattingMetadata=t.ConditionalFormattingMetadata},i.prototype.releaseDialog=function(){this.dialogUI&&(this.dialogUI.target.dispose(),this.dialogUI=null)},i.prototype.appendExtralPopup=function(n){var i=t.pageInfo.pageID;t.pageInfo.extraDialogCount+=1;n.on("Dispose",function(){var n=t.getPageInfo(i);n&&(n.extraDialogCount-=1)})},i.prototype.getSortInfoWithBinding=function(n){var t=this.sortInfoCache[n],i;return(t===null||t===void 0?void 0:t.sortInfo)?(i=t.sortInfo.filter(function(n){return!!n.ColumnBindingInfo}),i.length===0?null:i):null},i.prototype.getFilterInfoWithBinding=function(n){var i=this.columnFilterQueryCache[n],t;return i?(t=i.filter(function(n){return!!n.ColumnBindingInfoID}),t.length===0?null:t):null},i}();n.PageInfo=f;o=function(){function i(){}return i.getUniquePageName=function(){i._pageIndex===0&&t.alwaysUsePAsRunTimePageName()&&i._pageIndex++;var r=i._pageIndex++;return r===0?{runTimeNormalPageName:n.StaticValues.RunTimeNormalPagePrefix,runTimeMasterPageName:n.StaticValues.RunTimeMasterPagePrefix}:{runTimeNormalPageName:n.StaticValues.RunTimeNormalPagePrefix+r,runTimeMasterPageName:n.StaticValues.RunTimeMasterPagePrefix+r}},i.getRunTimePageName=function(n){switch(n){case t.pageInfo.pageName:return t.pageInfo.runTimeNormalPage;case t.pageInfo.masterPageName:return t.pageInfo.runTimeMasterPage;default:var i=t.pageInfo.pageElementManager.cells.getAllContainerCells().map(function(t){return t.cellType.getRunTimePageName(n)}).filter(function(n){return n});return i.length>0?i[0]:null}},i.getRunTimeNormalPageName=function(i){return i===t.pageInfo.runTimeMasterPage?t.pageInfo.runTimeNormalPage:i.startsWith(n.StaticValues.RunTimeNormalPagePrefix)?i:n.StaticValues.RunTimeNormalPagePrefix+i.substr(n.StaticValues.RunTimeMasterPagePrefix.length)},i.getRunTimeMasterPageName=function(i){return i===t.pageInfo.runTimeNormalPage?t.pageInfo.runTimeMasterPage:i.startsWith(n.StaticValues.RunTimeMasterPagePrefix)?i:n.StaticValues.RunTimeMasterPagePrefix+i.substr(n.StaticValues.RunTimeNormalPagePrefix.length)},i.getDesignerPageName=function(r,u,f){var e,o;f===void 0&&(f=!1);switch(r){case t.pageInfo.runTimeNormalPage:return t.pageInfo.pageName;case t.pageInfo.runTimeMasterPage:return u?t.pageInfo.pageName:t.pageInfo.masterPageName;default:return f&&(e=i.getRepeaterCellType(r),e)?n.FormulaHelper.getCellLogLocationString(e.ID,null,e.runTimePageName)+" "+n.RS.RepeaterTemplate:(o=i.getContainerCell(r),!o)?t.pageInfo.pageName:o.cellType.getDesignerPageName(r,u)}},i.getDesignerPageTitle=function(n){switch(n){case t.pageInfo.runTimeNormalPage:case t.pageInfo.runTimeMasterPage:return t.pageInfo.pageTitle;default:var r=i.getContainerCell(n);return r?r.cellType.getDesignerPageTitle(n):t.pageInfo.pageTitle}},i.isNormalCellID=function(t){var r,u,i=n.Common.parseIDStr(t);return((r=i===null||i===void 0?void 0:i.suffix)===null||r===void 0?void 0:r.startsWith(n.StaticValues.RunTimeNormalPagePrefix))||((u=i===null||i===void 0?void 0:i.suffix)===null||u===void 0?void 0:u.startsWith(n.StaticValues.RunTimeMasterPagePrefix))},i.isMasterPageName=function(t){return!!(t===null||t===void 0?void 0:t.startsWith(n.StaticValues.RunTimeMasterPagePrefix))},i.getPageStretchInfo=function(n){return t.pageInfo.pageStretchInfos?t.pageInfo.pageStretchInfos[n]:null},i.getPageLayout=function(n){return t.pageInfo.pageLayouts[n]},i.whetherExistPageStretch=function(n){var r,i,t,u;for(t in n.pageStretchInfos)if(r=n.pageStretchInfos[t],r.StretchMode!==0)return!0;i=n.pageLayouts;for(t in i)if(u=i[t],u.possibleStretch())return!0;return!1},i.getLocationString=function(r){var u;switch(r){case t.pageInfo.runTimeNormalPage:return t.pageInfo.pageName;case t.pageInfo.runTimeMasterPage:return t.pageInfo.masterPageName;default:if(u=i.getContainerCell(r),u){var f=u.cellType,e=f.getDesignerPageName(r,!1),o=f.getTabIndex(r);return i.getLocationString(u.runTimePageName)+","+u.row+","+u.column+","+o+","+e}return n.Common.getUniqueNumber()+""}},i.getLocatedNormalPageNames=function(n){var r,u;switch(n){case t.pageInfo.runTimeNormalPage:case t.pageInfo.runTimeMasterPage:return[t.pageInfo.pageName];default:return r=i.getContainerCell(n),r?(u=r.cellType.getDesignerPageName(n,!0),i.getLocatedNormalPageNames(r.runTimePageName).concat([u])):[]}},i.getContainerCell=function(n){var i;if((i=t.pageInfo.pageElementManager)!==null&&i!==void 0)return i.cells.getContainerCell(n)},i.getUserControlCellType=function(i){var u,r=(u=t.pageInfo.pageElementManager)===null||u===void 0?void 0:u.cells.getContainerCell(i);if((r===null||r===void 0?void 0:r.cellType)instanceof n.UserControlPageCellType)return r.cellType},i.getRepeaterCellType=function(i){var u,r=(u=t.pageInfo.pageElementManager)===null||u===void 0?void 0:u.cells.getContainerCell(i);if((r===null||r===void 0?void 0:r.cellType)instanceof n.RepeaterCellType)return r===null||r===void 0?void 0:r.cellType},i.isPageReady=function(r){if(r===t.pageInfo.runTimeNormalPage||r===t.pageInfo.runTimeMasterPage)return n.PageBuilder.pageTotallyLoaded&&!n.PageBuilder.pageIsLoading;var u=i.getContainerCell(r);return(u===null||u===void 0?void 0:u.cellType)instanceof n.SubPageContainerCellTypeBase?!u.cellType.isLoading(r)&&i.isPageReady(u.runTimePageName):u?i.isPageReady(u.runTimePageName):void 0},i.getSubRunTimePageNames=function(r){if(n.Common.IsEmpty(r))return[];var u=[];return t.pageInfo.pageElementManager.cells.getAllContainerCells().forEach(function(n){n.runTimePageName===r&&n.cellType.getAllRunTimePageNames().forEach(function(n){u.push(n);i.getSubRunTimePageNames(n).forEach(function(n){return u.push(n)})})}),u},i.getNestedRunTimePageNames=function(n){var t=[];return n.filter(function(n){return!!n}).forEach(function(n){t.push(n);i.getSubRunTimePageNames(n).forEach(function(n){return t.push(n)})}),t},i._pageIndex=0,i}();n.PageManager=o;s=function(){function t(){}return t.getBindingValueKeyStr=function(n){return"".concat(n.lookupColumnBindingInfo.GUID,",").concat(n.resultColumnBindingInfo.GUID,",").concat(n.itemQueryStr)},t.getCachedBindingValue=function(n){var i,f=t.getBindingValueKeyStr(n),u=(i=t._bindingValueCache[f])===null||i===void 0?void 0:i.data,r;return u?(r=u[t.converCacheValueKey(n.lookupValue)],r===undefined?t.CannotFindValue:r):t.CannotFindValue},t.setCachedBindingValue=function(n,i){var u=t.getBindingValueKeyStr(n),f=t._bindingValueCache[u],r;f?r=f.data:(t.cacheRelatedTables(n.lookupColumnBindingInfo),t.cacheRelatedTables(n.resultColumnBindingInfo),r={},t._bindingValueCache[u]={guids:[n.lookupColumnBindingInfo.GUID,n.resultColumnBindingInfo.GUID],data:r});i.forEach(function(n){r[t.converCacheValueKey(n[0])]=n[1]})},t.converCacheValueKey=function(t){return t instanceof Date?n.ConvertDateToOADate(t):t},t.cacheRelatedTables=function(i){var f,u,r;if(!t._bindingAndTablesRelation[i.GUID]){if(f=n.Common.isView(i.TableName),u={},!f)for(u[i.TableName]=!0,r=i.RelationBinding;r;){if(!r.RelatedTable)break;if(n.Common.isView(r.RelatedTable)){f=!0;break}u[r.RelatedTable]=!0;r=r.NextRelationBinding}f&&(u={"*":!0});t._bindingAndTablesRelation[i.GUID]=u}},t.cacheComboboxText=function(i,r,u){var f,o,e,s,h,a,c,l,v;for(u=n.Common.IsEmpty(u)?n.Common.generateID():u,f=0;f<i.data.length;f++){for(o=i.cacheKeys[f],e=0,s=i.data[f].queryAndValues;e<s.length;e++)h=s[e],o.itemQueryStr=JSON.stringify(h.query),t.updateRequestCacheAndCallbackCache(o,h,r,u);i.data[f].queryAndValues=i.data[f].queryAndValues.filter(function(n){return n.values.length>0})}(a=i.data.some(function(n){return n.queryAndValues.length>0}),a)&&(c=i.cacheKeys,delete i.cacheKeys,l=function(){t.setCache([],i,c,!0)},v="Home/GetMultiComboBindingOptions",n.Common.forguncyPost(v,i,function(n){t.setCache(n,i,c,!0)},"GetMultiComboBindingOptions_"+(new Date).valueOf(),l,l))},t.setCache=function(n,i,r,u){for(var e,o,s,h,c,f=0;f<i.data.length;f++)for(e=r[f],o=0;o<i.data[f].queryAndValues.length;o++)s=i.data[f].queryAndValues[o],e.itemQueryStr=JSON.stringify(s.query),h=n[f]?(c=n[f][o])!==null&&c!==void 0?c:[]:[],t.setReversedCachedBindingValue(e,h),t.fillComboBindingOptions(h,s.values),t.setCachedBindingValue(e,h),u&&t.clearRequestCacheAndCallbackCache(e,s)},t.updateRequestCacheAndCallbackCache=function(n,i,r,u){var o=t.getBindingValueKeyStr(n),e,s,h,c,f;if(r)for(t._callBackCache[u]||(t._callBackCache[u]={data:{}}),t._callBackCache[u].callBack=r,e=t._callBackCache[u].data[o],e||(e={},t._callBackCache[u].data[o]=e),s=0,h=i.values;s<h.length;s++)c=h[s],e[c]=!0;f=t._requestCache[o];f&&(i.values=i.values.filter(function(n){return!f[n]}));i.values.length>0&&(f||(f={},t._requestCache[o]=f),i.values.forEach(function(n){return f[n]=!0}))},t.clearRequestCacheAndCallbackCache=function(i,r){var u=t.getBindingValueKeyStr(i),f=t._requestCache[u],e,o,s;f&&(r.values.forEach(function(n){return delete f[n]}),Object.getOwnPropertyNames(f).length===0&&delete t._requestCache[u]);e=[];o=function(n){var i=t._callBackCache[n];i.data[u]&&(r.values.forEach(function(n){return delete i.data[u][n]}),Object.getOwnPropertyNames(i.data[u]).length===0&&delete i.data[u]);Object.getOwnPropertyNames(i.data).length===0&&e.push(n)};for(s in t._callBackCache)o(s);e.forEach(function(i){n.DelayRefresh.setTimeout(t._callBackCache[i].callBack);delete t._callBackCache[i]})},t.setReversedCachedBindingValue=function(n,i){var r=i.map(function(n){return[n[1],n[0]]}),u={lookupColumnBindingInfo:n.resultColumnBindingInfo,resultColumnBindingInfo:n.lookupColumnBindingInfo,itemQueryStr:n.itemQueryStr,lookupValue:null};t.setCachedBindingValue(u,r)},t.lookupComboboxResultFromCache=function(i,r,u,f,e){var o;if(r instanceof n.WrongParseResult)return{result:t.CannotFindValue,cannotFindValues:[]};if(o=[r],i.AllowMultiSelect){if(n.Common.IsEmpty(r))return{result:"",cannotFindValues:[]};o=(r+"").split(",").filter(function(t){return!n.Common.IsEmpty(t)})}var l=JSON.stringify(null),a=JSON.stringify(u),s=[],h=o.map(function(n){f.itemQueryStr=a;f.lookupValue=n;var i=t.getCachedBindingValue(f);return i===t.NoneExistentValue&&e&&u&&(f.itemQueryStr=l,i=t.getCachedBindingValue(f)),i===t.CannotFindValue&&s.push(n),i}),c=t.CannotFindValue;return s.length===0&&(c=h.length>1?h.filter(function(n){return n!==t.NoneExistentValue}).join(","):h[0]),{result:c,cannotFindValues:s}},t.lookupComboboxResultSync=function(i,r,u,f,e,o,s){var a=t.lookupComboboxResultFromCache(i,r,u,o,s),h=a.cannotFindValues,c;if(h.length===0)return a.result;if(f)return t.CannotFindValue;c=[{query:u,values:h}];u&&c.push({query:null,values:h});var l={pageName:e,data:[{lookupColumnBindingInfo:o.lookupColumnBindingInfo.GUID,resultColumnBindingInfo:o.resultColumnBindingInfo.GUID,queryAndValues:c}]},v=function(n){for(var i=[],r=0;r<l.data.length;r++)i.push(o);t.setCache(n,l,i,!1)};return n.Common.forguncyPostSync("Home/GetMultiComboBindingOptions",l,function(n){v(n)},function(){v([])}),t.lookupComboboxResultSync(i,r,u,!0,e,o,s)},t.lookupComboboxResultAsync=function(n,i,r,u,f,e,o,s){var l=t.lookupComboboxResultFromCache(n,i,r,f,s),h=l.cannotFindValues,c,a;return h.length===0?l.result:(c=[{query:r,values:h}],r&&c.push({query:null,values:h}),a={pageName:u,data:[{lookupColumnBindingInfo:f.lookupColumnBindingInfo.GUID,resultColumnBindingInfo:f.resultColumnBindingInfo.GUID,queryAndValues:c}],cacheKeys:[f]},t.cacheComboboxText(a,e,o),t.CannotFindValue)},t.fillComboBindingOptions=function(i,r){var f,e,s,o,h,c,l,u;for(r=r.map(function(t){return t instanceof Date?n.ConvertDateToOADate(t):t}),f={},e=0,s=r;e<s.length;e++)u=s[e],f[u]=u;for(o=0,h=i;o<h.length;o++)c=h[o],delete f[c[0]];for(l in f)u=f[l],i.push([u,t.getResult(i,u)])},t.getResult=function(i,r){for(var e,u=0,f=i;u<f.length;u++)if(e=f[u],n.Common.isFuzzyEquals(e[0],r))return e[1];return t.NoneExistentValue},t.getBindingValueCacheKey=function(n,t){return(t===void 0&&(t=!0),(n===null||n===void 0?void 0:n.$type)!=="Forguncy.DropDownListCellType, ServerDesignerCommon"||!n.IsBounding||!n.DataSource||!n.DisplayColumnBindingInfo||!n.ValueColumnBindingInfo)?null:{lookupColumnBindingInfo:t?n.ValueColumnBindingInfo:n.DisplayColumnBindingInfo,resultColumnBindingInfo:t?n.DisplayColumnBindingInfo:n.ValueColumnBindingInfo,itemQueryStr:null,lookupValue:null}},t.getQueryAndValuesOfCombobox=function(n,i,r,u){for(var h={},e=[],f=0;f<n.length;f++){var c=n[f],o=i[f],l=t.lookupComboboxResultFromCache(r,c,o,u,!0),s=l.cannotFindValues;s.length!==0&&(t.addToQueryAndValues(o,h,e,s),o&&t.addToQueryAndValues(null,h,e,s))}return e},t.addToQueryAndValues=function(t,i,r,u){var f=n.Common.IsEmpty(t)?"null":JSON.stringify(t),e;i[f]||(e={query:t,values:[]},i[f]={item:e,valueObj:{}},r.push(e));u.forEach(function(n){i[f].valueObj[n]||(i[f].valueObj[n]=1,i[f].item.values.push(n))})},t.updateCache=function(i){n.Common.IsEmpty(i)?t._bindingValueCache={}:t.getRelatedBindingValueCacheKeys(i).forEach(function(n){return delete t._bindingValueCache[n]})},t.getRelatedBindingValueCacheKeys=function(n){var r=[],i,u,f;for(i in t._bindingValueCache)u=t._bindingValueCache[i].guids,f=u.some(function(i){var r=t._bindingAndTablesRelation[i];return!r||r["*"]||r[n]}),f&&r.push(i);return r},t.addCacheFromGetComboBindingOptionsResult=function(n,i,r){var u,f;n&&n.length!==0&&(u=t.getBindingValueCacheKey(i),u)&&(u.itemQueryStr=JSON.stringify(r),f=n.map(function(n){return[n.Value,n.DisplayValue]}),t.setReversedCachedBindingValue(u,f),t.setCachedBindingValue(u,f))},t.NoneExistentValue="4DBB4E23-98C3-4C70-8A58-166D97B4FC40",t.CannotFindValue="13E0F8CD-FBD9-457F-99CA-D20C36056CB1",t._bindingValueCache={},t._bindingAndTablesRelation={},t._requestCache={},t._callBackCache={},t}();n.TableColumnsCacheManager=s;h=function(){function n(){}return n}();n.GetMultiComboBindingOptionsData=h})(Forguncy||(Forguncy={}))
;var __awaiter=this&&this.__awaiter||function(n,t,i,r){function u(n){return n instanceof i?n:new i(function(t){t(n)})}return new(i||(i=Promise))(function(i,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?i(n.value):u(n.value).then(o,s)}e((r=r.apply(n,t||[])).next())})},__generator=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=e[0]&2?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[e[0]&2,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i,e;return e={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e},Forguncy;(function(n){var t=function(){function t(){var t=this,i;this._pageAccessInfo=[];this._postOperateEventHandler=this.reactivationAfterTimeoutDisconnection.bind(this);i=this.documentHiddenProperty.replace(/hidden/i,"visibilitychange");window.addEventListener(i,function(){try{t.isDocumentHidden?t.handlePageHide():(n.HomeController.unregisterPostOperateEvent(t._postOperateEventHandler),n.HomeController.Operate(),t._suspend=!1,t.resetAccessTimesForAllPages(),t.createTimeoutTimerDetection())}catch(i){console.warn("[PageStatistics] - visibilityChangeEvent callback failed");console.error(i)}});window.addEventListener("unload",this.handlePageHide.bind(this));window.addEventListener("pagehide",this.handlePageHide.bind(this));this.createTimeoutTimerDetection()}return Object.defineProperty(t.prototype,"documentHiddenProperty",{get:function(){return["hidden","webkitHidden","mozHidden"].find(function(n){return n in document})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isDocumentHidden",{get:function(){return document[this.documentHiddenProperty]},enumerable:!1,configurable:!0}),t.prototype.tryClearTimeoutTimer=function(){this._timeoutTimer&&(clearInterval(this._timeoutTimer),this._timeoutTimer=null)},t.prototype.handlePageHide=function(){this.tryClearTimeoutTimer();this.leaveAllPages()},t.prototype.createTimeoutTimerDetection=function(){var i=this;this.tryClearTimeoutTimer();this._timeoutTimer=setInterval(function(){try{var r=Date.now()-n.HomeController.lastOperateTime.valueOf();r>t._autoDisconnectTime&&(clearInterval(i._timeoutTimer),n.HomeController.registerPostOperateEvent(i._postOperateEventHandler),i.leaveAllPages())}catch(u){console.warn("[PageStatistics] - createTimeoutTimerDetection failed");console.error(u)}},t._autoDisconnectDetectionTime)},t.prototype.resetAccessTimesForAllPages=function(){this._pageAccessInfo.forEach(function(n){return n.accessTime=new Date})},t.prototype.reactivationAfterTimeoutDisconnection=function(){n.HomeController.unregisterPostOperateEvent(this._postOperateEventHandler);this.resetAccessTimesForAllPages();this.createTimeoutTimerDetection();this._suspend=!1},t.prototype.getDesignTimePageName=function(t){if(t.startsWith(n.StaticValues.RunTimeMasterPagePrefix))return null;var i=n.PageManager.getContainerCell(t);return i&&(i.cellType instanceof n.RepeaterCellType||i.cellType instanceof n.UserControlPageCellType)?null:n.PageManager.getDesignerPageName(t,!0)},t.prototype.convertToCommitDataByRunTimePageNames=function(n){var i=this,t=[];return n.forEach(function(n){var r=i._pageAccessInfo.find(function(t){return t.runTimePageName===n});r&&t.push({key:r.designTimePageName,value:(new Date).getTime()-r.accessTime.getTime()})}),JSON.stringify({pageDurationMap:t})},t.prototype.commitDataWithBeacon=function(i){return __awaiter(this,void 0,void 0,function(){var r,u,f,e;return __generator(this,function(o){switch(o.label){case 0:if(o.trys.push([0,6,,7]),n.StaticData.IsDesignerPreview)return[2];r=this.convertToCommitDataByRunTimePageNames(i);u=!1;o.label=1;case 1:return o.trys.push([1,,2,5]),f=new Blob([r],{type:"application/json"}),u=navigator.sendBeacon(t._apiPath,f),[3,5];case 2:return!u?[4,this.commitDataWithFetch(r)]:[3,4];case 3:o.sent();o.label=4;case 4:return[7];case 5:return[3,7];case 6:return e=o.sent(),console.warn("[PageStatistics] - commitDataWithBeaconOrFetch failed"),console.error(e),[3,7];case 7:return[2]}})})},t.prototype.commitDataWithFetch=function(n){return fetch(t._apiPath,{method:"POST",headers:{"Content-Type":"application/json"},body:n})},t.prototype.enterPage=function(n){try{var t=this.getDesignTimePageName(n);if(!t)return;this._pageAccessInfo.push({designTimePageName:t,runTimePageName:n,accessTime:new Date})}catch(i){console.warn("[PageStatistics] - EnterPage failed");console.error(i)}},t.prototype.enterPages=function(n){try{n.forEach(this.enterPage.bind(this))}catch(t){console.warn("[PageStatistics] - EnterPages failed");console.error(t)}},t.prototype.leavePages=function(n){try{this.commitDataWithBeacon(n);var t=new Set(n);this._pageAccessInfo=this._pageAccessInfo.filter(function(n){return t.has(n.runTimePageName)?(t.delete(n.runTimePageName),!1):!0})}catch(i){console.warn("[PageStatistics] - LeavePages failed");console.error(i)}},t.prototype.leavePage=function(n){try{this.leavePages([n])}catch(t){console.warn("[PageStatistics] - LeavePage failed");console.error(t)}},t.prototype.leaveAllPages=function(){try{if(this._suspend)return;this.commitDataWithBeacon(this._pageAccessInfo.map(function(n){return n.runTimePageName}));this._suspend=!0}catch(n){console.warn("[PageStatistics] - LeaveAllPages failed");console.error(n)}},t._autoDisconnectTime=3e5,t._autoDisconnectDetectionTime=6e4,t._apiPath=n.ForguncyData.ForguncyRoot+"log/concurrency-stat-detail",t.instance=new t,t}();n.PageStatistics=t})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t=GC.Spread.CalcEngine,a=function(i){function r(){var n=i!==null&&i.apply(this,arguments)||this;return n._needRemovedPages=[],n}return __extends(r,i),r.prototype.addCustomName=function(t,i,r){var u,o,f,e;if(!n.Common.IsEmpty(i.Name)&&!n.Common.IsEmpty(i.Formula)&&(u=this,o=u.getCalcService(),o)){u._names||(u._names={});f=i.Name.toUpperCase();for(e in u._names)u._needRemovedPages.indexOf(e)>=0||u._names[e][f]&&(n.ErrorHelper.printErrorStr(n.Common.format(n.RS.NameConflict,f,n.PageManager.getDesignerPageName(e,!1,!0),n.PageManager.getDesignerPageName(t,!1,!0))),delete u._names[e][f]);u._names[t]||(u._names[t]={});u._names[t][f]=new GC.Spread.Sheets.NameInfo(f,r,i.BaseRow,i.BaseColumn,null);o.getGlobalSourceModel().updateNameCalc(f,!0)}},r.prototype.preRemoveCustomNames=function(n){this._needRemovedPages.push(n)},r.prototype.removeCustomNames=function(n){var t=this,i,r,u;if(t._names&&(i=t._names[n],i)&&(r=t.getCalcService(),r)){delete t._names[n];for(u in i)i[u]&&r.getGlobalSourceModel().updateNameCalc(u,!1)}},r.prototype.getCustomName=function(n){var t;if((t=this.getCustomNameInfo(n))!==null&&t!==void 0)return t.getExpression()},r.prototype.getCustomNameInfo=function(t){var i,r,u,f,e;return n.ForguncyData.GlobalSettings.NameConflictPolicy!==n.NameConflictPolicy.CellNamePreferred?(i=this.getParamNameInfo(t),i)?i:this.getCellNameInfo(t):(r=this.getCellNameInfo(t),r)?(u=n.ForguncyData.parameterManager.getValue(t),n.Common.IsEmpty(u)||(f=n.Page.getCell(t,!0,!1),n.ForguncyData.isDebugMode()&&f&&u!==f.getValue()&&(e=n.Common.format(n.RS.NameConflictWarning,t),console.warn(e),n.ForguncyData.pageInfo.dataModel.debugWarningInfoDataModel.push({message:e}))),r):this.getParamNameInfo(t)},r.prototype.getCellNameInfo=function(t){var r=typeof t=="string"&&!n.Common.IsEmpty(t)?t.toUpperCase():null,u,i;if(r&&this._names)for(u in this._names)if(i=this._names[u][r],i)return i},r.prototype.getParamNameInfo=function(i){var f=n.CustomFunction.GetParamFunction.getParamResult(i,!0,!1),r,u;return f===t.Errors.Name?null:(r=new t.Expression(t.ExpressionType.function),r.functionName="GetParam",r.function=new n.CustomFunction.GetParamFunction,u=new t.Expression(t.ExpressionType.string),u.value=i,r.arguments=[u],new GC.Spread.Sheets.NameInfo(i,r,0,0,null))},r}(t.CalcSource),i,r,u,o,f,e,s,h,c,l;n.GlobalSource=a;i=function(i){function r(n,t){var r=i.call(this,n)||this;return r._name=t,r._hasRemoved=!1,r._isSuspend=!1,r}return __extends(r,i),r.prototype.getName=function(){return this._hasRemoved?"":this._name},r.prototype.getColumnCount=function(){return this._hasRemoved?0:this._getColumnCount()},r.prototype.getRowCount=function(){return this._hasRemoved?0:this._getRowCount()},r.prototype._getColumnCount=function(){throw n.StaticValues.NeedImplementException;},r.prototype._getRowCount=function(){throw n.StaticValues.NeedImplementException;},r.prototype.suspend=function(){this._isSuspend=!0},r.prototype.getValue=function(){throw n.StaticValues.NeedImplementException;},r.prototype.setValue=function(){for(var i=[],t=0;t<arguments.length;t++)i[t]=arguments[t];throw n.StaticValues.NeedImplementException;},r.prototype.getReference=function(n){var r=n.row,u=n.col,f=n.rowCount,e=n.colCount,i=this;return r===-1&&u===-1?i.getSheetReference():r===-1?new t.CalcReference(i,[{row:0,rowCount:i.getRowCount(),col:u,colCount:e,rowUndefine:!0}]):u===-1?new t.CalcReference(i,[{row:r,rowCount:f,col:0,colCount:i.getColumnCount(),colUndefine:!0}]):new t.CalcReference(i,[{row:r,rowCount:f,col:u,colCount:e}])},r.prototype.referenceToArray=function(n,t,r,u,f,e,o,s){var h=i.prototype.referenceToArray.call(this,n,t,r,u,f,e,o,s);return h.isError&&(h.length===0||h.length===1&&h[0].length===0)?[]:h},r.prototype.getCustomName=function(){return null},r.prototype.getParserContext=function(t,r,u){n.Common.IsEmpty(r)&&(r={row:0,col:0});var f=i.prototype.getParserContext.call(this,t,r,u);return f.addResolver(new GC.Spread.Sheets.CalcEngine.SheetReferenceResolver(null)),f.addResolver(new GC.Spread.Sheets.CalcEngine.StructureReferenceResolver(null)),f},r.prototype.getRangeKey=function(n,t){return n.id+","+t.row+","+t.col+","+t.rowCount+","+t.colCount},r.prototype.dispose=function(){this._hasRemoved=!0},r.prototype.checkNullValue=function(t){if(n.FormulaManager.nullAsException&&(t===null||t===undefined)){n.FormulaManager.isNullValue=!0;throw"";}},r}(t.CalcSource);n.CalcSourceBase=i;r=function(t){function i(n,i,r){var u=t.call(this,n,i)||this;return u._formulaSheetDataModel=r,u.useFormulaSheetData=!1,u}return __extends(i,t),i.prototype.getValue=function(n,t){var i,r,u;return typeof n=="number"?(i=n,r=t):(i=n.row,r=n.col),u=this.useFormulaSheetData&&this._formulaSheetDataModel?this._formulaSheetDataModel.getValue(i,r):this.getActualValue(i,r),this.useFormulaSheetData=!1,this.checkNullValue(u),u},i.prototype.getActualValue=function(){throw n.StaticValues.NeedImplementException;},i.prototype.setValue=function(){for(var r,u,f,e,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];if(!this._isSuspend&&!this._hasRemoved){typeof t[0]=="number"?(r=t[0],u=t[1],f=t[2]):(e=t[0],r=e.row,u=e.col,f=t[1]);try{n.FormulaManager.suspendChange();this._formulaSheetDataModel.setValue(r,u,f)}finally{n.FormulaManager.resumeChange()}}},i.prototype.getSheet=function(){return new u(this)},i}(i);n.SheetCalcSourceBase=r;u=function(){function n(n){this._source=n}return n.prototype.name=function(){return this._source.getName()},n.prototype._getSheetSource=function(){return this._source},n}();o=function(i){function r(n,t,r,u,f){var e=i.call(this,n,t,r)||this;return e._dataModel=f,e._names={},e._rowCount=u.RowCount,e._columnCount=u.ColumnCount,e}return __extends(r,i),r.prototype.getCustomName=function(n){return this._names[n]?this._names[n].getExpression():i.prototype.getCustomName.call(this,n)},r.prototype.getCustomNameInfo=function(n){return this._names[n]?this._names[n]:i.prototype.getCustomNameInfo.call(this,n)},r.prototype.setUserControlCustomName=function(i,r){var u=t.ExpressionType.string,f;r===null||r===undefined||typeof r=="string"?(r===undefined&&(r=null),u=t.ExpressionType.string):typeof r=="number"?u=t.ExpressionType.number:typeof r=="boolean"?u=t.ExpressionType.boolean:r instanceof Date&&(r=n.ConvertDateToOADate(r),u=t.ExpressionType.number);f=new GC.Spread.CalcEngine.Expression(u);f.value=r;this._names[i]=new GC.Spread.Sheets.NameInfo(i,f,0,0,null);this.getCalcSourceModel().updateNameCalc(i,!0)},r.prototype._getColumnCount=function(){return this._columnCount},r.prototype._getRowCount=function(){return this._rowCount},r.prototype.getActualValue=function(t,i){if(!this._dataModel)return null;var r=n.Common.getIdStr(t,i,this._name);return this._dataModel.getValue(r)},r.prototype.listenFormula=function(t,i,r,u,e){e===void 0&&(e=!1);this._formulaReferCalcSource||(this._formulaReferCalcSource=new f(this.getCalcService(),"ref_"+this._name),this.getCalcService().getSourceModel(this._formulaReferCalcSource));try{this._formulaReferCalcSource.listenFormula(t,this.translateFormula(this._name,t,r,u),i,e)}catch(o){n.FormulaManager.showFormulaCalcErrorWithThrottle(t,o.toString(),this.getName())}},r.prototype.unListenFormula=function(n,t){this._formulaReferCalcSource&&this._formulaReferCalcSource.unListenFormula(n,t)},r.prototype.translateFormula=function(t,i,r,u,f){var e=f?[]:n.ListviewBase.getAllListviews([t]),o=new n.CellFormulaTranslator(t,t,e,this,r,u);return o.translate(i)},r.prototype.suspend=function(){this._formulaReferCalcSource&&this._formulaReferCalcSource.suspend();i.prototype.suspend.call(this)},r.prototype.dispose=function(){this._formulaReferCalcSource&&(this._formulaReferCalcSource.dispose(),this.getCalcService().removeSource(this._formulaReferCalcSource));i.prototype.dispose.call(this)},r}(r);n.PageCalcSource=o;f=function(t){function i(){var n=t!==null&&t.apply(this,arguments)||this;return n._rowCount=100,n._additionalFormulaOffset=0,n._additionalFormulaCache={},n._additionalFormulaLastValueCache={},n._additionalFormulaIndexCache={},n._additionalTranslatedFormulaIndexCache={},n}return __extends(i,t),i.prototype._getColumnCount=function(){return 1},i.prototype._getRowCount=function(){return this._rowCount},i.prototype.getValue=function(n){var t;return t=typeof n=="number"?n:n.row,this._additionalFormulaLastValueCache[t]},i.prototype.setValue=function(){for(var i,r,s,f,e,o=this,t=[],u=0;u<arguments.length;u++)t[u]=arguments[u];this._isSuspend||this._hasRemoved||(typeof t[0]=="number"?(i=t[0],r=t[2]):(s=t[0],i=s.row,r=t[1]),this._additionalFormulaLastValueCache[i]!==r)&&(this._additionalFormulaLastValueCache[i]=r,f=this._additionalFormulaIndexCache[i],f&&(e=this._additionalFormulaCache[f],e&&e.forEach(function(t){t(r,o.isUiAction(o._additionalTranslatedFormulaIndexCache[i],n.FormulaManager.uiActionInfo))})))},i.prototype.isUiAction=function(t,i){if(!i)return!1;try{var u=n.ForguncyData.pageInfo.formulaManager.getCalcService().parse(this,t,0,0),r=new n.CheckReferCellVisitor(i.row,i.col,i.id,i.calcSheetName);return r.visit(u,0,0),r.isRefer}catch(f){return!1}},i.prototype.listenFormula=function(n,t,i,r){if(r===void 0&&(r=!1),this._additionalFormulaCache[n]){this._additionalFormulaCache[n].push(i);return}var u=this._additionalFormulaOffset,f=this.getCalcSourceModel();this._additionalFormulaIndexCache[u]=n;this._additionalTranslatedFormulaIndexCache[u]=t;r&&(this._additionalFormulaCache[n]=[i]);f.setFormula(u,0,t);this._additionalFormulaCache[n]=[i];this._additionalFormulaOffset++;this._additionalFormulaOffset>=this._rowCount&&(this._rowCount+=100)},i.prototype.unListenFormula=function(n,t){var e=this._additionalFormulaCache[n],r,i,u,f,o;if(e){for(r=[],i=0,u=e;i<u.length;i++)f=u[i],o=t.indexOf(f),o<0&&r.push(f);this._additionalFormulaCache[n]=r}},i.prototype.getSheet=function(){return new u(this)},i}(i);n.FormulaReferCalcSource=f;e=function(t){function i(n,i,r,u){var f=t.call(this,n,i,r)||this;return f._dataModel=u,f}return __extends(i,t),i.prototype._getColumnCount=function(){return this._dataModel.getColumnCount()},i.prototype._getRowCount=function(){return this._dataModel.getRowCount()},i.prototype.getActualValue=function(t,i){var u=this,r=n.ListviewBase.getAllListviews().find(function(n){return n.getCalcSheetName()===u._name});return r&&r.isEditing()&&i===r.getCurrentColIndex()&&t===r.getCurrentRowIndex()&&r.isCurrentRowSameWithActiveCellRow()?r.getEditingValue():this._dataModel?this._dataModel.getValue(t,i):null},i}(r);n.ListCalcSource=e;s=function(t){function i(n,i){var r=t.call(this,n,"temp")||this;return r._formulaManager=i,r}return __extends(i,t),i.prototype.prepare=function(t){this._formulaCalcInfo={runTimePageName:t.runTimePageName,ignoreListviews:t.ignoreListviews,listInfo:t.listInfo?t.listInfo:null,rowOffset:n.Common.IsEmpty(t.rowOffset)?0:t.rowOffset,columnOffset:n.Common.IsEmpty(t.columnOffset)?0:t.columnOffset};this.updateRowCountAndColumnCount()},i.prototype.updateRowCountAndColumnCount=function(){var r=n.Common.IsEmpty(this._formulaCalcInfo.runTimePageName)?n.ForguncyData.pageInfo.runTimeNormalPage:this._formulaCalcInfo.runTimePageName,i=this._formulaManager.getCalcSource(r),t;i?(this._rowCount=i.getRowCount(),this._columnCount=i.getColumnCount()):(t=n.PageManager.getContainerCell(r),t&&t.cellType instanceof n.RepeaterCellType&&(this._rowCount=t.cellType.getTemplateRowCount(),this._columnCount=t.cellType.getTemplateColumnCount()))},i.prototype._getColumnCount=function(){return this._columnCount},i.prototype._getRowCount=function(){return this._rowCount},i.prototype.getValue=function(t,i){var e,u,r,h,f,l;typeof t=="number"?(e=t,u=i):(e=t.row,u=t.col);var c=null,o=e,s=u;return!this._formulaCalcInfo.ignoreListviews&&(r=this._getLocatedListview(e,u),r!==null&&(h=r.getCalcSheetName(),c=this._formulaManager.getCalcSource(h),o=this._formulaCalcInfo.listInfo&&typeof this._formulaCalcInfo.listInfo[h]=="number"?this._formulaCalcInfo.listInfo[h]:r.getCurrentRowIndex(),s=u-r.getRangeInfo().Column,r.isEditing()&&s===r.getCurrentColIndex()&&o===r.getCurrentRowIndex()&&r.isCurrentRowSameWithActiveCellRow()))?r.getEditingValue():(f=null,c?f=c.getValue({row:o,col:s}):(l=n.Common.getIdStr(o,s,this._formulaCalcInfo.runTimePageName),f=n.ForguncyData.pageInfo.dataModel.normalCellDataModel.getValue(l)),this.checkNullValue(f),f)},i.prototype._getLocatedListview=function(t,i){return n.Common.getLocatedListview(this._formulaCalcInfo.runTimePageName,t,i)},i}(n.CalcSourceBase);n.FormulaCalculator=s;h=function(n){function t(t,i,r,u){var f=n.call(this,t,i,null,r)||this;return f._spreadJSView=u,f}return __extends(t,n),t.prototype._getRowCount=function(){return this._spreadJSView.getSheetRowCount()},t.prototype.getSheet=function(){return this._spreadJSView.getControl().getActiveSheet()},t}(e);n.ConditionFormatCalcSource=h;c=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype._getColumnCount=function(){return 0},t.prototype._getRowCount=function(){return 0},t.prototype.getValue=function(){return null},t.prototype.setValue=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n]},t}(i);n.MockCalcSourceBase=c;l=function(n){function t(t,i,r){var u=n.call(this,t,i)||this;return u._sheet=r,u}return __extends(t,n),t.prototype.getName=function(){return this._name},t.prototype._getColumnCount=function(){return this._sheet.getColumnCount()},t.prototype._getRowCount=function(){return this._sheet.getRowCount()},t.prototype.getValue=function(n,t){var i,r;return typeof n=="number"?(i=n,r=t):(i=n.row,r=n.col),this._sheet.getValue(i,r)},t.prototype.getSheet=function(){return this._sheet},t}(i);n.PivotTableCalcSource=l})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__spreadArray=this&&this.__spreadArray||function(n,t,i){if(i||arguments.length===2)for(var r=0,f=t.length,u;r<f;r++)!u&&r in t||(u||(u=Array.prototype.slice.call(t,0,r)),u[r]=t[r]);return n.concat(u||Array.prototype.slice.call(t))},Forguncy;(function(n){var t;(function(t){var k=function(t){function i(){return t.call(this,"CLIENTOData",2,255)||this}return __extends(i,t),i.prototype.defaultValue=function(){return null},i.prototype.getCellCacheKey=function(t){var i="";return t.ctx&&t.ctx.source&&t.ctx.source.getName&&(i=t.ctx.source.getName()),i=n.Common.IsEmpty(i)?"":i,n.ForguncyData.pageInfo.pageName+","+i+","+t.row+","+t.col+","+t.id},i.prototype.evaluateAsync=function(){for(var h,e,r=[],u=0;u<arguments.length;u++)r[u]=arguments[u];var t=r[0],o={GUID:r[1],PageName:r[2],Params:r.slice(3)},f=JSON.stringify(o),s=!n.FormulaManager.syncExecuteAsyncFunction;return(s&&(i.cellCache[this.getCellCacheKey(t)]=f),h=i.requestValueCache,e=h[f],e!==undefined)?e:this.processODateServerRequest(o,f,t,s,function(n){var f,e,o,c,i,u;if(Array.isArray(n)){if(n.length===0)return GC.Spread.CalcEngine.Errors.NotAvailable}else if(t.ctx.arrayFormulaMode)n=[{a:n}];else return n;var r=[],s=0,h=0;for(f=0;f<n.length;f++){e=n[f];o=[];for(c in e)o.push(e[c]),s++;h++;r.push(o)}if(n.length===1&&t.ctx.arrayIdentity)for(i=0;i<t.ctx.arrayIdentity.rowCount;i++)for(u=0;u<t.ctx.arrayIdentity.colCount;u++)i>=r.length&&r.push([]),(i>=h||u>=s)&&(r[i][u]=GC.Spread.CalcEngine.Errors.NotAvailable);return new GC.Spread.CalcEngine.CalcArray(r)})},i.prototype.processODateServerRequest=function(t,r,u,f,e){var s=this,o=null,h=i.requestCache,c=h[r];return c===undefined||f===!1?(f&&(h[r]={contexts:[{contexts:u,shouldCoverBindingValueByFormulaResult:n.FormulaManager.shouldCoverBindingValueByFormulaResult}]}),this._getTableDataByODataFormula(t,u.ctx.source.getName()+"_r"+u.row+"c"+u.col+"_"+r,function(n){n=e(n);o=s.setResult(f,s,r,u,n,o)},function(n){n=e(GC.Spread.CalcEngine.Errors.Value);o=s.setResult(f,s,r,u,n,o)},f)):c.contexts.push({contexts:u,shouldCoverBindingValueByFormulaResult:n.FormulaManager.shouldCoverBindingValueByFormulaResult}),o},i.prototype.setResult=function(n,t,i,r,u,f){return n?t.setAsyncResult(i,r,u):f=u,f},i.prototype._getTableDataByODataFormula=function(t,i,r,u,f){f===void 0&&(f=!0);(t===null||t===void 0?void 0:t.Params)&&(t.Params=t.Params.map(function(n){return typeof n=="string"?"@"+n:n}));n.Common.operateODataPost("Home/CalcOdata",t,r,u,f,i)},i.prototype.setAsyncResult=function(t,r,u){var f;(t+"").toLowerCase().indexOf("now()")<0&&(i.requestValueCache[t]=u);var e=i.requestCache,o=function(r){var f=e[t].contexts[r],o=f.contexts.ctx.source,l,h,c;if(o instanceof n.ListCalcSource)n.DelayRefresh.Push(null,function(){n.FormulaManager.isReady()&&n.ForguncyData.pageInfo.formulaManager.recalc(f.shouldCoverBindingValueByFormulaResult,o)},"recalcSheet "+o.getName(),!0);else if(o instanceof n.PageCalcSource){l=n.FormulaManager.shouldCoverBindingValueByFormulaResult;n.FormulaManager.shouldCoverBindingValueByFormulaResult=f.shouldCoverBindingValueByFormulaResult;h=f.contexts;try{c=i.cellCache[s.getCellCacheKey(h)];(c===undefined||c===t)&&h.setAsyncResult(u)}finally{n.FormulaManager.shouldCoverBindingValueByFormulaResult=l}}},s=this;for(f=0;f<e[t].contexts.length;f++)o(f);e[t]=undefined},i.clearCache=function(t,r){if(r===void 0&&(r=null),t){t=t.toLocaleLowerCase();var u=i._clearCache(i.requestValueCache,t);r===null&&(r=u)}else r===null&&(r=i._hasODataFunctionInCurrentPage()),i.requestValueCache={};r&&n.FormulaManager.isReady()&&n.ForguncyData.pageInfo.formulaManager.recalc(!1)},i.clearCellCache=function(){var u=n.ForguncyData.pageInfo.pageName+",",t=[];for(var r in i.cellCache)r.startsWith(u)&&t.push(r);t.forEach(function(n){return delete i.cellCache[n]})},i._hasODataFunctionInCurrentPage=function(){var t=n.ForguncyData.pageInfo.pageName+",";for(var r in i.cellCache)if(r.startsWith(t))return!0;return!1},i._clearCache=function(n,t){var r=!1,i;t=t.toLocaleLowerCase();for(i in n)i&&(delete n[i],r=!0);return r},i.requestCache={},i.cellCache={},i.requestValueCache={},i._recalcSuspended=!1,i}(GC.Spread.CalcEngine.Functions.AsyncFunction),f,r,i,u,e,o,s,h,c,l,a,v,y,p,w,b;t.ODataFunction=k;var g=function(){function n(){}return n}(),nt=function(){function n(){}return n}(),d=function(t){function i(n){var r=t.call(this,i.NAME,1,1)||this;return r._asyncFuncName=n,r}return __extends(i,t),i.prototype.evaluate=function(){for(var i,r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];if(i=GC.Spread.CalcEngine.Functions.findGlobalFunction(this._asyncFuncName),!i)return null;var u=n.ForguncyData.pageInfo.formulaManager.getCalcSource("temp"),f=u.getEvaluatorContext({row:0,col:0},!1,null),e=new GC.Spread.CalcEngine.AsyncEvaluateContext(f);return i.evaluateAsync.apply(i,__spreadArray([e],r,!0))},i.NAME="ASYNCTOSYNC",i}(GC.Spread.CalcEngine.Functions.Function);t.AsyncToSyncFunction=d;f=function(t){function i(){return t.call(this,"TEXTJOINIF",4,5)||this}return __extends(i,t),i.prototype.acceptsReference=function(n){return n===0||n===2||n===4?!0:!1},i.prototype.acceptsArray=function(n){return n===0?!0:!1},i.prototype.evaluate=function(){for(var r,s,p,h,f,e,t=[],u=0;u<arguments.length;u++)t[u]=arguments[u];var l=[],a=[],k=!!t[1],o=t[3],v=t[2],y=t[4]?t[4]:t[2];if(i.addResult(a,t[0],!1),v instanceof GC.Spread.CalcEngine.CalcReference&&y instanceof GC.Spread.CalcEngine.CalcReference){if(r=v,s=y,r.getRangeCount()<1||s.getRangeCount()<1)return null;for(p=o===0||o==="*",h=n.SpreadJSHelpMethods._MathHelper._parseCriteria(o),f=0;f<r.getRowCount(0);f++)for(e=0;e<r.getColumnCount(0);e++){var w={row:f,col:e},b=r.getValue(w,0),c=s.getValue(w,0);if(!(c instanceof GC.Spread.CalcEngine.CalcError)&&(!p||b!==null)&&h&&h(b)){if(k&&n.Common.IsEmpty(c))continue;l.push(c)}}}return i.textJoin(a,l)},i.addResult=function(n,t,r){var o,e,c,h,u,f,s;if(t instanceof GC.Spread.CalcEngine.CalcReference)for(o=t,e=0;e<o.getRangeCount();e++)for(u=0;u<o.getRowCount(e);u++)for(f=0;f<o.getColumnCount(e);f++)c={row:u,col:f},s=o.getValue(c,e),i.addSingleValue(n,s,r);else if(t instanceof GC.Spread.CalcEngine.CalcArray)for(h=t,u=0;u<h.getRowCount();u++)for(f=0;f<h.getColumnCount();f++)s=h.getValue(u,f),i.addSingleValue(n,s,r);else i.addSingleValue(n,t,r)},i.addSingleValue=function(t,i,r){if(n.Common.IsEmpty(i)){if(r)return;i=""}t.push(i)},i.textJoin=function(n,t){var u,r,i;if(t.length===0)return"";if(n.length===1)return t.join(n[0]);for(u=t[0],r=1,i=0;r<t.length;r++,i++)i===n.length&&(i=0),u+=n[i]+t[r];return u},i}(GC.Spread.CalcEngine.Functions.Function);t.TextJoinIfFunction=f,function(n){n[n.SingleByte=0]="SingleByte";n[n.DoubleByte=1]="DoubleByte";n[n.FourByte=2]="FourByte"}(r||(r={})),function(n){n[n.SingleByte_All=0]="SingleByte_All";n[n.DoubleByte_FirstHalf=1]="DoubleByte_FirstHalf";n[n.DoubleByte_SecondHalf=2]="DoubleByte_SecondHalf";n[n.FourByte_FirstHalf=3]="FourByte_FirstHalf";n[n.FourByte_SecondHalf=4]="FourByte_SecondHalf";n[n.FourByte_ThirdHalf=5]="FourByte_ThirdHalf";n[n.FourByte_FourthHalf=6]="FourByte_FourthHalf"}(i||(i={}));u=function(){function n(n){this.originStr=n;this.initLength();this.initIterator()}return n.prototype.determineType=function(n){var t=n.charCodeAt(0);return t>=0&&t<129||t===63728||t>=65377&&t<65440||t>=63729&&t<63732?r.SingleByte:t>=55296&&t<=57343?r.FourByte:r.DoubleByte},n.prototype.initLength=function(){this.length=0;for(var n=0;n<this.originStr.length;n++)switch(this.determineType(this.originStr[n])){case r.SingleByte:this.length+=1;break;case r.DoubleByte:case r.FourByte:this.length+=2}},n.prototype.initIterator=function(){var n=1,t;for(this.iteratorType=[],this.iteratorPosition=[],t=0;t<this.originStr.length;t++)switch(this.determineType(this.originStr[t])){case r.SingleByte:this.iteratorType[n]=i.SingleByte_All;this.iteratorPosition[n]=t.toString();++n;break;case r.DoubleByte:this.iteratorType[n]=i.DoubleByte_FirstHalf;this.iteratorPosition[n]=t.toString();++n;this.iteratorType[n]=i.DoubleByte_SecondHalf;this.iteratorPosition[n]=t.toString();++n;break;case r.FourByte:this.iteratorType[n]=i.FourByte_FirstHalf;this.iteratorPosition[n]=t.toString()+"+"+(t+1).toString();++n;this.iteratorType[n]=i.FourByte_SecondHalf;this.iteratorPosition[n]=t.toString()+"+"+(t+1).toString();++n;this.iteratorType[n]=i.FourByte_ThirdHalf;this.iteratorPosition[n]=t.toString()+"+"+(t+1).toString();++n;this.iteratorType[n]=i.FourByte_FourthHalf;this.iteratorPosition[n]=t.toString()+"+"+(t+1).toString();++n;++t}this.iteratorLength=n-1},n}();e=function(t){function i(){return t.call(this,"LENB",1,1)||this}return __extends(i,t),i.prototype.evaluate=function(){for(var r,f,i=[],t=0;t<arguments.length;t++)i[t]=arguments[t];return r=n.SpreadJSHelpMethods.Convert.S(i[0]),f=new u(r),f.length},i}(GC.Spread.CalcEngine.Functions.Function);t.LenBFunction=e;o=function(t){function r(){return t.call(this,"FINDB",2,3)||this}return __extends(r,t),r.prototype.evaluate=function(){for(var s,a,p,f,h,e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];var c=n.SpreadJSHelpMethods.Convert,w=n.SpreadJSHelpMethods._Helper,v=c.S(e[0]),l=c.S(e[1]),t=w._argumentExists(e,2)?c.I(e[2]):1,r=new u(l),y=r.iteratorLength;if(n.Common.IsEmpty(v)||n.Common.IsEmpty(l))return t>0?y+1:GC.Spread.CalcEngine.Errors.Value;if(t<1||t>y)return GC.Spread.CalcEngine.Errors.Value;s=-1;switch(r.iteratorType[t]){case i.DoubleByte_SecondHalf:if(t===r.iteratorLength){t=-1;break}++t;break;case i.FourByte_SecondHalf:if(t+3>r.iteratorLength){t=-1;break}t+=3;break;case i.FourByte_ThirdHalf:if(t+2>r.iteratorLength){t=-1;break}t+=2;break;case i.FourByte_FourthHalf:if(t+1>r.iteratorLength){t=-1;break}t+=1}if(t===-1||(t!==-1&&s===-1&&(s=r.iteratorPosition[t].indexOf("+")>0?Number(r.iteratorPosition[t].split("+")[0]):Number(r.iteratorPosition[t])),a=l.indexOf(v,s),a===-1))return GC.Spread.CalcEngine.Errors.Value;for(p=0,f=1;f<=r.iteratorLength;f++)if(h=r.iteratorPosition[f],h.indexOf("+")>0&&(h=r.iteratorPosition[f].split("+")[0],++p),h===a.toString())return f},r}(GC.Spread.CalcEngine.Functions.Function);t.FindBFunction=o;s=function(t){function r(){return t.call(this,"LEFTB",1,2)||this}return __extends(r,t),r.prototype.evaluate=function(){for(var r,c,s,f=[],e=0;e<arguments.length;e++)f[e]=arguments[e];var h=n.SpreadJSHelpMethods.Convert,l=n.SpreadJSHelpMethods._Helper,o=h.S(f[0]),t=l._argumentExists(f,1)?h.I(f[1]):1;if(n.Common.IsEmpty(o))return n.Common.IsEmpty(t)||t>=0?"":GC.Spread.CalcEngine.Errors.Value;if(r=new u(o),t<0)return GC.Spread.CalcEngine.Errors.Value;if(t===0)return"";if(t>=r.iteratorLength)return o;c=r.iteratorType[t];s=-1;switch(c){case i.DoubleByte_FirstHalf:if(t===1)return"";--t;break;case i.FourByte_FirstHalf:if(t-1<1)return"";t-=1;break;case i.FourByte_SecondHalf:if(t-2<1)return"";t-=2;break;case i.FourByte_ThirdHalf:if(t-3<1)return"";t-=3}return s===-1&&(s=r.iteratorPosition[t].indexOf("+")>0?Number(r.iteratorPosition[t].split("+")[1]):Number(r.iteratorPosition[t])),o.substring(0,Number(s)+1)},r}(GC.Spread.CalcEngine.Functions.Function);t.LeftBFunction=s;h=function(t){function r(){return t.call(this,"RIGHTB",1,2)||this}return __extends(r,t),r.prototype.evaluate=function(){for(var t,l,s,e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];var c=n.SpreadJSHelpMethods.Convert,a=n.SpreadJSHelpMethods._Helper,f=c.S(e[0]),r=new u(f),h=a._argumentExists(e,1)?c.I(e[1]):1;if(h<0)return GC.Spread.CalcEngine.Errors.Value;if(h===0)return"";if(t=r.iteratorLength-h+1,n.Common.IsEmpty(f))return n.Common.IsEmpty(t)||t>=0?"":GC.Spread.CalcEngine.Errors.Value;if(isNaN(Number(t))||t<=0)return f;if(t===0)return"";l=r.iteratorType[t];s=-1;switch(l){case i.DoubleByte_SecondHalf:if(t===r.iteratorLength)return"";++t;break;case i.FourByte_SecondHalf:if(t+3>r.iteratorLength){t=-1;break}t+=3;break;case i.FourByte_ThirdHalf:if(t+2>r.iteratorLength){t=-1;break}t+=2;break;case i.FourByte_FourthHalf:if(t+1>r.iteratorLength){t=-1;break}t+=1}return t===-1?"":(t!==-1&&s===-1&&(s=r.iteratorPosition[t].indexOf("+")>0?Number(r.iteratorPosition[t].split("+")[0]):Number(r.iteratorPosition[t])),f.substring(Number(s),f.length))},r}(GC.Spread.CalcEngine.Functions.Function);t.RightBFunction=h;c=function(t){function r(){return t.call(this,"MIDB",3,3)||this}return __extends(r,t),r.prototype.evaluate=function(){for(var s=[],h=0;h<arguments.length;h++)s[h]=arguments[h];var e=n.SpreadJSHelpMethods.Convert.S(s[0]),t=n.SpreadJSHelpMethods.Convert.I(s[1]),r=new u(e),f=n.SpreadJSHelpMethods.Convert.I(s[2]),a=r.iteratorType[t],o=-1,v=r.iteratorType[t+f-1],c=-1,l=t;if(n.Common.IsEmpty(e))return t>0?"":GC.Spread.CalcEngine.Errors.Value;if(t<0||f<0)return GC.Spread.CalcEngine.Errors.Value;if(t>r.iteratorLength)return"";switch(a){case i.DoubleByte_SecondHalf:if(t===r.iteratorLength){t=-1;break}++t;break;case i.FourByte_SecondHalf:if(t+3>r.iteratorLength){t=-1;break}t+=3;break;case i.FourByte_ThirdHalf:if(t+2>r.iteratorLength){t=-1;break}t+=2;break;case i.FourByte_FourthHalf:if(t+3>r.iteratorLength){t=-1;break}t+=1}if(t===-1)return"";if(t!==-1&&o===-1&&(o=r.iteratorPosition[t].indexOf("+")>0?Number(r.iteratorPosition[t].split("+")[0]):Number(r.iteratorPosition[t])),t+f-1>r.iteratorLength)return e.substring(Number(o),e.length);switch(v){case i.DoubleByte_FirstHalf:if(f===1)return"";--f;break;case i.FourByte_FirstHalf:if(t+f-2<1)return"";f-=1;break;case i.FourByte_SecondHalf:if(t+f-3<1)return"";f-=2;break;case i.FourByte_ThirdHalf:if(t+f-4<1)return"";f-=3}return c===-1&&(c=r.iteratorPosition[l+f-1].indexOf("+")>0?Number(r.iteratorPosition[l+f-1].split("+")[1]):Number(r.iteratorPosition[l+f-1])),Number(o)!==-1&&Number(c)!==-1?e.substring(Number(o),Number(c)+1):void 0},r}(GC.Spread.CalcEngine.Functions.Function);t.MidBFunction=c;l=function(t){function r(){return t.call(this,"REPLACEB",4,4)||this}return __extends(r,t),r.prototype.evaluate=function(){for(var f,a,e=[],h=0;h<arguments.length;h++)e[h]=arguments[h];var o=n.SpreadJSHelpMethods.Convert.S(e[0]),t=n.SpreadJSHelpMethods.Convert.I(e[1]),r=n.SpreadJSHelpMethods.Convert.I(e[2]),v=n.SpreadJSHelpMethods.Convert.S(e[3]);if(n.Common.IsEmpty(o)||n.Common.IsEmpty(t)||n.Common.IsEmpty(v))return"";if((f=new u(o),isNaN(Number(r))||r<0)||isNaN(Number(t))||t<1||t>f.iteratorLength)return GC.Spread.CalcEngine.Errors.Value;r>f.iteratorLength&&(r=f.iteratorLength-1);var y=f.iteratorType[t],s=-1,p=f.iteratorType[t+r-1],c=-1,l=t;switch(y){case i.FourByte_SecondHalf:if(t+3>f.iteratorLength){t=-1;break}t+=3;break;case i.FourByte_ThirdHalf:if(t+2>f.iteratorLength){t=-1;break}t+=2;break;case i.FourByte_FourthHalf:if(t+3>f.iteratorLength){t=-1;break}t+=1}if(t===-1)return"";if(t!==-1&&s===-1&&(s=f.iteratorPosition[t].indexOf("+")>0?Number(f.iteratorPosition[t].split("+")[0]):Number(f.iteratorPosition[t])),t+r-1>f.iteratorLength)return o.substring(Number(s),o.length);switch(p){case i.FourByte_FirstHalf:if(t+r-2<1)return"";r-=1;break;case i.FourByte_SecondHalf:if(t+r-3<1)return"";r-=2;break;case i.FourByte_ThirdHalf:if(t+r-4<1)return"";r-=3}return c===-1&&(c=f.iteratorPosition[l+r-1].indexOf("+")>0?Number(f.iteratorPosition[l+r-1].split("+")[1]):Number(f.iteratorPosition[l+r-1])),r=Number(c)-Number(s)+1,a=o.split(""),a.splice(Number(s),r,v),a.join("")},r}(GC.Spread.CalcEngine.Functions.Function);t.ReplaceBFunction=l;a=function(t){function r(){return t.call(this,"SEARCHB",2,3)||this}return __extends(r,t),r.prototype.evaluate=function(){for(var c,o,y,b,p,k,f,l,e=[],s=0;s<arguments.length;s++)e[s]=arguments[s];var a=n.SpreadJSHelpMethods.Convert,d=n.SpreadJSHelpMethods._Helper,v=a.S(e[0]),h=a.S(e[1]),t=d._argumentExists(e,2)?a.I(e[2]):1,r=new u(h),w=r.iteratorLength;if(n.Common.IsEmpty(v)||n.Common.IsEmpty(h))return t>0?w+1:GC.Spread.CalcEngine.Errors.Value;if(t<1||t>w)return GC.Spread.CalcEngine.Errors.Value;switch(r.iteratorType[t]){case i.DoubleByte_SecondHalf:if(t===r.iteratorLength){t=-1;break}++t;break;case i.FourByte_SecondHalf:if(t+3>r.iteratorLength){t=-1;break}t+=3;break;case i.FourByte_ThirdHalf:if(t+2>r.iteratorLength){t=-1;break}t+=2;break;case i.FourByte_FourthHalf:if(t+1>r.iteratorLength){t=-1;break}t+=1}if(c=-1,t===-1)return GC.Spread.CalcEngine.Errors.Value;t!==-1&&c===-1&&(c=r.iteratorPosition[t].indexOf("+")>0?Number(r.iteratorPosition[t].split("+")[0]):Number(r.iteratorPosition[t]));o=-1;try{y=n.SpreadJSHelpMethods.RegUtil.getWildcardCriteria(v);y?(b=n.SpreadJSHelpMethods.RegUtil.getRegIgnoreCase(y),p=b.exec(h),o=n.Common.IsEmpty(p)?-1:p.index):o=h.toLowerCase().indexOf(v.toLowerCase(),c)}catch(g){}if(o===-1)return GC.Spread.CalcEngine.Errors.Value;for(k=0,f=1;f<=r.iteratorLength;f++)if(l=r.iteratorPosition[f],l.indexOf("+")>0&&(l=r.iteratorPosition[f].split("+")[0],++k),l===o.toString())return f},r}(GC.Spread.CalcEngine.Functions.Function);t.SearchBFunction=a;v=function(t){function i(){return t.call(this,"GETURLQUERYVALUE",1,1)||this}return __extends(i,t),i.prototype.evaluate=function(){for(var r,t,u=[],i=0;i<arguments.length;i++)u[i]=arguments[i];return(r=n.SpreadJSHelpMethods.Convert.S(u[0]),n.Common.IsEmpty(r))?GC.Spread.CalcEngine.Errors.NotAvailable:(t=n.MetadataLoader.GetUrlQuery(r,!1),!t&&n.MetadataLoader.IsInMobileSimulatorFrame()&&(t=n.MetadataLoader.GetUrlQuery(r,!0)),t===null)?GC.Spread.CalcEngine.Errors.NotAvailable:t},i}(GC.Spread.CalcEngine.Functions.Function);t.GetUrlQueryValueFunction=v;y=function(t){function i(){return t.call(this,"ISDIRTY",4,4)||this}return __extends(i,t),i.prototype.getDataModel=function(t,i){var u=n.ForguncyData.pageInfo,r;if(n.ForguncyData.pageInfo.pageID!==t){if(r=n.ForguncyData.pageInfoStack.filter(function(n){return n.pageID===t}),r.length<=0)return null;u=r[0]}return u.dataModel.getListDataByCalcSheetName(i)},i.prototype.evaluate=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];var u=n[0],f=n[1],r=n[2],e=n[3],i=this.getDataModel(u,f);return i?i.getRowQuery(r)&&i.isDirty(r,e):!1},i}(GC.Spread.CalcEngine.Functions.Function);t.IsDirtyFunction=y;p=function(t){function i(){return t.call(this,"GETPARAM",1,1)||this}return __extends(i,t),i.prototype.evaluate=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return i.getParamResult(t[0])},i.getParamResult=function(t,i,r){var h,c,o,f,s;i===void 0&&(i=!1);r===void 0&&(r=!0);var l=n.SpreadJSHelpMethods.Convert.S(t).replace(/\.\./g,"\n"),e=l.split(".").filter(function(n){return n}).map(function(n){return n.replace(/\n/g,".")}),u=n.ForguncyData.parameterManager;for(n.ForguncyData.parameterManager.getValue(e[0])===undefined&&(c=n.ForguncyData.commandExecutor.getCommandExecuteInfo(),c&&(o=n.PageManager.getContainerCell(c.runTimePageName),o&&o.cellType instanceof n.UserControlPageCellType&&(u=o.cellType))),f=0;f<e.length;f++){if(!n.Common.IsEmpty(u)){if(s=void 0,s=u instanceof n.ParameterManager?u.getValue(e[f]):u instanceof n.UserControlPageCellType?(h=u.GetSinglePropertyValue(e[f],!0))===null||h===void 0?void 0:h.Result:u instanceof Array&&e[f]==="Count"?u.length:u[e[f]],s===undefined)return r&&n.ForguncyData.commandLogHelper.log(n.Common.format(n.RS.CantFindParam,e[f])),GC.Spread.CalcEngine.Errors.Name;u=s}if(i)return u}return u},i}(GC.Spread.CalcEngine.Functions.Function);t.GetParamFunction=p;w=function(t){function i(){return t.call(this,"GETRESOURCESTRING",1,Number.MAX_SAFE_INTEGER)||this}return __extends(i,t),i.prototype.evaluate=function(){for(var u,f,e,i,r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];return(u=(i=r[0])===null||i===void 0?void 0:i.toString(),n.Common.IsEmpty(u))?GC.Spread.CalcEngine.Errors.NotAvailable:(f=n.Common.getMultiLanguageWord(u,!1),e=n.Common.format(f,r.slice(1)),e)},i}(GC.Spread.CalcEngine.Functions.Function);t.GetResourceString=w;b=function(){function t(){}return t.addCustomFunctions=function(){var i=GC.Spread.CalcEngine.Functions,r,t;for(r in n.CustomFunction)t=new n.CustomFunction[r],t instanceof i.Function&&(i.removeGlobalFunction(t.name),i.defineGlobalCustomFunction(t.name,t))},t}();b.addCustomFunctions()})(t=n.CustomFunction||(n.CustomFunction={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__spreadArray=this&&this.__spreadArray||function(n,t,i){if(i||arguments.length===2)for(var r=0,f=t.length,u;r<f;r++)!u&&r in t||(u||(u=Array.prototype.slice.call(t,0,r)),u[r]=t[r]);return n.concat(u||Array.prototype.slice.call(t))},Forguncy;(function(n){var u=GC.Spread.CalcEngine,c=GC.Spread.CalcEngine.CalcError,e=function(){function i(n){this._isReady=!1;this._bindDataModelEvent(n);this._initCalcService()}return i.prototype._initCalcService=function(){this._calcService=new u.CalcService;this._calcSourceCache={};this._formulaResultSyncOperator=[];this._formulaSheetDataModel=[];this._calcService.getGlobalSourceModel(new n.GlobalSource(this._calcService));this._formulaCalculator=new n.FormulaCalculator(this._calcService,this);this._calcSourceCache[this._formulaCalculator.getName()]=this._formulaCalculator},i.isReady=function(){return n.ForguncyData.pageInfo.formulaManager&&n.ForguncyData.pageInfo.formulaManager._isReady},i.prototype.init=function(t,i,r,u,f,e){var l=this._initCalcSource(t,i,r,u),s,o,h,c;if(this._initDefinedNames(t,r,u),e&&(s=n.ForguncyData.pageInfo.formulaManager.getCalcSource(r),s instanceof n.PageCalcSource))for(o=0,h=e.definedProperties;o<h.length;o++)c=h[o],s.setUserControlCustomName(c,e.templateSourceDefaultValue[c]);this._initFormula(this.getFormulaInfos(t,r,u,f));l();this._isReady=!0},i.prototype._initCalcSource=function(n,t,i,r){var e=this,o=this,f=[i],u;return this.addSheetCalcSource(i,n.PageSettings,t.normalCellDataModel),n.MasterPage&&r&&(f.push(r),this.addSheetCalcSource(r,n.MasterPage.PageSettings,t.normalCellDataModel)),u=t.getListDataList([i,r].filter(function(n){return!!n})),u.forEach(function(n){return o.addListviewSheetCalcSource(n)}),this._calcService.getParserContext(this._formulaCalculator),function(){e.handleCalcSourceCreatedCallback(f.concat(u.map(function(n){return n.name})))}},i.prototype.addSheetCalcSource=function(i,r,u){var f=new t(i+t.nameSuffix);this.addCalcSource(new n.PageCalcSource(this._calcService,i,f,r,u));this._formulaSheetDataModel.push(f);this._formulaResultSyncOperator.push(new o(f,i))},i.prototype.handleCalcSourceCreatedCallback=function(n){var t=this;n.forEach(function(n){var i=t._calcSourceCache[n];i&&t._calcSourceCreatedCallback&&t._calcSourceCreatedCallback[n]&&(t._calcSourceCreatedCallback[n].forEach(function(n){return n(i)}),t._calcSourceCreatedCallback[n]=undefined)})},i.prototype.addListviewSheetCalcSource=function(i){var r=new t(i.name+t.nameSuffix);this.addCalcSource(new n.ListCalcSource(this._calcService,i.name,r,i));this._formulaSheetDataModel.push(r);this._formulaResultSyncOperator.push(new s(r,i))},i.prototype._initDefinedNames=function(t,i,r){var u={},f;u[t.PageSettings.Name]=i;t.MasterPage&&(u[t.MasterPage.PageSettings.Name]=r!==null&&r!==void 0?r:n.PageManager.getRunTimeMasterPageName(i));f=this._translateDefinedNameInfo(i,u,t.DefinedNameInfos);this.addCustomNames(i,f);t.MasterPage&&r&&(f=this._translateDefinedNameInfo(r,u,t.MasterPage.DefinedNameInfos),this.addCustomNames(r,f))},i.prototype._translateDefinedNameInfo=function(t,i,r){if(!r)return[];var u=new n.CustomNameFormulaTranslator(t,i);return r.forEach(function(n){return n.Formula=u.translate(n.Formula)}),r},i.prototype.addCustomNames=function(n,t){var r,i,u;if(t)for(r=this._calcService.getGlobalSourceModel().getSource(),i=0;i<t.length;i++)u=this._calcService.parse(this._formulaCalculator,t[i].Formula,t[i].BaseRow,t[i].BaseColumn),r.addCustomName(n,t[i],u)},i.prototype.addCalcSource=function(n){var t=this._calcService.getSourceModel(n),i=t.recalculateCell;t.recalculateCell=function(){for(var n,r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];n=this.getSource();try{return typeof n.useFormulaSheetData=="boolean"&&(n.useFormulaSheetData=!0),i.apply(this,r)}finally{typeof n.useFormulaSheetData=="boolean"&&(n.useFormulaSheetData=!1)}};this._calcSourceCache[n.getName()]=n},i.prototype.getFormulaInfos=function(n,t,i,r){var u={};return this._translateFormula(t,n.FormulaInfos,u),this._translateFormula(t,r,u),n.MasterPage&&i&&this._translateFormula(i,n.MasterPage.FormulaInfos,u),u},i.prototype._translateFormula=function(t,i,r){var u,f,e;if(i){u=n.ListviewBase.getAllListviews([t]);f=function(f){if(!i[f])return"continue";var e=n.Common.IsEmpty(f)?t:n.ListviewBase.getListview(f,t).getCalcSheetName(),o=new n.CellFormulaTranslator(e,t,u);i[f].forEach(function(n){return n.Formula=o.translate(n.Formula)});r[e]=i[f]};for(e in i)f(e)}},i.prototype._initFormula=function(n){var t,r,u,i;this.suspend();try{for(t in n)if(r=this.getCalcSource(t),r&&n[t])for(u=r.getCalcSourceModel(),i=0;i<n[t].length;i++)this._setFormula(u,n[t][i])}finally{this.resume(!1)}},i.prototype._setFormula=function(n,t){t.IsArrayFormula?n.setArrayFormula(t.RowIndex,t.ColumnIndex,t.RowCount,t.ColumnCount,t.Formula):n.setFormula(t.RowIndex,t.ColumnIndex,t.Formula)},i.prototype.setFormula=function(n,t,i){var r=this.getCalcSource(n),u;r&&(this.getRelatedFormulaResultSyncOperator(n).cacheShouldSyncFormulaResultMethod(t.RowIndex,t.ColumnIndex,i),u=r.getCalcSourceModel(),this._setFormula(u,t))},i.prototype.hasFormula=function(t){var r,i=n.Common.parseIDStr(t),u;return i?(u=(r=this.getCalcSource(i.suffix))===null||r===void 0?void 0:r.getCalcSourceModel(),!u)?void 0:!n.Common.IsEmpty(u.getFormula(i.row,i.col)):!1},i.prototype.getRelatedFormulaResultSyncOperator=function(n){var t=this._formulaResultSyncOperator.filter(function(t){return t.getRelatedCalcSheetName()===n});return t.length<=0?null:t[0]},i.prototype.preDestroyRunTimePage=function(n){var t=this._calcService.getGlobalSourceModel().getSource();n.forEach(function(n){return t.preRemoveCustomNames(n)})},i.prototype.destroyRunTimePage=function(n){var t=this._getAllCalcSources(n);this._suspendCalcSources(t);this._removeCustomName(n);this._removeCalcSources(t)},i.prototype._removeCustomName=function(n){var t=this._calcService.getGlobalSourceModel().getSource();n.forEach(function(n){return t.removeCustomNames(n)})},i.prototype._getAllCalcSources=function(t){var r=this,u=t.concat(n.ListviewBase.getAllListviews(t).map(function(n){return n.getCalcSheetName()})),i={};return u.forEach(function(n){return i[n]=r.getCalcSource(n)}),i},i.prototype._suspendCalcSources=function(n){var t;for(var i in n)(t=n[i])===null||t===void 0?void 0:t.suspend()},i.prototype._removeCalcSources=function(n){var r=function(r){i.removeCalcSource(n[r]);i._formulaResultSyncOperator=i._formulaResultSyncOperator.filter(function(n){return n.getRelatedCalcSheetName()!==r});i._formulaSheetDataModel=i._formulaSheetDataModel.filter(function(n){return n.name!==r+t.nameSuffix})},i=this;for(var u in n)r(u)},i.prototype.removeCalcSourceByName=function(n){var t=this.getCalcSource(n);this.removeCalcSource(t)},i.prototype.removeCalcSource=function(n){n&&(this._calcService.removeSource(n),this._calcSourceCache[n.getName()]=undefined,n.dispose())},i.prototype._bindDataModelEvent=function(n){var t=this;n.bind("valuechanged",function(n,i){if(t._calcService)if(i.calcName)t.onListviewValueChanged(i.calcName,i.arg);else t.onNormalCellValueChanged(i.arg)})},i.prototype.onNormalCellValueChanged=function(t){var f=this,r,u;if(i.isSuspended()){t.valueType!==4&&n.DelayRefresh.setTimeout(function(){f.onNormalCellValueChanged(t)});return}(r=n.Common.parseIDStr(t.id),u=this.getCalcSource(r.suffix),u)&&this.recalc(t.valueType!==2,u,r.row,r.col,t.uiAction,t.id)},i.prototype.onListviewValueChanged=function(t,r){var h=this,u,f;if(i.isSuspended()){r.valueType!==4&&n.DelayRefresh.setTimeout(function(){h.onListviewValueChanged(t,r)});return}if(this.updateFormulaSheetDataModel(t,r),u=r.cellRange,f=this.getCalcSource(t),f!==null){var e=f,o=void 0,s=void 0;u.RowCount===1&&u.ColumnCount===1&&u.Row>=0&&u.Column>=0?(o=u.Row,s=u.Column):r.newRowCount!==r.oldRowCount&&(this._calcService.IsSuspended()||(e=null));this.recalc(r.valueType!==2,e,o,s,r.uiAction)}},i.prototype.updateFormulaSheetDataModel=function(n,i){var f=n+t.nameSuffix,u=this._formulaSheetDataModel.filter(function(n){return n.name===f}),r;if(!(u.length<=0)){r=u[0];switch(i.actionType){case 0:r.clean();break;case 2:r.deleteRow(i.deleteRow);break;case 4:r.insertRow(i.cellRange.Row,i.cellRange.RowCount)}}},i.prototype.recalc=function(t,r,u,f,e,o){var s,h,c;e===void 0&&(e=!1);o===void 0&&(o=null);s=i.shouldCoverBindingValueByFormulaResult;i.shouldCoverBindingValueByFormulaResult=t;e&&(i.uiActionInfo={row:u,col:f,id:o,calcSheetName:r===null||r===void 0?void 0:r.getName()});try{n.Common.IsEmpty(r)||n.Common.IsEmpty(u)||n.Common.IsEmpty(f)?n.Common.IsEmpty(r)?this._calcService.recalculateAll(!0):(h=r.getColumnCount(),c=r.getRowCount(),this._calcService.recalcRange(r,0,0,c,h)):this._calcService.recalculate(r,u,f)}catch(l){}finally{i.shouldCoverBindingValueByFormulaResult=s;i.uiActionInfo=null}},i.prototype.suspend=function(){this._calcService.suspend()},i.prototype.resume=function(n){var t=i.shouldCoverBindingValueByFormulaResult;i.shouldCoverBindingValueByFormulaResult=n;try{this._calcService.resume()}finally{i.shouldCoverBindingValueByFormulaResult=t}},i.prototype.isSuspended=function(){return this._calcService.IsSuspended()},i.prototype.getCalcSource=function(n){var t=this._calcSourceCache[n];return t?t:null},i.prototype.addCalcSourceCreatedCallback=function(n,t){var i=this.getCalcSource(n);i&&t(i);this._calcSourceCreatedCallback||(this._calcSourceCreatedCallback={});this._calcSourceCreatedCallback[n]||(this._calcSourceCreatedCallback[n]=[]);this._calcSourceCreatedCallback[n].push(t)},i.prototype.getCalcService=function(){return this._calcService},i.prototype._getMockSheet=function(){return i._mockSheet||(i._mockSheet=new GC.Spread.Sheets.Worksheet("mock"),i._mockSheetCalcService=i._mockSheet.getCalcService(),i._mockSheetSource=new n.MockCalcSourceBase(i._mockSheetCalcService,i._mockSheet.name())),i._mockSheet},i.prototype.restoreMockSheet=function(){i._mockSheet&&i._mockSheet.setCalc(i._mockSheetCalcService,i._mockSheetSource)},i.prototype.evaluateFormula=function(t,r,u){var e,f,o,s,a,v,h;if(u===void 0&&(u=!0),n.Common.isMultiLanguageKeyWord(t))return n.Common.getMultiLanguageWord(t);if(!i.shouldEvaluateFormula(t))return t!==null&&t!==void 0?t:null;if(t.startsWith("=")){e=t;try{n.Common.IsEmpty(r.rowOffset)&&(r.rowOffset=0);n.Common.IsEmpty(r.columnOffset)&&(r.columnOffset=0);f=null;r.isCommand?(this._formulaCalculator.prepare(r),f=this._formulaCalculator):(f=n.ForguncyData.pageInfo.formulaManager.getCalcSource(r.runTimePageName),f instanceof n.PageCalcSource&&(o=n.PageManager.getUserControlCellType(r.runTimePageName),t="="+f.translateFormula(r.runTimePageName,t,o===null||o===void 0?void 0:o.DefinedPropertyNames,r.listInfo,r.ignoreListviews)));s=this.getCalcService().parse(f,t,0,0);s=(new l).visit(s,0,0);try{return i.syncExecuteAsyncFunction=!0,i.nullAsException=r.nullAsException,i.isNullValue=!1,a=this._getMockSheet(),a.setCalc(this._calcService,f),v={convertNullToZero:!1},h=GC.Spread.Sheets.CalcEngine.evaluateExpression(a,s,r.rowOffset,r.columnOffset,v),r.nullAsException&&i.isNullValue?(i.clearFormulaCalcErrorWithThrottle(e,r.runTimePageName),null):(h instanceof c?i.showFormulaCalcErrorWithThrottle(e,h.toString(),r.runTimePageName):i.clearFormulaCalcErrorWithThrottle(e,r.runTimePageName),h)}finally{i.syncExecuteAsyncFunction=!1;i.nullAsException=!1}}catch(y){if(u)return null;i.showFormulaCalcErrorWithThrottle(e,y.toString(),r.runTimePageName);throw y;}}else if(t.charAt(0)==="'")return t.substring(1);return t},i.clearFormulaCalcErrorWithThrottle=function(n,t){var r=n+"|"+t;i.calcErrorCache[r]&&(i.calcErrorCache[r]=undefined)},i.showFormulaCalcErrorWithThrottle=function(t,r,u){var f=t+"|"+u;i.calcErrorCache[f]=[t,r,u];i._lastShowFormulaCalcErrorTimer&&n.DelayRefresh.clearTimeout(i._lastShowFormulaCalcErrorTimer);i.delayShowFormulaError()},i.delayShowFormulaError=function(){if(!i._delayErrorShown){if(!n.DelayOperateHelper.haveNoActiveAjaxCall()){i._delayErrorShown=!0;n.DelayRefresh.setTimeout(function(){i._delayErrorShown=!1;i.delayShowFormulaError()},100);return}i._lastShowFormulaCalcErrorTimer=n.DelayRefresh.setTimeout(function(){var t,n;for(t in i.calcErrorCache)i.calcErrorCache[t]&&(n=i.calcErrorCache[t],i.showFormulaCalcError(n[0],n[1],n[2]));i.calcErrorCache={}},500)}},i.showFormulaCalcError=function(t,i,r){if(n.ForguncyData.isDebugMode()){var u=n.PageManager.getDesignerPageName(r,!1,!0),f=n.Common.format(n.RS.FormulaErrorConsoleMessage,t,i,u);n.ForguncyData.pageInfo.dataModel.debugWarningInfoDataModel.contains(f)||(console.warn(n.Common.format(n.RS.FormulaErrorConsoleMessage,"%c"+t+"%c","%c"+i+"%c",u),"font-weight:bold","color:black;","color:red;font-weight:600","color:black;"),n.ForguncyData.pageInfo.dataModel.debugWarningInfoDataModel.push({message:f}))}},i.shouldEvaluateFormula=function(n){return i.isFormula(n)||i.isValueStartWithSingleQuotes(n)},i.isFormula=function(t){return n.Common.IsEmpty(t)||typeof t!="string"||t.length<1||t.charAt(0)!=="="&&t.charAt(0)!=="~"?!1:!0},i.isValueStartWithSingleQuotes=function(t){return n.Common.IsEmpty(t)||typeof t!="string"||t.length<1||t.charAt(0)!=="'"?!1:!0},i.prototype.getValue=function(n,t){try{return this._formulaCalculator.prepare(t),this._formulaCalculator.getValue({row:n.Row,col:n.Column})}catch(i){return null}},i.isSuspended=function(){return this._suspendCount>0},i.suspendChange=function(){this._suspendCount++},i.resumeChange=function(){this._suspendCount--},i.prototype.destroy=function(t){this.restoreMockSheet();t!==1&&n.CustomFunction.ODataFunction.clearCellCache()},i.syncExecuteAsyncFunction=!1,i.isNullValue=!1,i.nullAsException=!1,i.shouldCoverBindingValueByFormulaResult=!1,i._mockSheet=null,i._mockSheetCalcService=null,i._mockSheetSource=null,i.calcErrorCache={},i._lastShowFormulaCalcErrorTimer=0,i._delayErrorShown=!1,i._suspendCount=0,i}(),t,f,o,s,i,r,h;n.FormulaManager=e;t=function(n){function t(t){var i=n.call(this)||this;return i.name=t,i._data=[],i}return __extends(t,n),t.prototype.clean=function(){this._data=[]},t.prototype.insertRow=function(n,t){for(var i,r=[],u=0;u<t;u++)r.push([]);(i=this._data).splice.apply(i,__spreadArray([n,0],r,!1))},t.prototype.deleteRow=function(n){this._data.splice(n,1)},t.prototype.getValue=function(n,t){if(this._data[n]===undefined)return null;var i=this._data[n][t];return i===undefined?null:i},t.prototype.setValue=function(n,t,i){var r=this.getValue(n,t);r!==i&&(this._data[n]===undefined&&(this._data[n]=[]),this._data[n][t]=i,this.trigger("valuechanged",{row:n,col:t,oldValue:r,newValue:i}))},t.nameSuffix="__",t}(n.EventClassBase);n.FormulaSheetDataModel=t;f=function(){function t(n){var t=this;this._shouldSyncFormulaResultMethodCache={};n.bind("valuechanged",function(n,i){t.onDataModelValueChanged(i)})}return t.prototype.onDataModelValueChanged=function(n){var t=this.getCurrentValueType(n.row,n.col);this.shouldSyncFormulaResult(n.row,n.col,t)&&this.syncValue(n.row,n.col,n.newValue,!1)},t.prototype.shouldSyncFormulaResult=function(n,t,i){var r=this._shouldSyncFormulaResultMethodCache[n+","+t];return r?r(i):i!==2||e.shouldCoverBindingValueByFormulaResult},t.prototype.getCurrentValueType=function(){throw n.StaticValues.NeedImplementException;},t.prototype.syncValue=function(){throw n.StaticValues.NeedImplementException;},t.prototype.getRelatedCalcSheetName=function(){throw n.StaticValues.NeedImplementException;},t.prototype.cacheShouldSyncFormulaResultMethod=function(n,t,i){this._shouldSyncFormulaResultMethodCache[n+","+t]=i},t}();n.FormulaResultSyncOperator=f;o=function(t){function i(n,i){var r=t.call(this,n)||this;return r._runTimePageName=i,r}return __extends(i,t),i.prototype.getCurrentValueType=function(t,i){return n.ForguncyData.pageInfo.dataModel.normalCellDataModel.getValueType(this.getID(t,i))},i.prototype.syncValue=function(t,i,r){n.ForguncyData.pageInfo.dataModel.normalCellDataModel.setValue(this.getID(t,i),{newValue:r},4)},i.prototype.getID=function(t,i){return n.Common.getIdStr(t,i,this.getRelatedCalcSheetName())},i.prototype.getRelatedCalcSheetName=function(){return this._runTimePageName},i}(f);n.NormalCellFormulaResultSyncOperator=o;s=function(n){function t(t,i){var r=n.call(this,t)||this;return r._listDataModel=i,r}return __extends(t,n),t.prototype.getCurrentValueType=function(n,t){return this._listDataModel.getValueType(n,t)},t.prototype.syncValue=function(n,t,i){this._listDataModel.setValue(n,t,i,4)},t.prototype.getRelatedCalcSheetName=function(){return this._listDataModel.name},t}(f);n.ListviewCellFormulaResultSyncOperator=s;i=function(){function t(){}return t.getRangeLocations=function(t,i){var e,u=n.ForguncyData.pageInfo.formulaManager.getCalcSource(i),r,o,s,f;return n.ForguncyData.parameterManager.NeedUpdateReference(t)?t=n.ForguncyData.parameterManager.ParamToReference(t):(r=(e=n.PageManager.getContainerCell(i))===null||e===void 0?void 0:e.cellType,r&&r instanceof n.UserControlPageCellType&&r.needUpdateReference(t)&&(o=r.propertyToReference(t),t=o.referStr,i=o.runTimePageName,u=n.ForguncyData.pageInfo.formulaManager.getCalcSource(i))),u||(u=n.ForguncyData.pageInfo.formulaManager.getCalcSource(n.ForguncyData.pageInfo.runTimeNormalPage)),s=n.ForguncyData.pageInfo.formulaManager.getCalcService().parse(u,t,0,0),f=new a(i),f.visit(s,0,0),f.hasError?null:f.ranges},t.getCellLocation=function(t,i){return n.Helper.getCellLocation(t,{PageID:i})},t.getFormulaCalcInfo=function(t){return{runTimePageName:n.Common.getRunTimePageNameFromFormulaCalcContext(t),ignoreListviews:!0,rowOffset:t.RowOffset,columnOffset:t.ColumnOffset,listInfo:t.ListviewRowInfo}},t.getCellIds=function(t,i){var r=this.getCellIdInfos(t,i);return r.map(function(t){return n.Common.getIdStr(t.row,t.col,t.suffix)})},t.setValueToCellLocation=function(t,i,r,u,f){var e,o,s,h;if(f===void 0&&(f=!0),!n.Common.IsEmpty(i)){if(e=n.CommandBase.getCellID(i,u,!0),e&&e.length>0)for(o=0,s=e;o<s.length;o++)h=s[o],n.ForguncyData.pageInfo.dataModel.normalCellDataModel.setValue(h,{newValue:t},r);i.Name&&f&&n.ForguncyData.parameterManager.setValue(i.Name,t)}},t.getCellIdInfos=function(t,i){var u,r,e,f;if(typeof t!="string")return[];u=i.runTimePageName;n.ForguncyData.parameterManager.NeedUpdateReference(t)?t=n.ForguncyData.parameterManager.ParamToReference(t):(r=n.PageManager.getContainerCell(u),(r===null||r===void 0?void 0:r.cellType)instanceof n.UserControlPageCellType&&r.cellType.needUpdateReference(t)&&(e=r.cellType.propertyToReference(t),t=e.referStr,u=e.runTimePageName));f=n.ForguncyData.pageInfo.formulaManager.getCalcSource(u);f||(f=n.ForguncyData.pageInfo.formulaManager.getCalcSource(n.ForguncyData.pageInfo.runTimeNormalPage));var s=n.ForguncyData.pageInfo.formulaManager.getCalcService().parse(f,t,0,0),o=[];return this.getIDInfosByExpression(s,i,f,o,[],u),o},t.getIDInfosByExpression=function(i,r,u,f,e,o){var v,h,y,p,c,l,s,a,w,b;if(i.type===GC.Spread.CalcEngine.ExpressionType.name){if(h=i,e.indexOf(h.value)===-1&&n.ForguncyData.parameterManager.NeedUpdateReference(h.value))e.push(h.value),y=n.ForguncyData.parameterManager.ParamToReference(h.value),p=n.ForguncyData.pageInfo.formulaManager.getCalcService().parse(u,y,0,0),this.getIDInfosByExpression(p,r,u,f,e,o);else if(c=n.ForguncyData.pageInfo.pageElementManager.cells.getCellsByName(h.value,!1),c)for(l=0;l<c.length;l++)f.push(n.Common.parseIDStr(c[l].id))}else i.type===GC.Spread.CalcEngine.ExpressionType.reference?(s=i,t.isCellExpression(s)&&(s=this.offsetFormulaCellLocation(s,r.rowOffset,r.columnOffset),f.push({row:s.row,col:s.column,suffix:(v=t.getRunTimePageName(s))!==null&&v!==void 0?v:o}))):i.type===GC.Spread.CalcEngine.ExpressionType.operator&&(a=i,a.operatorType===16&&(w=n.Common.clone(e),b=n.Common.clone(e),this.getIDInfosByExpression(a.value,r,u,f,w,o),this.getIDInfosByExpression(a.value2,r,u,f,b,o)))},t.offsetFormulaCellLocation=function(t,i,r){if(n.Common.IsEmpty(t)||!t.rowRelative&&!t.columnRelative||(n.Common.IsEmpty(i)&&(i=0),n.Common.IsEmpty(r)&&(r=0),i===0&&r===0))return t;var u=n.Common.clone(t);return u.rowRelative&&(u.row+=i),u.columnRelative&&(u.column+=r),u},Object.defineProperty(t,"SheetParserContext",{get:function(){return t._sheetParserContext||(t._sheetParserContext=new GC.Spread.Sheets.CalcEngine.SheetParserContext(null,!1,{row:0,col:0})),t._sheetParserContext},enumerable:!1,configurable:!0}),t.parse=function(i,r){var u,f,o;return r===void 0&&(r=!1),e.isReady()||r?(u=n.ForguncyData.pageInfo.formulaManager.getCalcService(),f=n.ForguncyData.pageInfo.formulaManager.getCalcSource("temp"),u.parse(f,i,0,0)):(o=new GC.Spread.CalcEngine.Parser,o.parse(t.SheetParserContext,i))},t.unparse=function(n){var i=new GC.Spread.CalcEngine.Parser;return i.unparse(t.SheetParserContext,n)},t.translateFormula=function(i,r,u,f){if(u===void 0&&(u=0),f===void 0&&(f=0),n.Common.IsEmpty(i))return i;try{var e=t.parse(i,!0),o=r.visit(e,u,f);return t.unparse(o)}catch(h){return console.error("Invalid formula: "+i),null}},t.createCellExpression=function(n,t,i,r,u,f){var e=new GC.Spread.CalcEngine.ReferenceExpression(GC.Spread.CalcEngine.ExpressionType.reference);return e.row=i,e.column=r,e.rowRelative=u,e.columnRelative=f,n&&(e.source=n),t&&(e.endSource=t),e},t.createColumnRangeExpression=function(n,i,r,u,f){return t.createRangeExpression(n,null,GC.Spread.CalcEngine.BAND_INDEX_CONST,i,GC.Spread.CalcEngine.BAND_INDEX_CONST,r,!0,u,!0,f)},t.createRangeExpression=function(n,t,i,r,u,f,e,o,s,h){var c=new GC.Spread.CalcEngine.ReferenceExpression(GC.Spread.CalcEngine.ExpressionType.reference),l;return c.isFullRow=r===GC.Spread.CalcEngine.BAND_INDEX_CONST,c.isFullRow&&i===0&&u===GC.Spread.CalcEngine.MAX_ROW_COUNT-1&&(i=u=GC.Spread.CalcEngine.BAND_INDEX_CONST),c.isFullColumn=i===GC.Spread.CalcEngine.BAND_INDEX_CONST,i>u&&(l=i,i=u,u=l,l=e,e=s,s=l),r>f&&(l=r,r=f,f=l,l=o,o=h,h=l),c.row=i,c.column=r,c.endRow=u,c.endColumn=f,c.rowRelative=e,c.columnRelative=o,c.endRowRelative=s,c.endColumnRelative=h,n&&(c.source=n),t&&(c.endSource=t),c},t.createErrorExpressionfunction=function(n,t,i){var r=new GC.Spread.CalcEngine.Expression(GC.Spread.CalcEngine.ExpressionType.error);return t&&(r.source=t),i&&(r.endSource=i),r.value=n,r},t.createFunctionExpression=function(n,t){var i=new GC.Spread.CalcEngine.Expression(GC.Spread.CalcEngine.ExpressionType.function);return i.arguments=t,n instanceof GC.Spread.CalcEngine.Expression?(i.function=n.function,i.functionName=n.functionName):(i.function=n.name&&n,i.functionName=n.name||n),i},t.createParenthesesExpression=function(n){var t=new GC.Spread.CalcEngine.Expression(GC.Spread.CalcEngine.ExpressionType.parentheses);return t.value=n,t},t.createOperatorExpression=function(n,t,i){var r=new GC.Spread.CalcEngine.Expression(GC.Spread.CalcEngine.ExpressionType.operator);return r.operatorType=n,r.value=t,r.value2=i,r},t.isCellExpression=function(n){return n.endRow===undefined},t.getReferenceStringByID=function(t){var i=n.Common.parseIDStr(t);return i?this.getReferenceString(i.row,i.col):null},t.getCellLogLocationString=function(t,i,r){var o=n.FormulaHelper.getReferenceStringByID(t),f=i?i.join(","):null,e=n.PageManager.getDesignerPageName(r,!1,!0),u=o;return e&&u&&(u=e+"!"+u),f&&u&&(u=f+"("+u+")"),u},t.getListviewCellLogLocationString=function(t,i,r,u,f){var e=i===null||i===void 0?void 0:i.toString(),o,s;return r&&(e=r+":"+e),o=t===null||t===void 0?void 0:t.toString(),e&&(o="".concat(o,",").concat(e)),s=n.PageManager.getDesignerPageName(f,!1,!0),"".concat(s,"!").concat(u,"(").concat(o,")")},t.getReferenceString=function(n,i){var r=t.createCellExpression(null,null,n,i,!0,!0);return t.unparse(r)},t.adjustNumberPrecision=function(n){var t,i,r;return typeof n!="number"?n:(t=15,n>-10&&n<10&&(i=n.toString(),(i.indexOf("000000000000")>1||i.indexOf("999999999999")>1)&&(t=14)),n<1&&n>-1?(r=+n.toFixed(t),n=r===0?+n.toPrecision(t):r):n=+n.toPrecision(t),n)},t.getRunTimePageName=function(t){var i,r=(i=t.source)===null||i===void 0?void 0:i.getName();return n.Common.IsEmpty(r)?null:n.PageManager.getRunTimePageName(r)},t}();n.FormulaHelper=i;r=function(){function n(){}return n.prototype.visit=function(n,t,r){if(!n)return n;var f=u.ExpressionType;switch(n.type){case f.reference:return i.isCellExpression(n)?this.visitCellExpression(n,t,r):this.visitRangeExpression(n,t,r);case f.function:return this.visitFunctionExpression(n,t,r);case f.name:return this.visitNameExpression(n,t,r);case f.operator:return this.visitOperatorExpression(n,t,r);case f.parentheses:return this.visitParenthesesExpression(n,t,r);default:return n}},n.prototype.visitCellExpression=function(n){return n},n.prototype.visitRangeExpression=function(n){return n},n.prototype.visitFunctionExpression=function(n,t,r){for(var e,o=!1,f=[],u=0;u<n.arguments.length;u++)e=n.arguments[u],f[u]=this.visit(e,t,r),e!==f[u]&&(o=!0);return o?i.createFunctionExpression(n,f):n},n.prototype.visitNameExpression=function(n){return n},n.prototype.visitOperatorExpression=function(n,t,r){var u=this.visit(n.value,t,r),f=this.visit(n.value2,t,r);return u!==n.value||f!==n.value2?i.createOperatorExpression(n.operatorType,u,f):n},n.prototype.visitParenthesesExpression=function(n,t,r){var u=this.visit(n.value,t,r);return u!==n.value?i.createParenthesesExpression(u):n},n}();n.ExpressionVisitor=r;var l=function(t){function r(){return t!==null&&t.apply(this,arguments)||this}return __extends(r,t),r.prototype.visitFunctionExpression=function(r,f,e){var o=t.prototype.visitFunctionExpression.call(this,r,f,e),s;return o.function instanceof u.Functions.AsyncFunction&&(s=new n.CustomFunction.AsyncToSyncFunction(o.functionName),o=i.createFunctionExpression(s,o.arguments)),o},r}(r),a=function(t){function i(n){var i=t.call(this)||this;return i._runTimePageName=n,i.ranges=[],i}return __extends(i,t),i.prototype.visit=function(t,i,r){var f,e;if(!t)return this.hasError=!0,t;f=u.ExpressionType;switch(t.type){case f.reference:return this.visitRangeExpression(t,i,r);case f.operator:return this.visitOperatorExpression(t,i,r);case f.name:return t.value?(e=n.ForguncyData.pageInfo.formulaManager.getCalcService().getGlobalSourceModel().getSource().getCustomName(t.value),this.visit(e,i,r)):(this.hasError=!0,t);default:return this.hasError=!0,t}},i.prototype.visitRangeExpression=function(t){return this.ranges.push({Row:t.row,Column:t.column,EndRow:t.endRow,EndColumn:t.endColumn,PageName:n.PageManager.getDesignerPageName(this._runTimePageName,!1),PageID:this._runTimePageName}),t},i.prototype.visitOperatorExpression=function(n,i,r){return n.operatorType!==16&&(this.hasError=!0),t.prototype.visitOperatorExpression.call(this,n,i,r)},i}(r),v=function(t){function i(n,i,r,u){var f=t.call(this)||this;return f._row=n,f._col=i,f._id=r,f._calcSheetName=u,f}return __extends(i,t),i.prototype.visitCellExpression=function(n){var t;return n.row===this._row&&n.column===this._col&&((t=n.source)===null||t===void 0?void 0:t.getName())===this._calcSheetName&&(this.isRefer=!0),n},i.prototype.visitNameExpression=function(i,r,u){if(this._id&&!this._cellNames){var f=n.ForguncyData.pageInfo.pageElementManager.cells.getCell(this._id);this._cellNames=f.name}return this._cellNames&&this._cellNames.indexOf(i.value)!==-1&&(this.isRefer=!0),t.prototype.visitNameExpression.call(this,i,r,u)},i.prototype.visitRangeExpression=function(n,i,r){var u;return((u=n.source)===null||u===void 0?void 0:u.getName())===this._calcSheetName&&(n.isFullRow?n.row===this._row&&(this.isRefer=!0):n.isFullColumn?n.column===this._col&&(this.isRefer=!0):n.row>=this._row&&n.endRow<=this._row&&n.column>=this._col&&n.endColumn<=this._col&&(this.isRefer=!0)),t.prototype.visitRangeExpression.call(this,n,i,r)},i}(r);n.CheckReferCellVisitor=v;h=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.visitFunctionExpression=function(t,i,r){if(t.functionName==="NOW"){var u=new GC.Spread.CalcEngine.Expression(GC.Spread.CalcEngine.ExpressionType.function);return u.arguments=[],u.functionName="TODAY",u}return n.prototype.visitFunctionExpression.call(this,t,i,r)},t}(r);n.ReplaceNowVisitor=h})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var i=function(){function i(){this._defaultFormulas=new t}return i.prototype.setDefaultFormula=function(t){var i=this;i.addDefaultFormulaToCollection(t);t.forEach(function(t){var r=i._defaultFormulas.getDefaultFormulaArray(t);r.forEach(function(i){n.ForguncyData.pageInfo.formulaManager.setFormula(t,i,function(n){return n===0||n===1||n===4})})})},i.prototype.clearDefaultFormula=function(t){var i=this;t.forEach(function(t){var r=i._defaultFormulas.getDefaultFormulaArray(t);r.forEach(function(i){i.Formula="";n.ForguncyData.pageInfo.formulaManager.setFormula(t,i,null)});i._defaultFormulas.clear(t)})},i.prototype.addDefaultFormulaToCollection=function(n){this.addNormalCellDefaultFormulas(n);this._defaultFormulas.translateFormula(n)},i.prototype.addNormalCellDefaultFormulas=function(t){var i=this,r=n.ForguncyData.pageInfo.pageElementManager.cells.getAllCells(t);r.forEach(function(t){var u=t.getDefaultFormula(),r;n.Common.IsEmpty(u)||(r=n.Common.parseIDStr(t.id),i._defaultFormulas.addDefaultFormula(r.suffix,r.row,r.col,u))})},i}(),t;n.DefaultFormulaManager=i;t=function(){function t(){this.defaultFormulas={}}return t.prototype.addDefaultFormula=function(n,t,i,r){var u=this.getDefaultFormulaArray(n),f=this.createFormulaInfo(t,i,r);u.push(f)},t.prototype.getDefaultFormulaArray=function(n){return this.defaultFormulas[n]||(this.defaultFormulas[n]=[]),this.defaultFormulas[n]},t.prototype.createFormulaInfo=function(n,t,i){return{RowIndex:n,ColumnIndex:t,RowCount:1,ColumnCount:1,IsArrayFormula:!1,Formula:i}},t.prototype.translateFormula=function(t){var i=this;t.forEach(function(t){var r=i.getDefaultFormulaArray(t),u,f;r&&(u=n.ListviewBase.getAllListviews([t]),f=new n.CellFormulaTranslator(t,t,u),r.forEach(function(n){return n.Formula=f.translate(n.Formula)}))})},t.prototype.clear=function(n){delete this.defaultFormulas[n]},t}()})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var e=GC.Spread.CalcEngine,i=function(){function t(){}return t.prototype.translate=function(t,i,r){return i===void 0&&(i=0),r===void 0&&(r=0),n.FormulaHelper.translateFormula(t,this.createExpressionVisitor(),i,r)},t}(),r,u,f;n.FormulaTranslator=i;r=function(n){function t(t,i,r,u,f,e){var o=n.call(this)||this;return o._calcSourceName=t,o._runTimePageName=i,o._listviewList=r,o._calcSource=u,o._propertyList=f,o._listInfo=e,o}return __extends(t,n),t.prototype.createExpressionVisitor=function(){return this._calcSourceName===this._runTimePageName?new o(this._listviewList,this._calcSource,this._propertyList,this._listInfo):new s(this._calcSourceName,this._runTimePageName,this._listviewList)},t}(i);n.CellFormulaTranslator=r;var t=function(){function t(){}return t.getCalcSource=function(t){return n.ForguncyData.pageInfo.formulaManager.getCalcSource(t)},t.getLocatedListview=function(n,i,r,u,f){var o,e,s,h;if(n)for(o=n.length,e=0;e<o;e++)if(s=n[e].getRangeInfo(),h=n[e].getColumnHeaderRangeInfo(),t.isRangeIncluded(s,i,r,u,f)&&!t.isRangeIncluded(h,i,r,u,f))return n[e];return null},t.isRangeIncluded=function(n,t,i,r,u){return t>=n.Row&&r<n.Row+n.RowCount&&i>=n.Column&&u<n.Column+n.ColumnCount},t.getColumnIndexInListview=function(n,t){var r=n.getMergedColumnInfos(),i;if(r)for(i=0;i<r.length;i++)if(r[i].DesignerColumnIndex<=t&&r[i].DesignerColumnIndex+r[i].DesignerColumnCount>t){t=r[i].DesignerColumnIndex;break}return t-n.getRangeInfo().Column},t}(),o=function(i){function r(n,t,r,u){var f=i.call(this)||this;return f._listviewList=n,f._calcSource=t,f._propertyList=r,f._listInfo=u,f}return __extends(r,i),r.prototype.visitNameExpression=function(n){var t;return n.source=this._calcSource&&((t=this._propertyList)===null||t===void 0?void 0:t.some(function(t){var i;return(t===null||t===void 0?void 0:t.toLowerCase())===((i=n.value)===null||i===void 0?void 0:i.toLowerCase())}))?this._calcSource:null,n},r.prototype.visitCellExpression=function(i){var r,f,u,e;return i.source?i:(this._calcSource&&(i.source=this._calcSource),r=t.getLocatedListview(this._listviewList,i.row,i.column,i.row,i.column),!r)?i:(f=t.getCalcSource(r.getCalcSheetName()),u=t.getColumnIndexInListview(r,i.column),this._listInfo&&this._listInfo[r.getCalcSheetName()]!==undefined?(e=this._listInfo[r.getCalcSheetName()],n.FormulaHelper.createCellExpression(f,null,e,u,i.rowRelative,i.columnRelative)):n.FormulaHelper.createColumnRangeExpression(f,u,u,!0,!0))},r.prototype.visitRangeExpression=function(i){var r,u;if(i.source||(this._calcSource&&(i.source=this._calcSource),r=t.getLocatedListview(this._listviewList,i.row,i.column,i.endRow,i.endColumn),!r))return i;var f=t.getCalcSource(r.getCalcSheetName()),e=t.getColumnIndexInListview(r,i.column),o=t.getColumnIndexInListview(r,i.endColumn);return this._listInfo&&this._listInfo[r.getCalcSheetName()]!==undefined?(u=this._listInfo[r.getCalcSheetName()],n.FormulaHelper.createRangeExpression(f,null,u,e,u,o,i.rowRelative,i.columnRelative,i.endRowRelative,i.endColumnRelative)):n.FormulaHelper.createColumnRangeExpression(f,e,o,!0,!0)},r}(n.ExpressionVisitor),s=function(i){function r(n,r,u){var f=i.call(this)||this,e,o,s;for(f._calcSourceName=n,f._runTimePageName=r,f._listviewList=u,f._columnNames=null,f._calcSource=t.getCalcSource(f._calcSourceName),e=0,o=f._listviewList;e<o.length;e++)if(s=o[e],s.getCalcSheetName()===f._calcSourceName){f._columnNames=s.getColumnNameForTranslateFormula();break}return f}return __extends(r,i),r.prototype.visitNameExpression=function(t){var i,u,r;return(t.source=null,i=n.PageManager.getUserControlCellType(this._runTimePageName),i&&i.DefinedPropertyNames&&i.DefinedPropertyNames.some(function(n){var i;return(n===null||n===void 0?void 0:n.toLowerCase())===((i=t.value)===null||i===void 0?void 0:i.toLowerCase())}))?(t.source=n.ForguncyData.pageInfo.formulaManager.getCalcSource(this._runTimePageName),t):this._columnNames?(u=t.value.toLowerCase(),r=this._columnNames.indexOf(u),r===-1)?t:n.FormulaHelper.createCellExpression(this._calcSource,null,0,r,!0,!0):t},r.prototype.visitCellExpression=function(i){var r,u,f;return i.source?i:(r=t.getLocatedListview(this._listviewList,i.row,i.column,i.row,i.column),u=t.getCalcSource(r?r.getCalcSheetName():this._runTimePageName),r?(f=t.getColumnIndexInListview(r,i.column),r.getCalcSheetName()===this._calcSourceName?n.FormulaHelper.createCellExpression(u,null,0,f,i.rowRelative,i.columnRelative):n.FormulaHelper.createColumnRangeExpression(u,f,f,!0,!0)):(i.source=u,i))},r.prototype.visitRangeExpression=function(i){var r,u,f,e;return i.source?i:(r=t.getLocatedListview(this._listviewList,i.row,i.column,i.endRow,i.endColumn),u=t.getCalcSource(r?r.getCalcSheetName():this._runTimePageName),r?(f=t.getColumnIndexInListview(r,i.column),e=t.getColumnIndexInListview(r,i.endColumn),r.getCalcSheetName()===this._calcSourceName?n.FormulaHelper.createRangeExpression(u,null,0,f,0,e,i.rowRelative,i.columnRelative,i.endRowRelative,i.endColumnRelative):n.FormulaHelper.createColumnRangeExpression(u,f,e,!0,!0)):(i.source=u,i))},r}(n.ExpressionVisitor),h=function(n){function t(t,i){var r=n.call(this)||this;return r._runTimePageName=t,r._namePair=i,r}return __extends(t,n),t.prototype.createExpressionVisitor=function(){return new u(this._runTimePageName,this._namePair)},t}(i);n.CustomNameFormulaTranslator=h;u=function(i){function r(n,t){var r=i.call(this)||this;return r._runTimePageName=n,r._namePair=t,r}return __extends(r,i),r.prototype.visitNameExpression=function(n){return n.source=null,n},r.prototype.visitCellExpression=function(n,t,i){return this.visitRangeExpression(n,t,i)},r.prototype.visitRangeExpression=function(i){var r=this._runTimePageName,u;return i.source instanceof GC.Spread.CalcEngine.CalcSource&&(u=i.source.getName(),r=this._namePair[u],n.Common.IsEmpty(r))?i:(i.source=t.getCalcSource(r),i)},r}(n.ExpressionVisitor);f=function(t){function i(n){var i=t.call(this)||this;return i._currentParamToReferDic=n,i.Updated=!1,i}return __extends(i,t),i.prototype.visit=function(n,i,r){if(!n)return n;var u=e.ExpressionType;return n.type===u.name?this.visitNameExpression(n):t.prototype.visit.call(this,n,i,r)},i.prototype.visitNameExpression=function(t){var i,r=(i=this._currentParamToReferDic[t.value])===null||i===void 0?void 0:i.new,u;if(r!==undefined)try{return u=n.FormulaHelper.parse(r),this.Updated=!0,u}catch(f){}return t},i}(n.ExpressionVisitor);n.UpdateParamReferVisitor=f})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var t=function(){function t(){}t.GetEditorInfo=function(t,i,r){var u={editorDataInfos:t};n.Common.forguncyPost("Home/GetEditorInfo",u,function(n){i&&i.apply(null,[n])},r+" GetEditorInfo")};t.GetTableDataWithOffset=function(t,i,r,u,f){var e={bindingInfos:t.columnBindingInfos,currentRowInfo:t.rowInfo,demandRowCount:t.demandRowCount,currentDataLength:t.currentDataLength,needRowVersion:t.needRowVersion,queryCommandInfo:t.queryData,editorDataInfos:t.editorDataInfos,sortCommandID:t.sortCommandID,orderByInfo:t.sortInfo,offsetConditionInfo:t.offsetCondition,columnFilterQueries:t.columnFilterQueries,totalRowBindingInfos:t.totalRowBindingInfos,pageName:t.pageName,runtimeQueryConditionData:t.runtimeQueryConditionData};n.Common.forguncyPost("Home/GetTableDataWithOffset",e,function(n){i&&i.apply(null,[n])},u+" GetTableDataWithOffset",function(){r()},function(){f===null||f===void 0?void 0:f()})};t.GetTotalRowValues=function(t,i,r){var u={bindingInfos:t.columnBindingInfos,currentRowInfo:t.rowInfo,queryCommandInfo:t.queryData,columnFilterQueries:t.columnFilterQueries,totalRowBindingInfos:t.totalRowBindingInfos,pageName:t.pageName,runtimeQueryConditionData:t.runtimeQueryConditionData};n.Common.forguncyPost("Home/GetTotalRowValues",u,function(n){i&&i.apply(null,[n])},r+" GetTotalRowValues")};t.GetRowCount=function(t,i,r){n.Common.forguncyPost("Home/GetRowCount",t,function(n){i&&i.apply(null,[n])},r)};t.CalcParamValue=function(t,i,r){n.Common.forguncyPost("Home/CalcParamValue",t,function(n){i&&i.apply(null,[n])},null,function(){r&&r.apply(null)})};t.GetRowsDataForColumnFilter=function(t,i,r){var u={bindingInfos:t.columnBindingInfos,currentRowInfo:t.rowInfo,queryCommandInfo:t.queryData,sortCommandID:t.sortCommandID,orderByInfo:t.sortInfo,offsetConditionInfo:t.offsetCondition,columnFilterQueries:t.columnFilterQueries,pageName:t.pageName,runtimeQueryConditionData:t.runtimeQueryConditionData};n.Common.forguncyPost("Home/GetRowsDataForColumnFilter",u,function(n){i&&i.apply(null,[n])},r+" GetRowsDataForColumnFilter")};t.GetTableDataByColumnBindingInfo=function(t,i,r,u){u===void 0&&(u=!0);var f="Home/GetTableDataByColumnBindingInfos",e=function(n){i&&i.apply(null,[n])};u?n.Common.forguncyPost(f,t,e,r+" GetTableDataByColumnBindingInfos"):n.Common.forguncyPostSync(f,t,e)};t.GetTableRowData=function(t,i){var r={bindingInfos:t.columnBindingInfos,query:t.query,currentTableName:t.table};n.Common.forguncyPost("Home/GetTableRowData",r,function(n){i&&i.apply(null,[n])},"GetTableRowData "+t.table)};t.SetUserSelectorItemsInfo=function(t,i){var r=t.CellType,u={role:typeof r.Role=="undefined"?"":r.Role,displayColumnName:r.DisplayColumnName===undefined?"":r.DisplayColumnName,columns:r.Columns,customColumns:r.CustomColumns===undefined?"":r.CustomColumns.join(","),id:t.ServerPropertiesId.OwnerPage};n.Common.forguncyPost("Account/GetUsers",u,function(t){var o,f,e,u,i;if(r.ItemsInfo=t||{Items:[]},r.haveLoadItems=!0,r.UserInfo=[],t===null||t===void 0?void 0:t.Properties)for(o=t.Properties.users,f=JSON.parse(t.Properties.columns),e=0;e<o.length;e++){u=o[e];i=null;switch(r.DisplayColumnName){case"Name":i=u.UserName;break;case"FullName":i=u.FullName;break;case"Email":i=u.Email;break;default:i=n.UserInfoHelper.getUserPropertyValue(u,r.DisplayColumnName)}n.Common.IsEmpty(i)&&n.Common.IsEmpty(r.DisplayColumnName)&&(f.Name?i=u.UserName:f.FullName?i=u.FullName:f.Email?i=u.Email:r.CustomColumns&&r.CustomColumns.length>0&&(i=n.UserInfoHelper.getUserPropertyValue(u,r.CustomColumns[0])));r.UserInfo.push({Value:u.UserName,DisplayValue:i})}},"GetUsers "+i)};t.CommitEditedTable=function(t,i,r){var u={editedTableInfo:t.tableInfo,listviewName:t.viewName,masterQuery:t.masterQuery};n.Common.forguncyPost("Home/CommitEditedTable",u,function(n){i&&i.apply(null,[n])},null,r)};t.GetAutoGeneratedIDsOfPage=function(t,i){var r={pageName:t};n.Common.forguncyPost("Home/GetAutoGeneratedIDsOfPage",r,function(n){i&&i(n)},null,function(){i&&i(null)})};t.RefreshToken=function(){var i,r,u;if(!((i=n.PageBuilder)===null||i===void 0?void 0:i.pageTotallyLoaded)){setTimeout(function(){t.RefreshToken()},1e3);return}r=6e4;n.ForguncyData.SessionKeepTime<=5&&(r=2e4);u=setInterval(function(){var i,r,f;for(i in n.BuiltInPageManager.builtInPages)if(n.BuiltInPageManager.builtInPages[i]===n.ForguncyData.pageInfo.pageName)return;if(n.ForguncyData.AutoDisconnectTimeout&&(r=n.ForguncyData.AutoDisconnectTimeout,(new Date).valueOf()-t.lastOperateTime.valueOf()>r*6e4)){if(n.ForguncyData.EnableSession){f=new n.UserManagerCommand;f.Logout({NavigateWhenLogoutMode:n.NavigateWhenLogoutMode.None},function(){t.NavigateToDisconnectedPage(u)},!0);return}t.NavigateToDisconnectedPage(u)}n.Common.forguncyPost("Refresh/B0DA262E-08A7-48FE-B478-BDE2B817B902",null,function(){})},r)};t.NavigateToDisconnectedPage=function(t){clearInterval(t);n.PageBuilder.loadPage(n.BuiltInPageManager.builtInPages[n.BuiltInPageType.Disconnected])};t.registerPostOperateEvent=function(n){t._postOperateCallback.push(n)};t.unregisterPostOperateEvent=function(n){t._postOperateCallback=t._postOperateCallback.filter(function(t){return t!==n})};t.Operate=function(){var n;if(!t.IsTopForguncy){(n=window.parent.Forguncy)===null||n===void 0?void 0:n.HomeController.Operate();return}t.lastOperateTime=new Date;t._postOperateCallback.forEach(function(n){return n()})};t.GetQueryInfo=function(t,i,r){var u={tableName:t,queryDic:i};n.Common.forguncyPost("Home/GetQueryInfo",u,function(n){r&&r.apply(null,[n])},"GetQueryInfo"+t)};t.GetQueryInfoByCondition=function(t,i){var r={queryCondition:t};n.Common.forguncyPost("Home/GetQueryInfoByCondition",r,function(n){i&&i.apply(null,[n])},"GetQueryInfoByCondition"+t.Id)};var i;return i=t,t._postOperateCallback=[],t.lastOperateTime=new Date,t._inIframe=self.frameElement&&self.frameElement.tagName=="IFRAME",t.IsTopForguncy=function(){if(!i._inIframe)return!0;try{return window.parent.Forguncy===null}catch(n){return!0}}(),t}();n.HomeController=t;t.IsTopForguncy&&n.HomeController.RefreshToken();window.addEventListener("mousedown",function(){t.Operate()},!0);window.addEventListener("keydown",function(){t.Operate()},!0);window.addEventListener("touchstart",function(){t.Operate()},!0);window.addEventListener("scroll",function(){t.Operate()},!0)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__spreadArray=this&&this.__spreadArray||function(n,t,i){if(i||arguments.length===2)for(var r=0,f=t.length,u;r<f;r++)!u&&r in t||(u||(u=Array.prototype.slice.call(t,0,r)),u[r]=t[r]);return n.concat(u||Array.prototype.slice.call(t))},Forguncy;(function(n){var t;(function(t){var f=function(){function t(){this.events=new n.EventClassBase}return t.prototype.on=function(n,t){return this.events.bind(n,t),this},t.prototype.off=function(n,t){return this.events.unbind(n,t),this},t.prototype.dispatch=function(n){for(var i,r=[],t=1;t<arguments.length;t++)r[t-1]=arguments[t];return(i=this.events).trigger.apply(i,__spreadArray([n],r,!1)),this},t.prototype.dispose=function(){this.events.unbindAll()},t}(),i,r,u,e,o;t.EventDispatcher=f;i=function(n){function t(){var t=n.call(this)||this;return t.enabled=!0,t.visibility=!0,t.focusable=!1,t.isFocus=!1,t.classNames="",t.properties=[],t.attrs={},t.css={},t.registDefaultProperties(),t}return __extends(t,n),t.prototype.registDefaultProperties=function(){this.registProperty("id");this.registProperty("enabled");this.registProperty("visibility");this.registProperty("focusable");this.registProperty("isFocus");this.registProperty("classNames");this.registProperty("attrs");this.registProperty("css")},t.prototype.refresh=function(){return this.dispatch("Refresh"),this},t.prototype.identify=function(n){return this.id=n,this},t.prototype.addClass=function(n){return this.classNames+=" "+n,this},t.prototype.addCss=function(n){return this.css=n,this},t.prototype.addAttrs=function(n){return this.attrs=n,this},t.prototype.show=function(){return this.visibility=!0,this},t.prototype.hide=function(){return this.visibility=!1,this},t.prototype.focus=function(){return this.isFocus=!0,this},t.prototype.blur=function(){return this.isFocus=!1,this},t.prototype.enable=function(){return this.enabled=!0,this},t.prototype.disable=function(){return this.enabled=!1,this},t.prototype.dispose=function(){this.dispatch("Dispose");n.prototype.dispose.call(this)},t.prototype.createUI=function(n){return n===void 0&&(n=this.defaultUI),new n(this)},t.prototype.bindProperty=function(n,t,i){var r=this;this.properties.indexOf(i)<0&&this.registProperty(i);n.properties.indexOf(t)<0&&n.registProperty(t);n[t]=this[i];n.on("PropertyChanged",function(u,f){f===t&&n&&(r[i]=n[t])});this.on("PropertyChanged",function(u,f){f===i&&n&&(n[t]=r[i])})},t.prototype.registProperty=function(n,t){var u,i,r;t===void 0&&(t=this[n]);i=this;r="_"+n.toString();this[r]=t;Object.defineProperties(this,(u={},u[n]={get:function(){return i[r]},set:function(t){if(t!==i[r]){i[r]=t;i.onPropertyChanged(n)}}},u));this.properties.push(n)},t.prototype.onPropertyChanged=function(n){this.dispatch("PropertyChanged",n)},t}(f);t.UserControl=i;r=function(){function n(n){this.target=n;this.bindTargetEvents();this.createContainer();this.createContainerEvents();this.createModifiers();this.invokeModifyContainer();this.refresh()}return n.prototype.refresh=function(){return this.disposeChildren(),this.container.empty(),this.createChildren(),this},n.prototype.dispose=function(){this.disposeChildren();this.disposeModifiers();this.container.remove()},n.prototype.applyModifier=function(n){return this.modifiers||(this.modifiers=[]),this.modifiers.push(n),n.modifyContainer(),n.modifyProperties(),this},n.prototype.bindTargetEvents=function(){},n.prototype.createContainer=function(){this.container=$(document.createElement("div"))},n.prototype.createContainerEvents=function(){},n.prototype.createModifiers=function(){},n.prototype.invokeModifyContainer=function(){this.modifiers&&this.modifiers.forEach(function(n){n.modifyContainer()})},n.prototype.disposeModifiers=function(){var n;(n=this.modifiers)===null||n===void 0?void 0:n.forEach(function(n){n===null||n===void 0?void 0:n.dispose()})},n.prototype.createChildren=function(){},n.prototype.disposeChildren=function(){var n;(n=this.childrenUI)===null||n===void 0?void 0:n.forEach(function(n){n===null||n===void 0?void 0:n.dispose()});this.childrenUI=[]},n.prototype.addChild=function(n,t){return t===void 0&&(t=this.container),n&&t&&(this.childrenUI.push(n),t.append(n.container)),n},n}();t.JQueryUIBase=r;u=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),Object.defineProperty(i.prototype,"id",{set:function(t){n.Common.IsEmpty(t)?this.container.removeAttr("id"):this.container.attr("id",t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"enabled",{set:function(n){this.setEnabledProperty(n)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"visibility",{set:function(n){n?this.container.show():this.container.hide()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"focusable",{set:function(n){n&&this.target.enabled?this.focusableContainer.attr("tabindex","0"):this.focusableContainer.removeAttr("tabindex")},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isFocus",{set:function(n){n&&this.target.focusable?this.focusableContainer[0].focus():this.focusableContainer[0].blur()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"focusableContainer",{get:function(){return this.container},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"classNames",{set:function(n){this.container.addClass(n)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"css",{set:function(n){for(var t in n)this.container.css(t,n[t])},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"attrs",{set:function(n){for(var t in n)this.container.attr(t,n[t])},enumerable:!1,configurable:!0}),i.prototype.refresh=function(){return t.prototype.refresh.call(this),this.initializeProperties(),this.invokeModifyProperties(),this.bindFocusAndBlurEvent(),this},i.prototype.bindTargetEvents=function(){var n=this;this.target.on("Refresh",function(){n.refresh()});this.target.on("PropertyChanged",function(t,i){n[i]=n.target[i]});this.target.on("Dispose",function(){n.dispose()})},i.prototype.initializeProperties=function(){var n=this;this.target.properties.forEach(function(t){n[t]=n.target[t]})},i.prototype.invokeModifyProperties=function(){this.modifiers&&this.modifiers.forEach(function(n){n.modifyProperties()})},i.prototype.bindFocusAndBlurEvent=function(){var n=this;this.focusableContainer.on("focus",function(){n.target.focus();n.container.toggleClass("FUI-focus",!0)});this.focusableContainer.on("blur",function(){n.target.blur();n.container.toggleClass("FUI-focus",!1)})},i.prototype.setEnabledProperty=function(n,t){t===void 0&&(t=this.container);n?(t.removeClass("FUI-disable"),t.removeAttr("disabled"),this.focusable=this.target.focusable):(t.addClass("FUI-disable"),t.attr("disabled","disabled"),this.focusable=!1)},i}(r);t.ControlUIBase=u;e=function(n){function t(){var t=n.call(this)||this;return t.moveable=!1,t.registProperty("location"),t.registProperty("moveable"),t}return __extends(t,n),t.prototype.updateSizeFromUI=function(){this.dispatch("UpdateSizeFromUI")},t}(i);t.MoveableControl=e;o=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),Object.defineProperty(i.prototype,"location",{set:function(n){n&&this.container.offset({left:n.x,top:n.y})},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"moveableContainer",{get:function(){return this.container},enumerable:!1,configurable:!0}),i.prototype.createContainerEvents=function(){t.prototype.createContainerEvents.call(this);this.bindUpdateSizeEvent()},i.prototype.bindUpdateSizeEvent=function(){var n=this;this.target.on("UpdateSizeFromUI",function(){n.onUpdateSizeEvent()})},i.prototype.onUpdateSizeEvent=function(t){t===void 0&&(t=this.container);this.target.sizeFromUI=new n.Numerics.Vector2(t.width(),t.height())},i}(u);t.MoveableControlUI=o})(t=n.UI||(n.UI={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t;(function(t){var i=function(){function n(n){this.ui=n}return n.prototype.modifyContainer=function(){},n.prototype.modifyProperties=function(){},n.prototype.dispose=function(){},n}(),r,u,f;t.UIModifier=i;r=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.modifyContainer=function(){this._enforceFocusToPopupContainer()},i.prototype._enforceFocusToPopupContainer=function(){$(document).off("focusin #".concat(this.ui.target.id),"",i._documentFocusinHandler);$(document).on("focusin #".concat(this.ui.target.id),"",this.ui,i._documentFocusinHandler)},i._documentFocusinHandler=function(t){var s=t.data,f=document.activeElement,r=$(f),e,u,o;if(r.attr("imcontroltype")!=="Calendar"&&r.attr("ignoreFocusInPopup")!=="true"&&!(r.closest('[ignoreFocusInPopup="true"]').length>0)&&r.attr("FGCPopup")!=="true"&&!(r.closest('[FGCPopup="true"]').length>0)&&!(r.parents(".".concat("FUI-contextmenu")).length>0)&&!(r.parents("#".concat("fgc-rowheader-contextmenu")).length>0)&&r.parents("#pagesContainer").length!==0){if(e=$(".".concat("FUI-dialog",".").concat("FUI-show")).not(":hidden"),e.length===0){$(document).off("focusin #".concat(s.target.id),i._documentFocusinHandler);return}(u=e.last(),u.find(".FUI-dialog-content").length!==0)&&(u[0]===f||u.has(f).length||(o=r.attr("gcuielement"),o==="gcSheetFocusElementForTab"||o==="gcEditingInput"?n.DelayRefresh.setTimeout(function(){i.lostAllListviewsFocus();i.moveFocusToFirstElement(u[0])}):i.moveFocusToFirstElement(u[0])))}},i.lostAllListviewsFocus=function(){var t=n.ListviewBase.getAllListviews();t.forEach(function(n){n.focus(!1)})},i.moveFocusToFirstElement=function(t){var i=n.FocusMoveHelper.MoveFocusToFirstElement();i||t.focus()},i}(i);t.DialogFocusModifier=r;u=function(){function t(n){this.placement=n}return Object.defineProperty(t.prototype,"location",{get:function(){var t=this.placement.offset();return new n.Numerics.Vector2(t.left,t.top)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){var t=this.placement.outerWidth(),i=this.placement.outerHeight();return new n.Numerics.Vector2(t,i)},enumerable:!1,configurable:!0}),t}();t.Anchor=u;f=function(t){function i(n,i){var r=t.call(this,n)||this;r.anchor=i;n.target.on("Dispose",function(){r.releaseResizeEvent()});return r}return __extends(i,t),i.prototype.modifyProperties=function(){this.releaseResizeEvent();this.bindResizeEvent();this.adjustLocation()},i.prototype.dispose=function(){this.releaseResizeEvent();this.removeListviewAnchor()},i.prototype.removeListviewAnchor=function(){var t,r,u,n=(r=(t=this.anchor)===null||t===void 0?void 0:t.placement)===null||r===void 0?void 0:r[0];n&&n.classList.contains(i.ListviewPopupTempAnchor)&&((u=n.parentElement)===null||u===void 0?void 0:u.removeChild(n))},i.prototype.bindResizeEvent=function(){var n=this;this.resizeHandler=function(){window.requestAnimationFrame(function(){return n.adjustLocation()})};$(window).on("resize",this.resizeHandler);this.visibilityChangedHandler=function(t,i){i==="visibility"&&n.ui.target.visibility&&n.resizeHandler()};this.ui.target.on("PropertyChanged",this.visibilityChangedHandler)},i.prototype.releaseResizeEvent=function(){this.resizeHandler&&$(window).off("resize",this.resizeHandler);this.visibilityChangedHandler&&this.ui.target.off("PropertyChanged",this.visibilityChangedHandler)},i.prototype.adjustLocation=function(){var s=this.anchor.location,r=s.x,u=s.y,h=this.anchor.size,y=h.x,f=h.y,e=this.ui.moveableContainer.width(),o=this.ui.moveableContainer.height(),t;if(e!==0||o!==0){var c=$(document).scrollLeft(),l=$(document).scrollTop(),a=c+$(window).innerWidth(),v=l+$(window).innerHeight(),i=r;r+e>a&&(i=r+y-e);(i<c||i>a)&&(i=r);t=u+f;u+f+o>v&&(t=u-o);(t<l||t>v)&&(t=u+f);this.ui.target.location=new n.Numerics.Vector2(i,t)}},i.ListviewPopupTempAnchor="fgc-listview-popup-temp-anchor",i}(i);t.AutoLocateModifier=f})(t=n.UI||(n.UI={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t;(function(n){var r,t,i,f,e,u;n.FlexDirectionCSSNames=(r={},r[0]="FUI-flex-direction-row",r[1]="FUI-flex-direction-column",r[2]="FUI-flex-direction-row-reverse",r[3]="FUI-flex-direction-column-reverse",r);n.FlexAlignItemsCSSNames=(t={},t[0]="FUI-flex-align-items-flex-start",t[1]="FUI-flex-align-items-flex-end",t[2]="FUI-flex-align-items-center",t[3]="FUI-flex-align-items-baseline",t[4]="FUI-flex-align-items-stretch",t);n.FlexJustifyContentCSSNames=(i={},i[0]="FUI-flex-justify-content-flex-start",i[1]="FUI-flex-justify-content-flex-end",i[2]="FUI-flex-justify-content-center",i[3]="FUI-flex-justify-content-space-between",i[4]="FUI-flex-justify-content-space-around",i);f=function(){function n(){}return n}();n.FlexLayoutOption=f;e=function(n){function t(t,i){var r;t===void 0&&(t=0);i===void 0&&(i={});r=n.call(this)||this;r.items=[];r.defaultUI=u;var f=Object.assign({wrap:!1,isInline:!1},i),e=f.alignItems,o=f.wrap,s=f.isInline,h=f.justifyContent;return r.registProperty("items"),r.registProperty("layout",t),r.registProperty("wrap",o),r.registProperty("isInline",s),r.registProperty("alignItems",e),r.registProperty("justifyContent",h),r}return __extends(t,n),t.prototype.add=function(){for(var t,i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];(t=this.items).push.apply(t,i);this.onPropertyChanged("items");return this},t.prototype.insert=function(n,t){this.items.splice(n,0,t);this.onPropertyChanged("items");return this},t.prototype.remove=function(n){this.items.splice(this.items.indexOf(n),1);this.onPropertyChanged("items");return this},t.prototype.clear=function(){this.items=[];this.onPropertyChanged("items");return this},t}(n.UserControl);n.FlexLayout=e;u=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),Object.defineProperty(i.prototype,"items",{set:function(){this.refreshChildren()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"layout",{set:function(t){for(var i in n.FlexDirectionCSSNames)this.container.removeClass(n.FlexDirectionCSSNames[i]);this.container.addClass(n.FlexDirectionCSSNames[t])},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"wrap",{set:function(n){n?this.container.css("flex-wrap","wrap"):this.container.css("flex-wrap","nowrap")},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isInline",{set:function(n){n?this.container.addClass("FUI-inline-flex-layout"):this.container.removeClass("FUI-inline-flex-layout")},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"alignItems",{set:function(t){for(var i in n.FlexAlignItemsCSSNames)this.container.removeClass(n.FlexAlignItemsCSSNames[i]);t&&n.FlexAlignItemsCSSNames[t]&&this.container.addClass(n.FlexAlignItemsCSSNames[t])},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"justifyContent",{set:function(t){for(var i in n.FlexJustifyContentCSSNames)this.container.removeClass(n.FlexJustifyContentCSSNames[i]);t&&n.FlexJustifyContentCSSNames[t]&&this.container.addClass(n.FlexJustifyContentCSSNames[t])},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"cssName",{get:function(){return""},enumerable:!1,configurable:!0}),i.prototype.createContainer=function(){this.container=$('<div class="'.concat("FUI-flexlayout"," ").concat(this.cssName,'"><\/div>'))},i.prototype.createChildren=function(){},i.prototype.refreshChildren=function(){var n=this;this.container.empty();this.target.items&&this.target.items.forEach(function(t){n.addChild(t.createUI())})},i}(n.ControlUIBase);n.FlexLayoutUI=u})(t=n.UI||(n.UI={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t;(function(n){var r=function(n){function i(i,r,u){i===void 0&&(i="");r===void 0&&(r="");u===void 0&&(u="");var f=n.call(this)||this;return f.classNames="".concat("FUI-button"," ").concat("FUI-button-default"),f.focusable=!0,f.defaultUI=t,f.registProperty("text",i),f.registProperty("svg",r),f.registProperty("tooltip",u),f}return __extends(i,n),i.prototype.click=function(){this.dispatch("Clicked")},i}(n.UserControl),t,u,i;n.Button=r;t=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),Object.defineProperty(t.prototype,"text",{set:function(n){this.textContainer.text(n)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"svg",{set:function(n){this.svgContainer.empty();this.svgContainer.append($(n))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tooltip",{set:function(n){this.container.attr("title",n)},enumerable:!1,configurable:!0}),t.prototype.createContainer=function(){this.container=$(document.createElement("div"))},t.prototype.createChildren=function(){this.svgContainer=$(document.createElement("span")).addClass("FUI-button-svg");this.textContainer=$(document.createElement("span")).addClass("FUI-button-text");this.container.append(this.svgContainer,this.textContainer)},t.prototype.createContainerEvents=function(){var t=this;n.prototype.createContainerEvents.call(this);this.container.on("mousedown",function(n){n.stopPropagation()});this.container.on("mouseup",function(n){n.stopPropagation()});this.container.on("click",function(n){n.stopPropagation();t.target.click()});this.container.on("keypress",function(n){(n.keyCode===13||n.keyCode===32)&&(n.preventDefault(),n.stopPropagation(),t.target.click())})},t}(n.ControlUIBase);n.ButtonUI=t;u=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.defaultUI=i,t}return __extends(t,n),t.prototype.click=function(){n.prototype.click.call(this);this.isChecked=!this.isChecked},t}(r);n.ToggleButton=u;i=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),Object.defineProperty(t.prototype,"isChecked",{set:function(n){this.container.toggleClass("FUI-checked",n)},enumerable:!1,configurable:!0}),t}(t);n.ToggleButtonUI=i})(t=n.UI||(n.UI={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t;(function(n){var i=function(n){function i(){var i=n!==null&&n.apply(this,arguments)||this;return i.defaultUI=t,i}return __extends(i,n),i}(n.FlexLayout),t;n.ButtonGroup=i;t=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),Object.defineProperty(t.prototype,"cssName",{get:function(){return"FUI-button-group"},enumerable:!1,configurable:!0}),t}(n.FlexLayoutUI);n.ButtonGroupUI=t})(t=n.UI||(n.UI={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t;(function(n){var i=function(n){function i(i,r){var u=n.call(this)||this;return u.isChecked=!1,u.focusable=!0,u.defaultUI=t,u.registProperty("text",i),u.registProperty("name",r),u.registProperty("isChecked"),u}return __extends(i,n),i}(n.UserControl),t;n.Toggle=i;t=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),Object.defineProperty(t.prototype,"text",{set:function(n){this.textContainer.text(n)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{set:function(n){n!==undefined&&this.inputContainer.attr("name",n)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isChecked",{set:function(n){this.inputContainer[0].checked=n;this.container.toggleClass("FUI-checked",n)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"focusableContainer",{get:function(){return this.inputContainer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cssName",{get:function(){return""},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return""},enumerable:!1,configurable:!0}),t.prototype.createContainer=function(){this.container=$(document.createElement("label")).addClass("FUI-toggle").addClass(this.cssName)},t.prototype.createChildren=function(){this.createInnerContainer();this.createTextContainer();this.container.append(this.innerContainer,this.textContainer)},t.prototype.createInnerContainer=function(){var n=this;this.innerContainer=$(document.createElement("label")).addClass("FUI-toggle-inner");this.inputContainer=$(document.createElement("input")).addClass("FUI-toggle-input").attr("type",this.type).on("change",function(){n.target.isChecked=n.inputContainer[0].checked});this.innerContainer.append(this.inputContainer)},t.prototype.createTextContainer=function(){this.textContainer=$(document.createElement("span")).addClass("FUI-toggle-text").text(this.target.text)},t.prototype.setEnabledProperty=function(t){n.prototype.setEnabledProperty.call(this,t);t?this.inputContainer.removeAttr("disabled"):this.inputContainer.attr("disabled","disabled")},t}(n.ControlUIBase);n.ToggleUI=t})(t=n.UI||(n.UI={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t;(function(n){var i=function(n){function i(){var i=n!==null&&n.apply(this,arguments)||this;return i.defaultUI=t,i}return __extends(i,n),i}(n.Toggle),t;n.Radio=i;t=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),Object.defineProperty(t.prototype,"cssName",{get:function(){return"FUI-radio"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return"radio"},enumerable:!1,configurable:!0}),t.prototype.createInnerContainer=function(){var t=this;n.prototype.createInnerContainer.call(this);this.inputContainer.on("change",function(){t.target.isChecked&&($("input[name=".concat(t.inputContainer.attr("name"),"]")).not(t.inputContainer).trigger("change"),t.target.dispatch("Checked"))})},t}(n.ToggleUI);n.RadioUI=t})(t=n.UI||(n.UI={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t;(function(n){var i=function(n){function i(){var i=n!==null&&n.apply(this,arguments)||this;return i.defaultUI=t,i}return __extends(i,n),i}(n.FlexLayout),t;n.RadioGroup=i;t=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),Object.defineProperty(t.prototype,"cssName",{get:function(){return"FUI-radio-group"},enumerable:!1,configurable:!0}),t}(n.FlexLayoutUI);n.RadioGroupUI=t})(t=n.UI||(n.UI={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__awaiter=this&&this.__awaiter||function(n,t,i,r){function u(n){return n instanceof i?n:new i(function(t){t(n)})}return new(i||(i=Promise))(function(i,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?i(n.value):u(n.value).then(o,s)}e((r=r.apply(n,t||[])).next())})},__generator=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=e[0]&2?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[e[0]&2,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i,e;return e={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e},Forguncy;(function(n){var t;(function(t){var f=function(){function n(){}return n}(),r,u,i;t.SignaturePadProps=f;r=function(){function n(){}return n.clockwise=function(n){return new Promise(function(t){var i=new Image;i.onload=function(){var n=document.createElement("canvas"),u=n.getContext("2d"),e=i.width,f=i.height,r=Math.max(e,f),o,s;n.width=r*2;n.height=r*2;u.translate(r,r);u.rotate(Math.PI/2);u.drawImage(i,0,0);o={x:r-f,y:r};s=u.getImageData(o.x,o.y,f,e);n.width=f;n.height=e;u.putImageData(s,0,0);t(n.toDataURL("image/png"))};i.src=n})},n.anti_clockwise=function(n){return new Promise(function(t){var i=new Image;i.onload=function(){var n=document.createElement("canvas"),u=n.getContext("2d"),f=i.width,e=i.height,r=Math.max(f,e),o,s;n.width=r*2;n.height=r*2;u.translate(r,r);u.rotate(-Math.PI/2);u.drawImage(i,0,0);o={x:r,y:r-f};s=u.getImageData(o.x,o.y,e,f);n.width=e;n.height=f;u.putImageData(s,0,0);t(n.toDataURL("image/png"))};i.src=n})},n.loadDataURL=function(n,t){return new Promise(function(i,r){var u=new Image;u.onerror=function(n){r(n)};u.crossOrigin="anonymous";u.onload=function(){n.drawImage(u,0,0);i(t)};u.src=t})},n.screenIsPortrait=function(){var n=$("body").width(),t=$("body").height();return n<=t},n.canvasIsPortrait=function(n){var t=n.width,i=n.height;return t<=i},n}();t.SignaturePadControlHelper=r;u=function(n){function t(t){var r;t===void 0&&(t={});r=n.call(this)||this;r.defaultUI=i;r.result="";r.isEmpty=!0;var u=t.ratioOfWidthToHeight,s=u===void 0?2:u,f=t.initValue,h=f===void 0?"":f,e=t.canDraw,c=e===void 0?!0:e,o=t.width,l=o===void 0?-1:o;return r.ratioOfWidthToHeight=s,r.initValue=h,r.canDraw=c,r.width=l,r}return __extends(t,n),t.prototype.update=function(n){this.dispatch("update",n)},t.prototype.clear=function(){this.dispatch("clear")},t.prototype.getValue=function(){return this.result},t}(t.UserControl);t.SignaturePadControl=u;i=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.createContainer=function(){this.container=$('<div class="'.concat("FUI-signature-pad-container",'"><\/div>'))},i.prototype.createChildren=function(){var t=this;this.canvas=$("<canvas><\/canvas>");this.container.append(this.canvas);window.requestAnimationFrame(function(){n.ModuleLoader.IsModuleLoaded(["signaturePad"])?t.initSignaturePadAsync():n.ModuleLoader.LoadModels(["signaturePad"],n.ForguncyData.ForguncyRoot).done(function(){t.initSignaturePadAsync()})})},i.prototype.initSignaturePadAsync=function(){return __awaiter(this,void 0,void 0,function(){var i,t=this;return __generator(this,function(r){switch(r.label){case 0:return(this.resizeCanvas(),this.signaturePad=new SignaturePad(this.canvas[0],{throttle:16}),this.signaturePad.clear(),!!n.Common.IsEmpty(this.target.initValue))?[3,3]:[4,this.getFormatInitValueAsync()];case 1:return i=r.sent(),[4,this.signaturePad.fromDataURL(i,{ratio:1})];case 2:return r.sent(),this.updateResult(),[3,4];case 3:this.updateResult();r.label=4;case 4:return this.signaturePad.addEventListener("afterUpdateStroke",function(){t.debounceTimer&&(n.DelayRefresh.clearTimeout(t.debounceTimer),t.debounceTimer=null);t.debounceTimer=n.DelayRefresh.setTimeout(function(){t.updateResult()},10)}),this.target.canDraw||this.signaturePad.off(),[2]}})})},i.prototype.getFormatInitValueAsync=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return[2,this.target.initValue]})})},i.prototype.resizeCanvas=function(){var n;if(this.canvas){var t=this.canvas[0],i=parseInt(this.canvas.css("border-left-width")),r=parseInt(this.canvas.css("border-right-width")),f=(isNaN(i)?0:i)+(isNaN(r)?0:r),u=this.target.width>-1?this.target.width:this.canvas.parent().width()-f,e=this.target.ratioOfWidthToHeight;t.width=u;t.height=u/e;(n=this.signaturePad)===null||n===void 0?void 0:n.clear()}},i.prototype.createContainerEvents=function(){var t=this;this.target.on("update",function(i,r){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.signaturePad?(this.signaturePad.clear(),!!n.Common.IsEmpty(r))?[3,2]:[4,this.signaturePad.fromDataURL(r,{ratio:1})]:[2];case 1:t.sent();t.label=2;case 2:return this.updateResult(),this.target.dispatch("updated",this.target.result),[2]}})})});this.target.on("clear",function(){t.signaturePad&&(t.signaturePad.clear(),t.updateResult())})},i.prototype.updateResult=function(){this.target.isEmpty=this.signaturePad.isEmpty();this.target.result=this.target.isEmpty?"":this.signaturePad.toDataURL("image/png")},i}(t.ControlUIBase);t.SignaturePadControlUI=i})(t=n.UI||(n.UI={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__awaiter=this&&this.__awaiter||function(n,t,i,r){function u(n){return n instanceof i?n:new i(function(t){t(n)})}return new(i||(i=Promise))(function(i,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?i(n.value):u(n.value).then(o,s)}e((r=r.apply(n,t||[])).next())})},__generator=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=e[0]&2?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[e[0]&2,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i,e;return e={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e},__spreadArray=this&&this.__spreadArray||function(n,t,i){if(i||arguments.length===2)for(var r=0,f=t.length,u;r<f;r++)!u&&r in t||(u||(u=Array.prototype.slice.call(t,0,r)),u[r]=t[r]);return n.concat(u||Array.prototype.slice.call(t))},Forguncy;(function(n){var t;(function(t){var r=function(t){function r(r){var u=t.call(this)||this;u.actionColumns=[];u.selectedKeys=new Set;u.defaultUI=i;u.loadUserStep=25;u.loadUserTick=0;u.loadScrollDistance=50;var e=r.columns,y=e===void 0?[]:e,o=r.dataSource,p=o===void 0?[]:o,s=r.selectedKeys,w=s===void 0?[]:s,h=r.isMultiSelect,c=h===void 0?!1:h,l=r.isNeedIndex,b=l===void 0?!1:l,a=r.isNeedHeader,k=a===void 0?!0:a,f=[],v=[];return y.forEach(function(n){var t=n.type;if(!t){f.push(Object.assign({type:"Data"},n));return}switch(t){case"Action":v.push(n);break;default:f.push(n)}}),u.columns=f,u.actionColumns=v,u.dataSource=__spreadArray([],p,!0),u.canLoadDataSource=__spreadArray([],u.dataSource,!0),u.selectedKeys=new Set(w),u.isMultiSelect=c,u.isNeedIndex=b,u.isNeedHeader=k,u.isNeedCheckCol=n.Common.IsEmpty(r.isNeedCheckCol)?c:r.isNeedCheckCol,u}return __extends(r,t),Object.defineProperty(r.prototype,"isSingleSelect",{get:function(){return!this.isMultiSelect},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"hasActionButton",{get:function(){return this.actionColumns.length>0},enumerable:!1,configurable:!0}),r.prototype.select=function(n){this.selectedKeys.has(n)||this.dispatch("InnerSelectItem",n)},r.prototype.selectAll=function(n){var t=this;n.every(function(n){return t.selectedKeys.has(n)})||this.dispatch("InnerSelectAllItems",n)},r.prototype.unselect=function(n){this.selectedKeys.has(n)&&this.dispatch("InnerUnselectetem",n)},r.prototype.unselectAll=function(n){this.selectedKeys.size!==0&&this.dispatch("InnerUnselectAllItems",n)},r.prototype.filter=function(n){this.dispatch("InnerFilter",n)},r}(t.UserControl),i;t.Table=r;i=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.createContainer=function(){this.container=$('<div class="'.concat("FUI-table",'"><\/div>'))},i.prototype.getLayoutTemplate=function(){var i=this,t=this.target,s=t.isMultiSelect,r=t.isNeedCheckCol,u=t.isNeedIndex,h=t.isNeedHeader,f=t.columns,e=t.hasActionButton,o="\n            <colgroup>\n                ".concat(u?'<col style="width: 50px"><\/col>':"","\n                ").concat(r?'<col style="width: 50px"><\/col>':"","\n                ").concat(f.map(function(n){switch(n.type){case"Data":return i._getLayoutColgroupBaseTemplate(n);case"Custom":return i.getLayoutColgroupCustomTemplate(n);default:return""}}).join(""),"\n                ").concat(e?"<col><\/col>":"","\n             <\/colgroup>"),c=h?"<table automationid='".concat("table_header","'>\n                    ").concat(o,"\n                    <thead>\n                        <tr>\n                            ").concat(u?'<th data-key="index"><\/th>':"","\n                            ").concat(r?'<th data-key="isChecked">'.concat(s?'<input type="checkbox" name="isAllCheck"} />':"","<\/th>"):"","\n                            ").concat(f.map(function(n){switch(n.type){case"Data":return i._getLayoutHeaderBaseTemplate(n);case"Custom":return i.getLayoutHeaderCustomTemplate(n);default:return""}}).join(""),"\n                            ").concat(e?'<th data-key="actions">'.concat(n.RS.UI_Table_ActionColumn,"<\/th>"):"","\n                        <\/tr>\n                    <\/thead>\n                <\/table>"):"",l='<div class="'.concat("FUI-table-body-wrapper","\">\n                    <table automationid='").concat("table_body","'>\n                        ").concat(o,"\n                        <tbody><\/tbody>\n                    <\/table>\n                <\/div>");return"".concat(c,"\n                  ").concat(l)},i.prototype.getChildrenRows=function(n){var i=this,t=this.target,r=t.isMultiSelect,u=t.isNeedCheckCol,f=t.isNeedIndex,e=t.columns,o=t.hasActionButton,s=t.actionColumns,h=this.target.loadUserStep*this.target.loadUserTick;return n.map(function(n,t){var c=$('\n                    <tr data-key="'.concat(n.key,'">\n                        ').concat(f?'<td data-key="index">'.concat(h+t+1,"<\/td>"):"","\n                        ").concat(u?'<td data-key="isChecked"><input type="'.concat(r?"checkbox":"radio",'" name="isCheck" /><\/td>'):"","\n                        ").concat(e.map(function(n){switch(n.type){case"Data":return i._getDataColumnBaseTemplate(n);case"Custom":return i.getDataColumnCustomTemplate(n);default:return""}}).join(""),"\n                        ").concat(o?"<td class='".concat("FUI-table-action-column","'>").concat(s.map(function(n){var t=n.key,i=n.label;return'<div role="'.concat(t,'">').concat(i,"<\/div>")}).join(""),"<\/td>"):"","\n                    <\/tr>\n                "));return i.setChildrenRowData(c,n),c})},i.prototype._getLayoutColgroupBaseTemplate=function(t){var i=t.width;return n.Common.IsEmpty(i)?"<col><\/col>":'<col style="width: '.concat(i,'">')},i.prototype._getLayoutHeaderBaseTemplate=function(n){var i=n.key,r=n.label,t=n.align,u=t===void 0?"center":t;return'<th data-key="'.concat(i,"\" column-align='").concat(u,"'>").concat(r,"<\/th>")},i.prototype._getDataColumnBaseTemplate=function(n){var i=n.key,t=n.align,r=t===void 0?"center":t;return'<td data-key="'.concat(i,"\" column-align='").concat(r,"'><\/td>")},i.prototype.getLayoutColgroupCustomTemplate=function(n){return this._getLayoutColgroupBaseTemplate(n)},i.prototype.getLayoutHeaderCustomTemplate=function(n){return this._getLayoutHeaderBaseTemplate(n)},i.prototype.getDataColumnCustomTemplate=function(n){return this._getDataColumnBaseTemplate(n)},i.prototype.setChildrenCellData=function(n,t,i){if(Object.prototype.hasOwnProperty.call(t,i)){var r=n.find('[data-key="'.concat(i,'"]')),u=t[i];r.text(u);r.attr("title",u)}},i.prototype.setChildrenRowData=function(n,t){var i=this;this.target.columns.forEach(function(r){var u=r.key;return i.setChildrenCellData(n,t,u)})},i.prototype.createChildren=function(){var t=this;this.container.append($(this.getLayoutTemplate()));this.initData();this.loadMoreContent();this.updateIsAllCheckbox();window.requestAnimationFrame(function(){n.ModuleLoader.IsModuleLoaded(["simpleBar"])?t.addContainerScrollEvent():n.ModuleLoader.LoadModels(["simpleBar"],n.ForguncyData.ForguncyRoot).done(function(){t.addContainerScrollEvent()})})},i.prototype.addContainerScrollEvent=function(){var t=this,i=n.DomUtilities.applySimpleBar(this.container.find(".".concat("FUI-table-body-wrapper")));if(i)i.getScrollElement().addEventListener("scroll",function(n){t.addContainerScrollEventInner(n)});else this.container.find("table[automationid='".concat("table_body","']")).parent().on("scroll",function(n){t.addContainerScrollEventInner(n)})},i.prototype.addContainerScrollEventInner=function(t){var i=this;this.target.loadUserTimer>0&&clearTimeout(this.target.loadUserTimer);this.target.loadUserTimer=setTimeout(function(){n.Common.isShouldLoadMoreContent(t,i.container.height(),i.target.loadScrollDistance)&&i.loadMoreContent()},50)},i.prototype.initData=function(){this.target.loadUserTick=0;this.target.loadUserTimer=0;this.target.canLoadDataSource=__spreadArray([],this.target.dataSource,!0);this.container.find("table[automationid='".concat("table_body","'] tbody")).empty()},i.prototype.loadMoreContent=function(){var r=this,u=this.target.loadUserStep*this.target.loadUserTick,f=this.target.loadUserStep*(1+this.target.loadUserTick),t=this.target.canLoadDataSource.slice(u,f),n,i;t.length!==0&&(n=document.createDocumentFragment(),this.getChildrenRows(t).forEach(function(t){r.handleRowsChanged($(t));n.appendChild(t[0])}),i=this.container.find("table[automationid='".concat("table_body","'] tbody")),i[0].appendChild(n),this.target.loadUserTick++)},i.prototype.createContainerEvents=function(){var t=this;this.container.on("click","table thead tr input[name='isAllCheck']",function(n){var r=n.currentTarget,i=t.target.canLoadDataSource.map(function(n){return n.key}),u=r.checked;u?(t.handleSelectAll(i),t.target.dispatch("SelectedAllItems",i)):(t.handlUnselectAll(i),t.target.dispatch("UnselectedAllItems",i))});this.container.on("click","table tbody tr",function(n){return __awaiter(t,void 0,void 0,function(){var i,t,r,e,u,f;return __generator(this,function(o){switch(o.label){case 0:return(i=n.currentTarget,t=$(i).attr("data-key"),r=$(i).find("input[name='isCheck']"),e=n.target.name==="isCheck"?r.prop("checked"):!r.prop("checked"),e?(this.handleSelect(t),this.target.dispatch("SelectedItem",t)):(this.handlUnselect(t),this.target.dispatch("UnselectedItem",t)),u=$(n.target).attr("role"),f=this.target.dataSource.findIndex(function(n){return n.key===t}),!(u&&f>-1))?[3,2]:[4,this.actionExecute(f,u,$(i),t)];case 1:o.sent();o.label=2;case 2:return[2]}})})});this.target.on("InnerSelectItem",function(n,i){t.handleSelect(i)});this.target.on("InnerSelectAllItems",function(n,i){t.handleSelectAll(i)});this.target.on("InnerUnselectetem",function(n,i){t.handlUnselect(i)});this.target.on("InnerUnselectAllItems",function(n,i){t.handlUnselectAll(i)});this.target.on("InnerFilter",function(i,r){t.initData();t.target.canLoadDataSource=t.target.dataSource.filter(function(t){return Object.keys(t).some(function(i){return n.Common.getLowerCaseString(t[i]).includes(n.Common.getLowerCaseString(r))})});t.loadMoreContent();t.updateIsAllCheckbox()})},i.prototype.handleSelectAll=function(n){var t=this;n.forEach(function(n){t.target.selectedKeys.add(n)});this.container.find("tbody tr").each(function(n,i){t.handleRowsChanged($(i))});this.updateIsAllCheckbox()},i.prototype.handleSelect=function(n){this.target.isSingleSelect&&this.handlUnselectAll(Array.from(this.target.selectedKeys));this.target.selectedKeys.add(n);this.handleRowsChanged(this.container.find("table tbody tr[data-key='".concat(n,"']")));this.updateIsAllCheckbox()},i.prototype.handlUnselectAll=function(n){var t=this;n.forEach(function(n){t.target.selectedKeys.delete(n)});this.container.find("tbody tr").each(function(n,i){t.handleRowsChanged($(i))});this.updateIsAllCheckbox()},i.prototype.handlUnselect=function(n){this.target.selectedKeys.delete(n);this.handleRowsChanged(this.container.find("table tbody tr[data-key='".concat(n,"']")));this.updateIsAllCheckbox()},i.prototype.handleRowsChanged=function(n){var i=n.attr("data-key"),t=n.find("input[name='isCheck']");this.target.selectedKeys.has(i)?(n.addClass("FUI-table-item-selected"),t.prop("checked",!0)):(n.removeClass("FUI-table-item-selected"),t.prop("checked",!1))},i.prototype.updateIsAllCheckbox=function(){if(!this.target.isSingleSelect){var n=this.container.find("tbody tr input[name='isCheck']").toArray(),t=n.length>0&&n.every(function(n){return $(n).prop("checked")});this.container.find("thead tr input[name='isAllCheck']").prop("checked",t)}},i.prototype.actionExecute=function(){},i}(t.ControlUIBase);t.TableUI=i})(t=n.UI||(n.UI={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t;(function(n){var i=function(n){function i(i){var r=n.call(this,i)||this;return r.indeterminate=!1,r.defaultUI=t,r.registProperty("indeterminate"),r}return __extends(i,n),i}(n.Toggle),t;n.CheckBox=i;t=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),Object.defineProperty(t.prototype,"indeterminate",{set:function(n){this.inputContainer[0].indeterminate=n},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cssName",{get:function(){return"FUI-checkbox"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return"checkbox"},enumerable:!1,configurable:!0}),t.prototype.createContainerEvents=function(){var t=this;n.prototype.createContainerEvents.call(this);this.container.on("keydown",function(n){n.keyCode===32&&(n.preventDefault(),n.stopPropagation(),t.target.isChecked=!t.target.isChecked)})},t.prototype.createInnerContainer=function(){var t=this;n.prototype.createInnerContainer.call(this);this.inputContainer.on("change",function(){t.target.indeterminate=t.inputContainer[0].indeterminate})},t}(n.ToggleUI);n.CheckBoxUI=t})(t=n.UI||(n.UI={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t;(function(n){var i=function(n){function i(){var i=n!==null&&n.apply(this,arguments)||this;return i.defaultUI=t,i}return __extends(i,n),i}(n.FlexLayout),t;n.CheckBoxGroup=i;t=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),Object.defineProperty(t.prototype,"cssName",{get:function(){return"FUI-checkbox-group"},enumerable:!1,configurable:!0}),t}(n.FlexLayoutUI);n.CheckBoxGroupUI=t})(t=n.UI||(n.UI={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t;(function(t){var c='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><title>Check menu button<\/title><g fill="#4A9F26" fill-rule="nonzero"><path d="M8 1C4.135 1 1 4.135 1 8s3.135 7 7 7 7-3.135 7-7-3.135-7-7-7zm0 12.833A5.835 5.835 0 0 1 2.167 8 5.82 5.82 0 0 1 8 2.167 5.82 5.82 0 0 1 13.833 8 5.82 5.82 0 0 1 8 13.833z"/><path d="M10.07 6.192L7.11 9.544l-1.203-1.36a.506.506 0 0 0-.757 0c-.2.226-.2.63 0 .856l1.581 1.79c.2.227.557.227.757 0l3.362-3.806c.2-.227.2-.63 0-.857a.513.513 0 0 0-.78.025z"/><\/g><\/svg>',l=function(n){function t(t){t===void 0&&(t=[]);var r=n.call(this)||this;return r.moveable=!0,r.defaultUI=i,r.registProperty("items",t),r}return __extends(t,n),t.prototype.add=function(){for(var t,i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];(t=this.items).push.apply(t,i);this.onPropertyChanged("items");return this},t.prototype.refill=function(n){var t;this.items.splice(0,this.items.length);(t=this.items).push.apply(t,n);this.onPropertyChanged("items");return this},t}(t.MoveableControl),i,r,o,u,s,f,h,e;t.ContextMenu=l;i=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),Object.defineProperty(i.prototype,"moveableContainer",{get:function(){return this.contextMenu},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"id",{set:function(t){n.Common.IsEmpty(t)?this.contextMenu.removeAttr("id"):this.contextMenu.attr("id",t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"location",{set:function(n){if(n){var t=this.contextMenu.width(),i=this.contextMenu.height();n.x+t-$(document).scrollLeft()>$(window).width()&&(n.x-=t);n.y<0&&(n.y=0);n.y+i-$(document).scrollTop()>$(window).innerHeight()&&(n.y-=i,n.y<0&&(n.y=0));this.contextMenu.offset({left:n.x,top:n.y})}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"items",{set:function(n){var t=this;this.contextMenu.empty();n&&n.forEach(function(n){n&&t.addChild(n.createUI(),t.contextMenu)})},enumerable:!1,configurable:!0}),i.prototype.dispose=function(){t.prototype.dispose.call(this);this.escKeyDownHandler&&$(document).off("keydown",this.escKeyDownHandler)},i.prototype.createContainer=function(){this.container=$('<div class="'.concat("FUI-contextmenu-outer",'"><\/div>'))},i.prototype.createContainerEvents=function(){var n=this;t.prototype.createContainerEvents.call(this);this.container.on("mousedown",function(){n.target.dispose()});this.escKeyDownHandler=function(t){t.keyCode===27&&(t.stopPropagation(),document.activeElement===document.body?n.target.dispose():document.activeElement.blur())};$(document).on("keydown",this.escKeyDownHandler)},i.prototype.createChildren=function(){this.cover=$('<div class="'.concat("FUI-contextmenu-cover",'"><\/div>'));this.contextMenu=$('<div class="'.concat("FUI-contextmenu",'" style="position: absolute"><\/div>'));this.contextMenu.on("mousedown",function(n){n.stopPropagation()});this.container.append(this.cover,this.contextMenu)},i.prototype.onUpdateSizeEvent=function(n){n===void 0&&(n=this.contextMenu);t.prototype.onUpdateSizeEvent.call(this,n)},i.prototype.setEnabledProperty=function(n){t.prototype.setEnabledProperty.call(this,n,this.contextMenu)},i}(t.MoveableControlUI);t.ContextMenuUI=i;r=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.createChildren=function(){n.prototype.createChildren.call(this);this.cover.hide()},t}(i);t.ContextMenuChildUI=r;o=function(n){function t(t){var i=n.call(this)||this;return i.defaultUI=u,i.registProperty("inner",t),i.registProperty("child"),i}return __extends(t,n),t}(t.UserControl);t.ContextMenuItem=o;u=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),Object.defineProperty(i.prototype,"inner",{set:function(n){this.container.empty();n&&this.addChild(n.createUI())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"child",{set:function(n){n?(this.container.addClass("FUI-contextmenu-parent"),n.hide(),this.addChild(n.createUI(r))):this.container.removeClass("FUI-contextmenu-parent")},enumerable:!1,configurable:!0}),i.prototype.createContainer=function(){this.container=$('<div class="'.concat("FUI-contextmenu-item",'"><\/div>'))},i.prototype.createContainerEvents=function(){var t=this;this.container.on("mouseenter",function(){var i;if(t.target.child){t.target.child.show();t.target.child.updateSizeFromUI();var e=t.container.width(),h=t.container.height(),o=t.target.child.sizeFromUI.x,s=t.target.child.sizeFromUI.y,u=t.container.offset().left,f=t.container.offset().top,r=u+e;u+e+o-$(document).scrollLeft()>$(window).innerWidth()&&(r=u-o);i=f;f+s-$(document).scrollTop()>$(window).innerHeight()&&(i=f+h-s);r=Math.max(0,r);i=Math.max(0,i);t.target.child.location=new n.Numerics.Vector2(r,i)}});this.container.on("mouseleave",function(){t.target.child&&t.target.child.hide()})},i}(t.ControlUIBase);t.ContextMenuItemUI=u;s=function(n){function t(t,i,r){t===void 0&&(t="");i===void 0&&(i=c);r===void 0&&(r="");var u=n.call(this,t,i)||this;return u.defaultUI=f,u.classNames="".concat("FUI-contextmenu-button"),u.registProperty("uncheckedSVG",r),u}return __extends(t,n),t}(t.ToggleButton);t.ContextMenuButton=s;f=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),Object.defineProperty(t.prototype,"isChecked",{set:function(n){this.container.toggleClass("FUI-checked",n);this.svg=this.target.svg;this.uncheckedSVG=this.target.uncheckedSVG},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"svg",{set:function(n){this.target.isChecked&&(this.svgContainer.empty(),this.svgContainer.append($(n)))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uncheckedSVG",{set:function(n){this.target.isChecked||(this.svgContainer.empty(),this.svgContainer.append($(n)))},enumerable:!1,configurable:!0}),t}(t.ToggleButtonUI);t.ContextMenuButtonUI=f;h=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.defaultUI=e,t}return __extends(t,n),t}(t.UserControl);t.ContextMenuSpliter=h;e=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.createContainer=function(){this.container=$('<div class="'.concat("FUI-contextmenu-spliter",'"><\/div>'))},t}(t.ControlUIBase);t.ContextMenuSpliterUI=e})(t=n.UI||(n.UI={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t;(function(t){var h=[{flag:1,css:"FUI-resize-up"},{flag:2,css:"FUI-resize-down"},{flag:4,css:"FUI-resize-left"},{flag:8,css:"FUI-resize-right"},{flag:5,css:"FUI-resize-nw"},{flag:9,css:"FUI-resize-ne"},{flag:6,css:"FUI-resize-sw"},{flag:10,css:"FUI-resize-se"},],r=function(){function n(){}return n}(),s,u,i,f,e,o;t.DialogEventArgs=r;s=function(i){function f(){var r=i.call(this)||this;return r.title="Dialog",r.resizeable=!0,r.centerWhenOpen=!0,r.alwaysCenter=!1,r.closeByEscKey=!0,r.closeButton=new t.Button("×"),r.footerButtonGroup=new t.ButtonGroup(2),r.moveable=!0,r.visibility=!1,r.defaultUI=u,r.disposeDelayDuration=150,r.registProperty("title"),r.registProperty("resizeable"),r.registProperty("centerWhenOpen"),r.registProperty("alwaysCenter"),r.registProperty("closeByEscKey"),r.registProperty("disposing"),r.closeButton.classNames="FUI-dialog-header-close",r.closeButton.focusable=!1,r.closeButton.on("Clicked",function(){r.close()}).identify("FUI-dialog-close"),r.footerButtonGroup.add(new t.Button(n.RS.ForguncyUI_Dialog_OK).addClass("FUI-button-primary").on("Clicked",function(){r.confirm()}).identify("FUI-dialog-ok")),r.footerButtonGroup.add(new t.Button(n.RS.ForguncyUI_Dialog_Cancel).on("Clicked",function(){r.cancel()}).identify("FUI-dialog-cancel")),r}return __extends(f,i),f.prototype.confirm=function(){var n=new r;this.dispatch("Confirm",n);n.cancel||this.dispose()},f.prototype.cancel=function(){var n=new r;this.dispatch("Cancel",n);n.cancel||this.dispose()},f.prototype.close=function(){var n=new r;this.dispatch("Close",n);n.cancel||this.dispose()},f.prototype.dispose=function(){var r=this,t;this.disposing=!0;t=n.DelayRefresh.setTimeout||window.setTimeout;t(function(){i.prototype.dispose.call(r)},this.disposeDelayDuration)},f}(t.MoveableControl);t.Dialog=s;u=function(i){function r(){var n=i!==null&&i.apply(this,arguments)||this;return n.resizeFlag=0,n}return __extends(r,i),Object.defineProperty(r.prototype,"moveableContainer",{get:function(){return this.dialog},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"header",{get:function(){return new f(this.target)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"content",{get:function(){return new e(this.target)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"footer",{get:function(){return new o(this.target)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"id",{set:function(t){n.Common.IsEmpty(t)?this.dialog.removeAttr("id"):this.dialog.attr("id",t)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"classNames",{set:function(n){this.dialog.addClass(n)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"location",{set:function(n){if(n){var t=Math.max(0,n.x),i=Math.max(0,n.y);this.dialog.css({left:t,top:i})}},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"visibility",{set:function(n){var t=this;n?($(document.activeElement).blur(),this.centerWhenOpen=this.target.centerWhenOpen,window.requestAnimationFrame(function(){t.cover.addClass("FUI-show");t.dialog.addClass("FUI-show")})):(this.cover.removeClass("FUI-show"),this.dialog.removeClass("FUI-show"))},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"resizeable",{set:function(n){this.clearResizes();n&&this.createResizes()},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"centerWhenOpen",{set:function(n){var t=this;n&&window.requestAnimationFrame(function(){t.moveDialogToCenter()})},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"alwaysCenter",{set:function(n){var t=this;if(n){this.alwaysCenterHandler=function(){window.requestAnimationFrame(function(){t.moveDialogToCenter()})};$(window).on("resize",this.alwaysCenterHandler)}else this.alwaysCenterHandler&&$(window).off("resize",this.alwaysCenterHandler)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"disposing",{set:function(n){n&&(this.dialog.addClass("FUI-disposing"),this.visibility=!1)},enumerable:!1,configurable:!0}),r.prototype.dispose=function(){this.removeMouseHandlers();this.escKeyDownHandler&&$(document).off("keydown",this.escKeyDownHandler);this.alwaysCenterHandler&&$(window).off("resize",this.alwaysCenterHandler);i.prototype.dispose.call(this)},r.prototype.createContainer=function(){this.container=$('<div class="'.concat("FUI-dialog-outer",'"><\/div>'))},r.prototype.createModifiers=function(){this.modifiers=[new t.DialogFocusModifier(this)]},r.prototype.createChildren=function(){this.cover=$('<div class="'.concat("FUI-dialog-cover",'"><\/div>'));this.cursorCover=$('<div class="'.concat("FUI-cursor-cover",'"><\/div>'));this.dialog=$('<div class="'.concat("FUI-dialog",'"><\/div>'));this.actualHeader=this.addChild(this.header,this.dialog);this.actualContent=this.addChild(this.content,this.dialog);this.actualFooter=this.addChild(this.footer,this.dialog);this.container.append(this.cover,this.dialog);this.container.on("dragstart",function(n){n.preventDefault()})},r.prototype.createContainerEvents=function(){var n=this;i.prototype.createContainerEvents.call(this);this.escKeyDownHandler=function(t){n.target.closeByEscKey&&t.keyCode===27&&(t.stopPropagation(),document.activeElement===document.body&&n.target.close())};$(document).on("keydown",this.escKeyDownHandler)},r.prototype.createResizes=function(){var t,n=this,i=h.map(function(t){var i=$('<div class="'.concat(t.css,'"><\/div>'));i.on("mousedown",function(r){return n.resizeWindowByMouseDown(r,t.flag,i)});return i});this.removeMouseHandlers();this.mouseMoveHandler=function(t){window.requestAnimationFrame(function(){return n.resizeWindowByMouseMove(t,n.resizeFlag)})};this.mouseUpHandler=function(){n.resizeFlag=0;n.cursorCover.remove()};$(document).on("mousemove",this.mouseMoveHandler);$(document).on("mouseup",this.mouseUpHandler);this.resizes=i;(t=this.dialog).append.apply(t,this.resizes)},r.prototype.clearResizes=function(){this.removeMouseHandlers();this.resizes&&this.resizes.forEach(function(n){return n.remove()})},r.prototype.resizeWindowByMouseDown=function(t,i,r){t.stopPropagation();this.resizeFlag=i;this.mouseDownPosition=new n.Numerics.Vector2(t.screenX,t.screenY);this.oldSize=new n.Numerics.Vector2(this.dialog.width()||0,this.dialog.height()||0);this.oldLocation=new n.Numerics.Vector2(this.dialog.offset().left||0,this.dialog.offset().top||0);r.append(this.cursorCover)},r.prototype.resizeWindowByMouseMove=function(t,i){var r,u,f,e;i!==0&&(t.preventDefault(),t.stopPropagation(),r=new n.Numerics.Vector2(t.screenX,t.screenY).subtract(this.mouseDownPosition),u=this.oldSize.add(r),(i&1)!=0&&(f=this.target.location||this.oldLocation,this.target.location=new n.Numerics.Vector2(f.x,this.oldLocation.y+r.y),this.target.location.y>0&&this.dialog.height(this.oldSize.y-r.y)),(i&2)!=0&&this.dialog.height(u.y),(i&4)!=0&&(e=this.target.location||this.oldLocation,this.target.location=new n.Numerics.Vector2(this.oldLocation.x+r.x,e.y),this.target.location.x>0&&this.dialog.width(this.oldSize.x-r.x)),(i&8)!=0&&this.dialog.width(u.x))},r.prototype.removeMouseHandlers=function(){this.mouseMoveHandler&&$(document).off("mousemove",this.mouseMoveHandler);this.mouseUpHandler&&$(document).off("mouseup",this.mouseUpHandler)},r.prototype.moveDialogToCenter=function(){var n=this.getDialogLocation();this.target.location=n},r.prototype.getDialogLocation=function(t){var r,u;t===void 0&&(t=.5);var f=new n.Numerics.Vector2(this.cover.width(),this.cover.height()),e=new n.Numerics.Vector2(this.dialog.width(),this.dialog.height()),o=new n.Numerics.Vector2(this.cover.offset().left,this.cover.offset().top),s=new n.Numerics.Vector2((r=document.documentElement.scrollLeft)!==null&&r!==void 0?r:0,(u=document.documentElement.scrollTop)!==null&&u!==void 0?u:0),i=f.subtract(e).multiply(.5).add(o);return i.y=f.subtract(e).multiply(t).add(o).y,i.x=Math.max(s.x,i.x),i.y=Math.max(s.y,i.y),i},r}(t.MoveableControlUI);t.DialogUI=u;i=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),Object.defineProperty(t.prototype,"id",{set:function(){return},enumerable:!1,configurable:!0}),t}(t.ControlUIBase);t.DialogInnerUI=i;f=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),Object.defineProperty(i.prototype,"title",{set:function(n){this.titleContainer.text(n)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"moveable",{set:function(n){n?this.container.css("cursor","move"):this.container.css("cursor","initial")},enumerable:!1,configurable:!0}),i.prototype.dispose=function(){t.prototype.dispose.call(this);this.removeHandlers()},i.prototype.createContainer=function(){this.container=$('<div class="'.concat("FUI-dialog-header",'"><\/div>'))},i.prototype.createChildren=function(){var t=this,i,r,u;this.cursorCover=$('<div class="'.concat("FUI-cursor-cover",'"><\/div>'));this.titleContainer=$('<span class="'.concat("FUI-dialog-header-title",'"><\/span>')).text(this.target.title);i=!1;this.container.on("mousedown",function(f){t.target.moveable&&(i=!0,r=new n.Numerics.Vector2(f.screenX,f.screenY),u=new n.Numerics.Vector2(t.container.offset().left||0,t.container.offset().top||0),t.container.append(t.cursorCover))});this.removeHandlers();this.mouseMoveHandler=function(f){i&&window.requestAnimationFrame(function(){var i=new n.Numerics.Vector2(f.screenX,f.screenY).subtract(r);t.target.location=u.add(i)})};this.mouseUpHandler=function(){i=!1;t.cursorCover.remove()};this.bindHandlers();this.container.append(this.titleContainer);this.addChild(this.target.closeButton.createUI())},i.prototype.bindHandlers=function(){$(document).on("mousemove",this.mouseMoveHandler);$(document).on("mouseup",this.mouseUpHandler)},i.prototype.removeHandlers=function(){this.mouseMoveHandler&&$(document).off("mousemove",this.mouseMoveHandler);this.mouseUpHandler&&$(document).off("mouseup",this.mouseUpHandler)},i}(i);t.DialogHeaderUI=f;e=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.createContainer=function(){this.container=$('<div class="'.concat("FUI-dialog-content",'"><\/div>'))},t}(i);t.DialogContentUI=e;o=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.createContainer=function(){this.container=$('<div class="'.concat("FUI-dialog-footer",'"><\/div>'))},t.prototype.createChildren=function(){this.addChild(this.target.footerButtonGroup.createUI())},t}(i);t.DialogFooterUI=o})(t=n.UI||(n.UI={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t;(function(n){var r=function(){function n(){}return n}(),i,t;n.ListBoxItem=r;i=function(n){function i(i){i===void 0&&(i=!1);var r=n.call(this)||this;return r.items=[],r.selections=[],r.focusable=!0,r.defaultUI=t,r.registProperty("items"),r.autoSort=i,r.compareFn=function(n,t){return n.displayText.localeCompare(t.displayText)},r}return __extends(i,n),i.prototype.add=function(){for(var i,r=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];i=!1;t&&t.forEach(function(n){n&&(r.items.push(n),i=!0)});i&&(this.autoSort&&this.items.sort(this.compareFn),this.dispatch("ItemsChanged",this.items))},i.prototype.remove=function(){for(var t,r,u=this,i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];t=[];r=!1;i&&i.forEach(function(n){if(n){var i=u.items.indexOf(n);i>=0&&(t.push.apply(t,u.items.splice(i,1)),r=!0)}});r&&(this.autoSort&&this.items.sort(this.compareFn),this.unSelect.apply(this,t),this.dispatch("ItemsChanged",this.items))},i.prototype.active=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.dispatch("ActiveItemsChanged",t)},i.prototype.selectAll=function(){this.select.apply(this,this.items)},i.prototype.select=function(){for(var i,r=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];i=!1;t&&t.forEach(function(n){n&&r.selections.indexOf(n)<0&&(r.selections.push(n),i=!0)});i&&this.dispatch("SelectionsChanged",this.selections)},i.prototype.selectNew=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];n&&n.every(function(n){return n!==null&&n!==undefined})&&(this.selections=[],this.select.apply(this,n))},i.prototype.unSelect=function(){for(var i,r=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];i=!1;t&&t.forEach(function(n){if(n){var t=r.selections.indexOf(n);t>=0&&(r.selections.splice(t,1),i=!0)}});i&&this.dispatch("SelectionsChanged",this.selections)},i.prototype.clear=function(){this.items=[];this.selections=[];this.dispatch("SelectionsChanged",this.selections);this.dispatch("ItemsChanged",this.selections)},i.prototype.clearSelect=function(){this.selections=[];this.dispatch("SelectionsChanged",this.selections)},i.prototype.moveUpSelect=function(){var n=this,t=this.selections.sort(function(t,i){return n.items.indexOf(t)-n.items.indexOf(i)});t.forEach(function(t){var i=n.items.indexOf(t);i>0&&n.selections.indexOf(n.items[i-1])<0&&(n.items.splice(i-1,0,t),n.items.splice(i+1,1))});this.dispatch("ItemsChanged",this.items)},i.prototype.moveDownSelect=function(){var n=this,t=this.selections.sort(function(t,i){return n.items.indexOf(i)-n.items.indexOf(t)});t.forEach(function(t){var i=n.items.indexOf(t);i<n.items.length-1&&n.selections.indexOf(n.items[i+1])<0&&(n.items.splice(i+2,0,t),n.items.splice(i,1))});this.dispatch("ItemsChanged",this.items)},i.prototype.moveSelectionToViewport=function(){this.dispatch("MoveSelectionToViewport",this.selections)},i}(n.UserControl);n.ListBox=i;t=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.lastIndex=0,t}return __extends(t,n),Object.defineProperty(t.prototype,"items",{set:function(n){var t,i=this;this.container.empty();this.itemContainers=n.map(function(n){return i.createListBoxItem(n)});(t=this.container).append.apply(t,this.itemContainers);this.refreshSelections(this.target.selections)},enumerable:!1,configurable:!0}),t.prototype.createContainer=function(){this.container=$('<div class="'.concat("FUI-listbox",'"><\/div>'))},t.prototype.createContainerEvents=function(){var t=this;n.prototype.createContainerEvents.call(this);this.target.on("ItemsChanged",function(){t.items=t.target.items});this.target.on("SelectionsChanged",function(n,i){t.refreshSelections(i)});this.target.on("MoveSelectionToViewport",function(n,i){t.moveSelectionToViewport(i)});this.container.on("click",function(){t.target.focus()});this.container.on("keydown",function(n){n.ctrlKey&&n.keyCode===65&&(n.preventDefault(),n.stopPropagation(),t.target.selectAll(),t.lastIndex=0)})},t.prototype.createListBoxItem=function(n){var t=this,i=$('<div class="'.concat("FUI-listbox-item",'"><\/div>'));return i.data("value",n),i.text(n.displayText),i.attr("title",n.displayText),i.dblclick(function(){t.target.clearSelect();t.target.select(n);t.lastIndex=t.target.items.indexOf(n);t.target.active(n)}),i.click(function(i){var u,f,r;i.ctrlKey?(t.target.selections.indexOf(n)>=0?t.target.unSelect(n):t.target.select(n),t.lastIndex=t.target.items.indexOf(n)):i.shiftKey?(r=t.target.items.indexOf(n),r<t.lastIndex?(u=t.target).selectNew.apply(u,t.target.items.slice(r,t.lastIndex+1)):(f=t.target).selectNew.apply(f,t.target.items.slice(t.lastIndex,r+1))):(t.target.selectNew(n),t.lastIndex=t.target.items.indexOf(n))}),i},t.prototype.refreshSelections=function(n){this.itemContainers.forEach(function(t){n.indexOf(t.data("value"))>=0?t.addClass("FUI-selected"):t.removeClass("FUI-selected")})},t.prototype.moveSelectionToViewport=function(n){for(var t,u=this.itemContainers.length,i=0;i<u;i++)if(t=this.itemContainers[i],n.indexOf(t.data("value"))>=0){var f=this.container.scrollTop(),r=t.position().top,e=this.container.height()-t.height();(r<=0||r>e)&&this.container.scrollTop(f+r);break}},t}(n.ControlUIBase);n.ListBoxUI=t})(t=n.UI||(n.UI={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t;(function(n){var e=function(n){function i(){var i=n.call(this)||this;return i.nodes=[],i.defaultUI=t,i.registProperty("nodes"),i}return __extends(i,n),i.prototype.add=function(n){this.nodes.push(n);this.dispatch("ItemsChanged")},i.prototype.clear=function(){this.nodes=[];this.dispatch("ItemsChanged")},i.prototype.singleSelect=function(n){this.selectedNode&&this.selectedNode!==n&&(this.selectedNode.isSelected=!1);n.isSelected=!0;this.selectedNode=n},i.prototype.refreshNodes=function(){return this.nodes.forEach(function(n){return n.refreshNodes()}),this},i}(n.UserControl),t,f,i,r,u;n.TreeView=e;t=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),Object.defineProperty(t.prototype,"nodes",{set:function(n){this.refreshNodes(n)},enumerable:!1,configurable:!0}),t.prototype.createContainer=function(){this.container=$('<div class="'.concat("FUI-treeview",'"><\/div>'))},t.prototype.createContainerEvents=function(){var t=this;n.prototype.createContainerEvents.call(this);this.target.on("ItemsChanged",function(){t.refreshNodes(t.target.nodes)})},t.prototype.createChildren=function(){this.contentContainer=$('<div class="'.concat("FUI-treeview-content",'"><\/div>'));this.container.append(this.contentContainer)},t.prototype.refreshNodes=function(n){var t=this;this.updateRootTimer&&clearTimeout(this.updateRootTimer);this.updateRootTimer=setTimeout(function(){t.contentContainer.empty();n&&n.forEach(function(n){t.addChild(n.createUI(),t.contentContainer)})},0)},t}(n.ControlUIBase);n.TreeViewUI=t;f=function(t){function u(u,f){var e=t.call(this)||this;e.isExpand=!1;e.isChecked=!1;e.isLeaf=!1;e.indeterminate=!1;e.isSelected=!1;e.children=[];e.defaultUI=i;e.registProperty("text",u);e.registProperty("isExpand");e.registProperty("isChecked");e.registProperty("indeterminate");e.registProperty("isSelected");e.registProperty("children");e.registProperty("isLeaf");e.expandButton=new r;e.bindProperty(e.expandButton,"isChecked","isExpand");e.checkBox=new n.CheckBox(u);e.bindProperty(e.checkBox,"text","text");e.bindProperty(e.checkBox,"isChecked","isChecked");e.bindProperty(e.checkBox,"indeterminate","indeterminate");e.contentControl=f;e.on("PropertyChanged",function(n,t){t==="children"&&(e.isLeaf=e.children.length===0);t==="isChecked"&&(e.children&&e.children.forEach(function(n){return n.selectAll(e.isChecked)}),e.parent&&e.updateCheckState(e.parent));t==="indeterminate"&&e.parent&&e.updateInterminate(e.parent)});return e}return __extends(u,t),Object.defineProperty(u.prototype,"leafs",{get:function(){return this.children&&this.children.length!==0?this.children.map(function(n){return n.leafs}).reduce(function(n,t){return n.concat(t)}):[this]},enumerable:!1,configurable:!0}),u.prototype.refreshNodes=function(){this.isLeaf=this.children.length===0;this.children.forEach(function(n){return n.refreshNodes()})},u.prototype.selectAll=function(n){this.isChecked=n},u.prototype.addChildren=function(n){var t=this;n.forEach(function(n){n.parent=t});this.children=n;this.updateCheckState()},u.prototype.updateCheckState=function(n){n===void 0&&(n=this);var t=n.children.every(function(n){return n.isChecked===!0}),i=n.children.every(function(n){return n.isChecked===!1}),r=n.children.some(function(n){return n.indeterminate===!0});n.indeterminate=!(t||i)||r;t&&(n.isChecked=!0);i&&(n.isChecked=!1)},u.prototype.updateInterminate=function(n){var t=n.children.every(function(n){return n.isChecked===!0}),i=n.children.every(function(n){return n.isChecked===!1}),r=n.children.some(function(n){return n.indeterminate===!0});n.indeterminate=!(t||i)||r},u}(n.UserControl);n.TreeViewNode=f;i=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),Object.defineProperty(t.prototype,"isLeaf",{set:function(n){this.container.toggleClass("FUI-treeview-leaf-node",n)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isExpand",{set:function(n){this.childrenContainer.toggleClass("FUI-show",n)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isChecked",{set:function(n){this.container.toggleClass("FUI-checked",n)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"indeterminate",{set:function(n){this.container.toggleClass("FUI-interminate",n)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSelected",{set:function(n){this.container.toggleClass("FUI-selected",n)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"children",{set:function(){var n=this;this.childrenContainer.empty();this.target.children&&this.target.children.forEach(function(t){n.addChild(t.createUI(),n.childrenContainer)})},enumerable:!1,configurable:!0}),t.prototype.createContainer=function(){this.container=$(document.createElement("div")).addClass("FUI-treeview-node").addClass("FUI-treeview-leaf-node")},t.prototype.createChildren=function(){var n=this;this.itemContainer=$(document.createElement("div")).addClass("FUI-treeview-node-content");this.childrenContainer=$(document.createElement("div")).addClass("FUI-treeview-node-children");this.addChild(this.target.expandButton.createUI(),this.itemContainer);this.addChild(this.target.checkBox.createUI(),this.itemContainer);this.target.contentControl&&this.addChild(this.target.contentControl.createUI(),this.itemContainer);this.container.append(this.itemContainer,this.childrenContainer);this.itemContainer.on("click",function(){return n.target.dispatch("ItemContainerClicked")})},t}(n.ControlUIBase);n.TreeViewNodeUI=i;r=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.defaultUI=u,t.classNames="".concat("FUI-treeview-node-expand"),t}return __extends(t,n),t}(n.ToggleButton);n.ExpandTreeViewNodeButton=r;u=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t}(n.ToggleButtonUI);n.ExpandTreeViewNodeButtonUI=u})(t=n.UI||(n.UI={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t;(function(n){var r,u,f,t,i;(function(n){n.None="none";n.Both="both";n.Horizontal="horizontal";n.Vertical="vertical"})(r=n.TextAreaResize||(n.TextAreaResize={}));u=function(){function n(){}return n}();n.TextAreaProps=u;f=function(n){function i(i){var u=n.call(this)||this;u.focusable=!0;u.defaultUI=t;var f=i.text,h=f===void 0?"":f,e=i.resize,c=e===void 0?r.None:e,o=i.autosize,l=o===void 0?!0:o,s=i.placeholder,a=s===void 0?"":s;return u.registProperty("text",h),u.registProperty("resize",c),u.registProperty("autosize",l),u.registProperty("placeholder",a),u.registProperty("needResize",""),u}return __extends(i,n),i.prototype.cssHasChanged=function(){this.needResize=(new Date).toString()},i}(n.UserControl);n.TextArea=f;t=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),Object.defineProperty(t.prototype,"text",{set:function(n){this.container[0].value=n},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"placeholder",{set:function(n){this.container[0].placeholder=n},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resize",{set:function(n){this.container.css("resize",n)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"needResize",{set:function(){this.resizeTextarea()},enumerable:!1,configurable:!0}),t.prototype.createContainer=function(){this.container=$(document.createElement("textarea")).addClass("FUI-textarea")},t.prototype.createContainerEvents=function(){var t=this;n.prototype.createContainerEvents.call(this);this.container.on("change",function(){t.target.text=t.container[0].value});this.container.on("keypress",function(n){n.keyCode===13&&(n.stopPropagation(),t.target.text=t.container[0].value)});this.container.on("keyup",function(){t.resizeTextarea()})},t.prototype.resizeTextarea=function(){var t=this.target.autosize,n={};if(t){var r=t,u=r.minRows,f=r.maxRows;Object.assign(n,i.calcTextareaHeight(this.container[0],u,f))}else Object.assign(n,{minHeight:i.calcTextareaHeight(this.container[0]).minHeight});this.container.css(n)},t}(n.ControlUIBase);n.TextAreaUI=t;i=function(){function n(){}return n.calculateNodeStyling=function(t){var i=t.parentElement===null?$(t).clone()[0]:null;i&&n.hiddenTextarea.appendChild(i);var r=window.getComputedStyle(i!==null&&i!==void 0?i:t),u=r.getPropertyValue("box-sizing"),f=parseFloat(r.getPropertyValue("padding-bottom"))+parseFloat(r.getPropertyValue("padding-top")),e=parseFloat(r.getPropertyValue("border-bottom-width"))+parseFloat(r.getPropertyValue("border-top-width")),o=n.CONTEXT_STYLE.map(function(n){return"".concat(n,":").concat(r.getPropertyValue(n))}).join(";");return i&&n.hiddenTextarea.removeChild(i),{contextStyle:o,paddingSize:f,borderSize:e,boxSizing:u}},n.calcTextareaHeight=function(t,i,r){var u,f,a,e,o;i===void 0&&(i=1);r===void 0&&(r=null);n.hiddenTextarea||(n.hiddenTextarea=document.createElement("textarea"),document.body.appendChild(n.hiddenTextarea));var s=n.calculateNodeStyling(t),h=s.paddingSize,l=s.borderSize,c=s.boxSizing,v=s.contextStyle;return n.hiddenTextarea.setAttribute("style","".concat(v,";").concat(n.HIDDEN_STYLE)),n.hiddenTextarea.value=t.value||t.placeholder||"",u=n.hiddenTextarea.scrollHeight,f={},c==="border-box"?u=u+l:c==="content-box"&&(u=u-h),n.hiddenTextarea.value="",a=n.hiddenTextarea.scrollHeight-h,i!==null&&(e=a*i,c==="border-box"&&(e=e+h+l),u=Math.max(e,u),f.minHeight="".concat(e,"px")),r!==null&&(o=a*r,c==="border-box"&&(o=o+h+l),f.overflow=o>=u?"hidden":"auto",u=Math.min(o,u)),f.height="".concat(u,"px"),n.hiddenTextarea.parentNode&&n.hiddenTextarea.parentNode.removeChild(n.hiddenTextarea),n.hiddenTextarea=null,f},n.HIDDEN_STYLE="\n          height:0 !important;\n          visibility:hidden !important;\n          overflow:hidden !important;\n          position:absolute !important;\n          z-index:-1000 !important;\n          top:0 !important;\n          right:0 !important\n        ",n.CONTEXT_STYLE=["letter-spacing","line-height","padding-top","padding-bottom","font-family","font-weight","font-size","text-rendering","text-transform","width","text-indent","padding-left","padding-right","border-width","box-sizing"],n}()})(t=n.UI||(n.UI={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t;(function(n){var i=function(n){function i(i,r){i===void 0&&(i="");r===void 0&&(r="");var u=n.call(this)||this;return u.defaultUI=t,u.registProperty("text",i),u.registProperty("placeholder",r),u}return __extends(i,n),i}(n.UserControl),t;n.TextBlock=i;t=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),Object.defineProperty(t.prototype,"text",{set:function(n){n?this.container.removeClass("FUI-textblock-empty"):this.container.addClass("FUI-textblock-empty");this.container.text(n)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"placeholder",{set:function(n){this.container.attr("data-placeholder",n)},enumerable:!1,configurable:!0}),t.prototype.createContainer=function(){var n=this;this.container=$(document.createElement("div")).addClass("FUI-textblock");this.container.on("click",function(){return n.target.dispatch("ContainerClicked")})},t}(n.ControlUIBase);n.TextBlockUI=t})(t=n.UI||(n.UI={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t;(function(t){var u=function(n){function t(t,r,u){t===void 0&&(t="");r===void 0&&(r="");u===void 0&&(u="");var f=n.call(this)||this;return f.defaultUI=i,f.registProperty("text",t),f.registProperty("icon",r),f.registProperty("suffix",u),f}return __extends(t,n),t}(t.UserControl),i,r;t.IconText=u;i=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),Object.defineProperty(t.prototype,"text",{set:function(n){this.textContainer.text(n)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"icon",{set:function(n){this.svgContainer.empty();this.svgContainer.append($(n))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"suffix",{set:function(n){this.suffixContainer.empty();this.suffixContainer.append($(n))},enumerable:!1,configurable:!0}),t.prototype.createContainer=function(){this.container=$(document.createElement("div")).addClass("FUI-svgtext")},t.prototype.createChildren=function(){var n=this;this.svgContainer=$(document.createElement("span")).addClass("FUI-svgtext-icon");this.textContainer=$(document.createElement("span")).addClass("FUI-svgtext-text");this.suffixContainer=$(document.createElement("span")).addClass("FUI-svgtext-suffix");this.svgContainer.on("click",function(){return n.target.dispatch("IconClicked")});this.textContainer.on("click",function(){return n.target.dispatch("TextClicked")});this.suffixContainer.on("click",function(){return n.target.dispatch("SuffixClicked")});this.container.on("click",function(){return n.target.dispatch("ContainerClicked")});this.container.append(this.svgContainer,this.textContainer,this.suffixContainer)},t}(t.ControlUIBase);t.SVGTextUI=i;r=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),Object.defineProperty(i.prototype,"text",{set:function(n){this.textContainer.text(n)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"icon",{set:function(t){n.Common.IsEmpty(t)?this.imageContainer.hide():(this.imageContainer.show(),this.imageContainer.attr("src",n.ImageHelper.encodeImageUrl(t)))},enumerable:!1,configurable:!0}),i.prototype.createContainer=function(){this.container=$(document.createElement("div")).addClass("FUI-imagetext")},i.prototype.createChildren=function(){var n=this;this.imageContainer=$(document.createElement("img")).addClass("FUI-imagetext-icon");this.textContainer=$(document.createElement("span")).addClass("FUI-imagetext-text");this.imageContainer.on("click",function(){return n.target.dispatch("IconClicked")});this.textContainer.on("click",function(){return n.target.dispatch("TextClicked")});this.container.on("click",function(){return n.target.dispatch("ContainerClicked")});this.container.append(this.imageContainer,this.textContainer)},i}(t.ControlUIBase);t.ImageTextUI=r})(t=n.UI||(n.UI={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t;(function(n){var r=function(){function n(){}return n}(),i,t;n.PaginationProps=r;i=function(n){function i(i){var r=n.call(this)||this;r.defaultUI=t;var o=i.total,u=i.pageSize,s=u===void 0?10:u,f=i.pagerCount,h=f===void 0?7:f,e=i.currentPage,c=e===void 0?1:e;return r.registProperty("total",o),r.registProperty("pageSize",s),r.registProperty("pagerCount",h),r.registProperty("currentPage",c),r}return __extends(i,n),i}(n.UserControl);n.Pagination=i;t=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),Object.defineProperty(t.prototype,"total",{set:function(){this.dispatchPageCount()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pageSize",{set:function(){this.dispatchPageCount()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pageCount",{set:function(){console.log("please change the total or the pageSize to change the pageCount")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pagerCount",{set:function(n){var t=(n|0)===n&&n>4&&n<22&&n%2==1;if(!t){console.error("pagerCount did not pass validation");return}this.updatePages()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentPage",{set:function(n){this.updatePages();this.target.dispatch("PageChanged",n)},enumerable:!1,configurable:!0}),t.prototype.createContainer=function(){this.container=$("<ul/>").addClass("FUI-pagination")},t.prototype.createChildren=function(){var n=this;this.prevContainer=$("<li/>").addClass("FUI-pagination-prev").append('<svg width="1em" height="1em" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <path d="M4.76310905,0.51569502 C5.11115761,0.495957698 5.46684701,0.608520797 5.7445021,0.855577756 L5.7445021,0.855577756 L12.6970218,8.01347097 L5.74461047,15.1718757 C5.48852843,15.4000255 5.16381603,15.5134861 4.84124243,15.5134861 C4.47348845,15.5134861 4.10701636,15.3657095 3.8450215,15.0797967 C3.59337852,14.8067946 3.48181404,14.4610971 3.50238557,14.1237162 C3.52230512,13.7970279 3.66630185,13.4764746 3.93334941,13.2366952 L3.93334941,13.2366952 L8.78478176,8.01347944 L3.93334533,2.79005375 C3.66630039,2.55027471 3.52230502,2.22972305 3.50238557,1.9030364 C3.48181404,1.56565547 3.59337852,1.21995802 3.84456111,0.947456003 C4.08895736,0.681591219 4.42162654,0.53505999 4.76310905,0.51569502 Z" stroke="#FFFFFF" fill="#4180E3" fill-rule="nonzero" transform="translate(8.000000, 8.013486) scale(-1, 1) translate(-8.000000, -8.013486) "><\/path> <\/g> <\/svg>');this.startContainer=$(this.createItemHTML(1));this.prevMoreContainer=$("<li/>").addClass("FUI-pagination-prev-more").append('<svg width="1em" height="1em" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <path d="M13.5,5.5 C14.0599988,5.5 14.5589197,5.72181313 14.9185536,6.08144702 C15.2781863,6.44107975 15.5,6.93999919 15.5,7.5 C15.5,8.05999882 15.2781869,8.5589197 14.918553,8.91855359 C14.5589203,9.27818632 14.0600008,9.5 13.5,9.5 C12.9400012,9.5 12.4410803,9.27818687 12.0814464,8.91855298 C11.7218137,8.55892025 11.5,8.06000081 11.5,7.5 C11.5,6.94000118 11.7218131,6.4410803 12.081447,6.08144641 C12.4410797,5.72181368 12.9399992,5.5 13.5,5.5 L13.5,5.5 Z M3.5,5.5 C4.05999882,5.5 4.5589197,5.72181313 4.91855359,6.08144702 C5.27818632,6.44107975 5.5,6.93999919 5.5,7.5 C5.5,8.05999882 5.27818687,8.5589197 4.91855298,8.91855359 C4.55892025,9.27818632 4.06000081,9.5 3.5,9.5 C2.94000118,9.5 2.4410803,9.27818687 2.08144641,8.91855298 C1.72181368,8.55892025 1.5,8.06000081 1.5,7.5 C1.5,6.94000118 1.72181313,6.4410803 2.08144702,6.08144641 C2.44107975,5.72181368 2.93999919,5.5 3.5,5.5 Z M8.5,5.5 C9.05999882,5.5 9.5589197,5.72181313 9.91855359,6.08144702 C10.2781863,6.44107975 10.5,6.93999919 10.5,7.5 C10.5,8.05999882 10.2781869,8.5589197 9.91855298,8.91855359 C9.55892025,9.27818632 9.06000081,9.5 8.5,9.5 C7.94000118,9.5 7.4410803,9.27818687 7.08144641,8.91855298 C6.72181368,8.55892025 6.5,8.06000081 6.5,7.5 C6.5,6.94000118 6.72181313,6.4410803 7.08144702,6.08144641 C7.44107975,5.72181368 7.93999919,5.5 8.5,5.5 L8.5,5.5 Z" stroke="#FFFFFF" fill="#767676" fill-rule="nonzero"><\/path> <\/g> <\/svg>');this.pagerContainer=$("<ul/>");this.nextMoreContainer=$("<li/>").addClass("FUI-pagination-next-more").append('<svg width="1em" height="1em" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <path d="M13.5,5.5 C14.0599988,5.5 14.5589197,5.72181313 14.9185536,6.08144702 C15.2781863,6.44107975 15.5,6.93999919 15.5,7.5 C15.5,8.05999882 15.2781869,8.5589197 14.918553,8.91855359 C14.5589203,9.27818632 14.0600008,9.5 13.5,9.5 C12.9400012,9.5 12.4410803,9.27818687 12.0814464,8.91855298 C11.7218137,8.55892025 11.5,8.06000081 11.5,7.5 C11.5,6.94000118 11.7218131,6.4410803 12.081447,6.08144641 C12.4410797,5.72181368 12.9399992,5.5 13.5,5.5 L13.5,5.5 Z M3.5,5.5 C4.05999882,5.5 4.5589197,5.72181313 4.91855359,6.08144702 C5.27818632,6.44107975 5.5,6.93999919 5.5,7.5 C5.5,8.05999882 5.27818687,8.5589197 4.91855298,8.91855359 C4.55892025,9.27818632 4.06000081,9.5 3.5,9.5 C2.94000118,9.5 2.4410803,9.27818687 2.08144641,8.91855298 C1.72181368,8.55892025 1.5,8.06000081 1.5,7.5 C1.5,6.94000118 1.72181313,6.4410803 2.08144702,6.08144641 C2.44107975,5.72181368 2.93999919,5.5 3.5,5.5 Z M8.5,5.5 C9.05999882,5.5 9.5589197,5.72181313 9.91855359,6.08144702 C10.2781863,6.44107975 10.5,6.93999919 10.5,7.5 C10.5,8.05999882 10.2781869,8.5589197 9.91855298,8.91855359 C9.55892025,9.27818632 9.06000081,9.5 8.5,9.5 C7.94000118,9.5 7.4410803,9.27818687 7.08144641,8.91855298 C6.72181368,8.55892025 6.5,8.06000081 6.5,7.5 C6.5,6.94000118 6.72181313,6.4410803 7.08144702,6.08144641 C7.44107975,5.72181368 7.93999919,5.5 8.5,5.5 L8.5,5.5 Z" stroke="#FFFFFF" fill="#767676" fill-rule="nonzero"><\/path> <\/g> <\/svg>');this.endContainer=$(this.createItemHTML(this.target.pageCount));this.nextContainer=$("<li/>").addClass("FUI-pagination-next").append('<svg width="1em" height="1em" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <path d="M4.76310905,0.51569502 C5.11115761,0.495957698 5.46684701,0.608520797 5.7445021,0.855577756 L5.7445021,0.855577756 L12.6970218,8.01347097 L5.74461047,15.1718757 C5.48852843,15.4000255 5.16381603,15.5134861 4.84124243,15.5134861 C4.47348845,15.5134861 4.10701636,15.3657095 3.8450215,15.0797967 C3.59337852,14.8067946 3.48181404,14.4610971 3.50238557,14.1237162 C3.52230512,13.7970279 3.66630185,13.4764746 3.93334941,13.2366952 L3.93334941,13.2366952 L8.78478176,8.01347944 L3.93334533,2.79005375 C3.66630039,2.55027471 3.52230502,2.22972305 3.50238557,1.9030364 C3.48181404,1.56565547 3.59337852,1.21995802 3.84456111,0.947456003 C4.08895736,0.681591219 4.42162654,0.53505999 4.76310905,0.51569502 Z" stroke="#FFFFFF" fill="#4180E3" fill-rule="nonzero"><\/path> <\/g> <\/svg>');this.prevContainer.on("click",function(){n.dispatchCurrentPage(n.target.currentPage-1)});this.startContainer.on("click",function(){n.dispatchCurrentPage(1)});this.prevMoreContainer.on("mouseenter",function(){n.prevMoreContainer.empty();n.prevMoreContainer.append('<svg width="1em" height="1em" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <path d="M1.76310905,0.51569502 C2.11115761,0.495957698 2.46684701,0.608520797 2.7445021,0.855577756 L2.7445021,0.855577756 L9.69702175,8.01347097 L2.74461047,15.1718757 C2.48852843,15.4000255 2.16381603,15.5134861 1.84124243,15.5134861 C1.47348845,15.5134861 1.10701636,15.3657095 0.845021502,15.0797967 C0.593378523,14.8067946 0.481814035,14.4610971 0.502385567,14.1237162 C0.522305125,13.7970279 0.666301851,13.4764746 0.933349405,13.2366952 L0.933349405,13.2366952 L5.78478176,8.01347944 L0.933345329,2.79005375 C0.666300386,2.55027471 0.522305024,2.22972305 0.502385567,1.9030364 C0.481814035,1.56565547 0.593378523,1.21995802 0.844561105,0.947456003 C1.08895736,0.681591219 1.42162654,0.53505999 1.76310905,0.51569502 Z" stroke="#FFFFFF" fill="#4180E3" fill-rule="nonzero" transform="translate(5.000000, 8.013486) scale(-1, 1) translate(-5.000000, -8.013486) "><\/path> <path d="M6.76310905,0.51569502 C7.11115761,0.495957698 7.46684701,0.608520797 7.7445021,0.855577756 L7.7445021,0.855577756 L14.6970218,8.01347097 L7.74461047,15.1718757 C7.48852843,15.4000255 7.16381603,15.5134861 6.84124243,15.5134861 C6.47348845,15.5134861 6.10701636,15.3657095 5.8450215,15.0797967 C5.59337852,14.8067946 5.48181404,14.4610971 5.50238557,14.1237162 C5.52230512,13.7970279 5.66630185,13.4764746 5.93334941,13.2366952 L5.93334941,13.2366952 L10.7847818,8.01347944 L5.93334533,2.79005375 C5.66630039,2.55027471 5.52230502,2.22972305 5.50238557,1.9030364 C5.48181404,1.56565547 5.59337852,1.21995802 5.84456111,0.947456003 C6.08895736,0.681591219 6.42162654,0.53505999 6.76310905,0.51569502 Z" stroke="#FFFFFF" fill="#4180E3" fill-rule="nonzero" transform="translate(10.000000, 8.013486) scale(-1, 1) translate(-10.000000, -8.013486) "><\/path> <\/g> <\/svg>')});this.prevMoreContainer.on("click",function(){n.dispatchCurrentPage(n.target.currentPage-n.target.pagerCount)});this.prevMoreContainer.on("mouseleave",function(){n.prevMoreContainer.empty();n.prevMoreContainer.append('<svg width="1em" height="1em" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <path d="M13.5,5.5 C14.0599988,5.5 14.5589197,5.72181313 14.9185536,6.08144702 C15.2781863,6.44107975 15.5,6.93999919 15.5,7.5 C15.5,8.05999882 15.2781869,8.5589197 14.918553,8.91855359 C14.5589203,9.27818632 14.0600008,9.5 13.5,9.5 C12.9400012,9.5 12.4410803,9.27818687 12.0814464,8.91855298 C11.7218137,8.55892025 11.5,8.06000081 11.5,7.5 C11.5,6.94000118 11.7218131,6.4410803 12.081447,6.08144641 C12.4410797,5.72181368 12.9399992,5.5 13.5,5.5 L13.5,5.5 Z M3.5,5.5 C4.05999882,5.5 4.5589197,5.72181313 4.91855359,6.08144702 C5.27818632,6.44107975 5.5,6.93999919 5.5,7.5 C5.5,8.05999882 5.27818687,8.5589197 4.91855298,8.91855359 C4.55892025,9.27818632 4.06000081,9.5 3.5,9.5 C2.94000118,9.5 2.4410803,9.27818687 2.08144641,8.91855298 C1.72181368,8.55892025 1.5,8.06000081 1.5,7.5 C1.5,6.94000118 1.72181313,6.4410803 2.08144702,6.08144641 C2.44107975,5.72181368 2.93999919,5.5 3.5,5.5 Z M8.5,5.5 C9.05999882,5.5 9.5589197,5.72181313 9.91855359,6.08144702 C10.2781863,6.44107975 10.5,6.93999919 10.5,7.5 C10.5,8.05999882 10.2781869,8.5589197 9.91855298,8.91855359 C9.55892025,9.27818632 9.06000081,9.5 8.5,9.5 C7.94000118,9.5 7.4410803,9.27818687 7.08144641,8.91855298 C6.72181368,8.55892025 6.5,8.06000081 6.5,7.5 C6.5,6.94000118 6.72181313,6.4410803 7.08144702,6.08144641 C7.44107975,5.72181368 7.93999919,5.5 8.5,5.5 L8.5,5.5 Z" stroke="#FFFFFF" fill="#767676" fill-rule="nonzero"><\/path> <\/g> <\/svg>')});this.pagerContainer.on("click",function(t){n.dispatchCurrentPage(+t.target.innerText)});this.nextMoreContainer.on("mouseenter",function(){n.nextMoreContainer.empty();n.nextMoreContainer.append('<svg width="1em" height="1em" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <path d="M2.76310905,0.51569502 C3.11115761,0.495957698 3.46684701,0.608520797 3.7445021,0.855577756 L3.7445021,0.855577756 L10.6970218,8.01347097 L3.74461047,15.1718757 C3.48852843,15.4000255 3.16381603,15.5134861 2.84124243,15.5134861 C2.47348845,15.5134861 2.10701636,15.3657095 1.8450215,15.0797967 C1.59337852,14.8067946 1.48181404,14.4610971 1.50238557,14.1237162 C1.52230512,13.7970279 1.66630185,13.4764746 1.93334941,13.2366952 L1.93334941,13.2366952 L6.78478176,8.01347944 L1.93334533,2.79005375 C1.66630039,2.55027471 1.52230502,2.22972305 1.50238557,1.9030364 C1.48181404,1.56565547 1.59337852,1.21995802 1.84456111,0.947456003 C2.08895736,0.681591219 2.42162654,0.53505999 2.76310905,0.51569502 Z" stroke="#FFFFFF" fill="#4180E3" fill-rule="nonzero"><\/path> <path d="M7.76310905,0.51569502 C8.11115761,0.495957698 8.46684701,0.608520797 8.7445021,0.855577756 L8.7445021,0.855577756 L15.6970218,8.01347097 L8.74461047,15.1718757 C8.48852843,15.4000255 8.16381603,15.5134861 7.84124243,15.5134861 C7.47348845,15.5134861 7.10701636,15.3657095 6.8450215,15.0797967 C6.59337852,14.8067946 6.48181404,14.4610971 6.50238557,14.1237162 C6.52230512,13.7970279 6.66630185,13.4764746 6.93334941,13.2366952 L6.93334941,13.2366952 L11.7847818,8.01347944 L6.93334533,2.79005375 C6.66630039,2.55027471 6.52230502,2.22972305 6.50238557,1.9030364 C6.48181404,1.56565547 6.59337852,1.21995802 6.84456111,0.947456003 C7.08895736,0.681591219 7.42162654,0.53505999 7.76310905,0.51569502 Z" stroke="#FFFFFF" fill="#4180E3" fill-rule="nonzero"><\/path> <\/g> <\/svg>')});this.nextMoreContainer.on("click",function(){n.dispatchCurrentPage(n.target.currentPage+n.target.pagerCount)});this.nextMoreContainer.on("mouseleave",function(){n.nextMoreContainer.empty();n.nextMoreContainer.append('<svg width="1em" height="1em" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <path d="M13.5,5.5 C14.0599988,5.5 14.5589197,5.72181313 14.9185536,6.08144702 C15.2781863,6.44107975 15.5,6.93999919 15.5,7.5 C15.5,8.05999882 15.2781869,8.5589197 14.918553,8.91855359 C14.5589203,9.27818632 14.0600008,9.5 13.5,9.5 C12.9400012,9.5 12.4410803,9.27818687 12.0814464,8.91855298 C11.7218137,8.55892025 11.5,8.06000081 11.5,7.5 C11.5,6.94000118 11.7218131,6.4410803 12.081447,6.08144641 C12.4410797,5.72181368 12.9399992,5.5 13.5,5.5 L13.5,5.5 Z M3.5,5.5 C4.05999882,5.5 4.5589197,5.72181313 4.91855359,6.08144702 C5.27818632,6.44107975 5.5,6.93999919 5.5,7.5 C5.5,8.05999882 5.27818687,8.5589197 4.91855298,8.91855359 C4.55892025,9.27818632 4.06000081,9.5 3.5,9.5 C2.94000118,9.5 2.4410803,9.27818687 2.08144641,8.91855298 C1.72181368,8.55892025 1.5,8.06000081 1.5,7.5 C1.5,6.94000118 1.72181313,6.4410803 2.08144702,6.08144641 C2.44107975,5.72181368 2.93999919,5.5 3.5,5.5 Z M8.5,5.5 C9.05999882,5.5 9.5589197,5.72181313 9.91855359,6.08144702 C10.2781863,6.44107975 10.5,6.93999919 10.5,7.5 C10.5,8.05999882 10.2781869,8.5589197 9.91855298,8.91855359 C9.55892025,9.27818632 9.06000081,9.5 8.5,9.5 C7.94000118,9.5 7.4410803,9.27818687 7.08144641,8.91855298 C6.72181368,8.55892025 6.5,8.06000081 6.5,7.5 C6.5,6.94000118 6.72181313,6.4410803 7.08144702,6.08144641 C7.44107975,5.72181368 7.93999919,5.5 8.5,5.5 L8.5,5.5 Z" stroke="#FFFFFF" fill="#767676" fill-rule="nonzero"><\/path> <\/g> <\/svg>')});this.endContainer.on("click",function(){n.dispatchCurrentPage(n.target.pageCount)});this.nextContainer.on("click",function(){n.dispatchCurrentPage(n.target.currentPage+1)});this.container.append(this.prevContainer,this.startContainer,this.prevMoreContainer,this.pagerContainer,this.nextMoreContainer,this.endContainer,this.nextContainer)},t.prototype.createItemHTML=function(n){return"<li key='".concat(n,"' class='").concat("FUI-pagination-item","'>").concat(n,"<\/li>")},t.prototype.dispatchPageCount=function(){var n=Math.ceil(this.target.total/this.target.pageSize);this.target.pageCount=n;this.endContainer.text(n);this.endContainer.attr("key",n);n>=0?this.startContainer.show():this.startContainer.hide();n>1?this.endContainer.show():this.endContainer.hide();this.dispatchCurrentPage();this.updatePages()},t.prototype.dispatchCurrentPage=function(n){var t=n;n<1?t=1:n>this.target.pageCount?t=Math.max(this.target.pageCount,1):isNaN(n)&&(t=1);this.target.currentPage=t},t.prototype.updatePages=function(){this.updatePagers();this.updateItemActive()},t.prototype.updatePagers=function(){var c=this,e=this.target.currentPage,t=this.target.pagerCount,r=this.target.pageCount,s=(t-1)/2,u=!1,f=!1,i,h,o,n;if(r>t&&(e>t-s&&(u=!0),e<r-s&&(f=!0)),i=[],u&&!f)for(h=r-(t-2),n=h;n<r;n++)i.push(n);else if(!u&&f)for(n=2;n<t;n++)i.push(n);else if(u&&f)for(o=Math.floor(t/2)-1,n=e-o;n<=e+o;n++)i.push(n);else for(n=2;n<r;n++)i.push(n);u?this.prevMoreContainer.show():this.prevMoreContainer.hide();f?this.nextMoreContainer.show():this.nextMoreContainer.hide();this.pagerContainer.html("".concat(i.map(function(n){return c.createItemHTML(n)}).join("")))},t.prototype.updateItemActive=function(){this.container.find(".".concat("FUI-pagination-item-active")).removeClass("FUI-pagination-item-active");this.container.find(".".concat("FUI-pagination-item","[key=").concat(this.target.currentPage,"]")).addClass("FUI-pagination-item-active")},t}(n.ControlUIBase);n.PaginationUI=t})(t=n.UI||(n.UI={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t;(function(n){var i=function(n){function i(){var i=n!==null&&n.apply(this,arguments)||this;return i.defaultUI=t,i}return __extends(i,n),i}(n.UserControl),t;n.Progress=i;t=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.createContainer=function(){this.container=$('<div class="'.concat("FUI-progress",'"><\/div>'))},t.prototype.createChildren=function(){var n=$('<div class="spinner"><i><\/i><\/div>');this.container.append(n)},t}(n.ControlUIBase);n.ProgressUI=t})(t=n.UI||(n.UI={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t;(function(n){var i=function(n){function i(i,r,u,f){i===void 0&&(i="");r===void 0&&(r="");u===void 0&&(u="");f===void 0&&(f="text");var e=n.call(this)||this;return e.focusable=!0,e.defaultUI=t,e.registProperty("text",i),e.registProperty("placeholder",r),e.registProperty("type",f),e.registProperty("autocomplete"),e.registProperty("suffix",u),e}return __extends(i,n),i.prototype.valueChanged=function(){this.dispatch("ValueChanged")},i.prototype.confirm=function(){this.dispatch("Confirm")},i.prototype.asSearchBox=function(){return this.type="search",this},i}(n.UserControl),t;n.TextBox=i;t=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),Object.defineProperty(t.prototype,"text",{set:function(n){this.inputContainer[0].value=n},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"placeholder",{set:function(n){this.inputContainer[0].placeholder=n},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"suffix",{set:function(n){this.suffixContainer.empty();this.suffixContainer.append($(n))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"type",{set:function(n){this.inputContainer.attr("type",n)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"focusableContainer",{get:function(){return this.inputContainer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"autocomplete",{set:function(n){n&&(this.inputContainer[0].autocomplete=n)},enumerable:!1,configurable:!0}),t.prototype.createContainer=function(){this.container=$(document.createElement("div")).addClass("FUI-textbox")},t.prototype.createChildren=function(){var n=this;this.inputContainer=$(document.createElement("input")).addClass("FUI-textbox-input");this.suffixContainer=$(document.createElement("span")).addClass("FUI-textbox-suffix");this.container.append(this.inputContainer,this.suffixContainer);this.inputContainer.on("change",function(){n.target.text=n.inputContainer[0].value;n.target.valueChanged()});this.inputContainer.on("keypress",function(t){t.keyCode===13&&(t.stopPropagation(),n.target.text=n.inputContainer[0].value,n.target.confirm())});this.suffixContainer.on("click",function(){return n.target.dispatch("SuffixClicked")})},t}(n.ControlUIBase);n.TextBoxUI=t})(t=n.UI||(n.UI={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t;(function(n){var r=function(n){function i(i){i===void 0&&(i=[]);var r=n.call(this)||this;return r.focusable=!0,r.defaultUI=t,r.registProperty("items",i),r.registProperty("value"),r.registProperty("displayName"),r.registProperty("isSeparator"),r}return __extends(i,n),i.prototype.onSelectionChanged=function(){this.dispatch("SelectionChanged")},i.prototype.setItems=function(n){this.items=n;this.dispatch("ItemsChanged")},i.prototype.setValue=function(n){this.value=n;this.dispatch("ValueChanged");this.dispatch("SelectionChanged")},i}(n.UserControl),t,i;n.ComboBox=r;t=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),Object.defineProperty(t.prototype,"value",{set:function(n){this.container.val(JSON.stringify(n))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"items",{set:function(){this.container.empty();this.createChildren();this.value=this.target.value},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"displayName",{set:function(){this.container.empty();this.createChildren()},enumerable:!1,configurable:!0}),t.prototype.createContainer=function(){this.container=$(document.createElement("select")).addClass("FUI-combobox")},t.prototype.createContainerEvents=function(){var t=this;n.prototype.createContainerEvents.call(this);this.container.on("change",function(){t.target.value=JSON.parse(t.container.val());t.target.onSelectionChanged()});this.target.on("ItemsChanged",function(){t.items=t.target.items});this.target.on("ValueChanged",function(){t.value=t.target.value})},t.prototype.createChildren=function(){var t,n=this;if(this.target.items){var i=!!this.target.displayName,r=!!this.target.isSeparator,u=this.target.items.map(function(t){var u,f;return r&&!!t[n.target.isSeparator]?$(document.createElement("hr")).addClass("FUI-combobox-separator"):(u=$(document.createElement("option")).addClass("FUI-combobox-item"),f=JSON.stringify(t),u.val(f),u.text(i?t[n.target.displayName]:t),f===JSON.stringify(n.target.value)&&u.attr("selected","selected"),u)});(t=this.container).append.apply(t,u)}},t}(n.ControlUIBase);n.ComboBoxUI=t;i=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),Object.defineProperty(t.prototype,"value",{set:function(n){this.container.val(JSON.stringify(n))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"items",{set:function(){this.container.empty();this.createChildren();this.value=this.target.value},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"displayName",{set:function(){this.container.empty();this.createChildren()},enumerable:!1,configurable:!0}),t.prototype.createContainer=function(){this.container=$(document.createElement("div")).addClass("FUI-combobox")},t.prototype.createChildren=function(){var t,n=this,i=Math.floor(Math.random()*1e8),r,u;this.inputContainer=$(document.createElement("input")).attr("list",i).on("change",function(){n.target.value=JSON.parse(n.inputContainer.val())});this.container.append(this.inputContainer);this.dataListContainer=$(document.createElement("datalist")).attr("id",i);this.target.items&&(r=!!this.target.displayName,u=this.target.items.map(function(t){var i=$(document.createElement("option")).addClass("FUI-combobox-item"),u=JSON.stringify(t);return i.val(u),i.text(r?t[n.target.displayName]:t),u===JSON.stringify(n.target.value)&&i.attr("selected","selected"),i}),(t=this.dataListContainer).append.apply(t,u));this.container.append(this.dataListContainer)},t}(n.ControlUIBase);n.RecommendComboBoxUI=i})(t=n.UI||(n.UI={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t;(function(t){var r=function(t){function r(r){var u=t.call(this)||this;return u.defaultUI=i,u.isMobile=n.Platform.isMobile(),u.registProperty("dateTimeValue",n.FormatHelper.formatValue(r,"yyyy/MM/dd HH:mm:ss")),u}return __extends(r,t),r.prototype.getValue=function(){return n.Common.IsEmpty(this.dateTimeValue)?null:new Date(this.dateTimeValue)},r.prototype.setValue=function(t){n.Common.IsEmpty(t)||(this.dateTimeValue=n.FormatHelper.formatValue(t,"yyyy/MM/dd HH:mm:ss"))},r}(t.UserControl),i;t.DateTimePicker=r;i=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),Object.defineProperty(i.prototype,"dateTimeValue",{set:function(n){if(this.target.isMobile){if(this.getValueFromNativeControl()===n)return;this.setValueToNativeControl(n)}else{if(this.getValueFromInputManControl()===n)return;this.setValueToInputManControl(n)}},enumerable:!1,configurable:!0}),i.prototype.createContainer=function(){this.container=$("<div class=".concat("FUI-datetimepicker","><\/div>"))},i.prototype.createChildren=function(){var n=this;this.target.isMobile?(this.dateContainer=$('<input type="date"><\/input>'),this.timeContainer=$('<input type="time"><\/input>'),this.dateContainer.change(function(){n.target.dateTimeValue=n.getValueFromNativeControl()}),this.timeContainer.change(function(){n.target.dateTimeValue=n.getValueFromNativeControl()}),this.container.append(this.dateContainer,this.timeContainer)):this.container.append(this.getInputDateTime())},i.prototype.getInputDateTime=function(){var r=this,i=n.DomUtilities.createJqueryDomElement("input"),u=n.CellDomCreateHelper.createControlContainer(),t;u.append(i);t=new GC.InputMan.GcDateTime(i[0],{displayFormatPattern:"yyyy/MM/dd HH:mm:ss",formatPattern:"yyyy/MM/dd HH:mm:ss"});this._gcDateTime=t;setTimeout(function(){t.addDropDown(GC.InputMan.DropDownButtonAlignment.RightSide,GC.InputMan.DateDropDownType.Picker)},1);t.setValue(null);this.inputContainer=i;this._gcDateTime.onValueChanged(function(){r.target.dateTimeValue=r.getValueFromInputManControl()});return u},i.prototype.getValueFromInputManControl=function(){var t=this._gcDateTime.getValue();return t instanceof Date?n.FormatHelper.formatValue(t,"yyyy/MM/dd HH:mm:ss"):null},i.prototype.setValueToInputManControl=function(t){n.Common.IsEmpty(t)||this._gcDateTime.setValue(t)},i.prototype.getValueFromNativeControl=function(){if(n.Common.IsEmpty(this.dateContainer.val()))return this.timeContainer.val(""),null;n.Common.IsEmpty(this.timeContainer.val())&&this.timeContainer.val("00:00");var t=new Date("".concat(this.dateContainer.val()," ").concat(this.timeContainer.val(),":00"));return n.FormatHelper.formatValue(t,"yyyy/MM/dd HH:mm:ss")},i.prototype.setValueToNativeControl=function(t){if(!n.Common.IsEmpty(t)){var i=t.split(" "),r=i[0],u=i[1];this.dateContainer.val(n.FormatHelper.formatValue(r,"yyyy-MM-dd"));this.timeContainer.val(n.FormatHelper.formatValue(u,"HH:mm"))}},i}(t.ControlUIBase);t.DateTimePickerUI=i})(t=n.UI||(n.UI={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t,l="popuptype",a=(t={},t[0]="dialog",t[1]="dropdown",t[2]="dropdown",t[3]="drawer",t[4]="drawer",t),v=function(){function t(){}return t.createConfirmPopupDom=function(t,i,r,u){var o,c,l,f;u===void 0&&(u=!0);f=(new s).identify("fgc-popup-dialog");f.title=t;f.iconText.icon=i;f.iconText.text=r;f.closeButton.visibility=u;f.popupType="confirmbox";n.ForguncyData.pageInfo.appendExtralPopup(f);var a=f.createUI(h),v=a.container,e=$("#confirmContainer");e.append(v);e.css("display","");n.Platform.isMobile()&&e.addClass("mobile-confirm-container");f.on("Dispose",function(){e.children().length<1&&e.css("display","none")});return(l=(c=(o=n.ForguncyData===null||n.ForguncyData===void 0?void 0:n.ForguncyData.pageInfo)===null||o===void 0?void 0:o.pageElementManager)===null||c===void 0?void 0:c.listviewCollection)===null||l===void 0?void 0:l.loseAllFocus(),f.show(),a},t.createPopupDom=function(t,u,f,s){var h=(new r).identify("fgc-popup-dialog"),v,l,c;h.displayMode=s.popupDisplayMode;h.title=f;h.body=u;h.autoBodySize=!0;v=n.ForguncyData.GlobalSettings.HidePopUpCloseButton;h.closeButton.visibility=!v;h.closeByEscKey=!v;h.popupType=a[s.popupDisplayMode];s.popupDisplayMode===1&&s.anchor?h.centerWhenOpen=!1:s.popupDisplayMode===3||s.popupDisplayMode===4?(h.centerWhenOpen=!1,h.drawerDirection=s.drawerDirection,h.showHeader=s.showDrawerHeader,h.moveable=!1,h.disposeDelayDuration=300,h.closeWhenClickGrayArea=s.closeWhenClickGrayArea,s.popupDisplayMode===4&&(h.cover=!0)):s.popupDisplayMode===2?h.alwaysCenter=!0:s.popupDisplayMode===0&&(h.dialogLocation=s.dialogLocation,s.dialogLocation!=="50%"&&(h.centerWhenOpen=!1));l=i;switch(s.popupDisplayMode){case 1:case 2:l=e;break;case 3:case 4:l=o}c=h.createUI(l);t.append(c.container);s.popupDisplayMode===1&&s.anchor&&(c.applyModifier(new n.UI.AutoLocateModifier(c,s.anchor)),c.container.addClass("fgc-popup-transparentcover"));h.on("Close",function(t,i){var r,u;if(n.ForguncyData.pageInfo.hasExtraDialog||n.ForguncyData.pageInfo.dialogUI.target!==h){i&&(i.cancel=!0);return}((u=(r=n.ForguncyData.pageInfo.dialogUI)===null||r===void 0?void 0:r.target)===null||u===void 0?void 0:u.displayMode)===4&&n.Platform.isMobile()?n.Common.back():n.ClosePopupCommand.ClosePopup(!1);i.cancel=!0});return c},t}(),r,u,i,f,e,o,s,h,c;n.PopupHelper=v;r=function(t){function r(){var r=t.call(this)||this;return r.opacity=1,r.mainTextColor=n.ColorHelper.Convert("Text 1 0"),r.drawerDirection=1,r.dialogLocation="50%",r.resizeable=!1,r.defaultUI=i,r.registProperty("body"),r.registProperty("autoBodySize"),r.registProperty("opacity"),r.registProperty("popupType"),r.registProperty("mainTextColor"),r.registProperty("drawerDirection"),r}return __extends(r,t),r}(n.UI.Dialog);n.PopupDialog=r;u=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),Object.defineProperty(t.prototype,"mainTextColor",{set:function(n){this.container.css("color",n)},enumerable:!1,configurable:!0}),t}(n.UI.DialogHeaderUI);n.PopupDialogHeaderUI=u;i=function(n){function t(t){var i=n.call(this,t)||this;return t.dialogLocation!=="50%"&&i.setPopupDialogLocation(t),i}return __extends(t,n),Object.defineProperty(t.prototype,"header",{get:function(){return new u(this.target)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"content",{get:function(){return new f(this.target)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"footer",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"autoBodySize",{set:function(n){n?(this.dialog.css("display","inline-flex"),this.dialog.css("width","auto"),this.dialog.css("height","auto"),this.centerWhenOpen=this.target.centerWhenOpen):(this.dialog.css("display","flex"),this.dialog.css("width",""),this.dialog.css("height",""))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"zIndex",{set:function(n){this.container.css("z-index",n);this.cover.css("z-index",n);this.dialog.css("z-index",n)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"popupType",{set:function(n){this.container.attr(l,n);this.dialog.attr(l,n)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mainTextColor",{set:function(n){this.dialog.css("color",n)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"opacity",{set:function(n){this.container.css("opacity",n)},enumerable:!1,configurable:!0}),t.prototype.setPopupDialogLocation=function(n){var t=this,i=parseInt(n.dialogLocation)/100;window.requestAnimationFrame(function(){t.target.location=t.getDialogLocation(i)})},t}(n.UI.DialogUI);n.PopupDialogUI=i;f=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),Object.defineProperty(t.prototype,"body",{set:function(n){n&&(this.container.empty(),this.container.append(n))},enumerable:!1,configurable:!0}),t}(n.UI.DialogContentUI);n.PopupDialogContentUI=f;e=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),Object.defineProperty(t.prototype,"header",{get:function(){return null},enumerable:!1,configurable:!0}),t.prototype.createChildren=function(){var t=this;n.prototype.createChildren.call(this);this.cover.on("click",function(n){n.stopPropagation();t.target.close()})},t}(i);n.PopupDropdownUI=e;o=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.getRealHeight=function(n){return parseFloat(getComputedStyle(n).height)},i.prototype.observerCallback=function(){if(this.dialog.find(".".concat("fgc-page-container")).length!==0){var i=this.getRealHeight(this.dialog[0]),r=this.getRealHeight(this.dialog.find(".".concat("fgc-page-container"))[0]),n=r>i?"":0,t=parseFloat(this.dialog.css("bottom"));t<0||t!==parseFloat(n.toString())&&this.dialog.css("bottom",n)}},Object.defineProperty(i.prototype,"header",{get:function(){return this.target.showHeader?new u(this.target):null},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"drawerDirection",{set:function(n){this.dialog.addClass("fgc-drawer");this.target.showHeader&&this.dialog.addClass("fgc-drawer-includ-title");var t=this.target.cover;switch(n){case 1:this.dialog.css("width","100vw");this.dialog.css("height",t?"100%":"auto");this.dialog.addClass("fgc-drawer-ttb");break;case 0:this.dialog.css("width","100vw");this.dialog.css("height",t?"100%":"auto");t||(this.dialog.css("bottom","0"),this.dialog.css("max-height","100%"));this.dialog.addClass("fgc-drawer-btt");this.observer=new MutationObserver(this.observerCallback.bind(this));this.observer.observe(this.dialog[0],{attributes:!0});break;case 2:this.dialog.css("height","100%");this.dialog.css("width",t?"100vw":"auto");this.dialog.addClass("fgc-drawer-ltr");break;case 3:this.dialog.css("height","100%");this.dialog.css("width",t?"100vw":"auto");t||this.dialog.css("right","0");this.dialog.addClass("fgc-drawer-rtl")}},enumerable:!1,configurable:!0}),i.prototype.createChildren=function(){var n=this;t.prototype.createChildren.call(this);this.cover.on("click",function(t){n.target.closeWhenClickGrayArea&&(t.stopPropagation(),n.target.close())})},i.prototype.dispose=function(){var n,i=$(document.body);i.css("overflow",this.cachedBodyOverflow);i.css("padding-right",this.cachedPaddingRight);this.target.off("PropertyChanged",this.visibilityChangedHandler);(n=this.observer)===null||n===void 0?void 0:n.disconnect();t.prototype.dispose.call(this)},i.prototype.createContainerEvents=function(){var i=this;t.prototype.createContainerEvents.call(this);this.visibilityChangedHandler=function(t,r){var u,f,e;r==="visibility"&&(u=$(document.body),i.target.visibility?(i.cachedPaddingRight=u.css("padding-right"),f=n.DomUtilities.measureBrowserScrollbarWidth(),e=document.documentElement.clientHeight<document.body.scrollHeight,f>0&&e&&u.css("padding-right",f),i.cachedBodyOverflow=$(document.body).css("overflow"),u.css("overflow","hidden"),n.MetadataLoader.IsInMobileSimulatorFrame()&&$(".simplebar-scrollbar").css("opacity",0)):(u.css("overflow",i.cachedBodyOverflow),u.css("padding-right",i.cachedPaddingRight),n.MetadataLoader.IsInMobileSimulatorFrame()&&$(".simplebar-scrollbar").css("opacity",undefined)))};this.target.on("PropertyChanged",this.visibilityChangedHandler)},i}(i);n.DrawerUI=o;s=function(t){function i(){var i=t!==null&&t.apply(this,arguments)||this;return i.iconText=(new n.UI.IconText).identify("fgc-confirmbox-icontext"),i.mainTextColor="#333",i.autoBodySize=!0,i}return __extends(i,t),i}(r);n.PopupConfirmBox=s;h=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),Object.defineProperty(i.prototype,"content",{get:function(){return new c(this.target)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"footer",{get:function(){return new n.UI.DialogFooterUI(this.target)},enumerable:!1,configurable:!0}),i}(i);n.PopupConfirmBoxUI=h;c=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.createChildren=function(){this.addChild(this.target.iconText.createUI(n.UI.ImageTextUI))},i}(f);n.PopupConfirmBoxContentUI=c})(Forguncy||(Forguncy={}))
;var __assign=this&&this.__assign||function(){return __assign=Object.assign||function(n){for(var t,r,i=1,u=arguments.length;i<u;i++){t=arguments[i];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},__assign.apply(this,arguments)},Forguncy;(function(n){var t=function(){function t(){}return t.appendSendEmailConfirm=function(t){var r={email:"",sendText:n.RS.ConcurrentLicenseError_SendEmail,cancelText:n.RS.ConcurrentLicenseError_Cancel,warningText:n.RS.ConcurrentLicenseError_NoEnoughLicense,fromAddressPlaceHolderText:n.RS.ConcurrentLicenseError_AddressPlaceHolder,messagePlaceHolderText:n.RS.ConcurrentLicenseError_MessagePlaceHolder,onSendEmail:function(t,i){var r=$("#fgc-sendemail-address").val(),u=$("#fgc-sendemail-message").val();n.PageBuilder.showPageLoadingCover();n.Common.forguncyPost("Home/NoticeAdmin",{title:n.RS.ConcurrentLicenseError_EmailTitle,address:r,message:u},function(r){n.PageBuilder.hidePageLoadingCover();r&&r.Result?(window.alert(n.RS.ConcurrentLicenseError_SendSuccess),t&&t()):(window.alert(n.RS.ConcurrentLicenseError_SendFailed+"\n"+r.Message),i&&i())})},onCancel:function(){}},i=__assign(__assign({},r),t);n.ListviewBase.lockListviewClick();n.PageBuilder.hidePageLoadingCover();n.Platform.isMobile()?this.createForMobile(i):this.createForPC(i)},t.createForMobile=function(t){var u=n.MetadataHelper.getDefaultFonts(),r;$(document.head).append($("<style>html {font-family: ".concat(u,";}<\/style>")));r='\n                <div id="'.concat("fgc-sendemail-container",'" style="position:fixed;top:0;left:0;right:0;bottom:0;background-color:rgba(0,0,0,0.2);color:#333;">\n                    <div style="height:100%;padding:0 10px;background-color:#fff;">\n                        <p class="info" style="margin:0;padding:10px;text-align:left;">\n                        ').concat(t.warningText,'\n                        <\/p>\n                        <div style="margin:0 10px 10px 10px;">\n                            <textarea id="').concat("fgc-sendemail-message",'"placeholder="').concat(t.messagePlaceHolderText,'" style="display:block;height:300px;width:100%;resize:none;font-size:13.33px;box-sizing:border-box;"><\/textarea>\n                        <\/div>\n                        <div style="display:flex;align-items:center;margin:0 10px;">\n                            <label for="').concat("fgc-sendemail-address",'" style="font-size:14px;">').concat(n.RS.ConcurrentLicenseError_SenderAddress,'<\/label>\n                            <input id="').concat("fgc-sendemail-address",'" type="text" placeholder="').concat(t.fromAddressPlaceHolderText,'" style="flex-grow:1;margin-left:5px;padding:4px 1px;font-size:13.33px;box-sizing:border-box;" />\n                        <\/div>\n                        <div style="text-align:right;margin:10px 10px 0 10px;">\n                            <button id="').concat("fgc-sendemail-send",'" style="padding:4px 10px;margin-right:10px;">').concat(t.sendText,'<\/button>\n                            <button id="').concat("fgc-sendemail-cancel",'" style="padding:4px 10px;">').concat(t.cancelText,"<\/button>\n                        <\/div>\n                    <\/div>\n                <\/div>\n            ");(n.Platform.isIOSDevice()||n.Platform.isMac())&&$("meta[name='viewport']").replaceWith("<meta name='viewport' content='width=device-width; initial-scale=1.0; maximum-scale=1.0; minimum-scale=1.0; user-scalable=no; target-densityDpi=device-dpi' />");var i=$(r),f=i.find("#fgc-sendemail-send"),e=i.find("#fgc-sendemail-cancel");i.find("#fgc-sendemail-address").val(t.email);f.click(t.onSendEmail);e.click(function(){$("#fgc-sendemail-container").remove();t&&t.onCancel()});$(document.body).append(i)},t.createForPC=function(t){var u=n.MetadataHelper.getDefaultFonts(),r,i;$(document.head).append($("<style>html {font-family: ".concat(u,";}<\/style>")));r=$('\n                    <div style="width:400px;padding-bottom:10px;background-color:#fff;">\n                        <p class="info" style="margin:0;padding:10px 16px;text-align:left;">\n                        '.concat(t.warningText,'\n                        <\/p>\n                        <div style="margin:0 16px 10px 16px;">\n                            <textarea id="').concat("fgc-sendemail-message",'" placeholder="').concat(t.messagePlaceHolderText,'" style="display:block;height:150px;width:100%;resize:none;font-size:14px;box-sizing:border-box;"><\/textarea>\n                        <\/div>\n                        <div style="display:flex;align-items:center;margin:0 16px;">\n                            <label for="').concat("fgc-sendemail-address",'" style="font-size:14px;">').concat(n.RS.ConcurrentLicenseError_SenderAddress,'<\/label>\n                            <input id="').concat("fgc-sendemail-address",'" type="text" placeholder="').concat(t.fromAddressPlaceHolderText,'" style="flex-grow:1;margin-left:5px;padding:6px 1px;font-size:14px;box-sizing:border-box;" />\n                        <\/div>\n                    <\/div>\n                '));r.find("#fgc-sendemail-address").val(t.email);i=n.PopupHelper.createConfirmPopupDom("","","",!0);i.target.footerButtonGroup.items[0].text=t.sendText;i.target.footerButtonGroup.items[1].text=t.cancelText;i.container.find(".".concat("FUI-dialog")).width(400).css("height","auto");i.container.find(".".concat("FUI-dialog-content")).empty().append(r).css({width:"",height:""});i.centerWhenOpen=!0;i.target.on("Confirm",function(){i.target.visibility=!1;t.onSendEmail&&t.onSendEmail(function(){i&&i.target.close()},function(){i.target.visibility=!0})});i.target.on("Close",function(){t.onCancel&&t.onCancel()});i.target.on("Cancel",function(){t.onCancel&&t.onCancel()})},t}();n.SendEmailHelper=t})(Forguncy||(Forguncy={}))
;var __spreadArray=this&&this.__spreadArray||function(n,t,i){if(i||arguments.length===2)for(var r=0,f=t.length,u;r<f;r++)!u&&r in t||(u||(u=Array.prototype.slice.call(t,0,r)),u[r]=t[r]);return n.concat(u||Array.prototype.slice.call(t))},Forguncy;(function(n){var f=function(){function t(n,i,r,u){this.metadata=n;this.runTimePageName=i;this.designerPageName=r;this.uniqueIndex=u===undefined?this.generateUniqueIndex():u;this.name=t.NamePrefix+this.uniqueIndex.toString();this.rowHeaderCheckBoxColumnIndex=this.isRowHeaderVisible()===!0?1:0;this.preprocessMetadata();this.initColumnBindingInfos();this.initColumns(i);this.initVisibleColumns();this.initRowHeaderInfo();this.initRowHeaderCheckBoxInfo()}return t.prototype.isRowHeaderContextMenuVisible=function(){return this.metadata.RowHeaderContextMenu&&this.metadata.RowHeaderContextMenu.ContextMenuItems&&this.metadata.RowHeaderContextMenu.ContextMenuItems.some(function(n){return n.Visible===!0})},t.prototype.getRowHeaderContextMenuData=function(){return this.metadata.RowHeaderContextMenu},t.prototype.isDoubleClickCommandsExists=function(){return this.metadata.DoubleClickCommands&&this.metadata.DoubleClickCommands.length>0},t.prototype.getDoubleClickCommands=function(){return this.metadata.DoubleClickCommands},t.prototype.generateUniqueIndex=function(){return t.Index++},t.prototype.getTabIndex=function(){return(n.ForguncyData.pageInfo.enableTabIndex||{})[this.runTimePageName]?this.metadata.TabIndex:null},t.prototype.getBindingInfoColumnTypeInDataModel=function(t){var i,u,r;if(this.metadata.Columns&&t>-1&&t<this.metadata.ColumnCount)for(i=0,u=this.metadata.Columns;i<u.length;i++)if(r=u[i],r&&r.Index===t)return r.BindingColumnDataType;return n.ColumnDataType.Other},t.prototype.preprocessMetadata=function(){var t=this.metadata;t.DataTableCanEdit=!!t.DataTableCanEdit;t.CanDelete=!!t.CanDelete;t.CanAddRow=!!t.CanAddRow;t.CanEdit=!!t.CanEdit;t.AlwaysInEditMode=!!t.AlwaysInEditMode;t.IsGroupMode=!!t.IsGroupMode;t.LoadOnDemandCount===undefined&&(t.LoadOnDemandCount=0);t.CellRange||(t.CellRange={Row:0,Column:0,RowCount:0,ColumnCount:0});n.Common.AdjustCellRange(t.CellRange);t.SelectionMode===undefined&&(t.SelectionMode=0);t.AlwaysReservedSelections=!!t.AlwaysReservedSelections;t.IsSingleSelection=!!t.IsSingleSelection;t.DisableAutoSelectRow=!!t.DisableAutoSelectRow;t.AutoFitRowHeight=!!t.AutoFitRowHeight;t.AutoFitColumnWidth=!!t.AutoFitColumnWidth;this.metadata.ColumnOperation!==undefined&&this.metadata.DataTableName||(this.metadata.ColumnOperation=0)},t.prototype.initColumnBindingInfos=function(){var t,i,u;this.columnBindingInfos=[];var f=this.metadata.Columns,e=function(t){var i,u;if(!t.TemplateCell||!t.TemplateCell.Element||(i=t.TemplateCell.Element.BindingInfo,!i))return"continue";u=r.columnBindingInfos.some(function(t){return n.Common.isBindingInfoEquals(t,i)});u||r.columnBindingInfos.push(i)},r=this;for(t=0,i=f;t<i.length;t++)u=i[t],e(u)},t.prototype.initColumns=function(t){var s,h,c,v,l,y,f,a,e,o,i,u;for(this.columnDataInfos=[],v=this.getColumnCount(),l=0;l<v;l++)this.columnDataInfos.push(new r);for(y=this.metadata.Columns,f=0,a=y;f<a.length;f++)if(e=a[f],o=this.columnDataInfos[e.Index],e.TemplateCell&&(i=e.TemplateCell.Element,i&&(n.Common.IsEmpty(i.Value)||(o.staticValue=n.KeyWords.IsKeyWord(i.Value)?n.KeyWords.GetKeyWordValue(i.Value,t):n.Common.getMultiLanguageWord(i.Value)),(s=i.runtimeCellTypeCache)!==null&&s!==void 0?s:i.runtimeCellTypeCache=i.CellType,n.StaticData.IsDesignerPreview||(i.CellType=this.canEdit()?(h=i.EditableCellType)!==null&&h!==void 0?h:i.runtimeCellTypeCache:(c=i.ReadonlyCellType)!==null&&c!==void 0?c:i.runtimeCellTypeCache),o.columnName=i.Name&&i.Name.length>0?i.Name[0]:undefined,i.BindingInfo)))for(u=0;u<this.columnBindingInfos.length;u++)if(n.Common.isBindingInfoEquals(this.columnBindingInfos[u],i.BindingInfo)){o.bindingInfoIndex=u;break}},t.prototype.initVisibleColumns=function(){var e,s,t,u,f,o,r;if(this.visibleColumns=[],e=this.metadata.Columns,e)for(s=e.length,t=0;t<s;t++)this.isRowHeaderVisible()&&t===0||this.isRowHeaderCheckBoxVisible()&&t===this.rowHeaderCheckBoxColumnIndex||(u=e[t],u.Width<=0&&!u.IsHiddenByUIResizeColumn)||(f=new i(u,this.name,this.canEdit(),this.metadata.ColumnOfDetailTable,this),o=f.cellType.constructor,(o===n.RadioGroupCellType||o===n.CheckBoxGroupCellType||o===n.ComboBoxCellType_InputMan)&&(r=f.getTemplateCell(),(r===null||r===void 0?void 0:r.CellType)&&(r.CellType.haveLoadItems=!r.CellType.IsBounding)),f.dependenceColumnsIndex=u.DependenceColumnsIndex,this.visibleColumns.push(f))},t.prototype.initRowHeaderInfo=function(){if(this.isRowHeaderVisible()){var n=this.metadata.Columns;if(!n||n.length<=0)return;this.rowHeaderColumnInfo=new i(n[0],this.name,this.canEdit(),this.metadata.ColumnOfDetailTable,this)}},t.prototype.initRowHeaderCheckBoxInfo=function(){if(this.isRowHeaderCheckBoxVisible()){var n=this.metadata.Columns;if(!n||n.length<=this.rowHeaderCheckBoxColumnIndex+1)return;this.rowHeaderCheckBoxColumnInfo=new i(n[this.rowHeaderCheckBoxColumnIndex],this.name,this.canEdit(),this.metadata.ColumnOfDetailTable,this)}},t.prototype.isColumnHeaderVisibleInDesigner=function(){return!!this.metadata.IsColumnHeaderVisibleInDesigner},t.prototype.getListviewName=function(){return this.metadata.Name},t.prototype.getDataTableName=function(){return this.metadata.DataTableName},t.prototype.getMasterDataTableName=function(){return this.metadata.MasterDataTableName},t.prototype.getColumnOfMasterTable=function(){return this.metadata.ColumnOfMasterTable},t.prototype.getColumnOfDetailTable=function(){return this.metadata.ColumnOfDetailTable},t.prototype.getRangeInfo=function(){return this.metadata.CellRange},t.prototype.getContentRangeInfo=function(){var n=this.getRangeInfo(),t;return this.metadata.IsColumnHeaderVisibleInDesigner?(t=this.getDesignerColumnHeaderRowCount(),{Column:n.Column,ColumnCount:n.ColumnCount,Row:n.Row+t,RowCount:n.RowCount-t}):n},t.prototype.getColumnHeaderRangeInfo=function(){var t=this.getDesignerColumnHeaderRowCount(),n=this.getRangeInfo();return{Row:n.Row,Column:n.Column,RowCount:t,ColumnCount:n.ColumnCount}},t.prototype.getDesignerColumnHeaderRowCount=function(){return this.metadata.ColumnHeaderHeights?this.metadata.ColumnHeaderHeights.length:0},t.prototype.getColumnMetaData=function(n){var i=this.metadata.Columns,r,t;if(!i)return null;for(r=i.length,t=0;t<r;t++)if(i[t].Index===n)return i[t];return null},t.prototype.getLoadOnDemandCount=function(){return this.metadata.LoadOnDemandCount},t.prototype.shouldLoadOnDemand=function(){return!!this.metadata.LoadOnDemandCount},t.prototype.getTemplateRowHeight=function(){return this.metadata.TemplateRowHeight},t.prototype.getColumnHeaderHeight=function(){return this.metadata.IsColumnHeaderVisibleInDesigner?this.metadata.ColumnHeaderHeights:[t.DefaultColumnHeaderHeight]},t.prototype.getConditionFormulas=function(){return this.metadata.ConditionFormulas},t.prototype.getConditionFormulaList=function(){if(this.metadata.ConditionFormulaList===undefined){this.metadata.ConditionFormulaList=[];for(var n in this.metadata.ConditionFormulas)this.metadata.ConditionFormulaList.push(n)}return this.metadata.ConditionFormulaList},t.prototype.getDependenceCells=function(){return this.metadata.DependenceCells},t.prototype.getListViewStyleTemplate=function(){var i=this.metadata.ListViewStyleName,r,t;if(i)for(r=n.ListViewStyleTemplateUtils.ListViewStyleTemplates.length,t=0;t<r;t++)if(n.ListViewStyleTemplateUtils.ListViewStyleTemplates[t].Name===i)return n.Common.clone(n.ListViewStyleTemplateUtils.ListViewStyleTemplates[t]);return null},t.prototype.getAlternativeBackcolor=function(n){return n?this.getBackcolorStr(this.metadata.EvenRowBackcolor):this.getBackcolorStr(this.metadata.OddRowBackcolor)},t.prototype.getBackcolorStr=function(n){return n&&n!=="#FFFFFF"?n:null},t.prototype.isColumnHeaderVisible=function(){return this.metadata.IsColumnHeaderVisible},t.prototype.isRowHeaderVisible=function(){var n=this.metadata.Columns;return(!n||n.length<=0)&&(this.metadata.IsRowHeaderVisible=!1),this.metadata.IsRowHeaderVisible===!0?!0:!1},t.prototype.isRowHeaderCheckBoxVisible=function(){var n=this.metadata.Columns;return(!n||n.length<this.rowHeaderCheckBoxColumnIndex+1)&&(this.metadata.IsRowHeaderCheckBoxVisible=!1),this.metadata.IsRowHeaderCheckBoxVisible===!0?!0:!1},t.prototype.isRowHeaderFillNumber=function(){return this.metadata.IsRowHeaderFillNumber===!0?!0:!1},t.prototype.isMasterTable=function(){return n.Common.IsEmpty(this.getMasterDataTableName())},t.prototype.getColIndexOfColumnOfDetailTable=function(){var n=this.getColumnOfDetailTable();return n?this.getColIndexByDataColumnName(n):-1},t.prototype.canEdit=function(){return!n.Platform.isMobile()&&this.metadata.CanEdit},t.prototype.canDelete=function(){return this.metadata.CanDelete},t.prototype.canAddRow=function(){return this.metadata.CanAddRow},t.prototype.allowShowTotalRow=function(){return!!this.metadata.IsTotalRowVisible},t.prototype.getIsTotalRowAtFirstRow=function(){return!!this.metadata.IsTotalRowAtFirstRow},t.prototype.getIsTotalRowAtLastRow=function(){return!this.metadata.IsTotalRowAtFirstRow},t.prototype.getTotalRowBindingInfosIgnoreNullValues=function(){return this.getTotalRowSettingsIgnoreNullValues().map(function(n){return n&&n.BindingInfo}).filter(function(t){return!n.Common.IsEmpty(t)})},t.prototype.getTotalRowSettingsIgnoreNullValues=function(){return this.metadata.Columns.map(function(n){return n.TotalRowCell}).filter(function(t){return!n.Common.IsEmpty(t)})},t.prototype.ShowEditStatusIcon=function(){return this.metadata.ShowEditStatusIcon},t.prototype.isGroupMode=function(){return this.metadata.IsGroupMode},t.prototype.getBindingInfo=function(n){var t=this.getBindingInfoIndexOfColumn(n);return t===-1?null:this.columnBindingInfos[t]},t.prototype.isBindingColumn=function(n){return this.getBindingInfoIndexOfColumn(n)!==-1},t.prototype.getBindingInfoIndexOfColumn=function(n){var t=this.columnDataInfos[n];return t?t.bindingInfoIndex:-1},t.prototype.getStaticValue=function(n){var t=this.columnDataInfos[n];return t?t.staticValue:null},t.prototype.getColIndexByDataColumnName=function(n){return this.getColIndexByBindingInfo({TableName:this.metadata.DataTableName,ColumnName:n})},t.prototype.getColIndexByBindingInfo=function(t){var u,i,r;if(!t)return-1;for(u=this.getColumnCount(),i=0;i<u;i++)if((r=this.getBindingInfo(i),r)&&n.Common.isBindingInfoEquals(r,t))return i;return-1},t.prototype.getColIndexByName=function(n,t){var u,i,r;if(!n)return-1;for(t||(n=n.toLowerCase()),u=this.getColumnCount(),i=0;i<u;i++)if((r=this.columnDataInfos[i].columnName,r)&&(t||(r=r.toLowerCase()),r===n))return i;return-1},t.prototype.getColIndexByVisibleColIndex=function(n){return n<0||n>=this.visibleColumns.length?-1:this.visibleColumns[n].getColumnIndex()},t.prototype.getMergedColIndex=function(n){var i,r,t;if(n<0||(i=this.metadata.OriginalColumns||this.metadata.Columns,!i))return-1;for(r=i.length,t=0;t<r;t++)if(i[t].Index===n)return t;return-1},t.prototype.getMergedColumnInfos=function(){return n.Common.IsEmpty(this._mergedColumnInfos)&&(this._mergedColumnInfos=this._createMergedColumnInfos(),this._mergedColumnInfos=this._mergedColumnInfos.sort(function(n,t){return n.DesignerColumnIndex-t.DesignerColumnIndex})),this._mergedColumnInfos},t.prototype._createMergedColumnInfos=function(){var f=this.metadata.Columns,t,e,r,u,i,o,s;if(!f)return[];for(t=[],e=this.getRangeInfo().Column,r=0,u=f;r<u.length;r++)i=u[r],o=this.columnDataInfos[i.Index],t.push({DesignerColumnIndex:i.Index+e,DesignerColumnCount:i.ColumnCount,ColumnName:o.columnName,ColumnDataType:this.getBindingInfoColumnTypeInDataModel(i.Index),ColumnType:n.ListviewColumnType.DataColumn});return this.isRowHeaderVisible()&&(t[0].ColumnType=n.ListviewColumnType.RowHeader),this.isRowHeaderCheckBoxVisible()&&(s=this.isRowHeaderVisible()?1:0,t[s].ColumnType=n.ListviewColumnType.SelectedColumn),t},t.prototype.getColumnCellType=function(t,i){var r=this.getColumnMetaData(t),u;return r&&r.TemplateCell?(u=n.ListviewEditorHelper.getCell(r.TemplateCell.Element,i,this.designerPageName,this.getListviewName()),!u)?null:u.cellType:null},t.prototype.getDataColIndex=function(t){if(n.Common.IsEmpty(t))return-1;t=Number(t);var i=this.metadata.OriginalColumns||this.metadata.Columns;return!i||isNaN(t)||t<0||t>=i.length?-1:i[t].Index},t.prototype.getColumnCount=function(){return this.metadata.ColumnCount},t.prototype.getGrayAreaBackColor=function(){return n.Common.IsEmpty(this.metadata.GrayAreaColor)?"transparent":n.ColorHelper.Convert(this.metadata.GrayAreaColor)},t.prototype.hideSelectionWhenLostFocus=function(){return this.metadata.HideSelectionWhenLostFocus===!0?!0:!1},t.prototype.getSelectionBackColor=function(){return n.Common.IsEmpty(this.metadata.SelectionBackColor)?undefined:this.metadata.SelectionBackColor==="transparent"?"transparent":n.ColorHelper.Convert(this.metadata.SelectionBackColor)},t.prototype.getSelectionBorderColor=function(){return n.ColorHelper.Convert(this.metadata.SelectionBorderColor)},t.prototype.canUserDragDrop=function(){return this.canEdit()&&(this.metadata.AllowDragMove===!0?!0:!1)},t.prototype.canUserDragFill=function(){return this.canEdit()&&(this.metadata.AllowDragFill===!0?!0:!1)},t.prototype.getSelectionMode=function(){return this.metadata.SelectionMode},t.prototype.getAlwaysReservedSelections=function(){return this.metadata.AlwaysReservedSelections},t.prototype.isSingleSelection=function(){return this.metadata.IsSingleSelection},t.prototype.getDisableAutoSelectRow=function(){return this.getSelectionMode()===1&&this.metadata.DisableAutoSelectRow},t.prototype.getAutoFitRowHeight=function(){return this.metadata.AutoFitRowHeight},t.prototype.getAutoFitColumnWidth=function(){return this.metadata.AutoFitColumnWidth},t.prototype.getAlwaysInEditMode=function(){return this.metadata.AlwaysInEditMode},t.prototype.bindingTableCanEdit=function(){return this.metadata.DataTableCanEdit},t.prototype.getAllowGetFocus=function(){return this.metadata.AllowGetFocus===!0?!0:!1},t.prototype.getMoveFocusHorizontally=function(){return this.metadata.MoveFocusHorizontally===!0?!0:!1},t.prototype.getMoveFocusOnlyEditableCell=function(){return this.metadata.MoveFocusOnlyEditableCell===!0?!0:!1},t.prototype.getColumnOperation=function(){return this.metadata.ColumnOperation},t.prototype.getDataCommitMode=function(){return this.metadata.DataCommitType===undefined?0:this.metadata.DataCommitType},t.prototype.getDataValidationTime=function(){return this.metadata.DataValidationTime===undefined?0:this.metadata.DataValidationTime},t.prototype.getDoNotLoadDataWhenLoadPage=function(){return this.metadata.DoNotLoadDataWhenLoadPage===!0},t.prototype.getDelayLoadData=function(){return this.metadata.DelayLoadData===!0},t.prototype.getIsAutoReload=function(){return this.getAutoReloadInterval()>0},t.prototype.getAutoReloadInterval=function(){return this.metadata.IsAutoReload===!0?this.metadata.AutoReloadInterval||0:0},t.prototype.getIsAutoScroll=function(){return this.metadata.IsAutoScroll===!0},t.prototype.getAutoScrollSpeed=function(){return this.metadata.AutoScrollSpeed===undefined?0:this.metadata.AutoScrollSpeed},t.prototype.getFrozenIndex=function(){return this.metadata.FrozenIndex},t.prototype.getFrozenIndexEnd=function(){return this.metadata.FrozenIndexEnd},t.prototype.getFrozenLineColor=function(){return this.metadata.FrozenLineColor?n.ColorHelper.Convert(this.metadata.FrozenLineColor):"#9B9B9B"},t.prototype.getDataColumnBindingInfo=function(n){var t,i;return!this.columnDataInfos||!this.columnBindingInfos?null:this.isValidIndex(n,this.columnDataInfos.length)?(t=this.columnDataInfos[n],!this.isValidIndex(t.bindingInfoIndex,this.columnBindingInfos.length))?null:(i=this.columnBindingInfos[t.bindingInfoIndex],i?i:null):null},t.prototype.isValidIndex=function(n,t){return n>=0&&n<t},t.prototype.isDataColumnAllowEdit=function(t){var i=this.getDataColumnBindingInfo(t);return n.Common.cannotEditedBindingInfo(i)?!1:!0},t.prototype.getAllHeaderCellContentElement=function(){var u=[],o=this.metadata.Columns,t,f,n,s,i,e,r;if(!o)return u;for(t=0,f=o;t<f.length;t++)if(n=f[t],n&&n.HeaderCell)for(s=n.HeaderCell,i=0,e=s;i<e.length;i++)r=e[i],r&&r.Element&&u.push({isExternal:n.IsExternal,cell:r.Element});return u},t.NamePrefix="s",t.Index=0,t.DefaultColumnHeaderHeight=25,t}(),r,t,i,u;n.ListviewData=f;r=function(){function n(){this.bindingInfoIndex=-1;this.staticValue=null}return n}();n.ListviewColumnDataInfo=r;t=function(){function t(){}return t.getTemplateCell=function(n){return!n.TemplateCell||!n.TemplateCell.Element?null:n.TemplateCell.Element},t.getBindingInfo=function(n){var i=t.getTemplateCell(n);return i&&i.BindingInfo?i.BindingInfo:null},t.getName=function(n){var i=t.getTemplateCell(n);return!i||!i.Name||i.Name.length===0||!i.Name[0]?null:i.Name[0]},t.getColumnUniqueLocationKey=function(i){var r=t.getName(i),u;return r?r:(u=n.FormulaHelper.createCellExpression(null,null,i.TemplateCell.Element.Row,i.TemplateCell.Element.Column,!0,!0),n.FormulaHelper.unparse(u))},t.getFilterActualBindingInfo=function(n){return n.FilterDisplayBindingInfo||n.FilterBindingInfo||t.getBindingInfo(n)},t}();n.ColumnInfoHelper=t;i=function(){function i(t,i,r,u,f){var s,e,o,h;(this.columnInfo=t,this.idSuffix=i,this.canEditInForguncy=!1,this.canEnterEditMode=!1,this.needValidateWhenShowEditor=!1,e=this.getTemplateCell(),this.cellType=n.CellTypeHelper.getCellType(e?e:{},1,n.ListviewEditorHelper.getEditorID(),f),e)&&r&&((o=this.getBindingInfo(),((s=this.getTemplateCell())===null||s===void 0?void 0:s.OriginalBindingInfoForPreview)&&(o=this.getTemplateCell().OriginalBindingInfoForPreview),n.Common.cannotEditedBindingInfo(o))||o.ColumnName!==u&&(h=e.CellType,h&&!h.ReadOnly)&&this.cellType.cellTypeData instanceof n.InputCellTypeData&&(this.canEditInForguncy=!0,this.canEnterEditMode=this.cellType.cellTypeData.canEnterEditModeInListview()))}return Object.defineProperty(i.prototype,"totalRowSetting",{get:function(){return this.columnInfo&&this.columnInfo.TotalRowCell},enumerable:!1,configurable:!0}),i.prototype.getTemplateCell=function(){return t.getTemplateCell(this.columnInfo)},i.prototype.getOriginalFormatter=function(){var n;if((n=this.columnInfo.TemplateCell)!==null&&n!==void 0)return n.OriginalFormatter},i.prototype.getClickCommandsMetaData=function(){var t,n=(t=this.getTemplateCell())===null||t===void 0?void 0:t.CellType;return!n||n.CommandExcuteKind!==0||!n.CommandList?null:n.CommandList},i.prototype.getBindingInfo=function(){return t.getBindingInfo(this.columnInfo)},i.prototype.getFilterBindingInfo=function(){return this.columnInfo.FilterBindingInfo||this.getBindingInfo()},i.prototype.getFilterDisplayBindingInfo=function(){return this.columnInfo.FilterDisplayBindingInfo},i.prototype.getFilterActualBindingInfo=function(){return t.getFilterActualBindingInfo(this.columnInfo)},i.prototype.getFilterColumnDataType=function(){var t=this.columnInfo.FilterColumnDataType;return t!==undefined?t:this.columnInfo.BindingColumnDataType||n.ColumnDataType.Other},i.prototype.getIsFilterStatisticColumn=function(){return!!this.columnInfo.IsFilterStatisticColumn},i.prototype.getIsFilterListCompareType=function(){return!!this.columnInfo.IsFilterListCompareType},i.prototype.getColumnIndex=function(){return this.columnInfo.Index},i.prototype.getName=function(){return t.getName(this.columnInfo)},i.prototype.allowFieldSort=function(){return this.columnInfo.AllowSort},i.prototype.allowNoFieldSort=function(){var t,i,r,n,u;return this.allowFieldSort()?!1:(n=(i=(t=this.columnInfo)===null||t===void 0?void 0:t.TemplateCell)===null||i===void 0?void 0:i.Element,!n)?!0:n.BindingInfo?!1:(u=["Forguncy.ButtonCellType, ServerDesignerCommon","Forguncy.HyperlinkCellType, ServerDesignerCommon","Forguncy.ImageCellType, ServerDesignerCommon","Forguncy.UploadImageCellType, ServerDesignerCommon","Forguncy.AttachmentCelltype, ServerDesignerCommon"],u.indexOf((r=n.CellType)===null||r===void 0?void 0:r.$type)>=0)?!1:!0},i.prototype.getRightBorderWidth=function(t,i){var r=i?GC.Spread.Sheets.LineStyle.thin:GC.Spread.Sheets.LineStyle.empty;return t?r=this.columnInfo.HeaderCell&&this.columnInfo.HeaderCell.length>0&&this.columnInfo.HeaderCell[0].BorderRight?this.columnInfo.HeaderCell[0].BorderRight.Style:GC.Spread.Sheets.LineStyle.thin:this.columnInfo.TemplateCell&&this.columnInfo.TemplateCell.BorderRight&&(r=this.columnInfo.TemplateCell.BorderRight.Style),n.SpreadJSHelper.getBorderWidth(r)},i.prototype.getBottomBorderWidth=function(t){var i=t?GC.Spread.Sheets.LineStyle.thin:GC.Spread.Sheets.LineStyle.empty;return this.columnInfo.TemplateCell&&this.columnInfo.TemplateCell.BorderBottom&&(i=this.columnInfo.TemplateCell.BorderBottom.Style),n.SpreadJSHelper.getBorderWidth(i)},i.prototype.getDefaultValueFromCellType=function(){var t=this.cellType.getDefaultValue(),i;return!n.Common.IsEmpty(t)&&typeof t.Value!="undefined"&&!(typeof t.Value=="string"&&t.Value.length>0&&t.Value[0]==="=")?t.Value:(i=this.cellType.cellTypeData,i instanceof n.InputCellTypeData)?i.getDefaultValue():null},i.prototype.getDefaultFormulaFromCellType=function(){var i,t=this.cellType.getDefaultValue();return!n.Common.IsEmpty(t)&&typeof t.Value=="string"&&t.Value.length>0&&t.Value[0]==="="?t.Value:(i=this.getTemplateCell())===null||i===void 0?void 0:i.DefaultFormula},i.prototype.getDefaultValue=function(t,i,r){var f,h=this.getTemplateCell(),u,e,o,s;return h?(u=null,e=this.getDefaultFormulaFromCellType(),n.Common.IsEmpty(e)?(u=this.getDefaultValueFromCellType(i),o=this.cellType.cellTypeData,o instanceof n.CheckBoxCellTypeData&&(u=u===!0||u===1?1:null)):(s={runTimePageName:i,nullAsException:!1,listInfo:(f={},f[t]=0,f),rowOffset:r,columnOffset:0},u=n.ForguncyData.pageInfo.formulaManager.evaluateFormula(e,s)),u instanceof Date&&(u=n.Convertor.fromDateToOADate(u)),u):null},i}();n.VisibleListviewColumnInfo=i;u=function(){function i(n,t,i){this._locationString=n;this._visibleColumn=t;this.pageName=i}return Object.defineProperty(i.prototype,"columnFilterQuery",{get:function(){var n;return(n=this.getCachedFilterInfo(this._visibleColumn,!1))!==null&&n!==void 0?n:this.createColumnFilterInfo(this.pageName)},enumerable:!1,configurable:!0}),i.prototype.getActualCompareType=function(n){return n.filterComapreType>99?0:n.filterComapreType},i.prototype.createColumnFilterInfo=function(n){var i;return{ColumnName:t.getColumnUniqueLocationKey(this._visibleColumn.columnInfo),ColumnIndex:this._visibleColumn.getColumnIndex(),ColumnBindingInfoID:(i=this._visibleColumn.getFilterActualBindingInfo())===null||i===void 0?void 0:i.GUID,pageName:n,IsNotInMode:!1,Values:null,IsOrMode:!1,Conditions:null,filterComapreType:null}},i.prototype.clearColumnFilter=function(){var t=this,i=n.ForguncyData.pageInfo.columnFilterQueryCache[this._locationString];i&&(n.ForguncyData.pageInfo.columnFilterQueryCache[this._locationString]=i.filter(function(n){return!t.isFilterCacheMatch(n,t._visibleColumn)}))},i.prototype.clearColumnFilterConditions=function(){var n=this.getCachedFilterInfo(this._visibleColumn,!1);n&&(n.Conditions=null,n.filterComapreType=null,n.IsOrMode=!1)},i.prototype.clearColumnFilterValues=function(){var n=this.getCachedFilterInfo(this._visibleColumn,!1);n&&(n.Values=null,n.IsNotInMode=!1)},i.prototype.setBasicFilter=function(n,t){var i=this.getCachedFilterInfo(this._visibleColumn,!0);i.IsNotInMode=n;i.Values=t},i.prototype.setConditionFilter=function(n,t,i){var r=this.getCachedFilterInfo(this._visibleColumn,!0);r.filterComapreType=n;r.IsOrMode=t;r.Conditions=i},i.prototype.isColumnFilterValid=function(t){return!n.Common.IsEmpty(t.Values)||!n.Common.IsEmpty(t.Conditions)},i.prototype.getCachedFilterInfo=function(t,i){var u=n.ForguncyData.pageInfo.columnFilterQueryCache[this._locationString],f,e,r;if(!u)if(i)u=[],n.ForguncyData.pageInfo.columnFilterQueryCache[this._locationString]=u;else return null;for(f=0,e=u;f<e.length;f++)if(r=e[f],this.isFilterCacheMatch(r,t))return r;return i?(r=this.createColumnFilterInfo(this.pageName),u.push(r),r):null},i.prototype.isFilterCacheMatch=function(i,r){var u=t.getColumnUniqueLocationKey(r.columnInfo),f;return n.Common.IsEmpty(u)?n.Common.IsEmpty(i.ColumnBindingInfoID)?i.ColumnIndex===r.getColumnIndex():(f=r.getFilterActualBindingInfo(),i.ColumnBindingInfoID===f.GUID):i.ColumnName===u},i}();n.ListviewColumnFilterHelper=u;var o=function(){function n(){}return n}(),s=function(){function n(){}return n}(),e=function(){function t(){}return t.save=function(t,i){var r=JSON.parse(localStorage.getItem(this.CollectionName)),u;(n.Common.IsEmpty(r)||r.version!==this.getPackageVersion())&&(r={items:[],version:this.getPackageVersion()});u=r.items.filter(function(n){return n.id===i});u.length>0?u[0].metadata=t:r.items.push({metadata:t,id:i});localStorage.setItem(this.CollectionName,JSON.stringify(r))},t.getPackageVersion=function(){return n.ForguncyData.isDebugMode()?n.StaticData.MetaDataVersion+n.StaticData.GlobalSettingVersion:n.StaticData.MetaDataVersion},t.isExist=function(n){var t=this.restoreFromLocalStorage(n);return t&&t.length>0},t.restore=function(n){var t=this.restoreFromLocalStorage(n);return t&&t.length>0?t[0].metadata:null},t.restoreFromLocalStorage=function(t){var i=JSON.parse(localStorage.getItem(this.CollectionName));return!n.Common.IsEmpty(i)&&i.version===this.getPackageVersion()?i.items.filter(function(n){return n.id===t}):null},t.clear=function(t){var i=JSON.parse(localStorage.getItem(this.CollectionName)),r,u;n.Common.IsEmpty(i)||i.version!==this.getPackageVersion()||(r=i.items.filter(function(n){return n.id===t}),r.length>0&&(u=i.items.indexOf(r[0]),i.items.splice(u,1)));localStorage.setItem(this.CollectionName,JSON.stringify(i))},t.resolve=function(n){n.OriginalColumns=__spreadArray([],n.Columns,!0);n.Columns.forEach(function(n,t){n.OriginalWidth=n.Width>0?n.Width:0;n.IsHiddenByLayout=n.Width>0?!1:!0;n.IsHiddenByColumnOptions=!1;n.IsHiddenByJavaScriptAPI=!1;n.Order=t})},t.CollectionName="FGC_ListviewMetadataCollection",t}();n.ListviewMetadataHelper=e})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__assign=this&&this.__assign||function(){return __assign=Object.assign||function(n){for(var t,r,i=1,u=arguments.length;i<u;i++){t=arguments[i];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},__assign.apply(this,arguments)},Forguncy;(function(n){var r=function(){function n(n,t,i,r){t===void 0&&(t=null);i===void 0&&(i=[]);r===void 0&&(r=-1);this.query=n;this.rowVersion=t;this.values=i;this.index=r}return n}(),t,i,u,f,e,o,s,h;n.CachedRowData=r;t=function(t){function i(i,r,u){var f=t.call(this)||this,e;return f.listviewData=i,f.runTimePageName=r,f.designerPageName=u,f.deletedRowQuerys=[],f._isLoading=!1,f._masterValue=undefined,f.isFocused=!1,f._haveTriggerOnLostFocusMethod=!1,f._hasDestroyed=!1,f._protectListview=!1,f._locationString=null,f._isAllDataLoaded=!0,f._selectedRowsForEvent=[],f._waitValidateRows=[],f.cacheManager=new n.ListViewHelper.SelectionCacheManager(function(n){return f.getCachedRowData(n)}),f._isLoaded=!1,f.locatedPageID=n.ForguncyData.pageInfo.pageID,f.operationTypeWhenValueChanged=0,f._commitingRows=[],e=n.ForguncyData.pageInfo.dataModel,f._listData=e.addListData(f.getListviewName(),f.getCalcSheetName(),f.listviewData.getColumnCount(),f.runTimePageName),f._listData.bind("valuechanged",function(n,t){f._onValueChangedInDataModel(t)}),f.bindCurrentRowInfoAndPagingInfoChangedEvent(),f._initHeaderCellsValue(e),f._resolveAutoReload(),f}return __extends(i,t),Object.defineProperty(i.prototype,"isLoaded",{get:function(){return this._isLoaded},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"dataVersion",{get:function(){return this._dataVersion},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"totalRowDataVersion",{get:function(){return this._totalRowDataVersion},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hasRequestData",{get:function(){return this._hasRequestData},enumerable:!1,configurable:!0}),i.prototype._resolveAutoReload=function(){var i=this,r=this.listviewData.getAutoReloadInterval(),n,t;r>0&&(n=r*1e3,t=function(){i.hasDestroyed()||(i.isInCurrentPage()?i.fillData(null,!1,!1,function(){setTimeout(t,n)},function(){setTimeout(t,n)},function(){setTimeout(t,n)}):setTimeout(t,n))},setTimeout(t,n))},i.prototype.resetListviewData=function(t){this.listviewData=t;this._listData.resetColumnCount(this.listviewData.getColumnCount());this._initHeaderCellsValue(n.ForguncyData.pageInfo.dataModel)},i.prototype.bindCurrentRowInfoAndPagingInfoChangedEvent=function(){var t=this;this._currentRowInfoChangedEventHandler=function(n,i){t.onCurrentRowInfoChanged(i)};n.ForguncyData.pageInfo.currentRowInfoCollection.bind("currentrowinfochanged",this._currentRowInfoChangedEventHandler);n.Common.IsEmpty(n.ForguncyData.pageingInfoList)&&(n.ForguncyData.pageingInfoList=new n.PageingInfoList);this._pagingInfoChangedEventHandler=function(n,i){t._hasDestroyed||t.getLocationString()!==i.listviewLocation||t.fillData(null,!1,!0,undefined,undefined,undefined,!1)};n.ForguncyData.pageingInfoList.bind("pageingInfoChanged",this._pagingInfoChangedEventHandler)},i.prototype._initHeaderCellsValue=function(t){for(var s,f,h=this.listviewData.getAllHeaderCellContentElement(),u=0,e=h;u<e.length;u++){var o=e[u],c=o.isExternal,i=o.cell,r=n.Common.convertMetaDataDefaultValue(i.Value,this.runTimePageName);r=n.Common.getMultiLanguageWord(r);r!==null&&(s=this.getHeaderCellIDSuffix(c),f=n.Common.getIdStr(i.Row,i.Column,s),n.ForguncyData.pageInfo.formulaManager.hasFormula(f)||t.normalCellDataModel.setValue(f,{newValue:r},1,i.IgnoreExport))}},i.prototype.getHeaderCellIDSuffix=function(n){return n?this.listviewData.name:this.listviewData.isColumnHeaderVisibleInDesigner()?this.runTimePageName:this.listviewData.name},i.prototype.getListDataModel=function(){return this._listData},i.prototype.onDependenceCellValueChanged=function(){this.resetToFirstPage();this.fillData()},i.prototype.onLoad=function(){this._isLoaded=!0},i.prototype.onWindowResized=function(n){n===void 0&&(n=!1)},i.prototype.getColumnTypeByIndex=function(n){return this.listviewData.getBindingInfoColumnTypeInDataModel(n)},i.prototype.getVisibleColumnIndexInListViewByDataIndex=function(n){var t,i;if(this.listviewData.visibleColumns&&n>-1&&n<this.listviewData.getColumnCount())for(t=0;t<this.listviewData.visibleColumns.length;t++)if(i=this.listviewData.visibleColumns[t],i&&i.getColumnIndex()===n)return t;return-1},i.prototype.getDataIndexByVisibleColumnIndexInListView=function(n){return n<0||n>=this.listviewData.visibleColumns.length?-1:this.listviewData.visibleColumns[n].getColumnIndex()},i.prototype.getClonedListviewMetadataAfterAdjustColumnWidth=function(){return n.Common.clone(this.listviewData.metadata)},i.prototype.isInCurrentPage=function(){return this.locatedPageID===n.ForguncyData.pageInfo.pageID},i.prototype.getCellTypeByColIndex=function(){return null},i.prototype.onCurrentRowInfoChanged=function(n){this.syncSelectionOfListviewsHaveSameDataTable(n);this.refreshDetailListviewData(n)},i.prototype.syncSelectionOfListviewsHaveSameDataTable=function(t){var r,i;if(t.isQueryChanged&&(t.change===0||t.change===1)){if(this.isGroupMode()||t.rowInfo.currentTable!==this.getDataTableName())return;if(r=t.rowInfo.query,!n.Common.isQueryEqual(this._listData.getRowQuery(this._listData.getCurrentRowIndex()),r)&&(i=this._listData.getRowIndexByQuery(r),i>=0&&i<this.getEditorRowCount())){this.onCurrentRowChanged(i,!1);this.selectInEditor(i);this.onSelectionChanged(!1)}}},i.prototype.refreshDetailListviewData=function(n){n.isQueryChanged&&this.getMasterDataTableName()===n.rowInfo.currentTable&&(n.change===2?this.clearData():this.fillData())},i.prototype._onValueChangedInDataModel=function(n){this.operationTypeWhenValueChanged!==1&&(this.triggerAPIValueChangedEvent([__assign({},n.cellRange)],n.newRowCount,n.oldRowCount),this.operationTypeWhenValueChanged!==2)&&this.updateSelectedRowsCache()},i.prototype.triggerAPIValueChangedEvent=function(t,i,r){var u=this;t.forEach(function(n){return n.Column=u.getMergedColIndexByDataColIndex(n.Column)});u.trigger(n.ListViewEvents.ValueChanged,{CellRanges:t,NewRowCount:i,OldRowCount:r})},i.prototype._onCellValueChanged=function(n,t,r,u){var s=this.listviewData.getColIndexByVisibleColIndex(t),f,h,c,e,o;if(s!==-1&&(this._listData.setValue(n,s,r,6,u),n===this.getCurrentRowIndex()&&(f=this.listviewData.getBindingInfo(s),f&&!f.RelationBinding)))for(h=i.getAllListviews(),c=h.length,e=0;e<c;e++)o=h[e],o.getMasterDataTableName()===this.getDataTableName()&&o.getColumnOfMasterTable()===f.ColumnName&&o.masterValueChanged(r)},i.prototype.setDataToSpreadJSNow=function(n,t){n===void 0&&(n=-1);t===void 0&&(t=-1)},i.prototype.shouldCancelCommand=function(){return!1},i.prototype.masterValueChanged=function(n){var i=this.listviewData.getColIndexOfColumnOfDetailTable(),r,t;if(this.listviewData.canEdit()&&i!==-1&&this._masterValue!==n)for(r=this._listData.getRowCount(),t=0;t<r;t++)this._listData.setValue(t,i,n,7)},i.prototype.getRowInfo=function(t){var i=new n.CurrentRowInfo,r;return i.currentTable=this.getDataTableName(),i.viewname=this.getFullListviewName(),i.listviewLocation=this.getLocationString(),i.viewCondtionFormulaValues=this.GetQueryConditionFormulaValues(),i.masterTableQuery=this.getMasterQuery(),n.Common.IsEmpty(t)&&(t=this._listData.getCurrentRowIndex()),r=this._listData.getRowCount(),t!==undefined&&t<r&&(i.selectedRowIndex=t,i.recordID=this.getRecordID(t),i.query=this._listData.getRowQuery(t)),i},i.prototype.getRowVersion=function(n){return this._listData.getRowInfo(n).rowVersion},i.prototype.getRecordID=function(t){var r=n.ForguncyData.pageingInfoList.GetPageIndex(this.getLocationString()),i;return r=this.isInvalidNumber(r)?0:r-1,i=n.ForguncyData.pageingInfoList.GetLimit(this.getLocationString()),i=this.isInvalidNumber(i)?0:i,r*i+t},i.prototype.isInvalidNumber=function(n){return typeof n!="number"||isNaN(n)||n<=0},i.prototype.getDataTableName=function(){return this.listviewData.getDataTableName()},i.prototype.getMasterDataTableName=function(){return this.listviewData.getMasterDataTableName()},i.prototype.getColumnOfMasterTable=function(){return this.listviewData.getColumnOfMasterTable()},i.prototype.getColumnOfDetailTable=function(){return this.listviewData.getColumnOfDetailTable()},i.prototype.getMasterQuery=function(){var i=this.getMasterDataTableName(),t;if(i&&(t=n.ForguncyData.pageInfo.currentRowInfoCollection.getCurrentRowInfo(i),t))return t.query},i.prototype.allowLoadOnDemand=function(){return this.listviewData.shouldLoadOnDemand()?n.ForguncyData.pageingInfoList&&n.ForguncyData.pageingInfoList.IsPageing(this.getLocationString())?!1:this._isAllDataLoaded?!1:!0:!1},i.prototype.loadOnDemand=function(){if(this._isLoading!==!0&&this.allowLoadOnDemand()){this._isLoading=!0;this.showLoadingIndicator();var t=this;n.DelayRefresh.setTimeout(function(){t.hasDestroyed()||n.ListViewHelper.RequestHelper.queryDataFromServer(t,!0)},100)}},i.prototype.showLoadingIndicator=function(n){n===void 0&&(n=!0)},i.prototype.hiddenLoadingIndicator=function(n){n===void 0&&(n=!1)},i.prototype.protectListview=function(n){this._protectListview=n},i.prototype.isProtected=function(){return this._protectListview},i.prototype.needQueryData=function(){if(!this.getDataTableName()||this.listviewData.columnBindingInfos.length===0)return!1;if(!this.isMasterTable()){var n=this.getMasterQuery();if(!n)return!1}return!0},i.prototype._setInitData=function(t,i){var r=this._listData.getCurrentRowIndex();this.clearTemporaryThings();this._listData.indexFlag=0;this._isAllDataLoaded=i;this._listData.setData(t);this._commitingRows=[];this.dataCache=null;this._isAllDataLoaded&&this.onInitAllData();this.onDataLoaded();this.initSelectionAfterInitData(r);this.trigger(n.ListViewEvents.Reloaded,{})},i.prototype.onInitAllData=function(){},i.prototype.initSelectionAfterInitData=function(n){this.getEditorRowCount()>0?this.selectRowAfterInitData(n):this.isGroupMode()||this.clearCurrentRow()},i.prototype.onDataLoaded=function(){},i.prototype.allowShowTotalRow=function(){return this.listviewData.allowShowTotalRow()},i.prototype.canAddRow=function(){return!n.Platform.isMobile()&&this.listviewData.canAddRow()},i.prototype.allowAddRow=function(){return this.canAddRow()&&!this.allowLoadOnDemand()?!0:!1},i.prototype.allowInsertRow=function(){return this.listviewData.canEdit()&&!this.allowLoadOnDemand()?!0:!1},i.prototype.allowDuplicateRow=function(){var t,n;return this.listviewData.canEdit()&&!this.allowLoadOnDemand()?(t=this.listviewData.getDataCommitMode(),t===0&&(n=this.getSelectedRowsIndexes(),n&&n.length>1))?!1:!0:!1},i.prototype.addData=function(n,t){if(!n||n.length===0){this._isLoading=!1;return}this._isAllDataLoaded=t;this._listData.addData(n,2);this.dataCache=null;this.onDataLoaded();this._isLoading=!1},i.prototype.selectRowAfterInitData=function(t){var o=this.getEditorRowCount(),e,u,f,r,i;if(!(o<=0)){if(e=this._listData.getRowCount(),u=-1,!this.isGroupMode()&&(f=n.ForguncyData.pageInfo.currentRowInfoCollection.getCurrentRowInfo(this.getDataTableName()),f&&f.query))for(r=0;r<e;r++)if(n.Common.isQueryEqual(this._listData.getRowInfo(r).query,f.query)){u=r;break}i=u;u===-1&&(i=this.shouldResetCurrentRow()||n.Common.IsEmpty(t)?0:t);i=Math.min(e-1,i);i=Math.max(0,i);this.onCurrentRowChanged(i)}},i.prototype.shouldResetCurrentRow=function(){return!1},i.prototype.selectRow=function(n){if(n>=0&&n<this.getEditorRowCount()&&n!==this.getCurrentRowIndex()){this.selectInEditor(n);this.onCurrentRowChanged(n)}},i.prototype.selectCell=function(n,t){if(n>=0&&n<this.getEditorRowCount()&&t>=0&&(this.selectInEditor(n,t),n!==this.getCurrentRowIndex()))this.onCurrentRowChanged(n)},i.prototype.selectInEditor=function(){},i.prototype.isMasterTable=function(){return this.listviewData.isMasterTable()},i.prototype.commitChangeRealTime=function(n,t){if(n<0||!t)return!1;var i=this._listData.getRowQuery(n);return i?!0:t==="add"&&(this.isMasterTable()||!!this.getMasterQuery())},i.prototype.getEditorInfo=function(t){t===void 0&&(t=!1);var i=this,r=i.getEditorDataInfos(t);r&&r.length!==0&&(i.showLoadingIndicator(),n.HomeController.GetEditorInfo(r,function(r){(r&&r.errorMessage&&alert(r.errorMessage),i.hasDestroyed())||(r&&r.editor&&i.setEditorDataInfos(r.editor,t),n.DelayRefresh.Push(i,function(){i.hasDestroyed()||i.hiddenLoadingIndicator()},i.getCalcSheetName()+"hiddenLoadingIndicator"))},this.getCalcSheetName()))},i.prototype.firstLoadData=function(){var t=this;this.listviewData.getDoNotLoadDataWhenLoadPage()?(this.clearCurrentRow(),this.getEditorInfo(!0)):(this.fillData(null,!0),n.DependenceCellValueChangeHelper.listenFormulaRefChanged(this.listviewData.getConditionFormulaList(),function(){t.onDependenceCellValueChanged()},this.runTimePageName))},i.prototype.fillData=function(t,i,r,u,f,e,o){var s=this;(t===void 0&&(t=null),i===void 0&&(i=!1),r===void 0&&(r=!1),u===void 0&&(u=null),f===void 0&&(f=null),e===void 0&&(e=null),o===void 0&&(o=!0),this.hasDestroyed())||(this._hasRequestData=!0,o?(this.showLoadingIndicator(!0),n.ForguncyData.pageingInfoList.RefeshRowCount(this.getLocationString(),function(){n.ListViewHelper.RequestHelper.queryDataFromServer(s,!1,t,i,r,function(n){u&&u(n);s.hiddenLoadingIndicator()},f,function(){e&&e();s.hiddenLoadingIndicator()})})):n.ListViewHelper.RequestHelper.queryDataFromServer(this,!1,t,i,r,u,f,e))},i.prototype.beforeRefeshUIWhenQueryDataFromServer=function(){},i.prototype.updateSelectedRowsCache=function(){this.getAlwaysReservedSelections()&&this.cacheManager.update(this.getSelectedRowsIndexes())},i.prototype.updateSelectedRowsBeforeDeleteRow=function(n){this.getAlwaysReservedSelections()&&this.cacheManager.delete(n)},i.prototype.updateSelectedRowsAfterDeleteRow=function(){},i.prototype.getTotalRowSettingsIgnoreNullValues=function(){return this.listviewData.getTotalRowSettingsIgnoreNullValues()},i.prototype.getTotalRowBindingInfosIgnoreNullValues=function(){return this.listviewData.getTotalRowBindingInfosIgnoreNullValues()},i.prototype.resetToFirstPage=function(){var t=this.getLocationString();n.ForguncyData.pageingInfoList.ResetPageIndexToFirstPage(t)},i.prototype.GetQueryConditionFormulaValues=function(){var i=this.listviewData.getConditionFormulas(),r,u,t;if(i){r={};for(u in i)n.FormulaManager.isReady()&&(t=n.ForguncyData.pageInfo.formulaManager.evaluateFormula(i[u],{runTimePageName:this.runTimePageName,ignoreListviews:!0,nullAsException:!0}),r[u]=t instanceof GC.Spread.CalcEngine.CalcError?t.toString():t);return r}},i.prototype.rollbackBindingValue=function(n){for(var i,r,u=this.listviewData.getColumnCount(),t=0;t<u;t++)i=this.listviewData.columnDataInfos[t],i.bindingInfoIndex!==-1&&(r=this._listData.getBindingValue(n,t),this._listData.setValue(n,t,r,2))},i.prototype.reloadItemsEditor=function(t){var s=this,f,e,o,i,h,r,u;if(t&&(t=t.toLowerCase()),i=this.listviewData.visibleColumns,i)for(h=function(u){var c=i[u].getTemplateCell(),h;if(!c||(h=c.CellType,!h||!h.IsBounding||!h.DataSource)||t&&h.DataSource.toLowerCase()!==t||n.Common.typeContains(h,"DropDownListCellType"))return"continue";var l={tableName:h.DataSource,valueColumnBindingInfo:(f=h.ValueColumnBindingInfo)===null||f===void 0?void 0:f.GUID,displayColumnBindingInfo:(e=h.DisplayColumnBindingInfo)===null||e===void 0?void 0:e.GUID,dropDownSubItems:(o=h.DropDownSubItems)===null||o===void 0?void 0:o.map(function(n){var t;return __assign(__assign({},n),{BindingInfo:(t=n.BindingInfo)===null||t===void 0?void 0:t.GUID})}),itemQuery:n.ConditionHelper.getComputedSqlConditionFormula(h.ItemsQuery,r.runTimePageName,h.NullFormulaValueQueryPolicy),itemSort:h.ItemsSort,pageName:r.designerPageName,cacheSettingID:h.CacheSetting},a=r.getCalcSheetName()+u;n.Common.forguncyPost("Home/GetComboBindingOptions",l,function(t){t||(t={Items:[]});h.ItemsInfo=t;n.ItemsCellTypeHelper.initItemsOfItemsCell(c,h.ItemsInfo,h);h.haveLoadItems=!0;h.hasInitItemsInfo=!1;h.initItemsInfoCallback=function(){s.autoFit()};s.refreshUI()},"GetComboBindingOptions "+a)},r=this,u=0;u<i.length;u++)h(u)},i.prototype.autoFit=function(){},i.prototype.getEditorDataInfos=function(n){for(var e,t,i,r,s=this.getBoundingItemsElementsWithItemsCellType(n),u=[],f=0,o=s;f<o.length;f++)e=o[f],t=e.CellType,u.push({tableName:t.DataSource,pageName:this.designerPageName,valueColumnBindingInfo:(i=t.ValueColumnBindingInfo)===null||i===void 0?void 0:i.GUID,displayColumnBindingInfo:(r=t.DisplayColumnBindingInfo)===null||r===void 0?void 0:r.GUID,itemSort:t.ItemsSort,cacheSettingID:e.ServerPropertiesId.CacheSetting});return u.length===0?null:u},i.prototype.setEditorDataInfos=function(t,i){for(var r,f,o=this,e=this.getBoundingItemsElementsWithItemsCellType(i),u=0;u<e.length;u++)r=e[u].CellType,f=t[u],n.Common.IsEmpty(f)&&(f={Items:[]}),r.ItemsInfo=f,n.ItemsCellTypeHelper.initItemsOfItemsCell(e[u],r.ItemsInfo,r),r.haveLoadItems=!0,r.hasInitItemsInfo=!1,r.initItemsInfoCallback=function(){o.autoFit()}},i.prototype.getBoundingItemsElementsWithItemsCellType=function(n){var f=[],e=this.listviewData.visibleColumns,i,u,o,r,t;if(e)for(i=0,u=e;i<u.length;i++)if(o=u[i],r=o.getTemplateCell(),r){if(t=r.CellType,t&&t.$type==="Forguncy.DropDownListCellType, ServerDesignerCommon")continue;if(!t||!t.IsBounding)continue;if(!n&&t.haveLoadItems)continue;t.DataSource&&(t.ValueColumnBindingInfo||t.DisplayColumnBindingInfo)&&f.push(r)}return f},i.prototype.getUserSelectorCellContentElement=function(){var t=[],n=this.listviewData.visibleColumns;return n===null||n===void 0?void 0:n.forEach(function(n){var i=n.getTemplateCell(),r;i&&(r=i.CellType,r&&r.$type==="Forguncy.UserCellType, ServerDesignerCommon"&&t.push(i))}),t},i.prototype.clearCurrentRow=function(){n.ForguncyData.pageInfo.currentRowInfoCollection.removeCurrentRowInfo(this.getDataTableName())},i.prototype._showDeleteButton=function(){},i.prototype.getCurrentRowCenterY=function(){return 0},i.prototype.hideDeleteButton=function(){},i.prototype.clearData=function(){this._isAllDataLoaded=!0;this.dataCache=null;this.clearTotalRow();this._listData.clear();this.clearTemporaryThings();this.clearCurrentRow();this.updateDataVersion();this.updateTotalRowDataVersion()},i.prototype.clearTemporaryThings=function(){this._listData.select();this._masterValue=undefined;this.hideDeleteButton()},i.prototype.clearTotalRow=function(){if(this.listviewData.allowShowTotalRow()){var n=this.listviewData.getTotalRowSettingsIgnoreNullValues().filter(function(n){return n.BindingInfo});n.forEach(function(n){n.Value=n.FormulaType===2?0:""})}},i.prototype.updateDataVersion=function(){this._dataVersion=n.Common.getUniqueNumber()},i.prototype.updateTotalRowDataVersion=function(){this._totalRowDataVersion=n.Common.getUniqueNumber()},i.prototype.insertRowBySelection=function(n){var t=this.getSelectedRowsIndexes(),i;!t||t.length<=0||(t.sort(function(n,t){return n-t}),i=t[0],this.insertRow(i,t.length,null,!0,n))},i.prototype.duplicateRowBySelection=function(n){var u=this,t=this.getSelectedRowsIndexes(),i,r;!t||t.length<=0||(t.sort(function(n,t){return n-t}),i=t.slice(-1)[0]+1,r=[],t.forEach(function(n){r.push(u.getDuplicateRowData(n))}),this._listData.insertData(i,r,7,n,!1),this._listData.select(i))},i.prototype.addNewRow=function(t,i,r,u){var e,f;for(u===void 0&&(u=7),this._listData.addData([this.getNewRowData(!1,i)],u,r),e=this._listData.getRowCount()-1,f=0;f<t.length;f++)t[f]!==undefined&&this._listData.setValue(e,f,t[f],u,r);n.Common.IsEmpty(this._listData.getCurrentRowIndex())&&this.selectRow(0)},i.prototype.addNewRowWithText=function(n,t){this.changeTextToValue(n);this.addNewRow(n,!1,t)},i.prototype.duplicateRow=function(n,t,i,r){var u=this,f=t.map(function(n){return u.getDuplicateRowData(n)});this.updateAndInsertRows(n,f,i,r)},i.prototype.insertRow=function(n,t,i,r,u){for(var o,f=[],e=0;e<t;e++)o=this.getNewRowData(!0,r),f.push(o);this.updateAndInsertRows(n,f,i,u)},i.prototype.updateAndInsertRows=function(t,i,r,u){var e,s,f,o;if(i&&i.length!==0){if(r)for(e=0;e<i.length;e++)for(s=i[e],f=0;f<r.length;f++)r[f]!==undefined&&(o=new n.ListDataValue,o.value=r[f],o.valueType=7,s.data[f]=o);this._listData.insertData(t,i,7,u,!0);n.Common.IsEmpty(this._listData.getCurrentRowIndex())&&this.selectRow(0);this.updateSelectedRowsAfterInsertRows(t,i.length)}},i.prototype.updateSelectedRowsAfterInsertRows=function(){},i.prototype.insertRowWithText=function(n,t){this.changeTextToValue(t);this.insertRow(n,1,t,!1,!1)},i.prototype.changeTextToValue=function(n){for(var t in n)try{n[t]=this.validateValue(parseInt(t),n[t],!0)}catch(i){if(this.GetDataValidationTime()===0)throw i;}},i.prototype.setCellText=function(n,t,i,r){var u=i;try{u=this.validateValue(t,i,!0,!1,n)}catch(f){if(this.GetDataValidationTime()===0)throw f;}this._listData.setValue(n,t,u,7,r)},i.prototype.validateValue=function(t,i,r,u,f,e){var c,h,l,a,p,w;u===void 0&&(u=!1);f===void 0&&(f=-1);e===void 0&&(e=!0);var y=i,v,s=this.getCellTypeByColIndex(t),o="";if(!n.Common.IsEmpty(i))if(s&&r&&(i=s.getValueFromListviewText(i,u)),i instanceof n.WrongParseResult&&(v=i,i=y),c=this.getColumnTypeByIndex(t),c===n.ColumnDataType.Date||c===n.ColumnDataType.Time)try{typeof i=="string"&&(i=s?s.getValueFromListviewText(i):n.FormatHelper.getValueFromText(i));i instanceof Date&&(i=n.ConvertDateToOADate(i));n.DateHelper.isValidDateValue(i)||(o=n.RS.ListViewAddNewRowError_CantConvertToDateTime)}catch(b){o=b}else c===n.ColumnDataType.Number?(h=n.NumberCellTypeData.convertTextToNumber(i),h.isValid?i=h.validValue:o=n.RS.ListViewAddNewRowError_CantConvertToNumber):c===n.ColumnDataType.Bool&&(h=n.CheckBoxCellTypeData.convertTextToBool(i),h.isValid?i=h.validValue:o=n.RS.ListViewAddNewRowError_CantConvertToBool);if(!n.Common.IsEmpty(o)&&v&&(i=v,o=""),l={status:0},s&&(a=this.getValidateHelpInfo(f,t),a.returnPendingWhenValidateCommand=!0,a.ignoreCommandValidate=e,l=s.validateValue(i,a,u)),!n.Common.IsEmpty(o)||l.status!==0){l.status!==0&&(o=l.message);p=this.getMergedColIndexByDataColIndex(t);w={message:o,Message:o,CellValue:y,ColumnIndex:p};throw w;}return i},i.prototype.getValidateHelpInfo=function(t,i){var r,u,f;return t===-1&&(t=this.getListDataCount()),u=(r={},r[this.getCalcSheetName()]=t,r),f=this.getMergedColIndexByDataColIndex(i),{cellID:n.Common.getIdStr(t,f,this.getCalcSheetName()),isInListview:!0,runTimePageName:this.runTimePageName,ignoreCommandValidate:!1,listInfo:u,locationStr:this.getCellLogLocationString(t,i)}},i.prototype.getCellLogLocationString=function(t,i){var f=this.getMergedColIndexByDataColIndex(i),u=this.getVisibleColumnIndexInListViewByDataIndex(i),r=u===-1?null:this.listviewData.visibleColumns[u];return n.FormulaHelper.getListviewCellLogLocationString(t,f,r===null||r===void 0?void 0:r.getName(),this.getListviewName(),this.runTimePageName)},i.prototype.getListDataCount=function(){return this._listData.getRowCount()},i.prototype.getNewRowData=function(t,i){var u=i?this.getRowDataWithDefaultValue():[],f=this.listviewData.getColIndexOfColumnOfDetailTable(),e,r;return f!==-1&&(this._masterValue===undefined&&(this._masterValue=this._getMasterValueForDetailTable()),u[f]=this._masterValue),e=u.map(function(t){var i=new n.ListDataValue;return i.value=t,i.valueType=7,i}),r=new n.ListRowData,r.data=e,r.isInsertRow=t,this._setStaticValueToListRowDatas(r),r},i.prototype.getRowDataWithDefaultValue=function(){for(var t,r,u,f=[],e=this._listData.getRowCount(),o=this.listviewData.visibleColumns.length,i=0;i<o;i++)(t=this.listviewData.visibleColumns[i],t)&&(r=t.getColumnIndex(),r!==-1)&&(u=t.getDefaultValue(this.getCalcSheetName(),this.runTimePageName,e),n.Common.IsEmpty(u)||(f[r]=u));return f},i.prototype.getDuplicateRowData=function(t){var r=this._listData.getRowData(t),i=new n.ListRowData;return i.data=n.Common.clone(r.data),i.data.forEach(function(t){t&&t.valueType===2&&!n.Common.IsEmpty(t.bindingValue)&&(t.value=t.bindingValue,t.bindingValue=undefined,t.valueType=7)}),i.isInsertRow=!0,i},i.prototype._setStaticValueToListRowDatas=function(t){for(var u,r,f=this.listviewData.getColumnCount(),i=0;i<f;i++)(u=this.listviewData.getStaticValue(i),u!==null)&&(r=new n.ListDataValue,r.value=u,r.valueType=1,t.data[i]=r)},i.prototype.deleteRow=function(t,i){var r,u,f,e;if(t===undefined||t===null){if(r=this._listData.getCurrentRowIndex(),n.Common.IsEmpty(r))return n.CommandResult.stop;t=r}return(u=this.getActualDataLength(),t<0||u<=0||t>=u)?n.CommandResult.stop:(f=this._listData.getRowInfo(t),f&&i)?n.CommandResult.stop:(this.hideDeleteButton(),this.updateSelectedRowsBeforeDeleteRow(t),this._listData.deleteRow(t),e=this._listData.getCurrentRowIndex(),this.updateCurrentRowAfterDeleteRow(t,!0),this.updateSelectedRowsAfterDeleteRow(t,e),this.refreshUI(),n.CommandResult.completed)},i.prototype.deleteRowInDataModel=function(n){n>=0&&n<this._listData.getRowCount()&&(this._listData.deleteRow(n),this.updateCurrentRowAfterDeleteRow(n,!1))},i.prototype.updateCurrentRowAfterDeleteRow=function(n,t){var i=this._listData.getCurrentRowIndex(),r;if(this._listData.select(),r=this._listData.getRowCount()+(this.allowAddRow()?1:0),r>0){i>n&&(i=i-1);i=Math.min(r-1,Math.max(0,i));t&&this.allowAddRow()&&r>1&&i===r-1&&(i=r-2);this.onCurrentRowChanged(i)}},i.prototype.handleAfterUpdateDataChange=function(t,r,u){var a,e,s,h,o,l,c,f;if(this._commitingRows.indexOf(t)!==-1){if(u.Success){if(r==="delete")this.deleteRow(t,!1);else if(e=u.RowData,e){for(this.getRowVersionColumnNameInServerData()&&(s=void 0,e.RowVersionInfo&&e.RowVersionInfo.RowVersion&&(s=e.RowVersionInfo.RowVersion),this._listData.setRowVersion(t,s)),h=e.Values,o=0;o<h.length;o++)for(l=h[o],c=this.listviewData.getColumnCount(),f=0;f<c;f++)this.listviewData.columnDataInfos[f].bindingInfoIndex===o&&this._listData.setValue(t,f,l,2);this._listData.setRowQuery(t,u.JustInsertedRowInfo.query?u.JustInsertedRowInfo.query:null);t===this.getCurrentRowIndex()&&n.ForguncyData.pageInfo.currentRowInfoCollection.setCurrentRowInfo(this.getRowInfo(),!0);r==="add"&&this.updateSelectedRowsCache()}else if(r==="edit")for(c=this.listviewData.getColumnCount(),f=0;f<c;f++)this.listviewData.columnDataInfos[f].bindingInfoIndex!==-1&&this._listData.setValue(t,f,this._listData.getValue(t,f),2);else if(r==="add"){this.fillData();return}r==="add"&&this.getCurrentRowIndex()===this.getActualDataLength()&&(a=i.getDetailListviews(this.getDataTableName()),a.forEach(function(n){return n.clearData()}))}else if(u.Message&&alert(u.Message),u.ConcurrentError){if(e=u.RowData,e)for(this.getRowVersionColumnNameInServerData()&&(s=void 0,e.RowVersionInfo&&e.RowVersionInfo.RowVersion&&(s=e.RowVersionInfo.RowVersion),this._listData.setRowVersion(t,s)),h=e.Values,o=0;o<h.length;o++)for(l=h[o],c=this.listviewData.getColumnCount(),f=0;f<c;f++)this.listviewData.columnDataInfos[f].bindingInfoIndex===o&&this._listData.setValue(t,f,l,2)}else r==="edit"?this.rollbackBindingValue(t):r==="add"&&this.deleteRowInDataModel(t);this.removeFromCommitingRow(t);this.refreshUI()}},i.prototype.removeFromCommitingRow=function(n){var t=this._commitingRows.indexOf(n);t>=0&&this._commitingRows.splice(t,1)},i.prototype.pushToCommitingRow=function(n){var t=this._commitingRows.indexOf(n);t===-1&&this._commitingRows.push(n)},i.prototype.hasCommitingRow=function(){return this._commitingRows.length>0},i.prototype.refreshOtherListViewsBindingToSameTable=function(){var u=i.getAllListviews(),r=this,t=r.getDataTableName();u.forEach(function(n){n!==r&&n.getDataTableName()===t&&n.fillData()});n.NormalCellBindingManager.updateTableDataCacheForCombo(t,!0);n.clearGetTableDataByConditionCache();n.NormalCellBindingManager.reloadItemsCellType(t,!1,!0);n.CustomFunction.ODataFunction.clearCache(t)},i.prototype.onSelectionChanged=function(n){n===void 0&&(n=!0)},i.prototype.triggerSelectedRowsChangedEvent=function(){var t=this.getSelectedRowsIndexes();this.isSelectedRowsEqual(this._selectedRowsForEvent,t)||(this._selectedRowsForEvent=t,this.delayTriggerEvent(n.ListViewEvents.SelectedRowsChanged,{}))},i.prototype.isSelectedRowsEqual=function(n,t){if(n.length!==t.length)return!1;for(var i=0;i<n.length;i++)if(n[i]!==t[i])return!1;return!0},i.prototype.delayTriggerEvent=function(t,i){var r=this;n.DelayRefresh.Push(r,function(){r.hasDestroyed()||r.trigger(t,i)},t+r.getCalcSheetName())},i.prototype.onCurrentRowChanged=function(t,r){var e,f,o,s,u;if((r===void 0&&(r=!0),f=this._listData.getCurrentRowIndex(),t===undefined||t!==f)&&(o=this.commitEditChange(),o!=="cancel")){if(this._listData.select(t),((e=this.listviewData.metadata.CurrentRowChangedCommands)===null||e===void 0?void 0:e.length)>0&&(i.CurrentRowChangedCommandId+=1,n.ForguncyData.commandExecutor.executeCommand(this.listviewData.metadata.CurrentRowChangedCommands,{runTimePageName:this.runTimePageName,commandTrigger:this,commandID:this.getListviewName()+"|"+i.CurrentRowChangedCommandId,eventType:"currentrowinfochanged",locationString:n.FormulaHelper.getListviewCellLogLocationString(t,null,null,this.getListviewName(),this.runTimePageName)})),this.isGroupMode()){this.triggerSelectionChangedEvent(f,t);return}s=this.getActualDataLength();t!==undefined&&(t<s?this._showDeleteButton():this.hideDeleteButton());t!==undefined&&r&&(u=this.getRowInfo(),u&&u.currentTable&&u.query?n.ForguncyData.pageInfo.currentRowInfoCollection.setCurrentRowInfo(u,!0):this.clearCurrentRow());this.triggerSelectionChangedEvent(f,t)}},i.prototype.triggerSelectionChangedEvent=function(n,t){this.trigger("selectionchanged",{oldSelectedRowIndex:n===undefined?-1:n,newSelectedRowIndex:t===undefined?-1:t})},i.prototype.getRowVersionColumnNameInServerData=function(){return"C"+this.listviewData.columnBindingInfos.length},i.prototype.needCommit=function(n,t){if(!this.getDataTableName()||(typeof n=="undefined"&&(n=this._listData.getCurrentRowIndex()),n===undefined||this._commitingRows.indexOf(n)>=0))return!1;var i=this.getActualDataLength();return n<0||i<=0||n>=i?!1:t||this._listData.isDirty(n,-1)||this.GetDataCommitMode()!==0&&this.deletedRowQuerys.length>0||this.isDetailTableEdited()},i.prototype.deleteRowByJavascriptAPI=function(n){var t=this._listData.getRowInfo(n),i=t?t.query:null;i&&this.deletedRowQuerys.push(i);this.deleteRow(n,!1)},i.prototype.deleteOnUIClick=function(t){var i=this,f,l=this.stopEditingActiveCell(),r,e,o,c;if(l&&(r=[],r=t?(f=this.getSelectedRowsIndexes())===null||f===void 0?void 0:f.sort(function(n,t){return t-n}):[this._listData.getCurrentRowIndex()],!n.Common.IsEmpty(r)&&!(r.length<=0))){var s=this.isMasterTable(),u=[],h=[];(r.forEach(function(t){var f=i._listData.getRowInfo(t),r;if(i.needCommit(t,!0)){if(r=f?f.query:null,n.Common.IsEmpty(r)){i.deleteRow(t,!0);return}if(i.GetDataCommitMode()!==0){r&&i.deletedRowQuerys.push(r);i.deleteRow(t,!1);return}u.push(t);h.push(r)}}),u.length!==0)&&(e={ActualShowConfirm:!0,currentTable:this.getDataTableName(),querys:h,rowIndexes:u,UpdateType:"delete",columnBindingInfos:[{pageName:this.listviewData.designerPageName,bindingInfos:this.listviewData.columnBindingInfos.map(function(n){return n.GUID})}],viewName:s?null:this.getFullListviewName(),masterQuery:s?null:this.getMasterQuery(),ConfirmText:n.RS.ConfirmDelete,CheckDataValidation:!1,ReloadAfterSucceed:!0},o=new n.UpdateDataTableCommand,o.CommandParam=e,c=o.UpdateDataTableCommand(e,null,this,function(){t&&i.clearAllSelectedRows();n.ListViewHelper.RequestHelper.queryTotalRowValues(i)}),c===n.CommandResult.completed&&u.forEach(function(n){return i.pushToCommitingRow(n)}))}},i.prototype.updateDataChange=function(t){var s=this,i,u,r;if(n.Common.IsEmpty(t))return n.CommandResult.completed;if(i=this._listData.getRowInfo(t),this.needCommit(t,!1)){if(u=i?i.query:null,this.GetDataCommitMode()!==0)return n.CommandResult.completed;var f=this.isMasterTable(),e={ActualShowConfirm:!1,currentTable:this.getDataTableName(),querys:[u],rowIndexes:[t],UpdateType:i?"edit":"add",rowVersion:i?i.rowVersion:null,columnBindingInfos:[{pageName:this.listviewData.designerPageName,bindingInfos:this.listviewData.columnBindingInfos.map(function(n){return n.GUID})}],viewName:f?null:this.getFullListviewName(),masterQuery:f?null:this.getMasterQuery(),ConfirmText:null,CheckDataValidation:!1,ReloadAfterSucceed:!0},o=new n.UpdateDataTableCommand;return o.CommandParam=e,r=o.UpdateDataTableCommand(e,null,this,function(){n.ListViewHelper.RequestHelper.queryTotalRowValues(s)}),r===n.CommandResult.completed&&this.pushToCommitingRow(t),r}return n.CommandResult.completed},i.prototype.commitEditChange=function(t,i){var f,e,u,o,r,s;if((t===void 0&&(t=!1),this.isGroupMode())||i===undefined&&(i=this._listData.getCurrentRowIndex(),i===undefined||i===-1)||t===!1&&!this.listviewData.canEdit()||this._commitingRows.indexOf(i)!==-1||(f=this._listData.getRowCount(),i>=f))return n.CommandResult.completed;if(e=this.validateRow(i),!e)return"cancel";for(u=!1,o=this.listviewData.getColumnCount(),r=0;r<o;r++)if((s=this.listviewData.getBindingInfo(r),!n.Common.cannotEditedBindingInfo(s))&&this._listData.isDirty(i,r)){u=!0;break}return!u&&!this.isDetailTableEdited()?n.CommandResult.completed:this.commitChangeRealTime(i,this._listData.getRowInfo(i)?"edit":"add")?this.updateDataChange(i):n.CommandResult.completed},i.prototype.checkCalcError=function(t){var u=this.listviewData.visibleColumns,i,f,r,e;if(!u)return-1;for(i=u.length-1;i>=0;i--)if((f=u[i],r=f.getBindingInfo(),r&&!r.RelationBinding)&&(e=this._listData.getValue(t,f.getColumnIndex()),e instanceof GC.Spread.CalcEngine.CalcError))return alert(n.Common.format(n.RS.InvalidValueErrorMessage,e.toString(),r.ColumnName,r.TableName)),i;return-1},i.prototype._validateRequired=function(t){var f=this.listviewData.visibleColumns,o,s,r,i,e,u,h;if(!f)return-1;for(o={},o[this.getCalcSheetName()]=t,s=f.length,r=0;r<s;r++)if(i=f[r],i.canEnterEditMode){if(i.cellType.constructor===n.CheckBoxCellType)continue;if(e=this._listData.getValue(t,i.getColumnIndex()),!n.Common.IsEmpty(e))continue;if(u=i.getTemplateCell(),!u||!u.DataValidation||u.DataValidation.IgnoreBlank)continue;if(h=n.ValidationMananger.validateDataValidation(u,e,this.getValidateHelpInfo(t,i.getColumnIndex())),!n.Common.IsEmpty(h.message))return i.needValidateWhenShowEditor=!0,r}return-1},i.prototype.editAndValidateCellWithDelayRefresh=function(t,i,r){var u=this;r===void 0&&(r=null);this._waitValidateRows.indexOf(t)===-1&&this._waitValidateRows.push(t);n.DelayRefresh.NeedDelayRun?n.DelayRefresh.setTimeout(function(){!u.hasDestroyed()&&u.isInCurrentPage()&&u.editAndValidateCell(t,i,r)},100):this.editAndValidateCell(t,i,r)},i.prototype.editAndValidateCell=function(n,t,i){i===void 0&&(i=null)},i.prototype.getAllowEditedBindingInfo=function(t){var r=this.listviewData.columnBindingInfos,f=this.listviewData.columnDataInfos,i,u;return!f||!r?null:(i=f[t],i.bindingInfoIndex>=r.length||i.bindingInfoIndex<0)?null:(u=r[i.bindingInfoIndex],n.Common.cannotEditedBindingInfo(u))?null:u},i.prototype.buildEditedRowValue=function(n,t,i,r){var f=this.listviewData.columnDataInfos,u,l,a;if(!f)return null;var o={},s=[],h={},c=!1,e=-1,v=f.length;for(u=0;u<v;u++)(l=this.getAllowEditedBindingInfo(u),l)&&(r===1&&!f[u].columnName||r!==1&&f[u].bindingInfoIndex<0||(e===-1&&(e=u),(t||this._listData.isDirty(n,u))&&(c=!0,a=this._listData.getValue(n,u),this.addEditValue(o,s,h,r,f[u],a))));if(!c){var y=i||this._listData.getRowInfo(n)===undefined,p=this._listData.getRowData(n),w=p.isInsertRow;if(y&&!w&&e>=0)this.addEditValue(o,s,h,r,f[e],null);else return null}switch(r){case 1:return o;case 0:return h;case 2:return s}},i.prototype.addEditValue=function(n,t,i,r,u,f){switch(r){case 1:n[u.columnName]=f;break;case 0:i[u.bindingInfoIndex]=f;break;case 2:t.push({pageName:this.listviewData.designerPageName,bindingInfo:this.listviewData.columnBindingInfos[u.bindingInfoIndex].GUID,value:f})}},i.prototype.isDetailTableEdited=function(){for(var r,u=i.getDetailListviews(this.getDataTableName()),n=0,t=u;n<t.length;n++)if(r=t[n],r.hasEdited())return!0;return!1},i.prototype.hasEdited=function(){if(this.deletedRowQuerys.length>0)return!0;var n=this.buildDetailListviewValues(!1);return n?!0:!1},i.prototype._getMasterValueForDetailTable=function(){var r=this.listviewData.getColIndexOfColumnOfDetailTable(),u,t,i;if(r!==-1||!this.isMasterTable()){for(u=this._listData.getRowCount(),t=0;t<u;t++)if(this._listData.getRowQuery(t))return this._listData.getValue(t,r);return i=this._getMasterTable(),i?i.getCurrentRowValue(this.getColumnOfMasterTable()):n.ForguncyData.pageInfo.normalCellBindingManager.getBindingValue({TableName:this.getMasterDataTableName(),ColumnName:this.getColumnOfMasterTable()})}},i.prototype._getMasterTable=function(){var u,n,t,r;if(!this.isMasterTable())for(u=i.getAllListviews(),n=0,t=u;n<t.length;n++)if(r=t[n],r.getDataTableName()===this.getMasterDataTableName())return r},i.prototype.getCurrentRowValue=function(n){var i=this.listviewData.getColIndexByDataColumnName(n),t;return i===-1?null:(t=this._listData.getCurrentRowIndex(),t===undefined)?null:this._listData.getValue(t,i)},i.prototype.buildDetailListviewValues=function(t,i,r){var l,f,o,s,a,h,y,u,e;if(r===void 0&&(r=0),f={calcSheetName:this.getCalcSheetName(),TableName:this.getDataTableName(),EditValues:[],AddValues:[],ColumnOfMasterTable:this.getColumnOfMasterTable(),ColumnOfDetailTable:this.getColumnOfDetailTable(),DeletedValues:[],PageName:this.designerPageName,BindingInfos:(l=this.listviewData.columnBindingInfos)===null||l===void 0?void 0:l.map(function(n){return n.GUID})},o=i===n.UpdateType.add&&this.GetDataCommitMode()===1,!o)for(s=0,a=this.deletedRowQuerys;s<a.length;s++)h=a[s],f.DeletedValues.push({query:h});for(y=this._listData.getRowCount(),u=0;u<y;u++)if(this._commitingRows.indexOf(u)===-1&&(this._listData.isDirty(u,-1)||o)){var h=null,p=null,v=null,c=null;if(o)v=f.AddValues,c=this.buildEditedRowValue(u,!0,!0,r);else{if(c=this.buildEditedRowValue(u,!1,!1,r),c===null)continue;e=this._listData.getRowInfo(u);h=e?e.query:null;p=e?e.rowVersion:null;v=e===undefined?f.AddValues:f.EditValues}t&&this.pushToCommitingRow(u);v.push({values:c,query:h,rowVersion:p,rowIndex:u})}return f.EditValues.length===0&&f.AddValues.length===0&&f.DeletedValues.length===0?null:f},i.prototype.getActualDataLength=function(){return this._listData.getRowCount()},i.prototype.getEditorRowCount=function(){return this._listData.getRowCount()+(this.allowAddRow()?1:0)},i.prototype.getCurrentRowIndex=function(){return this._listData.getCurrentRowIndex()},i.prototype.getCurrentColIndex=function(){return-1},i.prototype.isCurrentRowSameWithActiveCellRow=function(){return!0},i.prototype.isEditing=function(){return!1},i.prototype.getEditingValue=function(){return null},i.prototype.getSelectedRowsIndexes=function(){var n=this.getListDataCount(),t=function(t){return t>=0&&t<n};return this.getAllSelectedRowsOfView().filter(function(n){return t(n)})},i.prototype.getNewRowIndex=function(){return-1},i.prototype.canEditInListview=function(){return this.listviewData.canEdit()||this.canAddRow()},i.prototype.canEditOrDeleteInListview=function(){return this.listviewData.canEdit()||this.canAddRow()||this.listviewData.canDelete()},i.prototype.allowEdit=function(){return this.listviewData.canEdit()},i.prototype.isGroupMode=function(){return this.listviewData.isGroupMode()},i.prototype.getColIndexOfNamedColumn=function(n,t){return this.listviewData.getColIndexByName(n,t)},i.prototype.getDataColIndexByMergedColIndex=function(n){return this.listviewData.getDataColIndex(n)},i.prototype.getMergedColIndexByDataColIndex=function(n){return this.listviewData.getMergedColIndex(n)},i.prototype.getMergedColumnInfos=function(){return this.listviewData.getMergedColumnInfos()},i.prototype.getRangeInfo=function(){return this.listviewData.getRangeInfo()},i.prototype.getContentRangeInfo=function(){return this.listviewData.getContentRangeInfo()},i.prototype.getColumnHeaderRangeInfo=function(){return this.listviewData.getColumnHeaderRangeInfo()},i.prototype.getCalcSheetName=function(){return this.listviewData.name},i.prototype.getListviewName=function(){return this.listviewData.getListviewName()},i.prototype.getFullListviewName=function(){return this.designerPageName+this.getListviewName()},i.prototype.onCellClick=function(n,t){n!==undefined&&t!==undefined&&this._showDeleteButton()},i.prototype.refreshUI=function(n,t){n===void 0&&(n=-1);t===void 0&&(t=-1)},i.prototype.tryCommitValueBeforeQueryOrSort=function(t){if(t===void 0&&(t=!1),this.stopEditingActiveCell(t)){if(this.commitEditChange()==="cancel")return t&&this.scrollToView(),!1}else return!1;return this.allowSortOrQuery()?!0:(alert(n.RS.ErrorInfo_Uncommited),!1)},i.prototype.allowSortOrQuery=function(){return this.GetDataCommitMode()===0&&(this.isMasterTable()||this.getMasterQuery())?!0:this.containUncommitedValue()?!1:!0},i.prototype.containUncommitedValue=function(){return this.containUncommitedDeleteRows()?!0:this.canEditOrDeleteInListview()?this.containUncommitedEditOrAddValues()?!0:this._commitingRows.filter(function(n){return n>=0}).length>0?!0:!1:!1},i.prototype.containUncommitedDeleteRows=function(){return this.deletedRowQuerys.length>0&&this.GetDataCommitMode()!==0},i.prototype.containUncommitedEditOrAddValues=function(){for(var t,i=this._listData.getRowCount(),r=this._listData.getColumnCount(),n=0;n<r;n++)if(this.listviewData.isDataColumnAllowEdit(n))for(t=0;t<i;t++)if(this._listData.isDirty(t,n))return!0;return!1},i.prototype.isCommiting=function(n){return this._commitingRows.indexOf(n)!==-1},i.getDetailListviews=function(t){return n.Common.IsEmpty(t)?[]:i.getAllListviews().filter(function(n){return n.getMasterDataTableName()===t})},i.getAllListviews=function(t){return n.ForguncyData.pageInfo.pageElementManager.listviewCollection.getListviews(t)},i.getListviewsRelatedWithTable=function(n){for(var t,u=[],e=i.getAllListviews(),r=0,f=e;r<f.length;r++)t=f[r],(t.getMasterDataTableName()===n||t.getDataTableName()===n)&&u.push(t);return u},i.getListviewByCalcSheetName=function(n){var t=i.getAllListviews().filter(function(t){return t.getCalcSheetName()===n});return t&&t.length>0?t[0]:null},i.getListviewByLocationString=function(n){var t=i.getAllListviews().filter(function(t){return t.getLocationString()===n});return t&&t.length>0?t[0]:null},i.getListview=function(n,t){var r=i.getAllListviews().filter(function(i){return i.getListviewName()===n&&i.runTimePageName===t});return r.length>0?r[0]:null},i.lockListviewClick=function(){$(document.body).addClass("listview-click-lock")},i.getListviewClickLocked=function(){return $(document.body).hasClass("listview-click-lock")},i.init=function(){var t=this;$(document).on("click",function(r){var u,e,a,v,s,h,c,o,l,f,y;if(!t.getListviewClickLocked()){if(r.target){if(n.ListviewDeleteButton&&r.target.className===n.ListviewDeleteButton.className)return;if(u=$(r.target),e=u.attr("type"),(e==="checkbox"||e==="radio"||e==="file")&&(a=u.attr(n.StaticValues.isInListview),a))return;if(v=u.closest("[gcuielement='fgcDropDownWindow']"),v.length===1)return;if(s=u.closest(".gcim-calendar,.gcim-calendar__navigator_vertical"),s.length===1&&s.parents().last()[0].tagName!=="HTML")return}if(h=n.ForguncyData.pageInfo.pageElementManager.listviewCollection.getUIListviews(),h.length!==0)for(c=n.Common.getMousePosition(r||window.event),o=0,l=h;o<l.length;o++)f=l[o],y=f.getContainerDiv(),i.isPointInElement(c,y)?f.isPointInDeleteButton(c)&&f.setIsFocused(!1):f.setIsFocused(!1)}})},i.isPointInElement=function(n,t){var i=t.offset(),r=t.width(),u=t.height();return n.y<i.top||n.y>i.top+u||n.x<i.left||n.x>i.left+r?!1:!0},i.prototype.onPageLoaded=function(){var t=this;this.listviewData.getDoNotLoadDataWhenLoadPage()&&n.DependenceCellValueChangeHelper.listenFormulaRefChanged(this.listviewData.getConditionFormulaList(),function(){t.onDependenceCellValueChanged()},this.runTimePageName)},i.onPageCreated=function(){$("#pageWrapper_"+n.ForguncyData.pageInfo.pageID).on("focusin",i.OnPageFocusin)},i.onPageDestroyed=function(){$("#pageWrapper_"+n.ForguncyData.pageInfo.pageID).off("focusin",i.OnPageFocusin)},i.OnPageFocusin=function(t){var i,r,u;n.ListviewDeleteButton&&t.target&&t.target.className===n.ListviewDeleteButton.className||(i=n.ForguncyData.pageInfo.pageElementManager.listviewCollection.getUIListviews(),i.length!==0)&&(r="",t.target&&(u=$(t.target).closest("[fgc-uielement='listview']"),u.length===1&&(r="#"+u.attr("id"))),i.forEach(function(n){return n.setIsFocused("#"+n.getContainerDiv().attr("id")===r)}))},i.prototype.setIsFocused=function(t){if(typeof t=="boolean"&&this.isFocused!==t&&(this.isFocused=t,!this.isFocused&&!this._haveTriggerOnLostFocusMethod)){this._haveTriggerOnLostFocusMethod=!0;var i=this;n.DelayRefresh.setTimeout(function(){i.hasDestroyed()||i.onLostFocus()})}},i.prototype.onLostFocus=function(){this.isFocused||(this.hideDeleteButton(),this.stopEditingActiveCell()&&this.commitEditChange(),this._haveTriggerOnLostFocusMethod=!1)},i.prototype.validateRow=function(n){if(n===undefined)return!0;var t=this._validateRequired(n);return t!==-1?(this.editAndValidateCellWithDelayRefresh(n,t),!1):(t=this.checkCalcError(n),t!==-1)?(this.selectInEditor(n,t),!1):i.validateDetailListviews(this.getDataTableName())},i.validateDetailListviews=function(n){var t=i.getDetailListviews(n);return t.every(function(n){if(!n.stopEditingActiveCell())return!1;var t=n.getCurrentRowIndex();return t>=0&&t<n._listData.getRowCount()?n.validateRow(t):!0})},i.validateListviewsData=function(n,t){return n?i.isListviewsValidationPassed(n,!0,t):0},i.isListviewsValidationPassed=function(n,t,i){for(var u,f=n.length,e=function(r){var f=n[r],u=null,e;if(i){if(u=i.filter(function(n){return n.calcSheetName===f.getCalcSheetName()})[0],u)return"continue";u={calcSheetName:f.getCalcSheetName(),runTimePageName:f.runTimePageName,columnCache:{}}}return e=f.isValidationPassed(u),u&&Object.keys(u.columnCache).length>0&&i.push(u),e===1&&t&&f.scrollToView(),e!==0?{value:e}:void 0},r=0;r<f;r++)if(u=e(r),typeof u=="object")return u.value;return 0},i.prototype.isValidationPassed=function(n){if(!this.stopEditingActiveCell())return 1;var t=this.buildDetailListviewValues(!1);return t?this.validateCellValues(t,n):0},i.prototype.scrollToView=function(){},i.prototype.endEdit=function(){},i.prototype.stopEditingActiveCell=function(n){return n===void 0&&(n=!1),!0},i.prototype.cancelEdit=function(){},i.prototype.tryCommitEdit=function(){return this.commitEditChange()==="cancel"?!1:this.stopEditingActiveCell()?!0:!1},i.prototype.getListviewControl=function(){return null},i.prototype.destroy=function(){this._destroy();this._currentRowInfoChangedEventHandler&&n.ForguncyData.pageInfo.currentRowInfoCollection.unbind("currentrowinfochanged",this._currentRowInfoChangedEventHandler);this._pagingInfoChangedEventHandler&&n.ForguncyData.pageingInfoList.unbind("pageingInfoChanged",this._pagingInfoChangedEventHandler);n.ForguncyData.pageInfo.dataModel.removeListData(this._listData);this._hasDestroyed=!0},i.prototype._destroy=function(){},i.prototype.hasDestroyed=function(){return this._hasDestroyed},i.prototype.GetDataCommitMode=function(){return this.listviewData.getDataCommitMode()},i.prototype.GetDataValidationTime=function(){return this.listviewData.getDataValidationTime()},i.prototype.getControl=function(){return null},i.prototype.validateCellValues=function(n,t){var i,f,u,e;if(n.EditValues)for(i=0,f=n.EditValues;i<f.length;i++){var o=f[i],s=o.values,h=o.rowIndex,r=this.validateRowValues(h,s,!0,t);if(r!==0)return r}if(n.AddValues)for(u=0,e=n.AddValues;u<e.length;u++){var c=e[u],s=c.values,h=c.rowIndex,r=this.validateRowValues(h,s,!1,t);if(r!==0)return r}return 0},i.prototype.validateRowValues=function(t,i,r,u){var o=this.listviewData.columnDataInfos,h,f,c,e,l,s,v;if(!o)return 0;for(h=o.length,f=0;f<h;f++)if(c=this.getAllowEditedBindingInfo(f),c){if(e=i[o[f].bindingInfoIndex],e===undefined)if(r)continue;else e=null;try{l=this.validateValue(f,e,!1,!1,t,u==null);i[o[f].bindingInfoIndex]=l}catch(a){if(s=this.getVisibleColumnIndexInListViewByDataIndex(f),s<0||!this.listviewData.visibleColumns[s].canEditInForguncy)continue;if(this._listData.getCurrentRowIndex()!==t&&(v=this.commitEditChange(),v==="cancel"))return 1;if(a.message===n.CommandValidator.pendingError)this.addValidateCommandCache(e,t,f,u);else return this.editAndValidateCellWithDelayRefresh(t,s,a),1}}return 0},i.prototype.addValidateCommandCache=function(t,i,r,u){if(u){if(!u.columnCache[r]){var e=this.getMergedColIndexByDataColIndex(r),o=this.getVisibleColumnIndexInListViewByDataIndex(r),f=o===-1?null:this.listviewData.visibleColumns[o];u.columnCache[r]={mergedColIndex:e,locationStr:n.FormulaHelper.getListviewCellLogLocationString("{0}",e,f===null||f===void 0?void 0:f.getName(),this.getListviewName(),this.runTimePageName),values:[]}}u.columnCache[r].values.push({rowIndex:i,value:t})}},i.prototype.updateMultiRows=function(t,i,r){var f=this,u=this.isMasterTable(),e={tableInfo:t,viewName:u?null:this.getFullListviewName(),masterQuery:u?null:this.getMasterQuery()};n.HomeController.CommitEditedTable(e,function(t){i.apply(null,[t]);n.ListViewHelper.RequestHelper.queryTotalRowValues(f)},r)},i.prototype.isTextFormat=function(n){for(var r,u,t=0,i=this.listviewData.visibleColumns;t<i.length;t++)if(r=i[t],r.getColumnIndex()===n){if(u=r.getTemplateCell(),u)return u.StyleInfo.Formatter==="@";break}return!1},i.prototype.clearSelectionOutOfCurrentRow=function(){},i.prototype.addSelectedRow=function(){},i.prototype.setSelectedRows=function(){},i.prototype.clearSelectedRow=function(){},i.prototype.selectAllRows=function(){},i.prototype.clearAllSelectedRows=function(t){t===void 0&&(t=n.SelectionRowMode.CurrentPagination);t===n.SelectionRowMode.AllPagination&&this.cacheManager.getCachedRows().length>0&&(this.cacheManager.clearAll(),this.delayTriggerEvent(n.ListViewEvents.SelectedRowsChanged,{}));this.onSelectionChanged(!0)},i.prototype.isSelectedRow=function(n){return this.getSelectedRowsIndexes().indexOf(n)>=0},i.prototype.getSelectedRowsDataByAPI=function(){var t=this,i=t.getMergedColumnInfos(),r=i.length,u=t.getSelectedRowsData(),f=u.map(function(u){var e,f,s,o;if(n.Common.IsEmpty(u)||n.Common.IsEmpty(u.values))return null;for(e=[],f=0;f<r;f++)s=i[f].DesignerColumnIndex-t.getRangeInfo().Column,o=u.values[s],e.push(n.Common.IsEmpty(o)?null:o);return{RowIndex:u.index,Query:__assign({},u.query),Values:e}});return f.filter(function(n){return!!n})},i.prototype.getSelectedRowsData=function(){var t=this,n=[];return n=this.getAlwaysReservedSelections()?this.cacheManager.getCachedRows():this.getSelectedRowsIndexes().map(function(n){return t.getCachedRowData(n)}),n?n:[]},i.prototype.clearSelectedRowByQuery=function(){},i.prototype.selectRowsByValue=function(t,i){var u=this,r;!n.Common.IsEmpty(t)&&t instanceof Array||(t=[]);r=t.map(function(n){return u.getRowIndexByValue(n,i)});this.getAlwaysReservedSelections()?this.selectRowsByValueInReservedMode(r,t,i):this.setSelectedRows(r)},i.prototype.selectRowsByValueInReservedMode=function(t,i,r){var e=this,u=[],f;if(t.forEach(function(n,t){n===-1&&u.push(i[t])}),f=this.getBindingInfoGUID(r),n.Common.IsEmpty(f)||u.length===0){this.selectRowsWithCache(t,i,r,null);return}n.ListViewHelper.RequestHelper.queryListviewDatasByQuery(this,f,u,function(n){return e.selectRowsWithCache(t,i,r,n)})},i.prototype.selectRowsWithCache=function(t,i,r,u){var f=this,e;this.cacheManager.clearAll();e=t.map(function(n,t){if(n===-1){var e=f.getListRowDataFromServerData(i[t],r,u);return e?f.getCachedRowDataFromListRowData(e):null}return f.getCachedRowData(n)}).filter(function(n){return n});this.cacheManager.saveSelectionDatas(e);this.setSelectedRows(t);this.delayTriggerEvent(n.ListViewEvents.SelectedRowsChanged,{})},i.prototype.getListRowDataFromServerData=function(t,i,r){var e,f,o,u,s;if(!r)return null;for(f=0,o=r;f<o.length;f++)if(u=o[f],s=(e=u===null||u===void 0?void 0:u.data[i])===null||e===void 0?void 0:e.bindingValue,n.Common.isFuzzyEquals(s,t))return u;return null},i.prototype.getCachedRowDataFromListRowData=function(n){for(var i,f,t=n.rowInfo,s=t===null||t===void 0?void 0:t.query,h=t===null||t===void 0?void 0:t.rowVersion,e=[],u=0,o=n.data;u<o.length;u++)i=o[u],f=i===null||i===void 0?void 0:i.bindingValue,e.push(f===undefined?null:f);return new r(s,h,e,-1)},i.prototype.getBindingInfoGUID=function(n){var t=this.listviewData.columnDataInfos[n].bindingInfoIndex;return t===-1?null:this.listviewData.columnBindingInfos[t].GUID},i.prototype.getRowIndexByValue=function(t,i){for(var u,r=0;r<this._listData.getRowCount();r++)if(u=this._listData.getValue(r,i),n.Common.isFuzzyEquals(u,t))return r;return-1},i.prototype.getAlwaysReservedSelections=function(){return this.listviewData.getAlwaysReservedSelections()&&this.listviewData.isRowHeaderCheckBoxVisible()},i.prototype.getAlwaysInEditMode=function(){return this.listviewData.getAlwaysInEditMode()},i.prototype.bindingTableCanEdit=function(){return this.listviewData.bindingTableCanEdit()},i.prototype.getText=function(t,i){var u=this._listData.getValue(t,i),r;return n.Common.IsEmpty(u)?null:(r=this.listviewData.getColumnMetaData(i),r&&r.TemplateCell&&r.TemplateCell.Element&&r.TemplateCell.Element.StyleInfo&&r.TemplateCell.Element.StyleInfo.Formatter)?n.FormatHelper.format(r.TemplateCell.Element.StyleInfo.Formatter,u).text:u instanceof Date?n.FormatHelper.format(n.StaticFormatString.dateTimeDefaultFormattingString,u).text:u},i.prototype.getColumnHeaderText=function(t,i){var u=this.getHeaderCellIDSuffix(this.listviewData.getColumnMetaData(i).IsExternal),r=this.getRangeInfo(),f=n.Common.getIdStr(t+r.Row,i+r.Column,u);return n.ForguncyData.pageInfo.dataModel.normalCellDataModel.getValue(f)},i.prototype._getPageStretchInfo=function(){return n.PageManager.getPageStretchInfo(this.runTimePageName)},i.prototype._getPageLayout=function(){return n.ForguncyData.getPageLayout(this.locatedPageID,this.runTimePageName)},i.prototype.getLocationString=function(){return n.Common.IsEmpty(this._locationString)&&(this._locationString=i.getLocationString(this.runTimePageName,this.getListviewName())),this._locationString},i.getLocationString=function(t,i){return n.PageManager.getLocationString(t)+"|"+i},i.prototype.getPagingInfo=function(){var i=this.getLocationString(),t;return n.ForguncyData.pageingInfoList.IsPageing(i)?(t=n.ForguncyData.pageingInfoList.GetInfo(i),{PageCount:t.getPageCount(),PageIndex:t.getCurrentPageIndex(),MaxRowCountOfOnePage:t.limit,TotalRowCount:t.rowCount}):null},i.prototype.selectRowByQuery=function(t){for(var r=this._listData.getRowCount(),i=0;i<r;i++)if(n.Common.isQueryEqual(this._listData.getRowQuery(i),t))return this.selectRow(i),!0;return!1},i.prototype.focus=function(){},i.prototype.getRowValue=function(n){return this._listData.getRowValue(n)},i.prototype.getColumnHeaderRowCount=function(){return this.listviewData.isColumnHeaderVisible()?this.listviewData.getColumnHeaderHeight().length:0},i.prototype.getExportColmnMetadatas=function(){var n=0;return this.listviewData.isRowHeaderVisible()&&n++,this.listviewData.isRowHeaderCheckBoxVisible()&&n++,this.listviewData.metadata.Columns.slice(n)},i.prototype.getColumnWidth=function(){return 0},i.prototype.getAutoFitWidth=function(){return 0},i.prototype.getRowState=function(){return 0},i.prototype.getColumnFilterHelper=function(t){return new n.ListviewColumnFilterHelper(this.getLocationString(),t,this.designerPageName)},i.prototype.getCachedRowData=function(n){var t=this._listData.getRowInfo(n),i=t?t.query:null,u=t?t.rowVersion:null,f=this._listData.getRowValue(n);return new r(i,u,f,i?-1:n)},i.prototype.getAllSelectedRowsOfView=function(){return[]},i.prototype.clearSelectionCache=function(n){this.getAlwaysReservedSelections()&&(n?this.cacheManager.clearByQuery(n,null):this.cacheManager.clearAll())},i.prototype.getColumnNameForTranslateFormula=function(){return null},i.CurrentRowChangedCommandId=0,i}(n.EventClassBase);n.ListviewBase=t;i=function(t){function i(n,i,r,u){var f=t.call(this,i,r,u)||this;return f._containerDiv=n,f.loadingIndicator=null,f.cover=null,f._forceHideLoadingIndicator=!1,f._nodataDom=null,f._forceHideLoadingIndicator=f.listviewData.getIsAutoReload(),f}return __extends(i,t),i.prototype.onLoad=function(){var i=this,u,r;t.prototype.onLoad.call(this);this.tryCreateDeleteButton();r=this.listviewData.metadata;n.DependenceCellValueChangeHelper.listenFormulaRefChanged([(u=r===null||r===void 0?void 0:r.NoItemSetting)===null||u===void 0?void 0:u.TextForNoItem],function(){if(i._nodataDom){var n=i.getNoItemText(),t=i._getNodataTextId();i._nodataDom.find("#"+t).text(n)}},this.runTimePageName)},i.prototype._getNodataTextId=function(){return this.getContainerDiv().attr("id")+"_nodata"},i.prototype.getContainerDiv=function(){return $(this._containerDiv)},i.prototype.refreshUI=function(n,i){n===void 0&&(n=-1);i===void 0&&(i=-1);t.prototype.refreshUI.call(this,n,i);this._deleteButton&&this._deleteButton.isVisible()&&this.getCurrentRowCenterY()!==this._deleteButton.getButtonCenterY()&&this._showDeleteButton()},i.prototype.getColHeaderHeight=function(){return 0},i.prototype.showLoadingIndicator=function(t){var i,u,r;if(t===void 0&&(t=!0),this.loadingIndicator===null){if(i=this.getContainerDiv(),!i||i.length===0)return;u=999;r=this.getColHeaderHeight();this.listviewData.getColumnOperation()!==1&&(r=0);this.cover=n.Common.getCover("transparent",1).css("position","absolute").css("width","100%").css("height","calc(100% - ".concat(r,"px)")).css("left","0").css("top",r+"px").css("zIndex",u).appendTo(i);var f=n.ForguncyData.GlobalSettings,e=f.ListviewLoadingIndicatorContentDom,o=f.ListviewLoadingIndicatorSettings,s=o.LoadingType===n.LoadingType.CSSAnimation?.5:1;this.loadingIndicator=$(e).addClass("listview-loading-indicator").css("position","absolute").css("left","50%").css("top","50%").css("transform","translate(-50%, -50%) scale(".concat(s,")")).css("zIndex",u).appendTo(i)}this.protectListview(!0);this.cover.show();!this._forceHideLoadingIndicator&&t&&this.loadingIndicator.show();this.hideDeleteButton()},i.prototype._hideNoData=function(){this._nodataDom&&(this._nodataDom.remove(),this._nodataDom=null)},i.prototype._showNoData=function(){this._hideNoData();var t=this.getContainerDiv(),r=this.listviewData.metadata.NoItemSetting,u=t.attr("id"),i=this._getNodataTextId(),f=this.getNoItemText(),e=this.listviewData.getListViewStyleTemplate().GrayAreaFore,o=n.Common.updateNoItemSettingToDom(r,t,{id:i,isInListview:!1},i,f,u,undefined,this._nodataDom,undefined,e);this._nodataDom=o._noItemPart},i.prototype.getNoItemText=function(){var t,i=this.listviewData.metadata.NoItemSetting;return n.ForguncyData.pageInfo.formulaManager.evaluateFormula(i.TextForNoItem,{runTimePageName:this.runTimePageName,listInfo:(t={},t[this.getCalcSheetName()]=0,t)})},i.prototype.updateNodata=function(){this.needShowNoItemImage()?this._showNoData():this._hideNoData()},i.prototype.hiddenLoadingIndicator=function(n){n===void 0&&(n=!1);this.loadingIndicator&&(this.cover.hide(),this.loadingIndicator.hide(),this.protectListview(!1))},i.prototype.needShowNoItemImage=function(){var t=this.listviewData.metadata.NoItemSetting,i=this._listData.getRowCount()+(this.allowAddRow()?1:0);return n.Common.needShowNoItemImage(t,i)},i.prototype.scrollToView=function(){var t=this.getContainerDiv();t.length>0&&n.Common.scrollToElement(t,this.runTimePageName)},i.prototype.tryCreateDeleteButton=function(){var t=this;this.listviewData.canDelete()&&(this._deleteButton||(this._deleteButton=new n.ListviewDeleteButton(this.getContainerDiv()),this._deleteButton.bind("click",function(){return t.deleteOnUIClick(!1)})))},i.prototype._showDeleteButton=function(){var n,t,i;if(this.listviewData.canDelete()&&this._deleteButton&&!this.isProtected()){if(n=this._listData.getCurrentRowIndex(),this.isFocused&&n!==undefined&&n>=0&&(t=this._listData.getRowCount(),t>0&&n<t&&(i=this.getCurrentRowCenterY(),i!==-1))){this._deleteButton.show(i);return}this.hideDeleteButton()}},i.prototype.hideDeleteButton=function(){this._deleteButton&&this._deleteButton.hide()},i.prototype.isPointInDeleteButton=function(n){var t;return((t=this._deleteButton)===null||t===void 0?void 0:t.isVisible())&&this._deleteButton.isPointIn(n)},i.prototype.getCellTypeByColIndex=function(n){return this.listviewData.getColumnCellType(n,this.runTimePageName)},i}(t);n.UIListviewBase=i;u=function(i){function r(t,r,u){var f=this,e=new n.ListviewData(t,r,u);return f=i.call(this,e,r,u)||this,f._selectedRowIndexes=[],f}return __extends(r,i),r.getFormulaInfos=function(n){for(var u,f,s=t.getAllListviews([n]).filter(function(n){return n instanceof r}),e={},i=0,o=s;i<o.length;i++)u=o[i],f=u.getFormulaInfos(),f&&(e[u.getListviewName()]=f);return e},r.prototype.getFormulaInfos=function(){var t=[];return this.listviewData.metadata.Columns.forEach(function(i){var r=i.TemplateCell.Element.Formula;n.Common.IsEmpty(r)||t.push({RowIndex:-1,ColumnIndex:i.Index,RowCount:0,ColumnCount:0,Formula:r})}),t.length===0?null:t},r.prototype.getColumnNameForTranslateFormula=function(){return this.listviewData.columnDataInfos.map(function(n){var t;if((t=n.columnName)!==null&&t!==void 0)return t.toLowerCase()})},r.prototype.shouldResetCurrentRow=function(){return!0},r.prototype.canAddRow=function(){return this.listviewData.canAddRow()},r.prototype.getAlwaysReservedSelections=function(){return this.listviewData.getAlwaysReservedSelections()},r.prototype.getAllSelectedRowsOfView=function(){return this._selectedRowIndexes},r.prototype.beforeRefeshUIWhenQueryDataFromServer=function(){this.getAlwaysReservedSelections()?this.updateSelectedRowsFromCache():this._selectedRowIndexes=[];this.triggerSelectedRowsChangedEvent()},r.prototype.updateSelectedRowsFromCache=function(){this._selectedRowIndexes=[];this.cacheManager.reset();for(var n=0;n<this._listData.getRowCount();n++)this.cacheManager.exists(this.getCachedRowData(n))&&this._selectedRowIndexes.push(n);this.cacheManager.save(this.getSelectedRowsIndexes())},r.prototype.clearSelectionOutOfCurrentRow=function(){this._selectedRowIndexes=[];this.onSelectionChanged()},r.prototype.addSelectedRow=function(n){n<0||n>=this.getListDataCount()||this._selectedRowIndexes.indexOf(n)>=0||(this.listviewData.isSingleSelection()?this._selectedRowIndexes=[n]:this._selectedRowIndexes.push(n),this.onSelectionChanged())},r.prototype.setSelectedRows=function(n){var i=this,t=n.filter(function(n){return n>=0&&n<i.getListDataCount()});this._selectedRowIndexes=this.listviewData.isSingleSelection()&&t.length>0?[t[t.length-1]]:t;this.onSelectionChanged()},r.prototype.clearSelectedRow=function(n){if(!(n<0)&&!(n>=this.getListDataCount())){var t=this._selectedRowIndexes.indexOf(n);t!==-1&&(this._selectedRowIndexes.splice(t,1),this.onSelectionChanged())}},r.prototype.selectAllRows=function(){var t,n;if(!this.listviewData.isSingleSelection()){for(t=[],n=0;n<this.getListDataCount();n++)t.push(n);this._selectedRowIndexes=t;this.onSelectionChanged()}},r.prototype.clearAllSelectedRows=function(n){this._selectedRowIndexes=[];i.prototype.clearAllSelectedRows.call(this,n)},r.prototype.clearSelectedRowByQuery=function(t){var i=this;this.getSelectedRowsIndexes().forEach(function(r){if(n.Common.isQueryEqual(i._listData.getRowQuery(r),t)){var u=i._selectedRowIndexes.indexOf(r);u>=0&&i._selectedRowIndexes.splice(u,1)}});this.getAlwaysReservedSelections()&&this.cacheManager.clearByQuery(t,function(){i.delayTriggerEvent(n.ListViewEvents.SelectedRowsChanged,{})});this.onSelectionChanged()},r.prototype.onSelectionChanged=function(n){var t,i;n===void 0&&(n=!0);t=this.getListDataCount();t<=0?this._selectedRowIndexes=[]:(i=function(n){return n>=0&&n<t},this._selectedRowIndexes=this._selectedRowIndexes.filter(function(n){return i(n)}).sort(function(n,t){return n-t}));this.operationTypeWhenValueChanged===0&&(this.getAlwaysReservedSelections()&&this.cacheManager.save(this.getSelectedRowsIndexes()),this.triggerSelectedRowsChangedEvent())},r.prototype.updateSelectedRowsAfterDeleteRow=function(n){this.getAlwaysReservedSelections()?this.updateSelectedRowsFromCache():this._selectedRowIndexes=this._selectedRowIndexes.map(function(t){return t===n?-1:t>n?t-1:t});this.onSelectionChanged()},r.prototype.updateSelectedRowsAfterInsertRows=function(n,t){this.getAlwaysReservedSelections()?this.updateSelectedRowsFromCache():this._selectedRowIndexes=this._selectedRowIndexes.map(function(i){return i>=n?i+t:i});this.onSelectionChanged()},r}(t);n.DataSourceListview=u;f=function(t){function i(n,i,r,u){var f=t.call(this,n,i,r,u)||this;return f._selectedRowIndexes=[],f}return __extends(i,t),i.prototype.getAllSelectedRowsOfView=function(){return this._selectedRowIndexes},i.prototype.beforeRefeshUIWhenQueryDataFromServer=function(){this.getAlwaysReservedSelections()?this.updateSelectedRowsFromCache():this._selectedRowIndexes=[];this.triggerSelectedRowsChangedEvent()},i.prototype.updateSelectedRowsFromCache=function(){this._selectedRowIndexes=[];this.cacheManager.reset();for(var n=0;n<this._listData.getRowCount();n++)this.cacheManager.exists(this.getCachedRowData(n))&&this._selectedRowIndexes.push(n);this.cacheManager.save(this.getSelectedRowsIndexes())},i.prototype.clearSelectionOutOfCurrentRow=function(){this._selectedRowIndexes=[this._listData.getCurrentRowIndex()];this.onSelectionChanged()},i.prototype.addSelectedRow=function(n){n<0||n>=this.getListDataCount()||this._selectedRowIndexes.indexOf(n)>=0||(this.listviewData.isSingleSelection()?this._selectedRowIndexes=[n]:this._selectedRowIndexes.push(n),this.onSelectionChanged())},i.prototype.setSelectedRows=function(n){var i=this,t=n.filter(function(n){return n>=0&&n<i.getListDataCount()});this._selectedRowIndexes=this.listviewData.isSingleSelection()&&t.length>0?[t[t.length-1]]:t;this.onSelectionChanged()},i.prototype.clearSelectedRow=function(n){if(!(n<0)&&!(n>=this.getListDataCount())){var t=this._selectedRowIndexes.indexOf(n);t!==-1&&(this._selectedRowIndexes.splice(t,1),this.onSelectionChanged())}},i.prototype.selectAllRows=function(){var t,n;if(!this.listviewData.isSingleSelection()){for(t=[],n=0;n<this.getListDataCount();n++)t.push(n);this._selectedRowIndexes=t;this.onSelectionChanged()}},i.prototype.clearAllSelectedRows=function(n){this._selectedRowIndexes=[];t.prototype.clearAllSelectedRows.call(this,n)},i.prototype.clearSelectedRowByQuery=function(t){var i=this;this.getSelectedRowsIndexes().forEach(function(r){if(n.Common.isQueryEqual(i._listData.getRowQuery(r),t)){var u=i._selectedRowIndexes.indexOf(r);u>=0&&i._selectedRowIndexes.splice(u,1)}});this.getAlwaysReservedSelections()&&this.cacheManager.clearByQuery(t,function(){i.delayTriggerEvent(n.ListViewEvents.SelectedRowsChanged,{})});this.onSelectionChanged()},i.prototype.selectInEditor=function(n){if(n>=0&&n<this.getListDataCount()){this._selectedRowIndexes=[n];this.onSelectionChanged(!1)}},i.prototype.onSelectionChanged=function(n){var t,i;if(n===void 0&&(n=!0),t=this.getListDataCount(),t<=0?this._selectedRowIndexes=[]:(i=function(n){return n>=0&&n<t},this._selectedRowIndexes=this._selectedRowIndexes.filter(function(n){return i(n)}).sort(function(n,t){return n-t})),n)if(this._selectedRowIndexes.length>0)this.onCurrentRowChanged(this._selectedRowIndexes[0]);else this.onCurrentRowChanged(0);this.operationTypeWhenValueChanged===0&&(this.getAlwaysReservedSelections()&&this.cacheManager.save(this.getSelectedRowsIndexes()),this.triggerSelectedRowsChangedEvent())},i.prototype.updateSelectedRowsAfterDeleteRow=function(n,t){this.getAlwaysReservedSelections()?this.updateSelectedRowsFromCache():this._listData.getCurrentRowIndex()!==t&&(this._selectedRowIndexes=[]);this.onSelectionChanged(!1)},i.prototype.updateSelectedRowsAfterInsertRows=function(){this.getAlwaysReservedSelections()?this.updateSelectedRowsFromCache():this._selectedRowIndexes=[];this.onSelectionChanged(!1)},i}(i);n.HiddenListview=f;e=function(){function t(){this.listviews=[]}return t.prototype.addSpreadJSView=function(t,i,r,u,f){var e=new n.SpreadJSView(t,i,r,u,f);return this.listviews.push(e),e},t.prototype.addHiddenListview=function(n,t,i,r){var u=new f(n,t,i,r);return this.listviews.push(u),u},t.prototype.addDataSourceListview=function(n,t,i){var r=new u(n,t,i);return this.listviews.push(r),r},t.prototype.getListviews=function(n){return n?this.listviews.filter(function(t){return n.indexOf(t.runTimePageName)>=0}):this.listviews},t.prototype.getUIListviews=function(n){return this.getListviews(n).filter(function(n){return n instanceof i})},t.prototype.destroy=function(n){n===void 0&&(n=null);this.getListviews(n).forEach(function(n){return n.destroy()});n&&(this.listviews=this.listviews.filter(function(t){return n.indexOf(t.runTimePageName)===-1}))},t.prototype.onDefaultDataSetted=function(t){var i=this.getListviews(t).filter(function(t){return n.SpreadJSView&&t instanceof n.SpreadJSView});i.forEach(function(n){return n.initConditionFormatCalc()});i.forEach(function(n){return n.initConditionFormatFormula()})},t.prototype.loseAllFocus=function(){this.getListviews().filter(function(t){return n.SpreadJSView&&t instanceof n.SpreadJSView}).forEach(function(n){return n.focus(!1)})},t}();n.ListviewCollection=e;o=function(){function n(n,t,i){var r=this;this._finishedCallBack=t;this._stopWhenHaveError=i;this._actions=[];this._errorInfos=[];this._finishedActionCount=0;this._actions=n.map(function(n){return r.getActionWrapper(n)})}return n.prototype.getActionWrapper=function(n){var t=this;return function(){if(t.shouldDoAction()){var i=n();i&&(t._errorInfos.push(i),t._stopWhenHaveError&&t._finishedCallBack(t._errorInfos))}t._finishedActionCount++;t.shouldCallBack()&&t._finishedCallBack(t._errorInfos)}},n.prototype.shouldDoAction=function(){return this._finishedActionCount>=this._actions.length?!1:this._errorInfos.length>0&&this._stopWhenHaveError?!1:!0},n.prototype.shouldCallBack=function(){return this._finishedActionCount<this._actions.length?!1:this._stopWhenHaveError&&this._errorInfos.length>0?!1:!0},n.prototype.execute=function(){var i=this,n,t;this._actions.length===0&&this._finishedCallBack(this._errorInfos);!!window.ActiveXObject||"ActiveXObject"in window?(n=0,t=function(){setTimeout(function(){var u,r;(r=(u=i._actions)[n])===null||r===void 0?void 0:r.call(u);n<i._actions.length&&(n++,t())},0)},t()):this._actions.forEach(function(n){setTimeout(n,0)})},n}();s=function(){function t(n){this._listview=n;this._dataModel=n.getListDataModel();this._listviewName=n.getListviewName()}return t.prototype.importDataWithText=function(t,i,r,u,f,e){var s=this,h=function(){var n=s.getValidateActions(t,u),h=function(n){n&&n.length!==0?e({Success:!1,ErrorInfos:n}):s.importData(t,i,r,u,e)};new o(n,h,f).execute()};n.SpreadJSView&&this._listview instanceof n.SpreadJSView?this._listview.cacheComboboxForValidateText(t,h):h()},t.prototype.getValidateActions=function(t,i){for(var u=this,f=[],e=function(r){f.push(function(){try{i.forEach(function(n){t[r][n]=u._listview.validateValue(n,t[r][n],!0,!0)})}catch(e){if(u._listview.GetDataValidationTime()===0){var f=e;return f.RowIndex=r,{ErrorType:n.ImportError.ValidateError,ErrorData:f}}}})},r=0;r<t.length;r++)e(r);return f},t.prototype.prepareListview=function(){var n=this._listview.stopEditingActiveCell(!1);n||this._listview.cancelEdit();this._listview.hideDeleteButton()},t.prototype.importData=function(t,i,r,u,f){var l=this,s,h,c,e,o;this.prepareListview();try{if(i===n.ImportMode.Replace&&r&&r.length>=1){for(h=[],c=function(n){h.push(r.map(function(t){return l._dataModel.getValue(n,t)}))},e=0;e<this._dataModel.getRowCount();e++)c(e);this.checkEmptyKeys(h,!1)}o=this.getImportDataInfo(t,i,r);this.onlyAddRows(o)?this.addData(t,u,o):this.replaceData(t,u,o);n.Common.IsEmpty(this._dataModel.getCurrentRowIndex())&&this._listview.selectRow(0);s={Success:!0}}catch(a){s={Success:!1,ErrorInfos:[a]}}f(s)},t.prototype.addData=function(n,t,i){var r=[];this.updateData(r,n,t,i);this._dataModel.addData(r,7)},t.prototype.replaceData=function(n,t,i){var r=this._dataModel.getData(!0);this.updateData(r,n,t,i);this._dataModel.setData(r)},t.prototype.updateData=function(n,t,i,r){var u=this;r.editRowIndexes&&r.editRowIndexes.forEach(function(f,e){var o=t[f],s=r.editRowIndexesInListView[e],h=n[s];i.forEach(function(n){u.changeValue(o[n],n,h)})});r.deleteRowIndexesInListView&&r.deleteRowIndexesInListView.sort(function(n,t){return t-n}).forEach(function(t){n.splice(t,1).forEach(function(n){var t;((t=n.rowInfo)===null||t===void 0?void 0:t.query)&&u._listview.deletedRowQuerys.push(n.rowInfo.query)})});r.addRowIndexes&&r.addRowIndexes.forEach(function(r){var f=u._listview.getNewRowData(!1,!1);i.forEach(function(n){u.changeValue(t[r][n],n,f)});n.push(f)})},t.prototype.changeValue=function(t,i,r){var u=r.data[i];n.Common.IsEmpty(u)&&(u=new n.ListDataValue,u.bindingValue=null);u.value=t;u.valueType=7;r.data[i]=u},t.prototype.onlyAddRows=function(n){return n.editRowIndexes&&n.editRowIndexes.length>0?!1:n.deleteRowIndexesInListView&&n.deleteRowIndexesInListView.length>0?!1:!0},t.prototype.getImportDataInfo=function(t,i,r){switch(i){case n.ImportMode.Merge:return this.getImportDataInfoInMergeMode(t,r);case n.ImportMode.Replace:return r&&r.length>=1?this.getImportDataInfoInReplaceMode(t,r):this.getImportDataInfoInTotallyReplaceMode(t);case n.ImportMode.MergeIgnoreEdit:return this.getImportDataInfoInMergeIgnoreEditMode(t,r);case n.ImportMode.ReplaceIgnoreEdit:return this.getImportDataInfoInReplaceIgnoreEditMode(t,r);default:return this.getImportDataInfoInAddMode(t)}},t.prototype.getImportDataInfoInAddMode=function(n){return{addRowIndexes:n.map(function(n,t){return t})}},t.prototype.getImportDataInfoInMergeMode=function(n,t){var i=n.map(function(n){return t.map(function(t){return n[t]})}),r=this.getPrimaryKeyStrs(i);this.checkEmptyKeys(i,!0);this.checkSameKeys(r,!0);var u=this.getPrimaryKeysFromListview(t),f=[],e=[],o=[];return r.forEach(function(n,t){for(var r=[],i=u.indexOf(n);i!==-1;)r.push(i),i=u.indexOf(n,i+1);r.length===0?f.push(t):r.forEach(function(n){e.push(t);o.push(n)})}),{addRowIndexes:f,editRowIndexes:e,editRowIndexesInListView:o}},t.prototype.getPrimaryKeysFromListview=function(n){for(var r=this,u=this._dataModel.getRowCount(),i=[],f=function(t){var u=n.map(function(n){return r._dataModel.getValue(t,n)});i.push(u)},t=0;t<u;t++)f(t);return this.getPrimaryKeyStrs(i)},t.prototype.getPrimaryKeyStrs=function(t){return t.map(function(t){var i=t.map(function(t){return n.Common.IsEmpty(t)&&(t=null),t&&(t=t+""),t});return JSON.stringify(i)})},t.prototype.checkSameKeys=function(t,i){var r=[],u=new Set,f;if(t.forEach(function(n){u.has(n)?r.push(n):u.add(n)}),r.length>0){f={IsCheckImportedData:i,ListViewName:this._listviewName,ErrorKeys:r};throw{ErrorType:n.ImportError.ExistSameKeys,ErrorData:f};}},t.prototype.checkEmptyKeys=function(t,i){var r=[],u;if(t.forEach(function(t,i){t.forEach(function(t){n.Common.IsEmpty(t)&&r.push(i+1)})}),r.length>0){u={IsCheckImportedData:i,ListViewName:this._listviewName,ErrorKeys:r};throw{ErrorType:n.ImportError.ExistEmptyKeys,ErrorData:u};}},t.prototype.getImportDataInfoInReplaceMode=function(n,t){var r=this.getImportDataInfoInMergeMode(n,t),u,i;for(r.deleteRowIndexesInListView=[],u=this._dataModel.getRowCount(),i=0;i<u;i++)r.editRowIndexesInListView.indexOf(i)===-1&&r.deleteRowIndexesInListView.push(i);return r},t.prototype.getImportDataInfoInReplaceIgnoreEditMode=function(n,t){var i=this.getImportDataInfoInReplaceMode(n,t);return i.editRowIndexes=[],i.editRowIndexesInListView=[],i},t.prototype.getImportDataInfoInMergeIgnoreEditMode=function(n,t){var i=this.getImportDataInfoInMergeMode(n,t);return i.editRowIndexes=[],i.editRowIndexesInListView=[],i},t.prototype.getImportDataInfoInTotallyReplaceMode=function(n){var i=this.getImportDataInfoInAddMode(n),r,t;for(i.deleteRowIndexesInListView=[],r=this._dataModel.getRowCount(),t=0;t<r;t++)i.deleteRowIndexesInListView.push(t);return i},t}();n.ListviewDataImportHelper=s;h=function(){function t(n){this._listview=n}return t.prototype.showOrHideColumns=function(t,i){var r,f,u,e;if(this.containRowHeaderColumns(t))throw n.RS.HideShowColumns_CannotHideRowHeader;if(!this._listview.tryCommitEdit())throw n.RS.HideShowColumns_ListviewIsEditing;if(r=this._listview.listviewData.metadata,f=r.Columns.filter(function(n){return t.indexOf(n.Index)>=0}),this.willShowHiddenColumn(f,i))throw n.RS.HideShowColumns_CannotShowHiddenColumn;(u=!1,f.forEach(function(n){i?n.Width>0&&(u=!0,n.Width=0,n.IsHiddenByJavaScriptAPI=!0):n.Width===0&&(u=!0,n.Width=n.OriginalWidth,n.IsHiddenByJavaScriptAPI=!1)}),u)&&(n.ColumnOptionsListviewMetadataHelper.recalcHeaderCellsColumnSpan(r),e=new n.ListviewData(r,this._listview.runTimePageName,this._listview.designerPageName,this._listview.listviewData.uniqueIndex),this._listview.resetListviewData(e))},t.prototype.containRowHeaderColumns=function(n){var t=-1,i;return(this._listview.listviewData.isRowHeaderVisible()&&t++,this._listview.listviewData.isRowHeaderCheckBoxVisible()&&t++,t===-1)?!1:(i=this._listview.listviewData.metadata.Columns[t].Index,n.some(function(n){return n<=i}))},t.prototype.willShowHiddenColumn=function(n,t){return t?!1:n.some(function(n){return n.IsHiddenByColumnOptions||n.IsHiddenByLayout})},t}();n.ListviewColumnManager=h})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var i=function(){function n(){}return n}(),t,r;n.ListViewStyleTemplateUtils=i;t=function(){function n(){this.SelectBack="#51141414";this.SelectBorder="#217346";this.ShowHorizontalGridLine=!0;this.ShowVerticalGridLine=!0;this.ShowColumnHeaderHorizontalGridLine=!0;this.ShowColumnHeaderVerticalGridLine=!0;this.ShowRowHeaderHorizontalGridLine=!0;this.ShowRowHeaderVerticalGridLine=!0;this.ColumnFilterButtonStyle=0;this.IconColorUseCellForground=!0;this.OutLineColor="Background 1 -15"}return n}();n.ListViewStyleTemplate=t,function(n){n[n.RowHeader=0]="RowHeader";n[n.CheckBoxRowHeader=1]="CheckBoxRowHeader";n[n.ColumnHeader=2]="ColumnHeader";n[n.CornerHeader=3]="CornerHeader"}(r=n.HeaderType||(n.HeaderType={}))})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var t;(function(t){var i=function(){function t(n){this.getCachedRowDataHandler=n;this.indexCache=new f;this.selectionsCache=new r}return t.prototype.getCachedRows=function(){return this.selectionsCache.items},t.prototype.save=function(n){var t=this;this.indexCache.update(n);this.indexCache.adds.forEach(function(n){t.selectionsCache.add(t.getCachedRowDataHandler(n))});this.indexCache.deletes.forEach(function(n){t.selectionsCache.remove(t.getCachedRowDataHandler(n))})},t.prototype.reset=function(){this.indexCache.reset();this.selectionsCache.clearInvalid()},t.prototype.update=function(n){var t=this;n.forEach(function(n){var i=t.getCachedRowDataHandler(n),u=i.index,r;i.index=n;r=t.selectionsCache.findIndex(i);r>=0&&(i.index=u,t.selectionsCache.items[r]=i)})},t.prototype.delete=function(n){this.indexCache.remove(n);this.selectionsCache.remove(this.getCachedRowDataHandler(n))},t.prototype.clearByQuery=function(t,i){var r=new n.CachedRowData(t);this.selectionsCache.exists(r)&&(this.selectionsCache.remove(r),i&&i())},t.prototype.clearAll=function(){this.indexCache.reset();this.selectionsCache.clear()},t.prototype.saveSelectionDatas=function(n){var t=this;n.forEach(function(n){t.selectionsCache.add(n)})},t.prototype.exists=function(n){return this.selectionsCache.exists(n)},t}();t.SelectionCacheManager=i;var r=function(){function n(){this.equality=new u;this.items=[]}return n.prototype.add=function(n){n&&!this.exists(n)&&this.items.push(n)},n.prototype.remove=function(n){var t=this.findIndex(n);t>=0&&this.items.splice(t,1)},n.prototype.clear=function(){this.items=[]},n.prototype.clearInvalid=function(){this.items=this.items.filter(function(n){return n.query})},n.prototype.exists=function(n){return this.findIndex(n)>=0},n.prototype.findIndex=function(n){if(n)for(var t=0;t<this.items.length;t++)if(this.equality.equals(this.items[t],n))return t;return-1},n}(),u=function(){function t(){}return t.prototype.equals=function(n,t){return this.isIndexEqual(n,t)||this.isQueryEqual(n,t)},t.prototype.isQueryEqual=function(t,i){return n.Common.isQueryEqual(t.query,i.query)},t.prototype.isIndexEqual=function(n,t){return n.index>=0&&t.index>=0&&n.index===t.index},t}(),f=function(){function t(){this.items=[];this.adds=[];this.deletes=[]}return t.prototype.reset=function(){this.items=[];this.adds=[];this.deletes=[]},t.prototype.update=function(t){this.adds=this.diff(t,this.items);this.deletes=this.diff(this.items,t);this.items=n.Common.clone(t)},t.prototype.remove=function(n){for(var t=0;t<this.items.length;t++)if(this.items[t]===n){this.items.splice(t,1);return}},t.prototype.diff=function(n,t){var i=[];return n.forEach(function(n){t.indexOf(n)<0&&i.push(n)}),i},t}()})(t=n.ListViewHelper||(n.ListViewHelper={}))})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var t;(function(t){var i="Query",r=function(){function t(){}return t.queryTotalRowValues=function(t){var i=this,r,u;t.isLoaded&&t.needQueryData()&&t.allowShowTotalRow()&&t.getTotalRowBindingInfosIgnoreNullValues().length!==0&&(r=this.createTotalRowRequestParameters(t),t.updateTotalRowDataVersion(),u=t.totalRowDataVersion,n.HomeController.GetTotalRowValues(r,function(n){if((n&&n.errorMessage&&alert(n.errorMessage),n)&&!t.hasDestroyed()){if(t.totalRowDataVersion!==u){i.hideLoadingIndicator(t);return}i.assignTotalRowValues(t,n.values);t.refreshUI()}},t.getCalcSheetName()))},t.queryDataFromServer=function(i,r,u,f,e,o,s,h){var l=this,v,c;if(u===void 0&&(u=null),f===void 0&&(f=!1),e===void 0&&(e=!1),o===void 0&&(o=null),s===void 0&&(s=null),h===void 0&&(h=null),!i.isLoaded){s&&s();return}if(!i.needQueryData()){f&&i.getEditorInfo(!0);o&&o(!1);return}i.showLoadingIndicator();var a=this.createRequestParameters(i,r,f,u),y=a.param,p=a.demandRowCount;i.updateDataVersion();v=i.dataVersion;c=i.listviewData.getIsAutoReload();n.HomeController.GetTableDataWithOffset(y,function(n){var r,u=!1;try{if(n&&n.errorMessage&&alert(n.errorMessage),i.hasDestroyed())return;if(u=!0,i.dataVersion!==v)return;t.AddWarningInfo(i,(r=n===null||n===void 0?void 0:n.table)===null||r===void 0?void 0:r.Data);t.FillServerListviewData(i,n,f,p,e);o&&o(!0);$(window).trigger("ForguncyRowCountChanged")}catch(h){s&&s()}finally{(u||c)&&l.hideLoadingIndicator(i)}},function(){c&&l.hideLoadingIndicator(i);s&&s()},i.getCalcSheetName(),function(){h===null||h===void 0?void 0:h()});this.refreshUserSelectorItemsInfo(i)},t.AddWarningInfo=function(i,r){var o,f,s,e,u;n.ForguncyData.isDebugMode()&&(f=n.RS.PerformanceWarning,n.PageManager.isPageReady(i.runTimePageName)||(s=i.getListDataModel().getRowCount(),s>0&&!i.listviewData.metadata.DoNotLoadDataWhenLoadPage&&(u=t.getDataLoadTwicePerformanceWarning(i),console.warn("%c"+f+" %c"+u,"color:red;font-weight:600","color:black;"),n.ForguncyData.pageInfo.dataModel.debugWarningInfoDataModel.push({message:"".concat(f).concat(u)}))),e=(o=r===null||r===void 0?void 0:r.length)!==null&&o!==void 0?o:0,e>2e3&&(u=t.getLoadTooManyDatasPerformanceWarning(i,e),console.warn("%c"+f+" %c"+u,"color:red;font-weight:600","color:black;"),n.ForguncyData.pageInfo.dataModel.debugWarningInfoDataModel.push({message:"".concat(f).concat(u)})),e>0&&t.contianSameRecord(r)&&(u=t.getDuplicateRowWarning(i),console.warn(u),n.ForguncyData.pageInfo.dataModel.debugWarningInfoDataModel.push({message:u})))},t.contianSameRecord=function(n){for(var e,t,u={},r=0,f=n;r<f.length;r++){if(e=f[r],t=e[i],!t)return!1;if(u[t])return!0;u[t]=!0}return!1},t.getDataLoadTwicePerformanceWarning=function(i){var r=t.getPerformanceWarningLocation(i);return r.type==="chart"?n.Common.format(n.RS.PerformanceWarningChartLoadTwice,r.location):n.Common.format(n.RS.PerformanceWarningListviewLoadTwice,r.location)},t.getLoadTooManyDatasPerformanceWarning=function(i,r){var u=t.getPerformanceWarningLocation(i);return u.type==="chart"?n.Common.format(n.RS.PerformanceWarningChartLoadTowManyDatas,u.location,r):n.Common.format(n.RS.PerformanceWarningListviewLoadTowManyDatas,u.location,r)},t.getDuplicateRowWarning=function(i){var r=t.getPerformanceWarningLocation(i);return r.type==="chart"?n.Common.format(n.RS.Chart_DuplicateRow_Warning,r.location):n.Common.format(n.RS.Listview_DuplicateRow_Warning,r.location)},t.getPerformanceWarningLocation=function(t){var i,r,f=t.getListviewName(),u;return t instanceof n.DataSourceListview&&(u=(r=(i=n.ForguncyData.pageInfo.pageElementManager.chartCollection)===null||i===void 0?void 0:i.getChartsReferListview(f,t.runTimePageName))!==null&&r!==void 0?r:[],u.length>0)?{type:"chart",location:t.designerPageName+"|"+u[0]}:{type:"listview",location:t.designerPageName+"|"+f}},t.queryListviewDatasByQuery=function(t,i,r,u){var h=this,o,f=this.createRequestParameters(t,!1,!1,null).param,e,s;if(f.columnFilterQueries=[{ColumnBindingInfoID:i,Values:r,pageName:t.designerPageName}],f.totalRowBindingInfos=[],f.editorDataInfos=null,f.offsetCondition=new n.OffsetConditionInfo,f.offsetCondition.targetPage=1,f.offsetCondition.pageLimitRowCount=0,f.queryData=null,e=(o=f.rowInfo)===null||o===void 0?void 0:o.viewCondtionFormulaValues,e)for(s in e)e[s]=null;n.HomeController.GetTableDataWithOffset(f,function(i){var r=n.Common.IsEmpty(i===null||i===void 0?void 0:i.errorMessage)?h.createListRowData(t,i===null||i===void 0?void 0:i.table):[];u&&u(r)},function(){u&&u([])},t.getCalcSheetName())},t.FillServerListviewData=function(t,i,r,u,f){var s,h,c,l;t.deletedRowQuerys=[];i&&i.editor&&t.setEditorDataInfos(i.editor,r);var e=i&&i.table,o=this.createListRowData(t,e),a=e===null||e===void 0?void 0:e.AllRowLoaded,v=this.shouldClearNoFieldColumnFilterAndSort(t,(s=o===null||o===void 0?void 0:o.length)!==null&&s!==void 0?s:0,a);this.updateCachedSortInfo(t,e===null||e===void 0?void 0:e.SortInfo,v);this.updateCachedFilterInfo(t,v);t.listviewData.metadata.CacheColumnFilterAndSort&&(l=t.getLocationString(),n.ListviewStatusCacheHelper.autoSaveMetadataCacheDataAsync(t,{sort:(h=n.ForguncyData.pageInfo.sortInfoCache[l])!==null&&h!==void 0?h:{},columnFilter:(c=n.ForguncyData.pageInfo.columnFilterQueryCache[l])!==null&&c!==void 0?c:[]}));this.assignTotalRowValues(t,e&&e.TotalRowValues);this.addListRowDataToListview(t,u,o,a,f);this.refreshListview(u,t,o)},t.createRequestParameters=function(t,i,r,u){var e,h=t.getListDataCount(),f=0;i&&t.allowLoadOnDemand()&&(f=t.listviewData.getLoadOnDemandCount());var c=f>0?h:0,l=this.getOffsetConditionInfo(t),o=t.getLocationString(),a=n.ForguncyData.pageInfo.getSortInfoWithBinding(o),v=n.ForguncyData.pageInfo.getFilterInfoWithBinding(o),s=t.listviewData.getTotalRowBindingInfosIgnoreNullValues(),y=t.getRowInfo(),p=f>0?null:t.getEditorDataInfos(r),w=n.ForguncyData.pageInfo.commandQuerys[t.getDataTableName()],b=n.ForguncyData.pageInfo.runtimeQueryConditionDataCache[o],k=!t.isGroupMode(),d={columnBindingInfos:(e=t.listviewData.columnBindingInfos)===null||e===void 0?void 0:e.map(function(n){return n.GUID}),rowInfo:y,demandRowCount:f,currentDataLength:c,needRowVersion:k,queryData:w,sortCommandID:u,editorDataInfos:p,sortInfo:a,offsetCondition:l,columnFilterQueries:v,totalRowBindingInfos:s===null||s===void 0?void 0:s.map(function(n){return n.GUID}),pageName:t.designerPageName,runtimeQueryConditionData:b};return{param:d,demandRowCount:f}},t.createTotalRowRequestParameters=function(t){var i,u=n.ForguncyData.pageInfo.getFilterInfoWithBinding(t.getLocationString()),r=t.listviewData.getTotalRowBindingInfosIgnoreNullValues(),f=t.getRowInfo(),e=n.ForguncyData.pageInfo.commandQuerys[t.getDataTableName()];return{columnBindingInfos:(i=t.listviewData.columnBindingInfos)===null||i===void 0?void 0:i.map(function(n){return n.GUID}),rowInfo:f,queryData:e,columnFilterQueries:u,totalRowBindingInfos:r===null||r===void 0?void 0:r.map(function(n){return n.GUID}),pageName:t.designerPageName}},t.refreshUserSelectorItemsInfo=function(t){for(var r=t.getUserSelectorCellContentElement(),i=0;i<r.length;i++)n.HomeController.SetUserSelectorItemsInfo(r[i],t.getCalcSheetName()+i.toString())},t.hideLoadingIndicator=function(t){n.DelayRefresh.Push(t,function(){t.hasDestroyed()||t.hiddenLoadingIndicator()},t.getCalcSheetName()+"hiddenLoadingIndicator")},t.refreshListview=function(n,t,i){var u,r,f;f=n===0?-1:!0&&u!==void 0?u:0;t.refreshUI(f,n===0?-1:(r=i===null||i===void 0?void 0:i.length)!==null&&r!==void 0?r:-1)},t.addListRowDataToListview=function(n,t,i,r,u){n.operationTypeWhenValueChanged=2;t===0?(n._setInitData(i,r),u&&n.clearSelectionOutOfCurrentRow(),n.beforeRefeshUIWhenQueryDataFromServer()):n.addData(i,r);n.operationTypeWhenValueChanged=0},t.createListRowData=function(n,t){var r,i;return(t===null||t===void 0?void 0:t.Data)&&(i=t.Data,i&&(r=this.getListDataFromBindingValues(n,i))),r},t.assignTotalRowValues=function(t,i){if(t.listviewData.allowShowTotalRow()){var r=t.listviewData.getTotalRowSettingsIgnoreNullValues().filter(function(n){return n.BindingInfo});r.forEach(function(t,r){t.Value=i&&!n.Common.IsEmpty(i[r])?i[r]:t.FormulaType===2?0:""})}},t.getListDataFromBindingValues=function(n,t){var r=[],u,i,f,e;if(!t)return r;for(u=t.length,i=0;i<u;i++)f=t[i],e=this.convertServerRowDataToListRowData(n,f),r.push(e);return r},t.convertServerRowDataToListRowData=function(t,r){var s=new n.ListRowData,h=new n.ListRowInfo,c,l,f,e,u,a,o;for(h.query=r[i]?JSON.parse(r[i]):null,h.rowVersion=this.getRowVersion(t,r),s.rowInfo=h,c=[],l=t.listviewData.getColumnCount(),f=0;f<l;f++){if(e=t.listviewData.columnDataInfos[f],u=new n.ListDataValue,e.bindingInfoIndex!==-1)a="C"+e.bindingInfoIndex,o=r[a],o===undefined&&(o=null),u.bindingValue=o,u.valueType=2;else if(e.staticValue!==null)u.value=e.staticValue,u.valueType=1;else continue;c[f]=u}return s.data=c,s},t.getRowVersion=function(n,t){var i=t[n.getRowVersionColumnNameInServerData()];return i&&i.$value?i.$value:i},t.getOffsetConditionInfo=function(t){var r=t.getLocationString(),i=new n.OffsetConditionInfo,u=n.ForguncyData.pageingInfoList.GetPageIndex(r),f=n.ForguncyData.pageingInfoList.GetLimit(r);return i.targetPage=u,i.pageLimitRowCount=f,i},t.updateCachedSortInfo=function(n,t,i){t=!t||t.length===0?null:t;t=this.updateSortInfoInPageCache(n,t,i);var r=n.listviewData.getColumnOperation();(r===1||r===2)&&this.updateSortInfoInColumn(n,t)},t.updateSortInfoInPageCache=function(t,i,r){var e,f=t.getLocationString(),u=(e=n.ForguncyData.pageInfo.sortInfoCache[f])===null||e===void 0?void 0:e.sortInfo,o=(u===null||u===void 0?void 0:u.length)>0&&!u[0].ColumnBindingInfo&&u[0].ColumnIndex>=0;return!i&&o&&!r?u:(n.ForguncyData.pageInfo.sortInfoCache[f]||(n.ForguncyData.pageInfo.sortInfoCache[f]={}),n.ForguncyData.pageInfo.sortInfoCache[f].sortInfo=i===null||i===void 0?void 0:i.map(function(i){var r=t.listviewData.getColIndexByBindingInfo(i.ColumnBindingInfo),u;return r!==-1&&(i.ColumnIndex=r,u=t.listviewData.metadata.Columns.find(function(n){return n.Index==r}),i.ColumnName=n.ColumnInfoHelper.getColumnUniqueLocationKey(u)),i}),i)},t.updateSortInfoInColumn=function(n,t){var u,o=n.listviewData.visibleColumns,i,f,e,r;if(o)for(i=0,f=o;i<f.length;i++)e=f[i],r=this.getMatchSortInfo(e,t),e.sortInfo=(u=r===null||r===void 0?void 0:r.Order)!==null&&u!==void 0?u:null},t.getMatchSortInfo=function(t,i){var e,o,c,u,s,f,h,r;if(!i)return null;if(o=n.ColumnInfoHelper.getColumnUniqueLocationKey(t.columnInfo),t.allowFieldSort()){for(c=t.getBindingInfo(),u=0,s=i;u<s.length;u++)if(r=s[u],r.ColumnName===o||n.Common.isBindingInfoEquals(r.ColumnBindingInfo,c))return r}else if(t.allowNoFieldSort())for(f=0,h=i;f<h.length;f++)if(r=h[f],r.ColumnName===o||!r.ColumnBindingInfo&&r.ColumnIndex>=0&&r.ColumnIndex===((e=t.columnInfo)===null||e===void 0?void 0:e.Index))return r;return null},t.updateCachedFilterInfo=function(n,t){t&&this.clearNoFieldColumnFilterInPageCache(n)},t.clearNoFieldColumnFilterInPageCache=function(t){var i=t.getLocationString(),u=n.ForguncyData.pageInfo.columnFilterQueryCache[i],r;u&&(r=u.filter(function(n){return!!n.ColumnBindingInfoID}),r.length===0?delete n.ForguncyData.pageInfo.columnFilterQueryCache[i]:n.ForguncyData.pageInfo.columnFilterQueryCache[i]=r)},t.shouldClearNoFieldColumnFilterAndSort=function(t,i,r){if(i===0||!r)return!0;var u=n.ForguncyData.pageingInfoList.IsPageing(t.getLocationString());return u?!0:!1},t}();t.RequestHelper=r})(t=n.ListViewHelper||(n.ListViewHelper={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__spreadArray=this&&this.__spreadArray||function(n,t,i){if(i||arguments.length===2)for(var r=0,f=t.length,u;r<f;r++)!u&&r in t||(u||(u=Array.prototype.slice.call(t,0,r)),u[r]=t[r]);return n.concat(u||Array.prototype.slice.call(t))},Forguncy;(function(n){var h=function(n){function t(){var t=n.call(this)||this,r=t;return t.debugWarningInfoDataModel=new f,t.normalCellDataModel=new i,t.normalCellDataModel.bind("valuechanged",function(n,t){r.trigger("valuechanged",{arg:t})}),t._listDatas=[],t}return __extends(t,n),t.prototype.addListData=function(n,t,i,r){var e=this,f=new u(t,i,r,n);return this._listDatas.push(f),f.bind("valuechanged",function(n,i){e.trigger("valuechanged",{calcName:t,arg:i})}),f},t.prototype.removeListData=function(n){var t=this._listDatas.indexOf(n);t!==-1&&(n.unbindAll(),this._listDatas.splice(t,1))},t.prototype.getListDataList=function(n){return this._listDatas.filter(function(t){return n.indexOf(t.runTimePageName)>=0})},t.prototype.getListDataByListviewName=function(n,t){var i=this._listDatas.filter(function(i){return i.listviewName===n&&i.runTimePageName===t});return i.length>0?i[0]:null},t.prototype.getListDataByCalcSheetName=function(n){var t=this._listDatas.filter(function(t){return t.name===n});return t.length>0?t[0]:null},t}(n.EventClassBase),i,r,t,e,o,u,f,s;n.DataModel=h;i=function(n){function t(){var t=n.call(this)||this;return t._data={},t}return __extends(t,n),t.prototype.setValue=function(n,t,i,r){var u,e;r===void 0&&(r=!1);t?(u=t.newValue,e=t.uiAction):u=t;var f=this.getValue(n),s=this.getValueType(n),o={value:u,valueType:i,bindingValue:i===2?u:this.getBindingValue(n)};r&&(o.ignoreExport=!0);this._data[n]=o;(f!==u||s!==i)&&this.trigger("valueortypechanged",{id:n,oldValue:f,newValue:u,uiAction:e,valueType:i});f!==u&&this.trigger("valuechanged",{id:n,oldValue:f,newValue:u,uiAction:e,valueType:i})},t.prototype.hasValue=function(n){return typeof this._data[n]!="undefined"},t.prototype.getValue=function(n){var t=this._data[n];return typeof t=="undefined"||typeof t.value=="undefined"?null:t.value},t.prototype.getValueType=function(n){var t=this._data[n];return typeof t=="undefined"||typeof t.valueType=="undefined"?0:t.valueType},t.prototype.getBindingValue=function(n){var t=this._data[n];return typeof t=="undefined"||typeof t.bindingValue=="undefined"?null:t.bindingValue},t.prototype.getAllExportDatas=function(){var t={};for(var n in this._data)this._data[n].ignoreExport||(t[n]=this.getValue(n));return t},t.prototype.clearValue=function(n){delete this._data[n]},t}(n.EventClassBase);n.NormalCellDataModel=i;r=function(){function n(){}return n}();n.ListDataValue=r;t=function(){function n(){}return n}();n.ListRowInfo=t;e=function(){function n(){}return n}();n.ListRowData=e;o=function(){function n(){}return n}();n.ListDataModelValueChangedEventArg=o;u=function(i){function u(n,t,r,u){var f=i.call(this)||this;return f.name=n,f._columnCount=t,f.runTimePageName=r,f.listviewName=u,f.indexFlag=0,f._eventTriggerID=0,f._data=[],f}return __extends(u,i),u.prototype.resetColumnCount=function(n){this._columnCount=n;this._data=[]},u.prototype.getCurrentRowIndex=function(){return this._currentRowIndex},u.prototype.select=function(n){n!==this._currentRowIndex&&(this._currentRowIndex=n,this.trigger("selectionchanged",n))},u.prototype.getRowData=function(n){return this._isRowIndexValid(n)?this._data[n]:null},u.prototype.getData=function(t){return t?n.Common.clone(this._data):this._data},u.prototype.setData=function(n,t){var f=this,r=this.getRowCount(),i,u;(this._data=[],n&&n.length&&(n.forEach(function(n){f.setRowUniqueIndex(n)}),this._data=n),i=this.getRowCount(),i!==0||r!==0)&&(u={cellRange:{Row:-1,Column:-1,RowCount:-1,ColumnCount:-1},oldRowCount:r,newRowCount:i,uiAction:!!t,actionType:0,valueType:2},this.triggerValueChangedEvent(u))},u.prototype.setRowUniqueIndex=function(t){n.Common.IsEmpty(t.uniqueIndex)&&(t.uniqueIndex=this.indexFlag,this.indexFlag++)},u.prototype.insertData=function(n,t,i,r,u){var e,s=this,f,o;!t||t.length<=0||(f=this.getRowCount(),n<0||n>f)||(t&&t.forEach(function(n){s.setRowUniqueIndex(n)}),(e=this._data).splice.apply(e,__spreadArray([n,0],t,!1)),u&&this._currentRowIndex>=n&&this.select(this._currentRowIndex+t.length),o={cellRange:{Row:n,Column:-1,RowCount:t.length,ColumnCount:-1},oldRowCount:f,newRowCount:this.getRowCount(),uiAction:!!r,actionType:4,valueType:i},this.triggerValueChangedEvent(o))},u.prototype.addData=function(n,t,i){var e=this,r,u,f;!n||n.length<=0||(n.forEach(function(n){e.setRowUniqueIndex(n)}),r=this.getRowCount(),u=r,this._data=this._data.concat(n),f={cellRange:{Row:u,Column:-1,RowCount:n.length,ColumnCount:-1},oldRowCount:r,newRowCount:this.getRowCount(),uiAction:!!i,actionType:1,valueType:t},this.triggerValueChangedEvent(f))},u.prototype.setValue=function(n,t,i,u,f){var s,e,o,h;this._isRowIndexValid(n)&&this._isColumnIndexValid(t)&&(s=this.getValue(n,t),e=new r,e.value=i,e.valueType=u,e.bindingValue=u===2?i:this.getBindingValue(n,t),this._data[n].data[t]=e,s!==i)&&(o=this.getRowCount(),h={cellRange:{Row:n,Column:t,RowCount:1,ColumnCount:1},oldRowCount:o,newRowCount:o,uiAction:!!f,actionType:3,valueType:u},this.triggerValueChangedEvent(h))},u.prototype.getBindingValue=function(n,t){if(!this._isRowIndexValid(n)||!this._isColumnIndexValid(t))return null;var i=this._data[n].data[t];return typeof i=="undefined"||typeof i.bindingValue=="undefined"?null:i.bindingValue},u.prototype.getValueType=function(n,t){if(!this._isRowIndexValid(n)||!this._isColumnIndexValid(t))return 0;var i=this._data[n].data[t];return typeof i=="undefined"||typeof i.valueType=="undefined"?0:i.valueType},u.prototype.getValue=function(n,t){if(!this._isRowIndexValid(n)||!this._isColumnIndexValid(t))return null;var i=this._data[n].data[t];return u.getValueFromItem(i)},u.getValueFromItem=function(n){if(typeof n=="undefined")return null;var t=n.valueType===2?n.bindingValue:n.value;return typeof t=="undefined"?null:t},u.prototype.getRowValue=function(n){var i,r,t;if(!this._isRowIndexValid(n))return null;for(i=[],r=this.getColumnCount(),t=0;t<r;t++)i.push(this.getValue(n,t));return i},u.prototype.getRowInfo=function(n){return this._isRowIndexValid(n)?this._data[n].rowInfo:null},u.prototype.getRowQuery=function(n){var t=this.getRowInfo(n);return t?t.query:null},u.prototype.getRowVersion=function(n){var t=this.getRowInfo(n);return t?t.rowVersion:null},u.prototype.setRowQuery=function(n,i){if(this._isRowIndexValid(n)){var r=this._data[n];r.rowInfo||(r.rowInfo=new t);r.rowInfo.query=i}},u.prototype.setRowVersion=function(n,i){if(this._isRowIndexValid(n)){var r=this._data[n];r.rowInfo||(r.rowInfo=new t);r.rowInfo.rowVersion=i}},u.prototype.clear=function(){this.setData([])},u.prototype.getRowIndexByQuery=function(t){var u,i,r;if(!t)return-1;for(u=this._data.length,i=0;i<u;i++)if(r=this._data[i].rowInfo,r&&n.Common.isQueryEqual(r.query,t))return i;return-1},u.prototype._isRowIndexValid=function(n){return n!==null&&n>=0&&n<this._data.length},u.prototype._isColumnIndexValid=function(n){return n!==null&&n>=0&&n<this._columnCount},u.prototype.getRowCount=function(){return this._data.length},u.prototype.getColumnCount=function(){return this._columnCount},u.prototype.deleteRow=function(n,t){if(this._isRowIndexValid(n)){var i=this.getRowCount(),r=this._data.splice(n,1),u={cellRange:{Row:-1,Column:-1,RowCount:-1,ColumnCount:-1},oldRowCount:i,newRowCount:this.getRowCount(),uiAction:!!t,actionType:2,valueType:7,deleteRow:n,deletedRowUniqueIndex:r[0].uniqueIndex};this.triggerValueChangedEvent(u)}},u.prototype.isDirty=function(n,t){return n===-1&&t===-1?this._isDirtySheet():t===-1?this._isDirtyRow(n):!this._isRowIndexValid(n)||!this._isColumnIndexValid(t)?!1:this._isDirtyValue(this._data[n].data[t])},u.prototype._isDirtyValue=function(t){if(typeof t=="undefined"||t.valueType===2||t.valueType===1)return!1;var i=typeof t.bindingValue=="undefined"?null:t.bindingValue,r=typeof t.value=="undefined"?null:t.value;return n.FormulaHelper.adjustNumberPrecision(i)!==n.FormulaHelper.adjustNumberPrecision(r)},u.prototype._isDirtyRow=function(n){var t,r,i;if(!this._isRowIndexValid(n))return!1;if(t=this._data[n],typeof t.rowInfo=="undefined")return!0;for(r=t.data.length,i=0;i<r;i++)if(this._isDirtyValue(t.data[i]))return!0;return!1},u.prototype._isDirtySheet=function(){for(var t=this.getRowCount(),n=0;n<t;n++)if(this._isDirtyRow(n))return!0;return!1},u.prototype.triggerValueChangedEvent=function(n){n.triggerID=++this._eventTriggerID;this.trigger("valuechanged",n)},u}(n.EventClassBase);n.ListDataModel=u;f=function(n){function t(){var t=n.call(this)||this;return t.list=[],t}return __extends(t,n),t.prototype.push=function(n){if(this.list.length>0){var t=this.list[this.list.length-1];if(t.message===n.message)return}this.list.push(n);this.trigger("collectionchanged")},t.prototype.contains=function(n){return this.list.some(function(t){return t.message===n})},t}(n.EventClassBase);n.DebugWarningInfoDataModel=f;s=function(){function n(){}return n}();n.WarningInfo=s})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t=function(){function n(){}return n.prototype.setCurrentPageIndex=function(n){isNaN(n)||(this.currentPageIndex=Math.max(1,n))},n.prototype.getCurrentPageIndex=function(){return this.currentPageIndex},n.prototype.getPageCount=function(){return this.limit>0?Math.max(1,Math.ceil(this.rowCount/this.limit)):1},n}(),i;n.PageingInfoItem=t;i=function(i){function r(){var n=i!==null&&i.apply(this,arguments)||this;return n._list={},n}return __extends(r,i),r.prototype.IsPageing=function(n){var t=this.GetInfo(n);return t.limit>0},r.prototype.Init=function(i,r){if(r===void 0&&(r=0),n.Common.IsEmpty(this._list)&&(this._list={}),n.Common.IsEmpty(this._list[i])){var u=new t;u.setCurrentPageIndex(1);u.limit=r;u.rowCount=0;this._list[i]=u}},r.prototype.RefeshRowCount=function(n,t){this.Init(n);var i=this.GetInfo(n);if(i.getCurrentPageIndex()===1&&i.limit===0){t(-1);return}this.GetRowCount(n,t)},r.prototype.GetPageIndex=function(n){var t=this.GetInfo(n);return t.getCurrentPageIndex()},r.prototype.SetPageingInfo=function(n,t,i){var u=this._list[n],r;if(!u||u.limit!==i||u.getCurrentPageIndex()!==Math.max(1,t))return(this.Init(n),r=this._list[n],r.getCurrentPageIndex()!==t||r.limit!==i)?(r.setCurrentPageIndex(t),r.limit=i,this.triggerPageingInfoChanged(n),!0):!1},r.prototype.ResetPageIndexToFirstPage=function(n){this.Init(n);this._list[n].setCurrentPageIndex(1)},r.prototype.triggerPageingInfoChanged=function(n){var t={listviewLocation:n,pagingInfo:this.GetInfo(n)};this.triggerApiEvent(n,t);this.trigger("pageingInfoChanged",t)},r.prototype.triggerPageingRowcountChanged=function(n){var t={listviewLocation:n,pagingInfo:this.GetInfo(n)};this.triggerApiEvent(n,t);this.trigger("pageingRowcountChanged",t)},r.prototype.triggerApiEvent=function(t,i){var r=n.Page.getListViews().filter(function(n){return n._getLocationStr()===t});r.forEach(function(n){return n.trigger("pageingInfoChanged",{CurrentPageIndex:i.pagingInfo.getCurrentPageIndex(),MaxRowCountOfOnePage:i.pagingInfo.limit,TotalRowCount:i.pagingInfo.rowCount})})},r.prototype.GetLimit=function(n){var t=this.GetInfo(n);return t.limit},r.prototype.GetRowCount=function(n,t){var i=this;this.GetRowCountFromServer(n,function(r){var s=i._list[n].rowCount,u,f,e,o;s!==r?(u=i.GetPageIndex(n),f=i.GetLimit(n),u=f!==0&&r!==0?Math.min(u,Math.ceil(r/f)):1,i.SetRowCount(n,r),i._list[n].setCurrentPageIndex(u),i.triggerPageingRowcountChanged(n)):(e={listviewLocation:n,pagingInfo:i.GetInfo(n)},i.triggerApiEvent(n,e));t&&(o=i.GetInfo(n),t(o.rowCount))})},r.prototype.SetRowCount=function(n,t){this.Init(n);this._list[n].rowCount=t},r.prototype.GetInfo=function(n){this.Init(n);var r=this._list[n],i=new t;return i.setCurrentPageIndex(r.getCurrentPageIndex()),i.limit=r.limit,i.rowCount=r.rowCount,i},r.prototype.GetRowCountFromServer=function(t,i){var u=n.ListviewBase.getAllListviews().filter(function(n){return n.getLocationString()===t}),r;u.length<=0&&i(0);r=u[0];r.isGroupMode()&&i(0);var f=r.getRowInfo(),e=n.ForguncyData.pageInfo.commandQuerys[f.currentTable],o=n.ForguncyData.pageInfo.getFilterInfoWithBinding(t),s=n.ForguncyData.pageInfo.runtimeQueryConditionDataCache[t];n.HomeController.GetRowCount({queryCommandInfo:e,currentRowInfo:f,columnFilterQueries:o,runtimeQueryConditionData:s},function(t){if(n.Common.IsEmpty(t))return 0;var r=t;i(r)})},r}(n.EventClassBase);n.PageingInfoList=i})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var r=function(){function n(){}return n}(),t,i;n.CurrentRowInfo=r;t=function(){function n(){}return n}();n.CurrentProcessInfo=t;i=function(t){function i(n){var i=t.call(this)||this;return i._changedCounter=0,i._normalCellBindingManager=n,i.list=[],i}return __extends(i,t),i.prototype.getCurrentRowInfo=function(t){if(this.list)for(var i=0;i<this.list.length;i++)if(this.list[i].currentTable===t)return n.Common.clone(this.list[i]);return null},i.prototype.setCurrentRowInfo=function(t,i){var u,f,r,e;if(t&&t.currentTable&&t.query){for(u=!0,f=!0,r=0;r<this.list.length;r++)if(this.list[r].currentTable===t.currentTable){n.Common.isQueryEqual(this.list[r].query,t.query)&&(u=!1);this.list[r]=t;f=!1;break}e={rowInfo:t,isQueryChanged:u};f?(this.list.push(t),e.change=0):e.change=1;this.trigger("currentrowinfochanged",e);i&&u&&this._normalCellBindingManager.getBindingValuesFromServer(t.currentTable,t.query);u&&this.checkProcessChanged(t,f)}},i.prototype.removeCurrentRowInfo=function(n,t){var u,i,r;if(t===void 0&&(t=!0),n!==undefined){for(u=this.list.length,i=0;i<u;i++)if(this.list[i].currentTable===n){r=this.list.splice(i,1);this._normalCellBindingManager.clearBindingValues(n);this.trigger("currentrowinfochanged",{rowInfo:r[0],change:2,isQueryChanged:!0});t&&this.checkProcessRemoved(r[0]);break}t&&(n==="ACT_RU_TASK_View"?this.removeCurrentRowInfo("ACT_HI_TASKINST_View",!1):n==="ACT_HI_TASKINST_View"&&this.removeCurrentRowInfo("ACT_RU_TASK_View",!1))}},i.prototype.setCurrentRowInfoByAPI=function(t){var i,f,e;if(t){var o=this,u=function(t){var u,r,i;if(!n.Common.IsEmpty(t)){if(n.Common.IsEmpty(t.query)){t.table&&n.ErrorHelper.printErrorStr(n.Common.format(n.RS.SetCurrentRow_Error_NoRecord,t.table));return}for(u=n.ListviewBase.getAllListviews().filter(function(n){return n.getDataTableName()===t.table}),r=0;r<u.length;r++)if(u[r].selectRowByQuery(t.query)===!0)return;i=new n.CurrentRowInfo;i.currentTable=t.table;i.query=t.query;i.selectedRowIndex=0;i.recordID=0;o.setCurrentRowInfo(i,!0)}},r=t;if(r.TableName&&r.PrimaryKey){n.HomeController.GetQueryInfo(r.TableName,r.PrimaryKey,u);return}i=t;i.QueryCondition&&(f=n.Common.getRunTimePageNameFromFormulaCalcContext(i.FormulaCalcContext),e=n.ConditionHelper.getComputedSqlConditionFormula(i.QueryCondition,f,n.NullFormulaValueQueryPolicy.AllDatas,i.FormulaCalcContext.RowOffset,i.FormulaCalcContext.ColumnOffset,i.FormulaCalcContext.ListviewRowInfo,i.FormulaCalcContext.IsCommand),n.HomeController.GetQueryInfoByCondition(e,u))}},i.prototype.setCurrentRowInfoByProessTaskId=function(t){var i,r,f,u;t&&(i=n.FormulaHelper.getFormulaCalcInfo(t.FormulaCalcContext),i.ignoreListviews=!1,r=n.ForguncyData.pageInfo.formulaManager.evaluateFormula(t.ProcessTaskId,i),r)&&(f=this,u=new n.BPM.DataPermissionApi,u.taskId=r,u.invokeAsync().then(function(t){var e,r,u,o,s,i;if(t.code!==200)throw new Error(t.message);if(t.data.businessKey&&(r=JSON.parse(t.data.businessKey),r&&r.length!==0&&r[0]))for(u=0,o=r;u<o.length;u++)s=o[u],i=new n.CurrentRowInfo,i.currentTable=s.tableName,i.query=(e=s.primaryKeys)===null||e===void 0?void 0:e[0],i.selectedRowIndex=0,i.recordID=0,f.setCurrentRowInfo(i,!0)}))},i.prototype.getTaskId=function(){var n;return(n=this._lastChangedProcessTable==="ACT_HI_TASKINST_View"?this.getCurrentRowInfo("ACT_HI_TASKINST_View")||this.getCurrentRowInfo("ACT_RU_TASK_View"):this.getCurrentRowInfo("ACT_RU_TASK_View")||this.getCurrentRowInfo("ACT_HI_TASKINST_View"),n)?n.query.ID_.toString():null},i.prototype.getProcessInstanceId=function(){var n=this.getCurrentRowInfo("ACT_HI_PROCINST_View");return n?n.query.ID_.toString():null},i.prototype.setProcessInfo=function(n,t,i){n?this.setCurrentRowInfo({currentTable:"ACT_HI_TASKINST_View",query:{ID_:t}},!1):this.setCurrentRowInfo({currentTable:"ACT_RU_TASK_View",query:{ID_:t}},!1);this.setCurrentRowInfo({currentTable:"ACT_HI_PROCINST_View",query:{ID_:i}},!1)},i.prototype.checkProcessChanged=function(t,i){var e=this,u,r=t.currentTable,o,f;(r==="ACT_RU_TASK_View"||r==="ACT_HI_TASKINST_View")&&(this._lastChangedProcessTable=r,this._changedCounter+=1,o=this._changedCounter,n.BPM.Engine.taskQueryService.describeBusinessKeyInfoAsync((u=t.query.ID_)===null||u===void 0?void 0:u.toString()).then(function(t){var i,r;o===e._changedCounter&&(t&&t.businessKey&&(i=JSON.parse(t.businessKey),i===null||i===void 0?void 0:i.forEach(function(t){n.Page.setCurrentRow({TableName:t.tableName,PrimaryKey:t.primaryKeys[0]})})),t&&!t.businessKey&&(r=t.tableNames,r&&r.forEach(function(n){e.removeCurrentRowInfo(n)})))}),f={change:0},f.change=i?0:1,this.trigger("currentprocessinfochanged",f),r==="ACT_RU_TASK_View"?this.removeCurrentRowInfo("ACT_HI_TASKINST_View",!1):r==="ACT_HI_TASKINST_View"&&this.removeCurrentRowInfo("ACT_RU_TASK_View",!1))},i.prototype.checkProcessRemoved=function(t){var u=this,i,r=t.currentTable,f,e;(r==="ACT_RU_TASK_View"||r==="ACT_HI_TASKINST_View")&&(this._lastChangedProcessTable=r,this._changedCounter+=1,f=this._changedCounter,n.BPM.Engine.taskQueryService.describeBusinessKeyInfoAsync((i=t.query.ID_)===null||i===void 0?void 0:i.toString()).then(function(t){if(f===u._changedCounter&&t&&t.businessKey){var i=JSON.parse(t.businessKey);i===null||i===void 0?void 0:i.forEach(function(t){n.Common.isPageContainsTableBinding(n.ForguncyData.pageInfo.pageName,t.tableName)&&u.removeCurrentRowInfo(t.tableName)})}}),e={change:2},this.trigger("currentprocessinfochanged",e))},i}(n.EventClassBase);n.CurrentRowInfoCollection=i})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var t=function(){function t(){}return t.prototype.getRelatedCellIdsByTable=function(n){for(var t,r=[],f=this._getCells(),i=0,u=f;i<u.length;i++)t=u[i],t.bindingInfo&&t.bindingInfo.TableName===n&&r.push(t.id);return r},t.prototype.getRelatedCellIdsByBindingInfo=function(t,i){for(var u,f=[],o=this._getCells(i),r=0,e=o;r<e.length;r++)u=e[r],n.Common.isBindingInfoEquals(u.bindingInfo,t)&&f.push(u.id);return f},t.prototype.getBindingInfos=function(){for(var f,t,e,i,o,h,r=[],c=this._getCells(),u=0,s=c;u<s.length;u++)if(f=s[u],t=f.bindingInfo,t){for(e=!1,i=0,o=r;i<o.length;i++)if(h=o[i],n.Common.isBindingInfoEquals(t,h.bindingInfo)){e=!0;break}e||r.push({pageName:f.designerPageName,bindingInfo:t})}return r},t.prototype._getCells=function(t){return n.ForguncyData.pageInfo&&n.ForguncyData.pageInfo.pageElementManager?n.ForguncyData.pageInfo.pageElementManager.cells.getAllCells(t):[]},t}(),i=function(){function t(){}return t.prototype.getRelatedImagesByTable=function(n){for(var t,r=[],f=this._getImages(),i=0,u=f;i<u.length;i++)t=u[i],t.bindingInfo&&t.bindingInfo.TableName===n&&r.push(t.id);return r},t.prototype.getRelatedImagesByBindingInfo=function(t,i){for(var u,f=[],o=this._getImages(i),r=0,e=o;r<e.length;r++)u=e[r],n.Common.isBindingInfoEquals(u.bindingInfo,t)&&f.push(u.id);return f},t.prototype.getBindingInfos=function(){for(var f,t,e,i,o,h,r=[],c=this._getImages(),u=0,s=c;u<s.length;u++)if(f=s[u],t=f.bindingInfo,t){for(e=!1,i=0,o=r;i<o.length;i++)if(h=o[i],n.Common.isBindingInfoEquals(t,h.bindingInfo)){e=!0;break}e||r.push({pageName:f.designerPageName,bindingInfo:t})}return r},t.prototype._getImages=function(t){return n.ForguncyData.pageInfo&&n.ForguncyData.pageInfo.pageElementManager?n.ForguncyData.pageInfo.pageElementManager.backgroundImages.getBackgroundImages(t):[]},t}(),r=function(){function r(n){this._dataModel=n;this.bindingValueVersions={};this._cellBindingRef=new t;this._backgroundImageBindingRef=new i}return r.prototype.getBindingValuesFromServer=function(t,i){if(this._dataModel&&t&&i){var r=this,u=r.getBindingInfos(t),f={columnBindingInfos:u.pageBindingInfo,query:i,table:t};n.HomeController.GetTableRowData(f,function(n){r.isQueryInfoValid(t,i)&&n&&r.updateBindingValues(n,t,u.bindingInfos)})}},r.prototype.isQueryInfoValid=function(t,i){if(!n.ForguncyData.pageInfo.currentRowInfoCollection)return!1;var r=n.ForguncyData.pageInfo.currentRowInfoCollection.getCurrentRowInfo(t);return r&&n.Common.isQueryEqual(i,r.query)},r.prototype.updateBindingValues=function(t,i,r){for(var e=t.Values.length,o=function(i){for(var h,e=r[i],o=t.Values[i],s=u._cellBindingRef.getRelatedCellIdsByBindingInfo(e),c=s.length,f=0;f<c;f++)u._dataModel.setValue(s[f],{newValue:o},2);h=u._backgroundImageBindingRef.getRelatedImagesByBindingInfo(e);n.ForguncyData.pageInfo.pageElementManager.backgroundImages.list.filter(function(n){return h.indexOf(n.id)>=0}).forEach(function(n){return n.changePicture(o)})},u=this,f=0;f<e;f++)o(f);t.RowVersionInfo?this.bindingValueVersions[t.RowVersionInfo.TableName]=t.RowVersionInfo.RowVersion:this.bindingValueVersions[i]=null},r.prototype.getRelatedCellIdsByBindingInfo=function(n){return this._cellBindingRef.getRelatedCellIdsByBindingInfo(n)},r.prototype.setValueToBindingCell=function(n,t,i){for(var f,e=this._cellBindingRef.getRelatedCellIdsByBindingInfo(n,i),r=0,u=e;r<u.length;r++)f=u[r],this._dataModel.setValue(f,{newValue:t},7)},r.prototype.clearBindingValues=function(t){var r,u,i,f;if(this._dataModel){for(r=this._cellBindingRef.getRelatedCellIdsByTable(t),u=r.length,i=0;i<u;i++)this._dataModel.setValue(r[i],{newValue:null},2);f=this._backgroundImageBindingRef.getRelatedImagesByTable(t);n.ForguncyData.pageInfo.pageElementManager.backgroundImages.list.filter(function(n){return f.indexOf(n.id)>=0}).forEach(function(n){return n.changePicture(null)})}},r.prototype.getEditedBindingValues=function(t){for(var e=[],r=this._cellBindingRef.getBindingInfos(),s=r.length,i=0;i<s;i++)if(r[i].bindingInfo.TableName===t&&!r[i].bindingInfo.RelationBinding&&!r[i].bindingInfo.AttachType){var h=r[i].bindingInfo.GUID,c=r[i].pageName,o=this._cellBindingRef.getRelatedCellIdsByBindingInfo(r[i].bindingInfo),u=n.ForguncyData.pageInfo.dataModel.normalCellDataModel.getValue(o[o.length-1]),f=n.ForguncyData.pageInfo.autoIDManager.getAutoIDByBindingInfo(r[i].bindingInfo),l=f&&!(n.Common.IsEmpty(f.id)&&n.Common.IsEmpty(u)||f.id===u);e.push({pageName:c,bindingInfo:h,value:u,isEditedAutoID:l?!0:undefined})}return e},r.prototype.getBindingValue=function(t){var i=this._cellBindingRef.getRelatedCellIdsByBindingInfo(t),r=i.length;return r===0?null:n.ForguncyData.pageInfo.dataModel.normalCellDataModel.getValue(i[r-1])},r.prototype.getBindingInfos=function(n){var e=[],r,s,t,i,u,h,y,f,c,p;this._cellBindingRef.getBindingInfos().filter(function(t){return t.bindingInfo.TableName===n}).forEach(function(n){return e.push(n)});this._backgroundImageBindingRef.getBindingInfos().filter(function(t){return t.bindingInfo.TableName===n}).forEach(function(n){return e.push(n)});var l={},o=[],a=[],v={};for(r=0,s=e;r<s.length;r++)t=s[r],i=l[t.pageName],v[t.bindingInfo.GUID]=t.bindingInfo,i||(i=[],l[t.pageName]=i,o.push({pageName:t.pageName,bindingInfos:i})),i.push(t.bindingInfo.GUID);for(u=0,h=o;u<h.length;u++)for(y=h[u],f=0,c=y.bindingInfos;f<c.length;f++)p=c[f],a.push(v[p]);return{pageBindingInfo:o,bindingInfos:a}},r.reloadData=function(n,t,i){n&&(n=n.toLowerCase());t&&(r.reloadListviewData(n,i),r.reloadNormalCells(n));r.clearDataCache(n,t)},r.reloadListviewData=function(t,i){for(var r,f,e,s=n.ListviewBase.getAllListviews(),u=0,o=s;u<o.length;u++)(r=o[u],i&&i.indexOf(r.getListviewName())>=0)||(f=r.getDataTableName(),e=r.getMasterDataTableName(),(n.Common.IsEmpty(t)||f&&f.toLowerCase()===t||e&&e.toLowerCase()===t)&&r.fillData(null,n.Common.IsEmpty(t)),n.Common.IsEmpty(t)&&r.needQueryData()||r.reloadItemsEditor(t))},r.reloadNormalCells=function(t){for(var i,f=n.ForguncyData.pageInfo.currentRowInfoCollection.list,r=0,u=f;r<u.length;r++)i=u[r],(n.Common.IsEmpty(t)||i.currentTable&&i.currentTable.toLowerCase()===t)&&n.ForguncyData.pageInfo.normalCellBindingManager.getBindingValuesFromServer(i.currentTable,i.query)},r.clearDataCache=function(t,i){r.updateTableDataCacheForCombo(t,i);n.clearGetTableDataByConditionCache();r.reloadItemsCellType(t,!0,i);n.CustomFunction.ODataFunction.clearCache(t)},r.updateTableDataCacheForCombo=function(t,i){i&&n.TableColumnsCacheManager.updateCache(t)},r.reloadItemsCellType=function(n,t,i){n&&(n=n.toLowerCase());r.reloadItemsCellTypeForNormalCell(n,i);r.reloadItemsCellTypeInListview(n,t,i)},r.reloadItemsCellTypeForNormalCell=function(t,i){for(var h,c,f,l,e,a,u,y=n.ForguncyData.pageInfo.pageElementManager.cells.getAllCells(),o=[],s=0,v=y;s<v.length;s++)(h=v[s],h.cellType)&&(u=h.cellType,c=u.getBindingTables(),c)&&r.needReloadCellType(t,c)&&o.push(u);for(f=0,l=o;f<l.length;f++)u=l[f],u.preReload();if(i)for(e=0,a=o;e<a.length;e++){u=a[e];u.onBindingTableChanged(t)}},r.reloadItemsCellTypeInListview=function(t,i,r){var e,u,f,o;if(r&&!i)for(e=n.ListviewBase.getAllListviews(),u=0,f=e;u<f.length;u++)o=f[u],o.reloadItemsEditor(t)},r.needReloadCellType=function(t,i){var r,u,f;if(n.Common.IsEmpty(t))return!0;for(r=0,u=i;r<u.length;r++)if(f=u[r],!n.Common.IsEmpty(f)&&f.toLowerCase()===t)return!0;return!1},r}();n.NormalCellBindingManager=r})(Forguncy||(Forguncy={}))
;var __spreadArray=this&&this.__spreadArray||function(n,t,i){if(i||arguments.length===2)for(var r=0,f=t.length,u;r<f;r++)!u&&r in t||(u||(u=Array.prototype.slice.call(t,0,r)),u[r]=t[r]);return n.concat(u||Array.prototype.slice.call(t))},Forguncy;(function(n){var s=function(){function i(u,f){var e=this;this._currentRowInfoCollection=u;this.placeHolders=[];this.restoring=!1;this._cellsNeedExecuteCommandWhenValueChanged=[];this._dataModel=f.normalCellDataModel;this.cells=new t(this._dataModel);this._wholeModel=f;f.bind("valuechanged",this,function(n,t){e._onValueChangedInDataModel(t)});this.listviewCollection=new n.ListviewCollection;this.backgroundImages=new r;this._currentRowInfoCollection.bind("currentrowinfochanged",this,i._onCurrentRowInfoChanged)}return Object.defineProperty(i.prototype,"chartCollection",{get:function(){return n.ChartCollection?(this._chartCollection||(this._chartCollection=new n.ChartCollection(this._wholeModel)),this._chartCollection):null},enumerable:!1,configurable:!0}),i._getChangeType=function(n){switch(n){case 2:return"binding";case 4:return"formula";case 3:return"passValue";case 5:return"command";case 6:return"userInput";case 7:return"other"}},i.prototype._onValueChangedInDataModel=function(t){var i=n.ListviewBase.getListviewByCalcSheetName(t.calcName);i?this._onListviewValueChangedInDataModel(i,t.arg):this._onNormalCellValueChangedInDataModel(t)},i.prototype._onListviewValueChangedInDataModel=function(t,r){var f,e,u;if(t.getCellTypeByColIndex&&r.actionType===3&&r.valueType!==2&&r.cellRange.RowCount===1&&r.cellRange.ColumnCount===1&&(e=t.getCalcSheetName(),u=t.getCellTypeByColIndex(r.cellRange.Column),(f=u===null||u===void 0?void 0:u.CellElement)===null||f===void 0?void 0:f.CellType)){var s=u.CellElement.CellType,h=s.CommandList,l=s.CommandExcuteKind;if(h&&l===1){var a=h.map(function(t){var i,u=n.Common.clone(t);return u.formulaListRowInfo=(i={},i[e]=r.cellRange.Row,i),u}),c=t.getVisibleColumnIndexInListViewByDataIndex(r.cellRange.Column),o=t.listviewData.visibleColumns[c];n.ForguncyData.commandExecutor.executeCommand(a,{runTimePageName:u.runTimePageName,commandTrigger:u,commandID:e+"_"+r.cellRange.Row+"_"+r.cellRange.Column,eventType:"valuechanged",initParams:{valueChangedReason:i._getChangeType(r.valueType),valueChangedRowIndex:r.cellRange.Row},locationString:n.FormulaHelper.getListviewCellLogLocationString(r.cellRange.Row,c,o===null||o===void 0?void 0:o.getName(),t.getListviewName(),t.runTimePageName)})}}},i.prototype._onNormalCellValueChangedInDataModel=function(t){var u=t.arg,r=this.cells.getCell(u.id),s,h,e,f,o;if(r!==null&&(s=this._dataModel.getValue(r.id),r.setValue(s),r.bindingInfo&&!r.bindingInfo.RelationBinding&&this._dataModel.getValueType(u.id)!==2&&this._changeMasterValueOfDetailTable(r.bindingInfo,u.newValue),r.ownerContainer&&r.ownerContainer.ownerCell&&r.templateCellSource))if(r.isUserControlTwoWayBindingCell())h=this._dataModel.getValue(r.ownerContainer.ownerCell.id),h!==u.newValue&&this._dataModel.setValue(r.ownerContainer.ownerCell.id,{newValue:u.newValue,uiAction:t.arg.uiAction},7);else if(e=r.ownerContainer.ownerCell.cellType,e instanceof n.UserControlPageCellType)e.onPropertyChanged(r.templateCellSource,u.newValue,u.uiAction,7);if(u.valueType!==1)for(f=0;f<this._cellsNeedExecuteCommandWhenValueChanged.length;f++)(o=this._cellsNeedExecuteCommandWhenValueChanged[f],o.id===u.id)&&function(t){n.ForguncyData.commandExecutor.executeCommand(t.commands,{runTimePageName:t.runTimePageName,commandTrigger:t.cellType,commandID:t.id,eventType:"valuechanged",callbackOnCommandCompleted:function(){t.cellType.initValueWhenTriggerValueChangedCommand()},initParams:{valueChangedReason:i._getChangeType(u.valueType)},locationString:n.FormulaHelper.getCellLogLocationString(t.id,t.name,t.runTimePageName)})}(o);else(r===null||r===void 0?void 0:r.cellType)&&r.cellType.initValueWhenTriggerValueChangedCommand()},i.prototype.addValueChangedCommandCell=function(n){n.cellType.initValueWhenTriggerValueChangedCommand();this._cellsNeedExecuteCommandWhenValueChanged.push(n)},i.prototype._changeMasterValueOfDetailTable=function(t,i){for(var f=n.ListviewBase.getAllListviews(),s=f.length,r=0;r<s;r++){var u=f[r],e=u.getMasterDataTableName(),o=u.getColumnOfMasterTable();e&&o&&e===t.TableName&&o===t.ColumnName&&u.masterValueChanged(i)}},i._onCurrentRowInfoChanged=function(n,t){var u=n.data,r,f,i;for(u.saveContext(),r=u.cells.getAllCells(),f=r.length,i=0;i<f;i++)r[i].onCurrentRowInfoChanged(t.rowInfo.currentTable)},i.prototype.setPrePageContext=function(t){var s=this.getStoredContext(),f,r,u,h,e,c,l,o,a,v,p,w,y,i;if((t===null||t===void 0?void 0:t.ignoreCurrentRowInfoInStoredContext)&&s&&(s.currentRowInfoList=null),t=this.mergeStoredContextToPageContext(t,s),t){if(t.currentRowInfoList)for(f=0;f<t.currentRowInfoList.length;f++){if(r=t.currentRowInfoList[f],u=t.loadBindingDataOption===1,t.loadBindingDataOption===undefined||t.loadBindingDataOption===0)for(u=!0,h=this.cells.getAllCells(),e=0;e<h.length;e++)if(c=h[e],c.commands){for(l=n.Common.enumAllCommandsMetaData(c.commands),o=0;o<l.length;o++)if(a=l[o],a.$type==="Forguncy.Model.UpdateDataTableCommand, ServerDesignerCommon"&&(v=a,v.UpdateType==="add"&&v.TableName===r.currentTable)){u=!1;break}if(!u)break}if(u){if(n.Common.isProcessView(r.currentTable)&&(p=n.ForguncyData.pageInfo.pageName,!n.Common.isPageContainsTableBinding(p,r.currentTable)&&(w=this.cells.getAllCells().some(function(n){var t,i,r;return((r=(i=(t=n.cellType)===null||t===void 0?void 0:t.cellTypeData)===null||i===void 0?void 0:i.metaData)===null||r===void 0?void 0:r.$type)==="Forguncy.ProcessPanelCellType, ServerDesignerCommon"}),!w)))continue;n.ForguncyData.pageInfo.currentRowInfoCollection.setCurrentRowInfo(r,!0)}}if(t.querys)for(y in t.querys)n.ForguncyData.pageInfo.commandQuerys[y]=t.querys[y];if(t.sortInfoCache)for(i in t.sortInfoCache)n.ForguncyData.pageInfo.sortInfoCache[i]=t.sortInfoCache[i];if(t.columnFilterQueryCache)for(i in t.columnFilterQueryCache)n.ForguncyData.pageInfo.columnFilterQueryCache[i]=t.columnFilterQueryCache[i];if(t.runtimeQueryConditionDataCache)for(i in t.runtimeQueryConditionDataCache)n.ForguncyData.pageInfo.runtimeQueryConditionDataCache[i]=t.runtimeQueryConditionDataCache[i]}},i.prototype.initPassedValues=function(t,i){var o,u,r,f,a,e,l;if(t)for(o=0;o<t.length;o++)if(u=t[o],r=this.getTargetCellSiteOfPassValue(u),r)if(f=n.Common.getLocatedListview(r.runTimePageName,r.Row,r.Column),f)if(i){var s=f.getListDataModel(),h=u.TargetCell.Column-f.getRangeInfo().Column,c=s.getCurrentRowIndex();c>=0&&c<s.getRowCount()&&h>=0&&s.setValue(c,h,u.Source,3)}else{var v=f.getListDataModel(),h=u.TargetCell.Column-f.getRangeInfo().Column,w=v.getRowCount(),y=u.Source,p=0;for(e=0;e<w;e++)if(l=v.getValue(e,h),!n.Common.IsEmpty(l)&&!n.Common.IsEmpty(y)&&l.toString()===y.toString()){p=e;break}f.selectRow(p)}else try{a=n.Common.getIdStr(r.Row,r.Column,r.runTimePageName);this._dataModel.setValue(a,{newValue:u.Source},3)}catch(b){}},i.prototype.initPluginPassValue=function(){var u=n.MetadataLoader.GetUrlQuery("fgc_passvalue",!1),t,i,r;if(u){t=JSON.parse(u,n.Common.dateReviver);for(i in t)try{r=n.Page.getCell(i);r&&r.setValue(t[i])}catch(f){continue}}},i.prototype.getTargetCellSiteOfPassValue=function(t){var r,i;return t.TargetCell.Row>=0&&t.TargetCell.Column>=0?{Row:t.TargetCell.Row,Column:t.TargetCell.Column,runTimePageName:n.Common.IsEmpty(t.TargetRunTimePageName)?n.ForguncyData.pageInfo.runTimeNormalPage:t.TargetRunTimePageName}:t.TargetCell.Name?(r=this.cells.getCellByName(t.TargetCell.Name,!0),!r)?null:(i=n.Common.parseIDStr(r.id),{Row:i.row,Column:i.col,runTimePageName:i.suffix}):null},i.prototype.saveContext=function(){this.restoring||this.saveContextInternal(this.getCurrentPageContext())},i.prototype.getCurrentPageContext=function(){var t={};return t.currentRowInfoList=n.ForguncyData.pageInfo.currentRowInfoCollection.list,t.pageName=n.ForguncyData.pageInfo.pageName,t.querys=n.ForguncyData.pageInfo.commandQuerys,t.sortInfoCache=n.ForguncyData.pageInfo.sortInfoCache,t.columnFilterQueryCache=n.ForguncyData.pageInfo.columnFilterQueryCache,t.runtimeQueryConditionDataCache=n.ForguncyData.pageInfo.runtimeQueryConditionDataCache,t.historyIndex=n.ForguncyData.historyIndex,t},i.prototype.saveContextInternal=function(t){n.ForguncyData.PageContext||(n.ForguncyData.PageContext={});n.ForguncyData.PageContext[t.pageName]=t},i.prototype.getStoredContext=function(t){this.restoring=!0;try{return(t||(t=n.ForguncyData.pageInfo.pageName),n.ForguncyData.PageContext)?n.ForguncyData.PageContext[t]:null}catch(i){return null}finally{this.restoring=!1}},i.prototype.mergeStoredContextToPageContext=function(n,t){var r,f,u,i;if(!t)return n;if(n||(n={}),n.currentRowInfoList){if(t.currentRowInfoList)for(r=0;r<t.currentRowInfoList.length;r++)f=t.currentRowInfoList[r],this.containsTable(f.currentTable,n.currentRowInfoList)||n.currentRowInfoList.unshift(f)}else n.currentRowInfoList=t.currentRowInfoList;if(t.querys){n.querys||(n.querys={});for(u in t.querys)n.querys[u]||(n.querys[u]=t.querys[u])}if(t.sortInfoCache){n.sortInfoCache||(n.sortInfoCache={});for(i in t.sortInfoCache)n.sortInfoCache[i]||(n.sortInfoCache[i]=t.sortInfoCache[i])}if(t.columnFilterQueryCache){n.columnFilterQueryCache||(n.columnFilterQueryCache={});for(i in t.columnFilterQueryCache)n.columnFilterQueryCache[i]||(n.columnFilterQueryCache[i]=t.columnFilterQueryCache[i])}if(t.runtimeQueryConditionDataCache){n.runtimeQueryConditionDataCache||(n.runtimeQueryConditionDataCache={});for(i in t.runtimeQueryConditionDataCache)n.runtimeQueryConditionDataCache[i]||(n.runtimeQueryConditionDataCache[i]=t.runtimeQueryConditionDataCache[i])}return n},i.prototype.containsTable=function(n,t){for(var r,i=0;i<t.length;i++)if(r=t[i],r.currentTable===n)return!0;return!1},i.prototype.cleanQuaryCookie=function(t){if(t===n.ForguncyData.pageInfo.pageName)n.ForguncyData.pageInfo.commandQuerys={},n.ForguncyData.pageInfo.sortInfoCache={},n.ForguncyData.pageInfo.columnFilterQueryCache={},n.ForguncyData.pageInfo.runtimeQueryConditionDataCache={},this.saveContext();else{var i=this.getStoredContext(t);i&&(i.querys={},i.sortInfoCache={},i.columnFilterQueryCache={},i.runtimeQueryConditionDataCache={},this.saveContextInternal(i))}},i.prototype.initCellDefaultValue=function(n){for(var r,i=this.cells.getAllCells(n),t=0;t<i.length;t++)i[t]&&!this._dataModel.hasValue(i[t].id)&&(r=i[t].getDefaultValue(),r!==undefined&&this._dataModel.setValue(i[t].id,{newValue:r},1))},i.prototype.initUserControlDefaultValues=function(t){var i,f,h,r,e,o,u,s;if(t&&t.templateSourceDefaultValue&&t.subPages){for(i=0,f=t.subPages;i<f.length;i++)for(h=f[i],r=0,e=h.childrens;r<e.length;r++)o=e[r],u=o.templateCellSource,u&&!n.Common.IsEmpty(t.templateSourceDefaultValue[u])&&this._dataModel.setValue(o.id,{newValue:t.templateSourceDefaultValue[u]},1);for(s in t.templateSourceDefaultValue)t.userControlCellType.onPropertyChanged(s,t.templateSourceDefaultValue[s],!1,1)}},i.prototype.onDefaultDataSetted=function(t){n.PageStatistics.instance.enterPages(t);var i=this;i.chartCollection&&i.chartCollection.initChart(t);i.cells.getAllCells(t).forEach(function(n){if(n.repaint(),n.cellType&&n.cellType.CellElement&&n.cellType.CellElement.CellType){var t=n.cellType.CellElement.CellType;t&&t.CommandList&&t.CommandList.length>0&&t.CommandExcuteKind===1&&i.addValueChangedCommandCell(n)}});i.listviewCollection.onDefaultDataSetted(t)},i.prototype.onPageLoaded=function(n){var t=this.cells.getAllCells(n);t.forEach(function(n){return n.onPageLoaded()});this.listviewCollection.getListviews(n).forEach(function(n){return n.onPageLoaded()});this._tabIndexHelper&&n||(this._tabIndexHelper=new e);this._tabIndexHelper.onPageLoaded(n)},i.prototype.destroyRunTimePage=function(t){this.chartCollection&&this.chartCollection.destroyRunTimePage(t);this._cellsNeedExecuteCommandWhenValueChanged=this._cellsNeedExecuteCommandWhenValueChanged.filter(function(n){return t.indexOf(n.runTimePageName)===-1});this.cells.destroyRunTimePage(t);this.listviewCollection.destroy(t);this.backgroundImages.destroy(t);this.placeHolders=this.placeHolders.filter(function(n){return t.indexOf(n.runTimePageName)===-1});t.forEach(function(t){delete n.ForguncyData.pageInfo.pageStretchInfos[t];delete n.ForguncyData.pageInfo.pageLayouts[t];delete n.ForguncyData.pageInfo.enableTabIndex[t]})},i.prototype.destroy=function(t){var i=[t.runTimeNormalPage];this.cells.getAllContainerCells().map(function(t){t.cellType instanceof n.ContainerCellTypeBase&&t.cellType.getAllRunTimePageNames().forEach(function(n){i.push(n)})});n.PageStatistics.instance.leavePages(i);this.cells.destroy();this.chartCollection&&this.chartCollection.destroy();this.listviewCollection.destroy();this.backgroundImages.destroy()},i.prototype.resizePageElements=function(n,t){if(t===void 0&&(t=!1),this.cells.getAllCells(n).forEach(function(n){return n.cellType&&n.cellType.onWindowResized()}),this.listviewCollection.getListviews(n).forEach(function(n){return n.onWindowResized(t)}),this.chartCollection)this.chartCollection.onWindowResized(n,t)},i.prototype.getRepeaterCellOfListview=function(){return this.cells.getAllContainerCells().filter(function(t){return t.cellType instanceof n.RepeaterCellType}).map(function(n){return n.cellType})},i.prototype.getPlaceHolders=function(n){return n?this.placeHolders.filter(function(t){return n.indexOf(t.runTimePageName)>=0}):this.placeHolders},i}(),u,t,i,r,f,e,o;n.PageElementManager=s;u=function(){function t(t,i,r,u,f,e){var v=this,l,s,a,o,h,c;if(this.id=r,this.runTimePageName=u,this.designerPageName=f,this.listviewName=e,this._suspendPaintCount=0,this._value=null,l=this,this.row=t.Row,this.column=t.Column,this.layout=t.Layout,this._defaultFormula=t.DefaultFormula,this._defaultValue=n.Common.getMultiLanguageWord(t.Value),this.styleInfo={styleInfo:n.Common.clone(t.StyleInfo),isDisabled:!1,isInvisible:!1,isReadOnly:!1},this.isContainSpecificFormulaRule=t.IsContainSpecificFormulaRule,this.isContainSpecificFormulaRule?(this.cellFinalConditionalRule=t.ConditionalFormattingMetadata.Rules,this.cellFinalConditionalRule.sort(function(n,t){return t.Priority-n.Priority})):(s=t.ConditionalFormattingGuids,s&&s.length>0&&(a=n.ForguncyData.pageInfo.ConditionalFormattingMetadata,this.cellFinalConditionalRule=[],s.forEach(function(n){v.cellFinalConditionalRule.push(a.Rules.find(function(t){return t.GUID===n}))}),this.cellFinalConditionalRule.sort(function(n,t){return t.Priority-n.Priority}))),i===0&&this.cellFinalConditionalRule&&this.cellFinalConditionalRule.length>0&&(o=[],h=n.ForguncyData.pageInfo.ConditionalFormattingMetadata,this.cellFinalConditionalRule.forEach(function(n){if(n===null||n===void 0?void 0:n.GUID){var t=h===null||h===void 0?void 0:h.DependenceCells[n.GUID];t&&t.length>0&&o.push.apply(o,t)}}),o.length&&n.DependenceCellValueChangeHelper.listenFormulaRefChanged(o,function(){l.repaint()},this.runTimePageName)),t.Name&&t.Name.length>0)for(this.name=t.Name,this.lowerCaseName=[],c=0;c<this.name.length;c++)this.lowerCaseName.push(this.name[c].toLowerCase());else this.name=null,this.lowerCaseName=null;this.bindingInfo=t.BindingInfo;this.formatString=t.StyleInfo.Formatter;this.templateCellSource=t.TemplateCellSource;t.CellType&&(this.commands=t.CellType.CommandList,this.commandExecuteKind=t.CellType.CommandExcuteKind);t.CellType&&t.CellType.ForguncyAttribute&&(this.forguncyattr=t.CellType.ForguncyAttribute);this.cellType=n.CellTypeHelper.getCellType(t,i,this.id,this);this.cellType.Name=this.name}return t.prototype.getDefaultFormula=function(){if(this.cellType){var t=this.cellType.getDefaultValue();if(!n.Common.IsEmpty(t)&&typeof t.Value=="string"&&t.Value.length>0&&t.Value[0]==="=")return t.Value}return this._defaultFormula},t.prototype.getDefaultValue=function(){var i=this._defaultValue,t;return this.cellType&&(t=this.cellType.getDefaultValue(),!n.Common.IsEmpty(t)&&typeof t.Value!="undefined"&&!(typeof t.Value=="string"&&t.Value.length>0&&t.Value[0]==="=")&&(i=t.Value,i===null))?null:(i=n.Common.convertMetaDataDefaultValue(i,this.runTimePageName),i===null?undefined:i)},t.prototype.suspendPaint=function(){this._suspendPaintCount++},t.prototype.resumePaint=function(){var t=this;this._suspendPaintCount--;this._suspendPaintCount===0&&n.DelayRefresh.Push(this,function(){t.cellType.setValue(t._value);t.repaint()},"repaint_"+this.id)},t.prototype.setValue=function(t){if(this.cellType&&!this.cellType.hasDestroyed){var i=this;i._value=t;i.updateActualStyleInfo();this._suspendPaintCount===0&&n.DelayRefresh.Push(i,function(){i.cellType.setValue(t);i.repaint()},"setCellValue"+i.id)}},t.prototype.onCurrentRowInfoChanged=function(n){if(this.cellType&&!this.cellType.hasDestroyed)this.cellType.onCurrentRowInfoChanged(n)},t.prototype.repaint=function(){!this.cellType||this.cellType.hasDestroyed||this._suspendPaintCount>0||(this.cellType.applyTemplateStyle(),this.updateActualStyleInfo(),this.cellType.setBackColor(this.actualStyleInfo.styleInfo.Background),this.cellType.setFontStyle(this.actualStyleInfo.styleInfo),this.cellType.setFormatString(this.actualStyleInfo.styleInfo.Formatter),this.actualStyleInfo.isDisabled?this.cellType.disable():this.cellType.enable(),this.cellType.setVisible(!this.actualStyleInfo.isInvisible),this.cellType.setReadOnly(this.actualStyleInfo.isReadOnly))},t.prototype.updateActualStyleInfo=function(){this.actualStyleInfo=i.getActualStyleInfo(this.id,this.cellFinalConditionalRule,this.styleInfo)},t.prototype.setBackColor=function(n){this.styleInfo.styleInfo.Background!==n&&(this.styleInfo.styleInfo.Background=n,this.repaint())},t.prototype.setForeColor=function(t){t=n.ColorHelper.Convert(t);this.styleInfo.styleInfo.Foreground!==t&&(this.styleInfo.styleInfo.Foreground=t,this.repaint())},t.prototype.setVisible=function(n){n&&(n+"").toLowerCase()==="false"&&(n=!1);this.styleInfo.isInvisible!==!n&&(this.styleInfo.isInvisible=!n,this.repaint())},t.prototype.enable=function(){this.styleInfo.isDisabled!==!1&&(this.styleInfo.isDisabled=!1,this.repaint())},t.prototype.disable=function(){this.styleInfo.isDisabled!==!0&&(this.styleInfo.isDisabled=!0,this.repaint())},t.prototype.setReadOnly=function(n){n=!!n;!!this.styleInfo.isReadOnly!==n&&(this.styleInfo.isReadOnly=n,this.repaint())},t.prototype.create=function(n){this.cellType&&(this.cellType.create(n),this.styleInfo.isDisabled=this.cellType.isDisabled(),this.styleInfo.isInvisible=!this.cellType.isVisible(),this.styleInfo.isReadOnly=this.cellType.isReadOnly())},t.prototype.onLoad=function(){var t=this,i;t.cellType&&(t.cellType.onLoad(),t.cellType.CellElement)&&(i=t.cellType.CellElement.CellType,i&&i.CommandList&&i.CommandExcuteKind!==1&&t.cellType.bind("click",t.id,function(t){var i=n.ForguncyData.pageInfo.pageElementManager.cells.getCell(t.data);i._updateRepeaterCurrentRow();n.ForguncyData.commandExecutor.executeCommand(i.commands,{runTimePageName:i.runTimePageName,commandTrigger:i.cellType,commandID:i.id,eventType:"click",locationString:n.FormulaHelper.getCellLogLocationString(i.id,i.name,i.runTimePageName)})}))},t.prototype.onPageLoaded=function(){var n;if(!this._hasPagedLoaed)return this._hasPagedLoaed=!0,(n=this.cellType)===null||n===void 0?void 0:n.onPageLoaded(this.cellType.getCellTypeInfo())},t.prototype._updateRepeaterCurrentRow=function(){var i=n.PageManager.getContainerCell(this.runTimePageName),t,r;i&&(t=i.cellType,t instanceof n.RepeaterCellType)&&(r=t.getTabIndex(this.runTimePageName),t.updateCurrentRowIndex(r))},t.prototype.destroy=function(){var t=this;t.cellType&&(t.cellType.unbindAll(),t.cellType.destroy());n.ForguncyData.pageInfo.dataModel.normalCellDataModel.clearValue(t.id)},t.prototype.setContainerInfo=function(n){this.ownerContainer=n;this.ownerContainer&&this.ownerContainer.subPageInfo&&this.ownerContainer.subPageInfo.childrens.push(this)},t.prototype.isUserControlTwoWayBindingCell=function(){return this.templateCellSource===n.UserControl_ValueBindingPropertyName},t.prototype.allowSetTabOrder=function(){var n,t,i;return!!((i=(t=(n=this.cellType)===null||n===void 0?void 0:n.CellElement)===null||t===void 0?void 0:t.CellType)===null||i===void 0?void 0:i.AllowSetTabOrder)},t.prototype.setTabIndex=function(n){this.cellType.setTabIndex(n)},t.prototype.isDisableTabOrder=function(){return n.ForguncyData.pageInfo.enableTabIndex[this.runTimePageName]&&this.cellType.CellElement.CellType.DisableTabOrder},t.prototype.getSettedTabIndex=function(){return n.ForguncyData.pageInfo.enableTabIndex[this.runTimePageName]?this.cellType.CellElement.CellType.TabIndex:0},t.prototype.getDirectRunTimePageNames=function(){var t,n;if((n=(t=this.cellType).getDirectRunTimePageNames)!==null&&n!==void 0)return n.call(t)},t}();n.NormalCell=u;t=function(){function t(n){this._dataModel=n;this._runTimePageNameAndCellDic={};this._cells=[];this._containerCells=[]}return t.prototype.addCell=function(t){var i=this;this._cells.push(t);t.cellType&&(t.cellType instanceof n.ContainerCellTypeBase&&this._containerCells.push(t),t.cellType.bind("valuechanged",{collection:self,cell:t},function(n,r){i._dataModel.setValue(t.id,r,6)}))},t.prototype.getCell=function(n){var i,t;if(n)for(i=this._cells.length,t=0;t<i;t++)if(this._cells[t].id===n)return this._cells[t];return null},t.prototype.getCellByName=function(n,t,i){var r=this.getCellsByName(n,t,i);return r.length>0?r[0]:null},t.prototype.getCellsByName=function(t,i,r){if(!t)return null;if(i&&(t=n.Common.getLowerCaseString(t)),t.indexOf("=")===0&&(t=t.substring(1)),t.indexOf("!")>=0)try{var u=n.FormulaHelper.parse(t);u.source=null;t=n.FormulaHelper.unparse(u)}catch(f){}return this.getAllCells(r).filter(function(n){var r=i?n.lowerCaseName:n.name;return r&&r.indexOf(t)!==-1})},t.prototype.getAllCells=function(n){var i,t,r,u;if(n){for(i={},t=0,r=n;t<r.length;t++)u=r[t],i[u]=!0;return this._cells.filter(function(n){return i[n.runTimePageName]})}return this._cells},t.prototype.getAllContainerCells=function(n){return n?this._containerCells.filter(function(t){return t.runTimePageName&&n.indexOf(t.runTimePageName)>=0}):__spreadArray([],this._containerCells,!0)},t.prototype.getContainerCell=function(n){var t=this._runTimePageNameAndCellDic[n],f,i,r,u;if(!t||!t.cellType.containRunTimePage(n)){for(t=null,f=this.getAllContainerCells(),i=0,r=f;i<r.length;i++)if(u=r[i],u.cellType.containRunTimePage(n)){t=u;break}this._runTimePageNameAndCellDic[n]=t}return t},t.prototype.getForguncyattrCell=function(n){for(var i=this._cells.length,t=0;t<i;t++)if(this._cells[t].forguncyattr===n)return this._cells[t];return null},t.prototype.getValueOfForguncyattrCell=function(n){var t=this.getForguncyattrCell(n);return t?this._dataModel.getValue(t.id):null},t.prototype.setValueToForguncyattrCell=function(n,t){var i=this.getForguncyattrCell(n);if(i)return this._dataModel.setValue(i.id,{newValue:t},2)},t.prototype.destroy=function(){n.ValidationMananger.clearCache(null);this._cells.forEach(function(n){return n.cellType&&n.cellType.destroy()})},t.prototype.destroyRunTimePage=function(t){var u,f,r,e,i;n.ValidationMananger.clearCache(t);this.getAllCells(t).forEach(function(n){return n.destroy()});this._cells=this._cells.filter(function(n){return t.indexOf(n.runTimePageName)===-1});this._containerCells=this._containerCells.filter(function(n){return t.indexOf(n.runTimePageName)===-1});u=[];for(i in this._runTimePageNameAndCellDic)f=this._runTimePageNameAndCellDic[i],f&&t.indexOf(f.runTimePageName)>=0&&u.push(i);for(r=0,e=u;r<e.length;r++)i=e[r],delete this._runTimePageNameAndCellDic[i]},t}();n.NormalCellCollection=t;i=function(){function t(){}return t.getActualStyleInfo=function(n,i,r){var f,u;if(!i)return r;for(f=null,u=0;u<i.length;u++)if(t.useConditionRule(n,i[u])&&(f=t.mergeCondtionalFullStyleInfo(f,i[u].StyleInfo,i[u].IsDisabled,i[u].IsInvisible,i[u].IsReadOnly),i[u].StopIfTrue))break;return t.mergeActualFullStyleInfo(f,r)},t.useConditionRule=function(n,i){switch(i.RuleType){case 1:return t.useCellValueRule(n,i.Params);case 2:return t.useSpecificTextRule(n,i.Params);case 3:return t.useDateOccurringRule(n,i.Params);case 10:return t.useFormulaRule(n,i.Params);default:return!1}},t.useCellValueRule=function(i,r){var u=GC.Spread.Sheets.ConditionalFormatting,f=t.evaluateFormula(i,r.Value1),e=t.evaluateFormula(i,r.Value2),o=t.getCellValue(i),s=new u.NormalConditionRule(u.RuleType.cellValueRule,[],null,n.ConditionFormatRuleHelper.ConvertComparisonOperator(r.Operator),f,e),h=s.createCondition();return!!h.evaluate(null,0,0,o)},t.useSpecificTextRule=function(n,i){var r=GC.Spread.Sheets.ConditionalFormatting,u=t.evaluateFormula(n,i.Value),f=t.getCellValue(n),e=new r.NormalConditionRule(r.RuleType.specificTextRule,[],null,i.Operator,null,null,u),o=e.createCondition();return!!o.evaluate(null,0,0,f)},t.useDateOccurringRule=function(n,i){var r=t.getCellValue(n),u=new GC.Spread.Sheets.ConditionalFormatting.NormalConditionRule(GC.Spread.Sheets.ConditionalFormatting.RuleType.dateOccurringRule,[],null,null,null,null,null,null,i.Operator),f=u.createCondition();return!!f.evaluate(null,0,0,r)},t.useFormulaRule=function(n,i){var r=t.evaluateFormula(n,i.Formula);return r instanceof GC.Spread.CalcEngine.CalcError?!1:!!r},t.evaluateFormula=function(t,i){if(n.Common.IsEmpty(i))return i;if(!n.FormulaManager.isReady())return null;var r=n.Common.parseIDStr(t),u=r.suffix,f={runTimePageName:u,nullAsException:!1};return n.ForguncyData.pageInfo.formulaManager.evaluateFormula(i,f)},t.getCellValue=function(t){return n.ForguncyData.pageInfo.dataModel.normalCellDataModel.getValue(t)},t.mergeCondtionalFullStyleInfo=function(i,r,u,f,e){var s={styleInfo:r,isDisabled:u,isInvisible:f,isReadOnly:e},o;return i?(o=n.Common.clone(i),n.Common.IsEmpty(o.isDisabled)&&(o.isDisabled=s.isDisabled),n.Common.IsEmpty(o.isInvisible)&&(o.isInvisible=s.isInvisible),n.Common.IsEmpty(o.isReadOnly)&&(o.isReadOnly=s.isReadOnly),o.styleInfo=t.mergeCondtionalStyleInfo(i.styleInfo,s.styleInfo),o):s},t.mergeCondtionalStyleInfo=function(t,i){if(!i)return t;if(!t)return i;var r=n.Common.clone(t);return n.Common.IsEmpty(r.Formatter)&&(r.Formatter=i.Formatter),r.FontStyle&&r.FontStyle!==n.StaticValues.Font_Normal||(r.FontStyle=i.FontStyle),r.FontWeight&&r.FontWeight!==n.StaticValues.Font_Normal||(r.FontWeight=i.FontWeight),n.Common.IsEmpty(r.Underline)&&(r.Underline=i.Underline),n.Common.IsEmpty(r.Strikethrough)&&(r.Strikethrough=i.Strikethrough),n.Common.IsEmpty(r.Foreground)&&(r.Foreground=n.ColorHelper.Convert(i.Foreground)),n.Common.IsEmpty(r.Background)&&(r.Background=n.ColorHelper.Convert(i.Background)),r},t.mergeActualFullStyleInfo=function(i,r){if(!i)return r;r||(r={});var u=n.Common.clone(r);return n.Common.IsEmpty(i.isDisabled)||(u.isDisabled=i.isDisabled),n.Common.IsEmpty(i.isInvisible)||(u.isInvisible=i.isInvisible),n.Common.IsEmpty(i.isReadOnly)||(u.isReadOnly=i.isReadOnly),u.styleInfo=t.mergeActualStyleInfo(i.styleInfo,r.styleInfo),u},t.mergeActualStyleInfo=function(i,r){var u,f,e;return i?r?(u=n.Common.clone(r),n.Common.IsEmpty(i.Formatter)||(u.Formatter=i.Formatter),f=t.getFontStyleInCondtionalStyleInfo(i),n.Common.IsEmpty(f)||(u.FontStyle=f),e=t.getFontWeightInCondtionalStyleInfo(i),n.Common.IsEmpty(e)||(u.FontWeight=e),n.Common.IsEmpty(i.Underline)||(u.Underline=i.Underline),n.Common.IsEmpty(i.Strikethrough)||(u.Strikethrough=i.Strikethrough),n.Common.IsEmpty(i.Foreground)||(u.Foreground=n.ColorHelper.Convert(i.Foreground)),n.Common.IsEmpty(i.Background)||(u.Background=n.ColorHelper.Convert(i.Background)),u):i:r},t.getFontStyleInCondtionalStyleInfo=function(t){return n.Common.IsEmpty(t.FontStyle)||t.FontStyle===n.StaticValues.Font_Normal?n.Common.IsEmpty(t.FontWeight)||t.FontWeight===n.StaticValues.Font_Normal?null:n.StaticValues.Font_Normal:t.FontStyle},t.getFontWeightInCondtionalStyleInfo=function(t){return n.Common.IsEmpty(t.FontWeight)||t.FontWeight===n.StaticValues.Font_Normal?n.Common.IsEmpty(t.FontStyle)||t.FontStyle===n.StaticValues.Font_Normal?null:n.StaticValues.Font_Normal:t.FontWeight},t}();n.CondtionalFormattingHelper=i;r=function(){function n(){this.index=0;this.list=[]}return n.prototype.addBackgroundImage=function(n){return n.id=this.getId(),this.list.push(n),n.id},n.prototype.getId=function(){return"bkg_"+ ++this.index},n.prototype.destroy=function(n){n===void 0&&(n=null);this.getBackgroundImages(n).forEach(function(n){return n.destroy()});this.list=n?this.list.filter(function(t){return n.indexOf(t.runTimePageName)===-1}):[]},n.prototype.getBackgroundImages=function(n){return n===void 0&&(n=null),this.list.filter(function(t){return!n||n.indexOf(t.runTimePageName)!==-1})},n}();n.BackgroundImageCollection=r;f=function(){function t(n,t,i,r,u){this.runTimePageName=n;this.designerPageName=t;this._pageID=i;this._imageElement=r;this.name=u.DisplayName;this.initPictureValue(u);this._originalImage=this._imageElement.css("background-image")}return t.prototype.initPictureValue=function(n){if(n.PictureFormulaValue){this.initPictureValueWhenCellLocation(n.PictureFormulaValue);return}n.PictureValue&&(this.initPictureValueWhenRelatedColumn(n.PictureValue)||this.initPictureValueWhenBindingInfo(n.PictureValue))},t.prototype.initPictureValueWhenRelatedColumn=function(n){return typeof n=="string"?(this.relatedColumn=n,!0):!1},t.prototype.initPictureValueWhenBindingInfo=function(n){return n.TableName?(this.bindingInfo=n,!0):!1},t.prototype.initPictureValueWhenCellLocation=function(t){var i=this;return n.DependenceCellValueChangeHelper.listenFormulaRefChanged([t],function(){var r=n.ForguncyData.pageInfo.formulaManager.evaluateFormula(t,{runTimePageName:i.runTimePageName});i.changePicture(r)},this.runTimePageName,!0),!0},t.prototype.changePicture=function(t){if(n.Common.IsEmpty(t))this._imageElement.css("background-image",this._originalImage);else{var i=n.ImageHelper.getImageUrl(t);this._imageElement.css("background-image",'url("'+i+'")');this._imageElement.css("font-size","0")}},t.prototype.destroy=function(){this._imageElement=null},t}();n.BackgroundImageItem=f;e=function(){function t(){this._isUnset=!0;this._disabledPages={}}return Object.defineProperty(t.prototype,"throttle",{get:function(){var t=this;return this._throttle||(this._throttle=new n.Throttle(function(){t.setTabIndex(1,t.getStartRunTimePageName())})),this._throttle},enumerable:!1,configurable:!0}),t.prototype.getStartRunTimePageName=function(){return n.Common.IsEmpty(n.ForguncyData.pageInfo.masterPageName)?n.ForguncyData.pageInfo.runTimeNormalPage:n.ForguncyData.pageInfo.runTimeMasterPage},t.prototype.onPageLoaded=function(t){if(!this._isUnset||Object.keys(n.ForguncyData.pageInfo.enableTabIndex).length!==0){this._isUnset=!1;var i=this.initElementDic(t);i&&this.throttle.execute()}},t.prototype.initElementDic=function(t){var u=this,f,e;t=this.adjustRunTimePageNames(t);var r={},i=!1,o={};return n.ForguncyData.pageInfo.pageElementManager.cells.getAllCells(t).forEach(function(n){return i=u.addElementToDic(n,r,o)||i}),f={},n.ForguncyData.pageInfo.pageElementManager.getPlaceHolders(t).forEach(function(n){return u.addElementToDic(n,r,f)}),e={},n.ForguncyData.pageInfo.pageElementManager.listviewCollection.getListviews(t).filter(function(n){var i,t;return((t=(i=n).allowSetTabOrder)===null||t===void 0?void 0:t.call(i))===!0}).forEach(function(n){return i=u.addElementToDic(n,r,e)||i}),this.mergeToElementDic(r,o,e,f),i},t.prototype.adjustRunTimePageNames=function(n){var t=this;return this._elementDic&&n?n.filter(function(n){return!t._elementDic[n]}):null},t.prototype.addElementToDic=function(t,i,r){var u,f;return t.allowSetTabOrder()?(u=t.runTimePageName,t.isDisableTabOrder()||this.isInDisabledPage(u))?(t.setTabIndex(-1),!1):(i[u]||(i[u]=[]),r[u]||(r[u]=[]),f=t.getSettedTabIndex(),n.Common.IsEmpty(f)||f<=0?r[u].push(t):(i[u][f-1]||(i[u][f-1]=[]),i[u][f-1].push(t)),!0):!1},t.prototype.isInDisabledPage=function(t){var u,i=this._disabledPages[t],r;return i===undefined&&(r=n.PageManager.getContainerCell(t),i=((u=r===null||r===void 0?void 0:r.cellType)===null||u===void 0?void 0:u.getElementTabIndex())===-1,this._disabledPages[t]=i),i},t.prototype.mergeToElementDic=function(n,t,i,r){var o,u,f,e,s,h,c;this._elementDic||(this._elementDic={});for(u in n){for(f=[],e=0,s=n[u];e<s.length;e++)h=s[e],f.push.apply(f,h);c=this.mergeUndeterminedElements(t[u],(o=i[u])!==null&&o!==void 0?o:r[u]);f.push.apply(f,c);this._elementDic[u]=f}},t.prototype.mergeUndeterminedElements=function(n,t){return n=n!==null&&n!==void 0?n:[],t=t!==null&&t!==void 0?t:[],n.length===0?t:t.length===0?n:n.concat(t).sort(function(n,t){return n.row<t.row?-1:n.row>t.row?1:n.column-t.column})},t.prototype.setTabIndex=function(t,i){var h=this,u=this._elementDic[i],e,o,r,f,s;if(!u||u.length<=0)return t;for(e=!n.ForguncyData.pageInfo.enableTabIndex[i],o=function(n){var i=t,r;if(n.setTabIndex(i),e||t++,r=n.getDirectRunTimePageNames(),!r||r.length===0)return"continue";r.forEach(function(n){return i=h.setTabIndex(i,n)});t=Math.max(i,t)},r=0,f=u;r<f.length;r++)s=f[r],o(s);return t},t}();o=function(){function n(n,t,i,r){this.runTimePageName=n;this.runTimeNormalPageName=t;this.row=i;this.column=r}return n.prototype.allowSetTabOrder=function(){return!0},n.prototype.setTabIndex=function(){},n.prototype.isDisableTabOrder=function(){return!1},n.prototype.getSettedTabIndex=function(){return 0},n.prototype.getDirectRunTimePageNames=function(){return[this.runTimeNormalPageName]},n}();n.PlaceHolderElement=o})(Forguncy||(Forguncy={}))
;var __awaiter=this&&this.__awaiter||function(n,t,i,r){function u(n){return n instanceof i?n:new i(function(t){t(n)})}return new(i||(i=Promise))(function(i,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?i(n.value):u(n.value).then(o,s)}e((r=r.apply(n,t||[])).next())})},__generator=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=e[0]&2?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[e[0]&2,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i,e;return e={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e},Forguncy;(function(n){var i=function(){function i(){}return i.hasFocusedErrorCell=function(){var t;return!!((t=n.ForguncyData.pageInfo.pageElementManager.cells.getCell(i.errorFocusedCellID))===null||t===void 0?void 0:t.cellType.hasFocus())},i.validateCell=function(n,t){var u=n.getValidators(),r,f,e;if(!u||u.length===0)return 0;if(t=t!==null&&t!==void 0?t:i.getCellValidateHelpInfo(n),r=i.validateRules(u,n.getValue(!1),n.getValue(!0),t),r instanceof Promise)return r.then(function(r){r.obsolete||i.validateCell(n,t)}),r;switch(r.status){case 0:n.onValidateSuccess();i.errorFocusedCellID===n.ID&&(i.errorFocusedCellID=null);break;case 1:f=t.ignoreKeepFocus||i.hasFocusedErrorCell();e=n.onValidateError(r,f);e&&(i.errorFocusedCellID=n.ID)}return r.status},i.getCellValidateHelpInfo=function(t){return{cellID:t.ID,runTimePageName:t.runTimePageName,locationStr:n.FormulaHelper.getCellLogLocationString(t.ID,t.Name,t.runTimePageName)}},i.validateRules=function(n,t,i,r){r.startTime||(r.startTime=(new Date).valueOf());var u={status:0};return n&&n.length>0&&n.every(function(n){u=n.validate(t,i,r);var f=u instanceof Promise||u.status!==0;return!f}),u},i.validateAllCellsAsync=function(n,t){return __awaiter(this,void 0,void 0,function(){var r,u,f;return __generator(this,function(){return(r={},u=i.validateAllCells(n,t,null,r),u===0)?[2,!0]:(f=(u&1)!=0,f)?[2,!1]:[2,new Promise(function(t){var u=function(e,o){o.cellType.unbind("validate",u);delete r[o.cellType.ID];o.isValid||(n&&i.showAndFocusCell(o.cellType),t(!1));Object.keys(r).length===0&&t(!f)};for(var e in r)r[e].bind("validate",null,u)})]})})},i.validateAllCells=function(t,r,u,f){if(t===void 0&&(t=!0),r===void 0&&(r=null),u===void 0&&(u=null),f===void 0&&(f=null),!n.ForguncyData.pageInfo.pageElementManager)return 0;var e=null,o=!1,s=n.ForguncyData.pageInfo.pageElementManager.cells.getAllContainerCells().filter(function(t){return t.cellType instanceof n.RepeaterCellType}).map(function(n){return n.cellType.getNewRowRunTimePageName()}).filter(function(n){return!!n});return n.ForguncyData.pageInfo.pageElementManager.cells.getAllCells(r).map(function(n){return n.cellType}).filter(function(n){return!!n&&s.indexOf(n.runTimePageName)===-1}).forEach(function(n){var t=i.getCellValidateHelpInfo(n);t.returnPendingWhenValidateCommand=!!u;t.ignoreKeepFocus=!0;switch(i.validateCell(n,t)){case 0:break;case 1:e||(e=n);break;case 2:t.returnPendingWhenValidateCommand?u.push(n.ID):o=!0;break;default:f&&(f[n.ID]=n);o=!0}}),e&&t&&!this.hasFocusedErrorCell()&&i.showAndFocusCell(e),o?e?3:2:e?1:0},i.showAndFocusCell=function(t){i.errorFocusedCellID=t.ID;n.Common.scrollToElement(t.getContainer(),t.runTimePageName);n.ForguncyData.GlobalSettings.KeepFocusWhenDataValidationFailed?t.setFocus():n.DelayRefresh.setTimeout(function(){t.hasDestroyed||t.setFocus()},400)},i.clearCache=function(t){n.UniqueValidator.clearCache(t);n.CommandValidator.clearCache(t)},i.validateDataValidation=function(r,u,f){var e=t.createValidators(r,f.isInListview);return(f.ignoreCommandValidate&&(e=e===null||e===void 0?void 0:e.filter(function(t){return!(t instanceof n.CommandValidator)})),!e||e.length<=0)?{status:0}:i.validateRules(e,u,u,f)},i}(),t;n.ValidationMananger=i;t=function(){function t(){}return t.createValidators=function(n,i){var r=[t.getUniqueValidator(n,i),t.getDataValidator(n),t.getCommandValidator(n)].filter(function(n){return!!n});return r.length===0?null:r},t.getUniqueValidator=function(t,i){var e,u,f,o,r;if(i||(u=(e=t===null||t===void 0?void 0:t.CellType)===null||e===void 0?void 0:e.Validators,!u))return null;for(f=0;f<u.length;f++)if((o=u[f],o.$type.indexOf("UniqueValidadator")!==-1)&&(r=t.BindingInfo,typeof r!="undefined"&&typeof r.TableName!="undefined"&&typeof r.ColumnName!="undefined"&&typeof r.RelationBinding=="undefined"))return new n.UniqueValidator({table:r.TableName,column:r.ColumnName});return null},t.getDataValidator=function(t){return!(t===null||t===void 0?void 0:t.DataValidation)||t.DataValidation.NumberType===9?null:new n.DataValidator({dataValidationInfo:t.DataValidation})},t.getCommandValidator=function(t){var i;return((i=t===null||t===void 0?void 0:t.DataValidation)===null||i===void 0?void 0:i.NumberType)!==9?null:new n.CommandValidator({dataValidationInfo:t.DataValidation})},t}();n.ValidatorCreator=t})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var t=function(){function t(n){this._param=n}return t.prototype.validate=function(n,t,i){var r=this.isUnique(n,t,i.cellID,i.runTimePageName);return r instanceof Promise?r:this.createValidateResult(r)},t.prototype.isUnique=function(i,r,u,f){var s=this,e,o,h;return n.Common.IsEmpty(r)?!0:(e=n.ForguncyData.pageInfo.dataModel.normalCellDataModel.getBindingValue(u),!n.Common.IsEmpty(e)&&(e===r||e+""==r+""))?!0:(o=t.getCache(u,f),o&&o.value===r)?o.unique:(h=new Promise(function(i){var e={table:s._param.table,column:s._param.column,value:r};n.Common.forguncyPost("Home/CheckDatabase",e,function(n){var o=!!n,e=t.getCache(u,f);e&&e.value===r&&(e.unique=o);i(s.createValidateResult(o))},u+" CheckDatabase")}),t.addCache(u,f,r,h),h)},t.prototype.createValidateResult=function(t){return t?{status:0}:{status:1,message:n.RS.unique}},t.addCache=function(n,i,r,u){var f=t._cache[i];f||(f={},t._cache[i]=f);f[n]={value:r,result:u}},t.getCache=function(n,i){var r;return n&&i?(r=t._cache[i])===null||r===void 0?void 0:r[n]:null},t.clearCache=function(n){n?n.forEach(function(n){return delete t._cache[n]}):t._cache={}},t._cache={},t}();n.UniqueValidator=t})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var i=function(){function i(n){this._param=n}return i.prototype.validate=function(n,i,r){var u=t.IsValidValue(this._param.dataValidationInfo,n,r.runTimePageName,r.listInfo);return{status:u?0:1,message:u?null:this.getErrorMessage()}},i.prototype.getErrorMessage=function(){var i=this._param.dataValidationInfo,t;if(!n.Common.IsEmpty(i.ErrorMessage))return n.Common.getMultiLanguageWord(i.ErrorMessage);n.Common.IsEmpty(i.NumberType)&&(i.NumberType=0);switch(i.NumberType){case 0:t=n.RS.Required;break;case 1:t=n.RS.WholeNumberDefaultErrorMessage;break;case 2:t=n.RS.DecimalDefaultErrorMessage;break;case 4:t=n.RS.DateDefaultErrorMessage;break;case 5:t=n.RS.TimeDefaultErrorMessage;break;case 6:t=n.RS.TextLenghtDefaultErrorMessage;break;case 7:t=n.RS.CustomDefaultErrorMessage;break;case 8:t=n.Common.IsEmpty(i.SelectedDefaultRegularExpression)?n.RS.RegularUserInputDefaultErrorMessage:n.Common.format(n.RS.RegularDefaultErrorMessage,i.SelectedDefaultRegularExpression)}return t},i.isValid=function(t,r,u){return u===void 0&&(u=n.ForguncyData.pageInfo.runTimeNormalPage),new i({dataValidationInfo:t}).validate(r,r,{cellID:null,runTimePageName:u}).status===0},i}(),t;n.DataValidator=i;t=function(){function t(){}return t.IsValidValueByDataValidationInfo=function(t,i){if(!this.IsValidDataValidationInfo(t))return!0;if(t.NumberType===undefined&&(t.NumberType=0),this.EnsureDatavalidationValue(t),n.Common.IsEmpty(i)){if(t.IgnoreBlank===!0)return!0;if(t.NumberType!==7&&t.NumberType!==8&&t.NumberType!==6)return!1}switch(t.NumberType){case 0:return this.AnyValueValidator(t,i);case 1:return this.WholeNumberValidator(t,i);case 2:return this.DecimalValidator(t,i);case 3:return this.ListValidator(t,i);case 4:return this.DateValidator(t,i);case 5:return this.TimeValidator(t,i);case 6:return this.TextLengthValidator(t,i);case 7:return this.CustomValidator(t,i);case 8:return this.RegularValidator(t,i);default:return!0}},t.IsValidValue=function(n,t,i,r){return r===void 0&&(r=null),this.runTimePageName=i,this.listInfo=r,this.IsValidValueByDataValidationInfo(n,t)},t.GetResultOfCompareValues=function(t,i,r,u){if(n.Common.IsEmpty(r)&&this.isValue1FromFormual&&this.needValue1||n.Common.IsEmpty(u)&&this.isValue2FromFormual&&this.needValue2)return!0;t===undefined&&(t=0);i=+i;r=n.Common.IsEmpty(i)?null:+r;u=n.Common.IsEmpty(i)?null:+u;switch(t){case 0:if(i>=r&&i<=u)return!0;break;case 1:if(i<r||i>u)return!0;break;case 2:if(i===r)return!0;break;case 3:if(i!==r)return!0;break;case 4:if(i>r)return!0;break;case 6:if(i>=r)return!0;break;case 5:if(i<r)return!0;break;case 7:if(i<=r)return!0}return!1},t.AnyValueValidator=function(){return!0},t.WholeNumberValidator=function(n,t){return $.isNumeric(t)?t%1!=0?!1:this.GetResultOfCompareValues(n.CompareParamType,t,this.value1,this.value2):!1},t.DecimalValidator=function(n,t){return $.isNumeric(t)?this.GetResultOfCompareValues(n.CompareParamType,t,this.value1,this.value2):!1},t.ListValidator=function(n,t){return this.value1.indexOf(t)===-1?!1:!0},t.DateValidator=function(t,i){if(typeof i=="number"&&(i=n.Convertor.fromOADateToDate(i)),!this.isValideDateTime(i))return!1;var f=new Date(i),r=this.value1,u=this.value2;return n.Common.IsEmpty(this.value1)||(r=!isNaN(this.value1)&&(this.isValue1FromFormual||!(this.value1 instanceof Date))?n.Convertor.fromOADateToDate(this.value1):new Date(this.value1)),n.Common.IsEmpty(this.value2)||(u=!isNaN(this.value2)&&(this.isValue2FromFormual||!(this.value2 instanceof Date))?n.Convertor.fromOADateToDate(this.value2):new Date(this.value2)),this.GetResultOfCompareValues(t.CompareParamType,f,r,u)},t.TimeValidator=function(t,i){if(typeof i=="number"&&(i>1&&(i=i-1),i=n.Convertor.fromOADateToDate(i)),!this.isValideDateTime(n.FormatHelper.getValueFromText(i)))return!1;var f=n.FormatHelper.getValueFromText(i),r=this.value1,u=this.value2;return n.Common.IsEmpty(this.value1)||(r=!isNaN(this.value1)&&(this.isValue1FromFormual||!(this.value1 instanceof Date))?n.Convertor.fromOADateToDate(this.value1):n.FormatHelper.getValueFromText(this.value1)),n.Common.IsEmpty(this.value2)||(u=!isNaN(this.value2)&&(this.isValue2FromFormual||!(this.value2 instanceof Date))?n.Convertor.fromOADateToDate(this.value2):n.FormatHelper.getValueFromText(this.value2)),this.GetResultOfCompareValues(t.CompareParamType,f,r,u)},t.RegularValidator=function(t,i){n.Common.IsEmpty(i)&&(i="");var r=RegExp(this.value1);return r.test(i)},t.IsValidDataValidationInfo=function(n){return n===null||n===undefined?!1:!0},t.isValideDateTime=function(n){var t=new Date(n);return!this.isInvalidDate(t)},t.isInvalidDate=function(n){return isNaN(n)},t.CustomValidator=function(){var n;return this.value1===0||this.value1==="0"||this.value1===!1||((n=this.value1)===null||n===void 0?void 0:n.toLowerCase())==="false"?!1:!0},t.TextLengthValidator=function(t,i){return n.Common.IsEmpty(i)&&(i=""),this.GetResultOfCompareValues(t.CompareParamType,i.toString().length,this.value1,this.value2)},t.EnsureDatavalidationValue=function(t){if(this.value1=t.FirstParamValue,this.value2=t.SecondParamValue,this.isValue1FromFormual=!1,this.isValue2FromFormual=!1,n.Common.IsEmpty(this.value1)||(this.isValue1FromFormual=n.FormulaManager.isFormula(this.value1),this.value1=n.ForguncyData.pageInfo.formulaManager.evaluateFormula(this.value1,{runTimePageName:this.runTimePageName,nullAsException:!1,listInfo:this.listInfo,rowOffset:0,columnOffset:0}),this.value1 instanceof Date&&(this.value1=n.ConvertDateToOADate(this.value1)),this.value1=this.value1===null?this.value1:this.value1.toString()),n.Common.IsEmpty(this.value2)||(this.isValue2FromFormual=n.FormulaManager.isFormula(this.value2),this.value2=n.ForguncyData.pageInfo.formulaManager.evaluateFormula(this.value2,{runTimePageName:this.runTimePageName,nullAsException:!1,listInfo:this.listInfo,rowOffset:0,columnOffset:0}),this.value2 instanceof Date&&(this.value2=n.ConvertDateToOADate(this.value2)),this.value2=this.value2===null?this.value2:this.value2.toString()),this.needValue1=!0,this.needValue2=!0,t.NumberType===0){this.needValue1=!1;this.needValue2=!1;return}if(t.NumberType===8||t.NumberType===7){this.needValue2=!1;return}t.CompareParamType!==0&&t.CompareParamType!==1&&(this.needValue2=!1)},t}()})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var t=function(){function t(t){this._command=t.dataValidationInfo.ValidateCommand;this._errorMessage=n.Common.getMultiLanguageWord(t.dataValidationInfo.ErrorMessage)}return t.prototype.validate=function(i,r,u){var h=this,f=u.cellID,e=u.runTimePageName,o,s;return!this._command||this._command.length<=0?{status:0}:u.returnPendingWhenValidateCommand?{status:2,message:t.pendingError}:(o=t.getCache(f,e,r,u.startTime),o)?o.result:(s=new Promise(function(o){var s,c=(s={},s[n.RS.DataValidation_Command_Param_NewValue]=i,s);n.ForguncyData.commandExecutor.executeCommand(h._command,{runTimePageName:e,commandTrigger:null,commandID:f!==null&&f!==void 0?f:n.Common.generateID(),eventType:"validate",locationString:u.locationStr,initParams:c,callbackOnCommandCompleted:function(n,i){var s=t.getValidateResult(i,h._errorMessage),c=t.getCache(f,e,r,u.startTime);c?c.result=s:s.obsolete=!0;o(s)}})}),f&&t.addCache(f,e,r,u.startTime,s),s)},t.getValidateResult=function(n,t){var i,r=(n===null||n===void 0?void 0:n.status)===1;return t=(i=n===null||n===void 0?void 0:n.message)!==null&&i!==void 0?i:t,{status:r?1:0,message:r?t:null}},t.addCache=function(n,i,r,u,f){var e=t._cache[i];e||(e={},t._cache[i]=e);e[n]={startTime:u,text:r,result:f}},t.getCache=function(n,i,r,u){var e,f;return n&&i&&(f=(e=t._cache[i])===null||e===void 0?void 0:e[n],f&&u-f.startTime<200&&f.text===r)?f:null},t.clearCache=function(n){n===void 0&&(n=null);n?n.forEach(function(n){return delete t._cache[n]}):t._cache={}},t._cache={},t.pendingError="29401889-8AA6-4361-8E80-7EE79BC25AB1",t}();n.CommandValidator=t})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var i=function(){function n(n){this.metaData=n}return n.prototype.getEditorFormatString=function(){return null},n.prototype.convertToValidValue=function(n){return{isValid:!0,validValue:n}},n}(),t,r,u,f,e,o,s,h;n.CellTypeDataBase=i;t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.getDefaultValue=function(){var t=this.metaData.DefaultValue;return n.Common.IsEmpty(t)&&(t=null),n.KeyWords.IsKeyWord(t)&&(t=n.KeyWords.GetKeyWordValue(t)),t},i.prototype.canEnterEditModeInListview=function(){return!0},i}(i);n.InputCellTypeData=t;r=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.getDefaultValue=function(){var i=t.prototype.getDefaultValue.call(this);return n.Common.IsEmpty(i)?null:this._getDefaultDate(i)},i.prototype._getDefaultDate=function(t){var i=n.FormatHelper.getValueFromText(t);return n.DateHelper.isValidDateValue(i)?typeof i=="number"&&(i=n.Convertor.fromOADateToDate(i)):i=null,i},i.prototype.getEditorFormatString=function(){var t=this.metaData;return n.Common.IsEmpty(t.DisplayFormat)?n.Common.IsEmpty(t.DateFormat)?null:t.DateFormat:t.DisplayFormat},i}(t);n.DateCellTypeData=r;u=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.getDefaultValue=function(){var i=t.prototype.getDefaultValue.call(this);return n.Common.IsEmpty(i)?null:(i=n.FormatHelper.getValueFromText(i),!n.DateHelper.isValidDateValue(i))?null:(i instanceof Date&&(i=n.Convertor.fromDateToOADate(i)),typeof i!="number")?null:i},i.prototype.getEditorFormatString=function(){return n.StaticFormatString.timeDefaultFormattingString},i}(t);n.TimeCellTypeData=u;f=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.convertToValidValue=function(n){return i.convertTextToNumber(n)},i.convertTextToNumber=function(t){if(n.Common.IsEmpty(t))return{isValid:!0,validValue:t};var i=Number(t);return{isValid:!isNaN(i),validValue:i}},i}(t);n.NumberCellTypeData=f;e=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.canEnterEditModeInListview=function(){return this.metaData.ShowOnlyEdit},t}(t);n.GroupCellTypeData=e;o=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.canEnterEditModeInListview=function(){return this.metaData.ShowOnlyEdit},i.prototype.convertToValidValue=function(n){return i.convertTextToBool(n)},i.convertTextToBool=function(t){if(n.Common.IsEmpty(t))return{isValid:!0,validValue:t};var r=!0,i;return t===1||t==="1"||t===!0||(t+"").toLowerCase()==="true"?i=1:t===0||t==="0"||t===!1||(t+"").toLowerCase()==="false"?i=0:r=!1,{isValid:r,validValue:i}},i}(t);n.CheckBoxCellTypeData=o;s=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.canEnterEditModeInListview=function(){return!1},t}(t);n.UploadImageCellTypeData=s;h=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.canEnterEditModeInListview=function(){return!1},t}(t);n.AttachmentCelltypeData=h})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__assign=this&&this.__assign||function(){return __assign=Object.assign||function(n){for(var t,r,i=1,u=arguments.length;i<u;i++){t=arguments[i];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},__assign.apply(this,arguments)},__spreadArray=this&&this.__spreadArray||function(n,t,i){if(i||arguments.length===2)for(var r=0,f=t.length,u;r<f;r++)!u&&r in t||(u||(u=Array.prototype.slice.call(t,0,r)),u[r]=t[r]);return n.concat(u||Array.prototype.slice.call(t))},Forguncy;(function(n){var r=function(t){function r(i,r,u,f){var e=t.call(this)||this;return e._textCacheForValidate=null,e.isEnabled=!0,e._isVisible=!0,e._isReadOnly=!1,e._settedValue=null,e._propertyFormulaCallbackCache={},e._hasDestroyed=!1,e._tabIndex=0,e.validateError=!1,e._pageID=n.ForguncyData.pageInfo.pageID,e.ID=u,e.CellElement=i,e.isInListview=r===1,e._isSettingValue=!1,e._isWaitingServerData=!1,e.allowSetValueByUser=!0,e.supportedEvents=[],e._dataValidationInfo=i.DataValidation,e.cellTypeData=e._getCellTypeData(e.CellElement.CellType),e.IsInMasterPage=n.PageManager.isMasterPageName(f===null||f===void 0?void 0:f.runTimePageName),e.owner=f,e}return __extends(r,t),Object.defineProperty(r.prototype,"runTimePageName",{get:function(){var n;if((n=this.owner)!==null&&n!==void 0)return n.runTimePageName},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"designerPageName",{get:function(){var n;if((n=this.owner)!==null&&n!==void 0)return n.designerPageName},enumerable:!1,configurable:!0}),r.prototype.getPluginResource=function(t){for(var u,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];return u=n.Plugin.LocalizationResourceHelper.getLocalizationResourceByCellType(this),n.Common.formatResource(u[t],r)},r.prototype.getApplicationResource=function(t){for(var r,u=[],i=1;i<arguments.length;i++)u[i-1]=arguments[i];return(r=n.Plugin.LocalizationResourceHelper).getApplicationResource.apply(r,__spreadArray([t],u,!1))},r.prototype.getFormulaListRowInfo=function(){if(this.listviewCalcName){var n={};return n[this.listviewCalcName]=this.listviewRowIndex,n}},r.prototype._getCellTypeData=function(t){return new n.CellTypeDataBase(t)},r.prototype.create=function(t){var l=this,h,r,o,e,c,a,s,f,u;this._containerCache=t;r=this.CellElement;r.TemplateCellSource&&(o=n.PageManager.getUserControlCellType(this.runTimePageName),o&&(e=null,r.TemplateCellSource===n.UserControl_ValueBindingPropertyName?e=n.ForguncyData.pageInfo.dataModel.normalCellDataModel.getValue(o.ID):(e=o.GetSinglePropertyValue(r.TemplateCellSource).Result,n.Common.IsEmpty(e)&&(c=o.CellElement.CellType.PropertyValues,c&&(a=(h=c.find(function(n){return n.Name===r.TemplateCellSource}))===null||h===void 0?void 0:h.Value,e=o.evaluateFormula(a)))),n.Common.IsEmpty(e)||(r.Value=e)));this._keywordDisposeHandler=n.KeyWords.onKeyWordValueChanged(r.Value,this.runTimePageName,function(t){var i=n.ForguncyData.pageInfo.dataModel.normalCellDataModel,r=i.getValue(l.ID);r!==t&&i.setValue(l.ID,{newValue:t,uiAction:!0},7)});s=n.KeyWords.GetKeyWordValue(r.Value);r.Value=s===r.Value?n.Common.getMultiLanguageWord(s):s;f=r.CellType;u=this.createContent();f&&f.IsDisabled&&(this._disable(u),this.isEnabled=!1);n.ValidationTooltipHelper.setTooltipAttr(t);this._setOverflowHidden(t);u=i.adjustDomForOverflow(u,t,r,this.runTimePageName);this.disableAnimationWhenLoad()&&(u===null||u===void 0?void 0:u.addClass("disableAnimationWhenLoad"));this._setDataValidationToDom(u);u&&(t.append(u),(f===null||f===void 0?void 0:f.IsInvisible)&&(this._setVisible(t,!1),this._isVisible=!1),f&&(f.ReadOnly||f.Readonly)&&this.setReadOnly(!0));this.applyTemplateStyle();this.refreshClickable()},r.prototype.disableAnimationWhenLoad=function(){var n=this.getUIPermission(2);return n?!0:!1},r.prototype.shrinkToFit=function(t){var f=this.CellElement.StyleInfo,c=f.ShrinkToFit,l=f.WordWrap,e=f.VerticalAlignment,u,o;if(c&&!l){var a=n.CellVerticalAlignment[e].toLowerCase(),s=t[0].offsetWidth,i=t[0].offsetHeight,h=this.getContainer().width(),r=this.getContainer().height();s!==0&&h!==0&&i!==0&&r!==0&&(u=0,i>r&&(e===n.CellVerticalAlignment.Center?u=(i-r)/2:e===n.CellVerticalAlignment.Bottom&&(u=i-r)),o=parseFloat((h/s).toFixed(6)),o<1?(t.css("transform-origin","left ".concat(a)),t.css("transform","translateY(-".concat(u,"px) scale(").concat(o,")"))):(t.css("transform-origin",""),t.css("transform","")))}},r.prototype.applyTemplateStyle=function(){var n=this.getStyleTemplateHelper();n!==null&&n.ApplyTemplateStyle(this.CellElement.StyleTemplate,this._containerCache,this.validateError)},r.prototype.checkAuthority=function(n){var t=this.getUIPermission(n);return t?this.checkRoleAuthority(t.AllowRoles):!0},r.prototype.checkRoleAuthority=function(t){var i,r,u;return t&&(t.indexOf("FGC_Anonymous")!==-1||(i=n.Page.getUserInfo(),!n.Common.IsEmpty(i===null||i===void 0?void 0:i.UserName)&&t.indexOf("FGC_LoginUser")!==-1)||(r=[],n.Common.IsEmpty(i===null||i===void 0?void 0:i.Role)||(r=i.Role.split(",")),n.Common.IsEmpty(i===null||i===void 0?void 0:i.InheritedPermissionRoles)||(r=r.concat(i.InheritedPermissionRoles.split(","))),u=t.filter(function(n){return r.indexOf(n)!==-1}),u.length!==0))?!0:!1},r.prototype.getPermissionKey=function(){var f,e,o,u,t,i;if(!r._permissionPageCache[this.designerPageName]){if(u=this.designerPageName,!((o=(e=(f=n.ForguncyData)===null||f===void 0?void 0:f.GlobalSettings)===null||e===void 0?void 0:e.PageUIPermissions)===null||o===void 0?void 0:o[u])&&(t=n.PageManager.getContainerCell(this.runTimePageName),t&&t.cellType instanceof n.RepeaterCellType&&(i=n.PageManager.getLocatedNormalPageNames(this.runTimePageName),i&&i.length>1))){var c=i[i.length-2],s=n.Common.getA1ReferenceString(t.row,t.column,!0,!0),h=this.getCellName(t.name,t.runTimePageName);n.Common.IsEmpty(h)||(s=h);u=c+"->"+s+"->"+r.UIPermission_TemplatePageKey}r._permissionPageCache[this.designerPageName]=u}return r._permissionPageCache[this.designerPageName]},r.prototype.getUIPermission_obsolete=function(t){var e,o,s,h,r,u,c,f;if(this.isInListview||(s=(o=(e=n.ForguncyData)===null||e===void 0?void 0:e.GlobalSettings)===null||o===void 0?void 0:o.PageUIPermissions,!s)||(h=this.getPermissionKey(),r=s[h],!r||!r.CellUIPermissions))return null;var a=h!==this.designerPageName,i=n.ForguncyData.pageInfo.pageElementManager.cells.getCell(this.ID),l=n.Common.getA1ReferenceString(i.row,i.column,!0,!0);return(a&&i.templateCellSource&&(l=i.templateCellSource),u=r.CellUIPermissions[l],!u&&(c=this.getCellName(i.name,i.runTimePageName),n.Common.IsEmpty(c)||(u=r.CellUIPermissions[c]),!u))?null:(f=u.filter(function(n){return n.Scope===t}),f.length===0||!f[0].Enabled)?null:f[0]},r.prototype.getCellName=function(t,i){var r,u;if(t&&t.length>0)for(r=0;r<t.length;r++)if(u=t[r],n.ForguncyData.pageInfo.pageElementManager.cells.getCellsByName(u,!0,[i]).length===1)return u;return null},r.prototype.getUIPermission=function(n){var t,i,r,f,u,e;if(this.isInListview||(t=this.tryGetPermissionData(),!t)||(t.permissionResource.enabledTypes&n)!==n)return null;for(i=[],r=0,f=t.permissionBindings;r<f.length;r++)u=f[r],u&&u.cellPermissionType==n&&i.push(u);return i.length===0?null:(e=this.buildUIPermissionRecursively(t.permissionResource,i),e[0])},r.prototype.tryGetPermissionData=function(){var f,e,u=(e=(f=n.ForguncyData)===null||f===void 0?void 0:f.GlobalSettings)===null||e===void 0?void 0:e.CellPermissionDataContext;if(!u)return null;var o=this.designerPageName,i=n.ForguncyData.pageInfo.pageElementManager.cells.getCell(this.ID),t=n.Common.getA1ReferenceString(i.row,i.column,!0,!0),r=u[this.concatCellResourceName(o,t)];return r||(t=this.getCellName(i.name,i.runTimePageName),r=u[this.concatCellResourceName(o,t)]),r||(t=i.templateCellSource,t&&(r=u[this.concatCellResourceName(o,t)])),r},r.prototype.concatCellResourceName=function(n,t){return!n||!t?null:n+"!"+t},r.prototype.buildUIPermissionRecursively=function(n,t){var e,r,o,i,s,l,h,u,c,f,a;if(!t||t.length===0)return null;for(e=[],r=0,o=t;r<o.length;r++){if(i=o[r],s={Category:n.category,Enabled:(n.enabledTypes&i.cellPermissionType)===i.cellPermissionType,Scope:i.cellPermissionType,AllowRoles:i.roleNames,Name:i.nodeName},n.isMenu&&i.children){for(l=this.buildUIPermissionRecursively(n,i.children),h=[],u=0,c=l;u<c.length;u++)f=c[u],a={Name:f.Name,Children:f.Children,AllowRoles:f.AllowRoles},h.push(a);s.Children=h}e.push(s)}return e},r.prototype.createContent=function(){return null},r.prototype.getStyleTemplateHelper=function(){return null},r.prototype.clearStyleTemplate=function(){var n=this.getStyleTemplateHelper();n!==null&&n.Clear();this.CellElement&&this.CellElement.StyleTemplate&&(this.CellElement.StyleTemplate=null)},r.prototype.clickable=function(){return!0},r.prototype._setOverflowHidden=function(n){n.css("overflow","hidden")},r.prototype.getElementTabIndex=function(){return this._tabIndex},r.prototype.setTabIndex=function(n){this._tabIndex!==n&&(this._tabIndex=n,this.setTabIndexToElement(n))},r.prototype.setTabIndexToElement=function(t){n.DomUtilities.setTabIndex(this.getTabIndexDom(),t)},r.prototype.getTabIndexDom=function(){return this.getContainer().find("button, input, a, textarea")},r.prototype.shouldEnableTabIndex=function(){return!1},r.prototype._setDataValidationToDom=function(t){var r,i;t&&(r=this,n.Common.IsEmpty(this._dataValidationInfo)||(t.attr("data-dataValidationInputTitle",n.Common.getMultiLanguageWord(this._dataValidationInfo.InputMessageTitle)),t.attr("data-dataValidationInputMessage",n.Common.getMultiLanguageWord(this._dataValidationInfo.InputMessage)),this._dataValidationInfo.ShowInputMessageWhenCellIsSelected!==!0||n.Common.IsEmpty(this._dataValidationInfo.InputMessage)||(i=null,t.focusin(function(){var t=$(this).attr("data-dataValidationInputTitle"),u=$(this).attr("data-dataValidationInputMessage"),f;n.Common.IsEmpty(t)&&n.Common.IsEmpty(u)||(n.DelayRefresh.NeedDelayRun===!0?$(".dataValidationInput").fadeToggle(function(){$(this).remove()}):$(".dataValidationInput").remove(),i=r.createInputMessageToolTip($(this),t,u),i.addClass("dataValidationInput"),f=$(this).parent().parent(),$(f).append(i),i.fadeToggle())}),t.focusout(function(){i!==null&&(n.DelayRefresh.NeedDelayRun===!0?i.fadeToggle(function(){$(this).remove()}):$(i).remove())}))),n.ValidatorCreator.createValidators(this.CellElement,this.isInListview)&&this.hideValidationTooltipWhenInputOrSelect(t))},r.prototype.createInputMessageToolTip=function(t,i,r){var f=t.parent(),u=$(document.createElement("div")),e,o;return u.addClass("fgc-input-tooltip"),u.css("top",f.position().top+f.height()),u.css("left",f.position().left+f.width()-90),e=$(document.createElement("div")),e.addClass("fgc-input-tooltip__title"),n.Common.IsEmpty(i)||e.append(i),u.append(e),o=$(document.createElement("div")),o.addClass("fgc-input-tooltip__message"),n.Common.IsEmpty(r)||o.append(r),u.append(o),u},r.prototype.hideValidationTooltipWhenInputOrSelect=function(n){var i=this,t=this;t._textCache=n.find("#"+t.ID).val();n.keyup(function(){var r=n.find("#"+t.ID);t._textCache!==r.val()&&i.hideValidateTooltip();t._textCache=r.val()})},r.prototype.hideValidateTooltip=function(){var t,i;((i=(t=this===null||this===void 0?void 0:this.CellElement)===null||t===void 0?void 0:t.DataValidation)===null||i===void 0?void 0:i.ErrorTo)===1?n.FormulaHelper.setValueToCellLocation(null,this.CellElement.DataValidation.ErrorToTargetCell,7,this.getDefaultFormulaCalcInfo(),!1):n.ValidationTooltipHelper.destroyTooltip(this.getContainer())},r.prototype.getDefaultValue=function(){return null},r.prototype.executeCommand=function(t,i){!t||t.length<=0||n.ForguncyData.commandExecutor.executeCommand(t,{runTimePageName:this.runTimePageName,commandTrigger:this,commandID:this.ID,eventType:"click",locationString:n.FormulaHelper.getCellLogLocationString(this.ID,this.Name,this.runTimePageName),initParams:i===null||i===void 0?void 0:i.initParams,callbackOnCommandCompleted:i===null||i===void 0?void 0:i.callbackOnCommandCompleted})},r.prototype.executeCustomCommandObject=function(n,t,i,r){i===void 0&&(i="click");this.executeCustomCommandObjectWithID(n,t,i,r,this.ID)},r.prototype.executeCustomCommandObjectWithID=function(t,i,r,u,f){(r===void 0&&(r="click"),!t||!t.Commands||t.Commands.length<=0)||n.ForguncyData.commandExecutor.executeCommand(t.Commands,{runTimePageName:this.runTimePageName,commandTrigger:this,commandID:f,eventType:r,initParams:i,locationString:n.FormulaHelper.getCellLogLocationString(this.ID,this.Name,this.runTimePageName),callbackOnCommandCompleted:u})},r.prototype.isCommandExecuting=function(){return n.ForguncyData.commandExecutor.isCommandExecuting(this.ID,"click")},r.prototype.onDependenceCellValueChanged=function(t){n.DependenceCellValueChangeHelper.listenFormulaRefChanged(this.CellElement.DependenceCells,t,this.runTimePageName,!1,!0)},r.prototype.hasFocus=function(){var n=$("#"+this.ID);return n.length>0&&document.activeElement===n[0]?!0:!1},r.prototype.setFocus=function(){var n=$("#"+this.ID);n.length>0&&n[0].focus()},r.prototype.setValue=function(n){if(!this._isSettingValue){this._settedValue=n;var t=$("#"+this.ID);(t.length!==1&&(t=this.getContainer()),t.length===1)&&(this._setValue(t,n),this._textCache=$("#"+this.ID).val(),this._textCacheForValidate=this.getValue(!0))}},r.prototype._setValue=function(n,t){this._isWaitingServerData||(this._isSettingValue=!0,this.setValueToElement(n,t),this._isSettingValue=!1)},r.prototype.setValueToElement=function(){},r.prototype.getValue=function(t){var i=this.getValueFromElement(t);return n.Common.IsEmpty(i)?null:i},r.prototype.getValueFromElement=function(){return null},r.prototype.getValueFromDataModel=function(){if(!this.isInListview)return n.ForguncyData.pageInfo.dataModel.normalCellDataModel.getValue(this.ID);throw"Not support in listview";},r.prototype.commitValue=function(){this._onValueChanged()},r.prototype._onValueChanged=function(){this._isSettingValue||this.trigger("valuechanged",{newValue:this.getValue(!1),uiAction:!0})},r.prototype.getFormatString=function(){var t=this.CellElement.StyleInfo.Formatter;return n.Common.IsEmpty(t)&&(t=this.cellTypeData.getEditorFormatString()),t},r.prototype.setFormatString=function(n){this.CellElement.StyleInfo.Formatter!==n&&(this.CellElement.StyleInfo.Formatter=n,this.onFormatterChanged())},r.prototype.onFormatterChanged=function(){},r.prototype.isDisabled=function(){return!this.isEnabled},r.prototype.disable=function(){this.isEnabled&&(this.isEnabled=!1,this._disable($("#"+this.ID+"_div").children()))},r.prototype._disable=function(n){n&&n.data("DisableCallback")&&n.data("DisableCallback")()},r.prototype.enable=function(){this.isEnabled||this.checkAuthority(2)&&(this.isEnabled=!0,this._enable($("#"+this.ID+"_div").children()))},r.prototype._enable=function(n){n&&n.data("EnableCallback")&&n.data("EnableCallback")()},r.prototype.setBackColor=function(t){this.CellElement.StyleInfo.Background=t;var i=this._getPartsUseBackcolor();t?i.css("background",n.ColorHelper.Convert(t)):i.css("background","")},r.prototype._getPartsUseBackcolor=function(){var n=$("#"+this.ID+"_backgrounddiv");return n.length>0?n:$("#"+this.ID+"_div")},r.prototype.adjustForeColor=function(t,i){var u=n.ForguncyData.pageInfo.dataModel.normalCellDataModel.getValue(this.ID),r={value:null};return n.FormatHelper.formatValue(u,i,r),r.value&&(t=r.value),t?n.ColorHelper.Convert(t):""},r.prototype.setFontStyle=function(t){var i=this.CellElement.StyleInfo;i.FontFamily=t.FontFamily;i.FontStyle=t.FontStyle;i.FontSize=t.FontSize;i.FontWeight=t.FontWeight;i.Foreground=n.ColorHelper.Convert(t.Foreground);i.Strikethrough=t.Strikethrough;i.Underline=t.Underline;this._setFontStyle(t)},r.prototype._setFontStyle=function(t){var r=this._getPartsUseFontStyle(),i;r&&(i=n.Common.clone(t),i.Foreground=this.adjustForeColor(i.Foreground,this.getFormatString()),n.DomUtilities.setFontStyle(i,r))},r.prototype._needAdaptIosUnderlineinherit=function(t){var i,r,u;if(n.Platform.isIOSDevice()&&(r=((i=this.CellElement.StyleTemplate)===null||i===void 0?void 0:i.Styles[t])||{},u=0,Object.keys(r).forEach(function(n){r[n].Underline&&u++}),u>0))return!0},r.prototype._getPartsUseFontStyle=function(){return $("#"+this.ID)},r.prototype.isNormalCellVisibleOfLayout=function(){var r,t,i;return this.isInListview?!0:(t=n.ForguncyData.getPageLayout(this._pageID,this.runTimePageName),(t===null||t===void 0?void 0:t.isVisible(this.CellElement.Layout))===!1)?!1:(i=n.PageManager.getContainerCell(this.runTimePageName),((r=i===null||i===void 0?void 0:i.cellType)===null||r===void 0?void 0:r.isNormalCellVisibleOfLayout())===!1)?!1:!0},r.prototype.isVisible=function(){return this._isVisible},r.prototype.setVisible=function(n){var t;if((n=!!n,this._isVisible!==n)&&(!n||this.checkAuthority(1))){var i=this.ID+"_div",r=this.ID+"_backgrounddiv",u=$("#"+i).add("#"+r);this._setVisible(u,n);this._isVisible=n;this.refreshClickable();t=$("#"+this.ID+"_outerdiv");this.updateOuterDivPointerEvents(t,n)}},r.prototype.refreshClickable=function(){var n=this.getContainer().parent();this.isVisible()&&this.clickable()?n.removeClass("fgc-penetrable"):n.addClass("fgc-penetrable")},r.prototype.updateOuterDivPointerEvents=function(n,t){n.css("pointer-events",t?"":"none")},r.prototype._setVisible=function(t,i){var r=this._getVisibleParts(t),e,f,u;if(i)t.css("display",""),r&&(u=r.attr("olddisplay"),r.css("display",n.Common.IsEmpty(u)?"":u));else if(t.css("display","none"),r)for(e=0;e<r.length;e++)f=$(r[e]),f.attr("olddisplay")===undefined&&(u=f.css("display"),f.attr("olddisplay",u)),f.css("display","none")},r.prototype._getVisibleParts=function(){return null},r.prototype.isReadOnly=function(){return this._isReadOnly},r.prototype.setReadOnly=function(n){if(n=!!n,this._isReadOnly!==n){if(!n&&!this.checkAuthority(4))return;this._isReadOnly=n;this.updateReadOnlyStatus()}},r.prototype.updateReadOnlyStatus=function(){},r.prototype.enterPrintMode=function(){},r.prototype.quitPrintMode=function(){},r.prototype.trigger=function(i,r){this._pageID===n.ForguncyData.pageInfo.pageID&&this.isEnabled&&t.prototype.trigger.call(this,i,r)},r.prototype._startWaitingServerData=function(){this._isWaitingServerData=!0},r.prototype._endWaitingServerData=function(){this._isWaitingServerData=!1;var t=n.ForguncyData.pageInfo.dataModel.normalCellDataModel.getValue(this.ID);this.setValue(t)},r.prototype.getContainer=function(){return this._containerCache?this._containerCache:$("#"+this.ID+"_div")},r.prototype.validate=function(){n.ForguncyData.GlobalSettings&&n.ForguncyData.GlobalSettings.TriggerTime===1||(this._textCacheForValidate!==this.getValue(!0)&&this.commitValue(),n.ValidationMananger.validateCell(this))},r.prototype.onValidateError=function(t,i){var c=this,u,f,e,r,s,o,h;return this.validateError=!0,this.applyTemplateStyle(),r=this.getContainer(),((f=(u=this===null||this===void 0?void 0:this.CellElement)===null||u===void 0?void 0:u.DataValidation)===null||f===void 0?void 0:f.ErrorTo)===1?n.FormulaHelper.setValueToCellLocation(t.message,this.CellElement.DataValidation.ErrorToTargetCell,7,this.getDefaultFormulaCalcInfo(),!1):((e=r===null||r===void 0?void 0:r.parents("#pagesContainer"))===null||e===void 0?void 0:e.length)===1&&(s=r[0],n.Common.IsEmpty(t.message)?n.ValidationTooltipHelper.destroyTooltip(r):n.ValidationTooltipHelper.showTooltip(s,t.message)),o=!1,!n.ForguncyData.GlobalSettings.KeepFocusWhenDataValidationFailed||this.IgnoreKeepFocus||i||(h=n.ForguncyData.getPageInfo(this._pageID),h.hasExtraDialog||this._pageID!==n.ForguncyData.pageInfo.pageID||(this.setFocus(),this.hasFocus()||(this.IgnoreKeepFocus=!0,window.requestAnimationFrame(function(){c.IgnoreKeepFocus=undefined})),o=!0)),this.trigger("validate",{cellType:this,isValid:!1}),o},r.prototype.onValidateSuccess=function(){this.validateError=!1;this.applyTemplateStyle();this.hideValidateTooltip();this.trigger("validate",{cellType:this,isValid:!0})},r.prototype.validateValue=function(t,i,r){return r===void 0&&(r=!1),n.ValidationMananger.validateDataValidation(this.CellElement,t,i)},r.prototype.getValidators=function(){if(!this.needValidate()||!this.isEnabled||!this.isVisible()||!this.isNormalCellVisibleOfLayout())return null;var t=n.ValidatorCreator.createValidators(this.CellElement,this.isInListview);return this.CellElement.CellType.$type==="ImageEditor.ImageEditor, ImageEditor"&&this.customValidate&&(t=t!==null&&t!==void 0?t:[],t.push(new h(this))),t},r.prototype.needValidate=function(){return this.isReadOnly()?!1:!0},r.prototype.shouldCancelCommand=function(t,i){if(this._hasDestroyed)return!0;if(i==="valuechanged"){var r=n.ForguncyData.pageInfo.dataModel.normalCellDataModel.getValue(t);if(r===this._valueOfTriggerValueChangedCommand)return!0;this._valueOfTriggerValueChangedCommand=r}return!this.checkAuthority(1)||!this.checkAuthority(2)||!this.checkAuthority(4)?!0:!1},r.prototype.initValueWhenTriggerValueChangedCommand=function(){this._valueOfTriggerValueChangedCommand=n.ForguncyData.pageInfo.dataModel.normalCellDataModel.getValue(this.ID)},r.prototype.allowFormatValue=function(){return!0},r.prototype.onLoad=function(){this.checkAuthority(1)||this.setVisible(!1);this.checkAuthority(2)||this.disable();this.checkAuthority(4)||this.setReadOnly(!0)},r.prototype.getCellTypeInfo=function(){return{value:this._settedValue,isDisabled:this.isDisabled(),isReadOnly:this.isReadOnly(),styleData:__assign({},this.CellElement.StyleInfo)}},r.prototype.onPageLoaded=function(){},r.prototype.showDesignerPreviewError=function(){},r.prototype.getPageLayout=function(){return n.ForguncyData.getPageLayout(this._pageID,this.runTimePageName)},r.prototype.isAutoFitWidth=function(){var n;if((n=this.getPageLayout())!==null&&n!==void 0)return n.possibleAutoFitInColumns(this.CellElement.Layout)},r.prototype.isAutoFitHeight=function(){var n;if((n=this.getPageLayout())!==null&&n!==void 0)return n.possibleAutoFitInRows(this.CellElement.Layout)},r.prototype.isIgnoreLogicVisible=function(){return!!n.ForguncyData.GlobalSettings.IgnoreLogicVisible},r.prototype.onCurrentRowInfoChanged=function(){},r.prototype.destroy=function(){var t,i,r;if((t=this._keywordDisposeHandler)===null||t===void 0?void 0:t.call(this),this.clearStyleTemplate(),this._containerCache&&this._containerCache.empty(),this._containerCache=null,this._propertyFormulaCallbackCache&&(i=n.ForguncyData.pageInfo.formulaManager.getCalcSource(this.runTimePageName),i instanceof n.PageCalcSource)){for(r in this._propertyFormulaCallbackCache)i.unListenFormula(r,this._propertyFormulaCallbackCache[r]);this._propertyFormulaCallbackCache=undefined}this._hasDestroyed=!0},Object.defineProperty(r.prototype,"hasDestroyed",{get:function(){return this._hasDestroyed},enumerable:!1,configurable:!0}),r.prototype.getValueFromListviewText=function(t,i){var r,u;return(i===void 0&&(i=!1),typeof t=="string"&&(r=this.cellTypeData.convertToValidValue(t),r.isValid&&r.validValue!==t))?r.validValue:(u=this.getFormatString(),n.Common.IsEmpty(u)?t:n.FormatHelper.getValueFromText(t,u))},r.prototype.getListviewNoneEditModeText=function(t,i,r,u){return u===void 0&&(u=null),r||(r=this.getFormatString()),n.FormatHelper.formatValue(t,r,i)},r.prototype.getControl=function(){return null},r.prototype.getBindingTables=function(){return this._bindingDataSourceTables},r.prototype.reload=function(){},r.prototype.preReload=function(){},r.prototype.onBindingTableChanged=function(){this.reload()},r.prototype.evaluateFormula=function(t){var i=this.getDefaultFormulaCalcInfo();return n.ForguncyData.pageInfo.formulaManager.evaluateFormula(t,i)},r.prototype.onFormulaResultChanged=function(t,i,r){var e,f,u;(r===void 0&&(r=!0),i)&&(r&&(e=this.evaluateFormula(t),i(e,!1)),t&&typeof t=="string"&&t[0]==="="&&(t=t.substring(1),f=n.ForguncyData.pageInfo.formulaManager.getCalcSource(this.runTimePageName),f instanceof n.PageCalcSource&&(u=n.PageManager.getUserControlCellType(this.runTimePageName),f.listenFormula(t,i,u===null||u===void 0?void 0:u.DefinedPropertyNames,this.getFormulaListRowInfo()),this._propertyFormulaCallbackCache||(this._propertyFormulaCallbackCache={}),this._propertyFormulaCallbackCache[t]||(this._propertyFormulaCallbackCache[t]=[]),this._propertyFormulaCallbackCache[t].push(i))))},r.prototype.onBindingDataSourceDependenceCellValueChanged=function(t,i){t.Params.length&&n.DependenceCellValueChangeHelper.listenFormulaRefChanged(t.Params,i,this.runTimePageName)},r.prototype.setContextVariableValue=function(t,i){return n.ForguncyData.parameterManager.setValue(t,i,null)},r.prototype.clearContextVariableValue=function(t){return n.ForguncyData.parameterManager.setValue(t,undefined,null)},r.prototype.getDefaultFormulaCalcInfo=function(){return{runTimePageName:this.runTimePageName,nullAsException:!1,listInfo:this.getFormulaListRowInfo(),isCommand:!1,rowOffset:0,columnOffset:0}},r.prototype.getFormulaCalcContext=function(){return{IsInMasterPage:this.IsInMasterPage,PageID:this.runTimePageName}},r.prototype.shouldDisplayInListviewNewRow=function(){return!0},r.prototype.onWindowResized=function(){return null},r.prototype._getDomCreateInfo=function(){return{id:this.ID,isInListview:this.isInListview}},r.prototype.shouldCheckDirtyWhenLeavePage=function(){var n,t;return!!((t=(n=this.CellElement)===null||n===void 0?void 0:n.CellType)===null||t===void 0?void 0:t.ShouldCheckDirtyWhenLeavePage)},r.prototype.isDirty=function(n){return n.currentValue!==n.defaultValue},r.prototype.ignoreDirty=function(){},r.prototype.getExecutingGetBindingDataSourceResultKey=function(n,t){var f={},i,r,u,e;if(n.Params)for(i=0,r=n.Params;i<r.length;i++)u=r[i],f[u]=this.evaluateFormula(u);return e={CommandId:n.GUID,Params:f,options:t},JSON.stringify(e)},r.prototype.getBindingDataSourceValue=function(t,i,u,f,e){var a=this,c,v,s,l,h,y,o;if(f===void 0&&(f=!1),e===void 0&&(e=!1),t&&u)if(t.GUID){if(t.TableName&&(this._bindingDataSourceTables||(this._bindingDataSourceTables=[]),this._bindingDataSourceTables.indexOf(t.TableName)<0&&this._bindingDataSourceTables.push(t.TableName)),c={},v=new n.Throttle(function(n,r){a.getBindingDataSourceValue(t,i,u,!1,r)}),t.Params)for(s=0,l=t.Params;s<l.length;s++)if(h=l[s],c[h]=this.evaluateFormula(h),f)this.onFormulaResultChanged(h,function(n,t){v.execute(n,t)},!1);if(y={CommandId:t.GUID,Params:c,options:i},o=this.getExecutingGetBindingDataSourceResultKey(t,i),r._executingGetBindingDataSourceResult[o]){u(r._executingGetBindingDataSourceResult[o],!1);return}r._executingGetBindingDataSourceValue[o]?r._executingGetBindingDataSourceValue[o].push(u):(r._executingGetBindingDataSourceValue[o]=[u],n.Common.forguncyPost("Home/CalcBindingDataSource",y,function(n){r._executingGetBindingDataSourceResult[o]=n;a.addWarningInfoIfNecessary(n);setTimeout(function(){r._executingGetBindingDataSourceResult[o]=undefined},0);r._executingGetBindingDataSourceValue[o].forEach(function(t){return t&&t(n,e)});r._executingGetBindingDataSourceValue[o]=undefined},(t===null||t===void 0?void 0:t.GUID)+"|"+this.ID+"|"+this.runTimePageName))}else console.error("Can't find GUID in bindingDataSourceModel")},r.prototype.addWarningInfoIfNecessary=function(t){var i,r,u,f,o,e;n.ForguncyData.isDebugMode()&&(r=n.RS.PerformanceWarning,u=(i=t===null||t===void 0?void 0:t.length)!==null&&i!==void 0?i:0,u>2e3&&(f="",this.owner instanceof n.ListviewData&&(f=this.owner.getListviewName()),o=this.designerPageName+"|"+n.CellStatusCacheHelper.getCellLocationKey(this.CellElement,f),e=n.Common.format(n.RS.PerformanceWarningCellTypeLoadTooManyDatas,o,u),console.warn("%c"+r+" %c"+e,"color:red;font-weight:600","color:black;"),n.ForguncyData.pageInfo.dataModel.debugWarningInfoDataModel.push({message:"".concat(r).concat(e)})))},r.prototype.clearBindingDataSourceValueCache=function(n,t){var i=this.getExecutingGetBindingDataSourceResultKey(n,t);Reflect.has(r._executingGetBindingDataSourceResult,i)&&Reflect.deleteProperty(r._executingGetBindingDataSourceResult,i)},r.UIPermission_TemplatePageKey="0BD905CA-8A4D-4F75-BF5F-582F869D0E46",r._permissionPageCache={},r._executingGetBindingDataSourceValue={},r._executingGetBindingDataSourceResult={},r}(n.EventClassBase),u,f,e,t,o,s,i,h;n.CellTypeBase=r;u=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.updateContainerForSimplebar=function(){var t=n.ForguncyData.getPageLayout(this._pageID,this.runTimePageName),i=t.possibleAutoFitInRows(this.CellElement.Layout),r=t.possibleAutoFitInColumns(this.CellElement.Layout);i?(this.getContainer().css("height","auto"),this.getContainer().css("min-height","100%")):this.getContainer().css("height","");r?this.getContainer().css("width","100%"):this.getContainer().css("width","");this.getContainer().css("overflow","visible")},i}(r);n.CellTypeBaseWithSimplebar=u;f=function(){function n(){}return n}();n.FormulaListRowInfo=f;e=function(){function t(){}return t.getCellType=function(i,r,u,f){var e=t.getRegistedCellTypeCreateFunction(i);return n.Common.IsEmpty(e)&&(i.Value===n.KeyWords.CurrentUserStr&&n.Common.IsEmpty(i.BindingInfo)?(e=n.CurrentUserCellType,i.CellType={ShowUserPicture:!1,ShowDropDown:!0,$type:"Forguncy.CurrentUserCellType, ServerDesignerCommon",IsGenerateByKeyWord:!0},i.IsLeftOverflow=!1,i.IsRightOverflow=!1,i.LeftOverflowSpace=undefined,i.RightOverflowSpace=undefined,i.CanAdjustOverflowRegardlessOfLengthMode=!1):e=n.GeneralCellType),new e(i,r,u,f)},t.registerCellType=function(i,r,u){typeof i!="string"||n.Common.IsEmpty(i)||typeof r=="function"&&(n.Common.IsEmpty(u)||typeof u=="function")&&(t._registedCellTypes[i]||(t._registedCellTypes[i]=[]),t._registedCellTypes[i].push({cellTypeCtor:r,match:u}))},t.getRegistedCellTypeCreateFunction=function(n){var i,r,u;if(!n||!n.CellType)return null;if(i=t._registedCellTypes[n.CellType.$type],!i||i.length<=0)return console.error("Can't found cell type "+n.CellType.$type),null;for(r=i.length-1;r>=0;r--)if(u=i[r],!u.match||u.match(n))return u.cellTypeCtor;return null},t.getIdentifierByCellType=function(n){var u,i,r,f,e;if(!n)return null;for(u in t._registedCellTypes)if(i=t._registedCellTypes[u],i&&!(i.length<=0))for(r=0,f=i;r<f.length;r++)if(e=f[r],e.cellTypeCtor===n.constructor)return u;return null},t._registedCellTypes={},t}();n.CellTypeHelper=e;t=function(){function t(n){this.text=n}return t.prototype.toString=function(){return n.Common.IsEmpty(this.text)?"":this.text.toString()},t}();n.WrongParseResult=t;o=function(){function i(){}return i.getDisplayValue=function(i,r){var f,u;if(r instanceof t)return r.toString();if(i.UserInfo&&i.UserInfo.length>0)for(f=i.UserInfo,u=0;u<f.length;u++)if(n.Common.isEquals(r,f[u].Value))return n.Common.IsEmpty(f[u].DisplayValue)?"":f[u].DisplayValue.toString();if(i.ItemsInfo&&i.ItemsInfo.Items)for(f=i.ItemsInfo.Items,u=0;u<f.length;u++)if(n.Common.isEquals(r,f[u].Value))return n.Common.IsEmpty(f[u].DisplayValue)?"":f[u].DisplayValue.toString();return null},i}();n.UserSelectorCellHelper=o;s=function(){function i(){}return i.getFormattedItems=function(t,i){for(var o,s=[],h=t.length,f=0;f<h;f++){var r=t[f],e=null,u=n.Common.getMultiLanguageWord(r.DisplayValue);i&&(o=n.FormatHelper.format(i,n.Common.getMultiLanguageWord(r.DisplayValue)),e=o.color,u=o.text);typeof u=="string"&&(u=u.replace(/[\r\n]/g,""));s.push({Value:r.Value,DisplayValueBeforeFormat:n.Common.getMultiLanguageWord(r.DisplayValue),DisplayValue:u,Forecolor:e?e:null,DropDownSubItemsList:r.DropDownSubItemsList})}return s},i.getDisplayValue=function(i,r,u,f,e,o,s){var l=this,h,c;if(r instanceof t)return r.toString();if(i.IsBounding)return c=this.getIndexAndText(i,r,f,e,o,s,!0,!1,null,null,!0),c.index!==-1?c.beforeFormatValue:this.needValidateItem(i)?"":n.Common.IsEmpty(r)?"":r.toString();if(i.haveLoadItems&&i.ItemsInfo&&i.ItemsInfo.Items){if(i.AllowMultiSelect)return n.Common.IsEmpty(r)?null:(r+"").split(",").map(function(n){var t;if((t=l.getDisplayValueForNoBoundingItem(i,n))!==null&&t!==void 0)return t.text}).filter(function(t){return!n.Common.IsEmpty(t)}).join(",");if(h=this.getDisplayValueForNoBoundingItem(i,r),h)return h.text}return null},i.getDisplayValueForNoBoundingItem=function(t,i){for(var r,f="",e=!1,s=t.ItemsInfo.Items,u=0,o=s;u<o.length;u++)if(r=o[u],n.Common.isEquals(i,r.Value)){e=!0;f=n.Common.IsEmpty(r.DisplayValue)?"":n.Common.getMultiLanguageWord(r.DisplayValue.toString());break}return e?{text:f}:null},i.isComboBoxItemEqual=function(i,r){return i instanceof t?!1:((i===null||i===undefined)&&(i=""),(r===null||r===undefined)&&(r=""),i===""||r===""?i===r:n.Common.isFuzzyEquals(i,r))},i.getIndexAndText=function(t,i,r,u,f,e,o,s,h,c,l){var a,w;if(s===void 0&&(s=!1),h===void 0&&(h=null),c===void 0&&(c=null),l===void 0&&(l=!1),n.Common.IsEmpty(i)&&t.AddNullItemWhenBinding)return{index:0,beforeFormatValue:n.Common.getMultiLanguageWord(t.NoneItemText),text:n.Common.getMultiLanguageWord(t.NoneItemText)};var b=-1,v="",y="",p=n.TableColumnsCacheManager.getBindingValueCacheKey(t);return p&&(a=n.TableColumnsCacheManager.CannotFindValue,w=n.ConditionHelper.getComputedSqlConditionFormula(t.ItemsQuery,f,t.NullFormulaValueQueryPolicy,0,0,e),a=s?n.TableColumnsCacheManager.lookupComboboxResultAsync(t,i,w,u,p,h,c,o):n.TableColumnsCacheManager.lookupComboboxResultSync(t,i,w,l,u,p,o),a!==n.TableColumnsCacheManager.NoneExistentValue&&a!==n.TableColumnsCacheManager.CannotFindValue&&(b=0,v=n.Common.IsEmpty(a)?"":a,y=v,r&&(y=n.FormatHelper.format(r,v).text))),{index:b,beforeFormatValue:n.Common.IsEmpty(v)?"":v,text:n.Common.IsEmpty(y)?"":y}},i.processAsMultiSelect=function(n,t){return n.AllowMultiSelect&&t},i.needValidateItem=function(n){return n.AllowMultiSelect?!0:!n.SelectOnly&&!n.ValidateItem?!1:!0},i}();n.ComboCellHelper=s;i=function(){function t(){}return t.adjustDomForOverflow=function(i,r,u,f){var o,s,h,c,l,a,v,y,p,e;if(!i||u.Layout==undefined)return i;switch(u.StyleInfo.HorizontalAlignment){case n.CellHorizontalAlignment.Right:u.Layout.IsLeftOverflow=(o=u.IsLeftOverflow)!==null&&o!==void 0?o:!1;u.Layout.leftOverflowOffset=(s=u.LeftOverflowSpace)!==null&&s!==void 0?s:0;break;case n.CellHorizontalAlignment.Center:u.Layout.IsLeftOverflow=(h=u.IsLeftOverflow)!==null&&h!==void 0?h:!1;u.Layout.IsRightOverflow=(c=u.IsRightOverflow)!==null&&c!==void 0?c:!1;u.Layout.leftOverflowOffset=(l=u.LeftOverflowSpace)!==null&&l!==void 0?l:0;u.Layout.rightOverflowOffset=(a=u.RightOverflowSpace)!==null&&a!==void 0?a:0;break;default:u.Layout.IsRightOverflow=(v=u.IsRightOverflow)!==null&&v!==void 0?v:!1;u.Layout.rightOverflowOffset=(y=u.RightOverflowSpace)!==null&&y!==void 0?y:0}if(!t.needAdjustDom(u))return i;if(r.css("overflow","hidden"),u.StyleInfo.HorizontalAlignment==n.CellHorizontalAlignment.Center){if(p=n.ForguncyData.pageInfo.pageLayouts[f],e=u.Layout,!e)return i;var w=e.IsLeftOverflow?e.leftOverflowOffset:0,nt=e.IsRightOverflow?e.rightOverflowOffset:0,b=p.getColumnWidth(e.Column-w,w),k=p.getColumnWidth(e.Column+1,nt),d=b+k+u.FullWidth,g=n.DomUtilities.createJqueryDomElement("div"),tt={position:"relative",marginLeft:b/d*100+"%",marginRight:k/d*100+"%",height:"100%"};i.css("position","relative");i.css("left","50%");i.css("transform","translateX(-50%)");g.addClass(n.CSSHelper.getClassName(tt));i=g.append(i)}return i},t.needAdjustDom=function(n){return n.IsLeftOverflow||n.IsRightOverflow?!0:!1},t}();n.OverflowHelper=i;h=function(){function t(n){this._cellType=n}return t.prototype.validate=function(){var t=this._cellType.customValidate();return n.Common.IsEmpty(t)?{status:0}:{status:1,message:t}},t}()})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t=function(t){function i(n,i,r,u){var f=t.call(this,n,i,r,u)||this;return f.supportedEvents=["click","mouseenter","mouseleave"],f}return __extends(i,t),i.prototype.bind=function(i,r,u){var f=this,e;if(f.supportedEvents.indexOf(i)!==-1&&!f.isEventHasBeenBinding(i)&&(e=f._getClickableDomId(),!n.Common.IsEmpty(e)))$("#"+e).on(i,function(){return f.trigger(i,null),!1});t.prototype.bind.call(this,i,r,u)},i.prototype.unbind=function(i,r){t.prototype.unbind.call(this,i,r);var u=this,f=u._getClickableDomId();n.Common.IsEmpty(f)||u.supportedEvents.indexOf(i)!==-1&&(u.isEventHasBeenBinding(i)||$("#"+f).off(i))},i.prototype.unbindAll=function(){var r=this,u=r._getClickableDomId(),f,i;if(!n.Common.IsEmpty(u))for(f=$("#"+u),i=0;i<r.supportedEvents.length;i++)f.off(r.supportedEvents[i]);t.prototype.unbindAll.call(this)},i.prototype._getClickableDomId=function(){throw"No implement.";},i.prototype.hasFocus=function(){var n=$("#"+this.ID+"_btn");return n.length>0&&document.activeElement===n[0]?!0:!1},i.prototype.setFocus=function(){var n=$("#"+this.ID+"_btn");n.length>0&&n[0].focus()},i}(n.CellTypeBase),i;n.ClickableCellTypeBase=t;i=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.destroy=function(){this.generalElement=null;t.prototype.destroy.call(this)},i.prototype.needValidate=function(){return!1},i.prototype.createContent=function(){var t=this.CellElement,n=i.createLabelElement(t,this._getDomCreateInfo());return n.attr("data-cell-type","GeneralCellType"),this.generalElement=n,n},i.createLabelElement=function(t,i){var u=n.DomUtilities.createJqueryDomElement("label"),r={},f=n.CellDomCreateHelper.createTextElement(t,u,i);return r.webkitUserSelect="initial",i.isInListview&&(r.pointerEvents="none"),u.addClass(n.CSSHelper.getClassName(r)),f},i.prototype.clickable=function(){return!1},i.prototype.setValueToElement=function(n,t){this._updateText(n,t)},i.prototype._updateText=function(t,r){var u={value:null},f=n.FormatHelper.formatValue(r,this.getFormatString(),u);i.setValueToLabel(t,f,u.value,this.CellElement);this.shrinkToFit(this.generalElement)},i.prototype.onWindowResized=function(){this.shrinkToFit(this.generalElement)},i.prototype.getValueFromElement=function(){return null},i.prototype.onFormatterChanged=function(){var t=$("#"+this.ID),i;t.length===1&&(i=n.ForguncyData.pageInfo.dataModel.normalCellDataModel.getValue(this.ID),this._updateText(t,i))},i.setValueToLabel=function(t,i,r,u){if(n.Common.IsEmpty(i))i="";else if(r)t.css("color",n.ColorHelper.Convert(r)),t.data(n.StaticValues.conditionalForeColor,t.css("color"));else{var f=t.data(n.StaticValues.conditionalForeColor);f&&(t.removeData(n.StaticValues.conditionalForeColor),t.css("color")===f&&t.css("color",u.StyleInfo.Foreground===undefined?"black":n.ColorHelper.Convert(u.StyleInfo.Foreground)))}t.text(i)},i.prototype._getClickableDomId=function(){return this.ID+"_div"},i}(t);n.GeneralCellType=i})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__assign=this&&this.__assign||function(){return __assign=Object.assign||function(n){for(var t,r,i=1,u=arguments.length;i<u;i++){t=arguments[i];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},__assign.apply(this,arguments)},Forguncy;(function(n){var i=function(t){function i(n,i,r,u){return t.call(this,n,i,r,u)||this}return __extends(i,t),i.prototype.canInputChars=function(){return!1},i.prototype.selectAll=function(){},i.prototype.setCaretAtLast=function(){},i.prototype.focus=function(){var n=$("#"+this.ID);n.length>0&&n.focus()},i.prototype.getDropDownObj=function(){return null},i.prototype.getIgnoreKeysInListview=function(){return[]},i.prototype.setStyle=function(t,i,r,u,f,e,o){var s={Row:this.CellElement.Row,Column:this.CellElement.Column,StyleInfo:{WordWrap:this.CellElement.StyleInfo.WordWrap,Background:t,Foreground:i,FontFamily:this.CellElement.StyleInfo.FontFamily,FontSize:r,FontStyle:u?n.StaticValues.FontStyle_Italic:n.StaticValues.Font_Normal,FontWeight:f?n.StaticValues.FontWeight_Bold:n.StaticValues.Font_Normal,Underline:e,Strikethrough:o,HorizontalAlignment:this.CellElement.StyleInfo.HorizontalAlignment}};this.setStyleInternal(s)},i.prototype.setStyleInternal=function(){},i}(n.CellTypeBase),t;n.ListviewEditModeCellType=i;t=function(t){function i(n,i,r,u){return t.call(this,n,i,r,u)||this}return __extends(i,t),i.prototype.onFormatterChanged=function(){this.changeFormatElement()},i.prototype._getPartsUseFontStyle=function(){return this.$formatElement},i.prototype.shouldNeverShowFormatLabel=function(){return!1},i.prototype.getFormatterOfFormatLabel=function(){var n,t=this.getCellActualStyleInfo();return(n=t===null||t===void 0?void 0:t.Formatter)!==null&&n!==void 0?n:"@"},i.prototype.createContent=function(){var i=this,r=n.ForguncyData.getPageLayout(this._pageID,this.runTimePageName),t,u;return(r&&(this.shouldAutoFitInRows=r.possibleAutoFitInRows(this.CellElement.Layout),this.shouldAutoFitInColumns=r.possibleAutoFitInColumns(this.CellElement.Layout)),t=this.createCellContent(),!this.shouldHandleFormat())?t:(this._$inputElement=t.find("#"+this.ID),this._$inputElement.bind("input propertychange",function(){i.tryToAutoFitFormatElement()}),u=this.appendFormatLabelPart(t),this.showFormatElement(),this.initHandlingFormatLabelEvent(this._$inputElement,function(){return i.onFocusIn()},function(){return i.onFocusOut()}),u)},i.prototype.appendFormatLabelPart=function(t){var i=n.DomUtilities.createJqueryDomElement("div");i.addClass("fgc-container-relative");var u=this.getFormatPart(),f=t.children(),r=n.DomUtilities.createJqueryDomElement("div");return r.addClass("fgc-container-absolute"),r.append(f),i.append(u),i.append(r),t.append(i),t},Object.defineProperty(i.prototype,"$formatElement",{get:function(){return this._$formatElement||this.getFormatPart(),this._$formatElement},enumerable:!1,configurable:!0}),i.prototype.getFormatPart=function(){return this._formatPart||(this._formatPart=this.createFormatElement(),this._$formatElement=this._formatPart.find("[format-label]")),this._formatPart},i.prototype.initHandlingFormatLabelEvent=function(n,t,i){n.focusin(function(){t()});n.focusout(function(){i()})},i.prototype.onFocusIn=function(){this.hideFormatElement()},i.prototype.onFocusOut=function(){this.showFormatElement()},i.prototype.shouldHandleFormat=function(){return this.isInListview?!1:!0},i.prototype.hideFormatElement=function(){this.getContainer().toggleClass("fgc-format-label-show",!1)},i.prototype.showFormatElement=function(){this.shouldHandleFormat()&&this.changeFormatElement()},i.prototype.getCellActualStyleInfo=function(){if(this.isInListview)return this.CellElement.StyleInfo;var t=n.ForguncyData.pageInfo.pageElementManager.cells.getCell(this.ID);return t&&t.actualStyleInfo?t.actualStyleInfo.styleInfo:null},i.prototype.changeFormatElement=function(){var t,i;this.shouldHandleFormat()&&(i=this.getFormattedResult(),this.$formatElement.text(i),n.Common.IsEmpty(this.getValueToFormat())?this.hideFormatElement():this.shouldNeverShowFormatLabel()||((t=this._$inputElement)===null||t===void 0?void 0:t.is(":focus"))||this.getContainer().toggleClass("fgc-format-label-show",!0))},i.prototype.getFormattedResult=function(){var t=this.getValueToFormat(),i=this.getFormatterOfFormatLabel(),r=n.FormatHelper.format(i,t);return r.text},i.prototype.createFormatElement=function(){var t=__assign({},this.CellElement),r,i,u;return t.runtimeContainer=null,t.StyleInfo=n.Common.clone(t.StyleInfo),r=this._getDomCreateInfo(),r.id=null,t.BindingInfo=null,t.StyleInfo||(t.StyleInfo={}),t.StyleInfo.TextIndent=1,t.StyleInfo.HorizontalAlignment=this.getHorizontalAlignmentForFormatLabel(),t.StyleInfo.VerticalAlignment=this.getVerticalAlignmentForFormatLabel(),i=n.DomUtilities.createJqueryDomElement("label"),u=n.CellDomCreateHelper.createTextElement(t,i,r),u.addClass("fgc-align-format-label"),i.attr("format-label","true"),i.css("overflow","hidden"),i.css("white-space","pre"),i.css("padding","0px 2px"),u},i.prototype.tryToAutoFitFormatElement=function(){(this.shouldAutoFitInRows||this.shouldAutoFitInColumns)&&this.changeFormatElement()},i.prototype.getHorizontalAlignmentForFormatLabel=function(){return this.CellElement.StyleInfo.HorizontalAlignment},i.prototype.getVerticalAlignmentForFormatLabel=function(){return n.CellVerticalAlignment.Center},i.prototype.setValueToElement=function(){this.changeFormatElement()},i}(n.ListviewEditModeCellType);n.SupportFormatCellType=t})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var t=function(){function t(){}return t.prototype.ApplyTemplateStyle=function(i,r,u){var f=t.ERROR_KEY,l=t.NORMAL_KEY,e,a,o,y,c;if(r){if(!i){r.attr("fgc-no-styletemplate","true");return}for(e=i.Key,a=this.MapPartsNameToDom(r),o=0;o<this.TemplateNameParts.length;o++){var h=this.TemplateNameParts[o],v=h,s="";h==="MAIN"&&i.Styles[f]&&(u?(v=f,s=n.CellTypeStyleTemplateUtils.FormatTemplateStyleClassName(this.CellTypeString,e,l)):s=n.CellTypeStyleTemplateUtils.FormatTemplateStyleClassName(this.CellTypeString,e,f));y=n.CellTypeStyleTemplateUtils.FormatTemplateStyleClassName(this.CellTypeString,e,v);c=a[h];s&&c.removeClass(s);c.addClass(y)}r.attr("data-applyedTemplateKey",u?f:l);this.OnTemplateStyleApplied(i,r)}},t.prototype.MapPartsNameToDom=function(){return null},t.prototype.OnTemplateStyleApplied=function(){},t.prototype.Clear=function(){},t.ERROR_KEY="FGC_BUILDIN_ERROR",t.NORMAL_KEY="MAIN",t}();n.CellTypeStyleTemplateHelperBase=t})(Forguncy||(Forguncy={}))
;var __spreadArray=this&&this.__spreadArray||function(n,t,i){if(i||arguments.length===2)for(var r=0,f=t.length,u;r<f;r++)!u&&r in t||(u||(u=Array.prototype.slice.call(t,0,r)),u[r]=t[r]);return n.concat(u||Array.prototype.slice.call(t))},Forguncy;(function(n){var t=function(){function t(){}return t.FormatTemplateStyleClassName=function(n,t,i){return"".concat(n.replace(/\./g,""),"-").concat(t,"-").concat(i)},t.PrepareTemplateStyles=function(n){t.ParseAndAppendTemplateStyles(n);t.InitEvents()},t.InitEvents=function(){var n="data-styleTemplate-bodyHasMouseUp",i=$("body").attr(n);if(!i){$("body").attr(n,!0);$("body").on("mouseup",function(){var n=t.EventTarget;n&&n.removeClass("active")})}},t.ParseAndAppendTemplateStyles=function(n){var o,u,f,r,e,s,i,h;for(o in n){u=n[o];for(f in u)if(Object.prototype.hasOwnProperty.call(u,f)){r=u[f].Styles;t.CopyActiveStyleToError(r);for(e in r)if(Object.prototype.hasOwnProperty.call(r,e)){if(s=r[e],i=t.FormatTemplateStyleClassName(o,f,e),t.CellTypeTemplateStyleCache[i])continue;t.PrePageCellTypeTemplateStyleCache[i]&&(h=document.getElementById(i),h.remove(),t.PrePageCellTypeTemplateStyleCache[i]=!1);t.ParseAndAppendPartStyle(s,i);t.CellTypeTemplateStyleCache[i]=!0}}}},t.CopyActiveStyleToError=function(n){"FGC_BUILDIN_ERROR"in n&&"MAIN"in n&&Object.keys(n).length===2&&n.MAIN.ActiveStyle&&(n.FGC_BUILDIN_ERROR.ActiveStyle=n.MAIN.ActiveStyle)},t.ParseAndAppendPartStyle=function(i,r){var u=[],s=["box-sizing:border-box;",],a;n.ForguncyData.IsAutoTest&&(i.Transition="0s");i.Transition&&s.push("transition:".concat(i.Transition,";"));var h=t.ConvertStyleString.apply(t,__spreadArray([i.NormalStyle],s,!1)),c=t.ConvertStyleString(i.HoverStyle),e=t.ConvertStyleString(i.FocusStyle),o=t.ConvertStyleString(i.ActiveStyle),l=t.ConvertStyleString(i.SelectedStyle),f=t.ConvertStyleString(i.DisableStyle);h&&u.push(".".concat(r),h);e&&u.push(".".concat(r,":not([disabled]):focus"),e,".".concat(r,"-focus:not([disabled])"),e);c&&n.Platform.isMobile()===!1&&n.Platform.isIpad()===!1&&u.push(".".concat(r,":not([disabled]):hover"),c);o&&(u.push(".".concat(r,":not([disabled]):active"),o),u.push(".".concat(r,":not([disabled]).active"),o));l&&u.push(".".concat(r,":not([disabled]).selected"),l);f&&(u.push(".".concat(r,":disabled"),f),u.push(".".concat(r,"-disabled"),f),u.push(".".concat(r,'[disabled="disabled"]'),f));u.push(".".concat(r," input, .").concat(r," textarea, .").concat(r," select"),"{color:inherit;font:inherit;}");u.push(".".concat(r," input:disabled, .").concat(r," textarea:disabled, .").concat(r," select:disabled"),"{color:inherit;}");a=u.join("");t.AddCSSTextToDocument(a,r)},t.AddCSSTextToDocument=function(n,t){var i=document.createElement("style"),r=document.body||document.getElementsByTagName("body")[0],u=document.createTextNode(n);i.type="text/css";i.id=t;i.appendChild(u);r.appendChild(i)},t.ConvertStyleString=function(t){for(var a,v=[],f=1;f<arguments.length;f++)v[f-1]=arguments[f];if(n.Common.IsEmpty(t))return null;var y=t.FontColor,p=t.Background,w=t.BorderString,b=t.BorderTopString,k=t.BorderRightString,d=t.BorderBottomString,g=t.BorderLeftString,e=t.PaddingLeft,o=t.PaddingRight,r=t.PaddingBottom,s=t.PaddingTop,h=t.MarginLeft,c=t.MarginRight,u=t.MarginBottom,l=t.MarginTop,nt=t.Opacity,rt=t.Bold,ut=t.Italic,tt=t.BorderRadiusString,it=t.BoxShadowString,ft=t.Underline,i=[];return y&&i.push("color: ".concat(n.ColorHelper.Convert(y),";")),p&&i.push("background: ".concat(n.ColorHelper.Convert(p)," border-box;")),tt&&i.push("border-radius: ".concat(n.ColorHelper.Convert(tt),";")),w?i.push("border: ".concat(n.ColorHelper.ConvertBorder(w),";")):(b&&i.push("border-top: ".concat(n.ColorHelper.ConvertBorder(b),";")),k&&i.push("border-right: ".concat(n.ColorHelper.ConvertBorder(k),";")),d&&i.push("border-bottom: ".concat(n.ColorHelper.ConvertBorder(d),";")),g&&i.push("border-left: ".concat(n.ColorHelper.ConvertBorder(g),";"))),r&&r===o&&r===s&&r===e?i.push("padding: ".concat(r,"px!important;")):(s&&i.push("padding-top: ".concat(s,"px!important;")),o&&i.push("padding-right: ".concat(o,"px!important;")),r&&i.push("padding-bottom: ".concat(r,"px!important;")),e&&i.push("padding-left: ".concat(e,"px!important;"))),u&&u===c&&u===l&&u===h?i.push("margin: ".concat(u,"px;")):(l&&i.push("margin-top: ".concat(l,"px;")),c&&i.push("margin-right: ".concat(c,"px;")),u&&i.push("margin-bottom: ".concat(u,"px;")),h&&i.push("margin-left: ".concat(h,"px;"))),n.Common.IsEmpty(nt)||i.push("opacity: ".concat(nt,";")),it&&i.push("box-shadow: ".concat(n.ColorHelper.ConvertShadow(it),";")),rt&&i.push("font-weight: bold;"),ft&&i.push("text-decoration: underline;"),ut&&i.push("font-style: italic;"),i.push.apply(i,v),a=i.join(""),a?"{"+a+"}":null},t.ApplyCellTypeStyleTemplates=function(n,t){return t?(n.addClass(t),!0):!1},t.GetStyleTemplateByKey=function(n,t,i){return i&&i[n]?i[n][t]:null},t.IsTransparentColor=function(t){if(n.Common.IsEmpty(t)||t.indexOf("rgba")===-1)return!1;var r=t.split(","),i=parseFloat(r[r.length-1]);return isNaN(i)?!1:i===255||i===0?!1:!0},t.AddFocusStyleToContainer=function(n,t){var i="data-focus-within",r=t.attr(i);!r&&n&&(t.focusin(function(){if(typeof n=="function"){var i=n();i.add.forEach(function(n){t.addClass("".concat(n,"-focus"))})}else t.addClass("".concat(n,"-focus"))}),t.focusout(function(){if(!($(document.activeElement).closest(t).length>0))if(typeof n=="function"){var i=n();i.remove.forEach(function(n){t.removeClass("".concat(n,"-focus"))})}else t.removeClass("".concat(n,"-focus"))}),t.attr(i,!0))},t.AddDiableCallbackToContainer=function(n,t){var i=t.attr("data-disabled-event");t.attr("disabled")&&t.addClass("".concat(n,"-disabled"));!i&&n&&(t.data("DisableCallback",function(){t.addClass("".concat(n,"-disabled"));t.attr("disabled",!0)}),t.data("EnableCallback",function(){t.removeClass("".concat(n,"-disabled"));t.removeAttr("disabled")}),t.attr(i,!0))},t.ForceInnerEditorFontSizeToInherit=function(n,t){n&&(t.find("input").css({fontSize:"inherit"}),t.find("textarea").css({fontSize:"inherit"}))},t.CellTypeTemplateStyleCache={},t.PrePageCellTypeTemplateStyleCache={},t}();n.CellTypeStyleTemplateUtils=t})(Forguncy||(Forguncy={}))
;var __assign=this&&this.__assign||function(){return __assign=Object.assign||function(n){for(var t,r,i=1,u=arguments.length;i<u;i++){t=arguments[i];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},__assign.apply(this,arguments)},Forguncy;(function(n){var i,t;(function(n){n[n.EmptyDatas=0]="EmptyDatas";n[n.AllDatas=1]="AllDatas";n[n.GetEmptyValueItems=2]="GetEmptyValueItems"})(i=n.NullFormulaValueQueryPolicy||(n.NullFormulaValueQueryPolicy={}));t=function(){function t(){}return t.prepareMetaData=function(n){n.haveLoadItems===undefined&&(n.haveLoadItems=!n.IsBounding);n.ValueColumnBindingInfo&&!n.DisplayColumnBindingInfo?n.DisplayColumnBindingInfo=n.ValueColumnBindingInfo:!n.ValueColumnBindingInfo&&n.DisplayColumnBindingInfo&&(n.ValueColumnBindingInfo=n.DisplayColumnBindingInfo)},t.initItems=function(i,r,u,f){var l,e=r.CellType,v,h,s,c,o,a;if((!n.FormulaManager.isReady()||!i.getIsPageLoaded())&&e.ItemsQuery){n.DelayRefresh.setTimeout(function(){t.initItems(i,r,u,f)},0);return}if(v=n.Common.typeContains(e,"UserCellType"),h=i,!e.haveLoadItems||i.getOffsetCondition()){if(s=void 0,v){if(o=e,(n.Common.IsEmpty(o.Columns)||o.Columns===0)&&(n.Common.IsEmpty(o.CustomColumns)||o.CustomColumns.length<=0))return;s="Account/GetUsers";c={role:typeof o.Role=="undefined"?"":o.Role,displayColumnName:o.DisplayColumnName===undefined?"":o.DisplayColumnName,columns:o.Columns,customColumns:o.CustomColumns===undefined?"":o.CustomColumns.join(","),id:r.ServerPropertiesId.OwnerPage}}else{if(typeof e.ValueColumnBindingInfo=="undefined"){t.setItemsCellTypeItems(i,r,e,u,{Items:[]},f);return}s="Home/GetComboBindingOptions";c=t.getRequestDataInfo(e,h)}a=!f.isInListview&&(!n.Common.typeContains(e,"DropDownListCellType")||i instanceof n.ComboBoxCellType_Mobile);a&&h._startWaitingServerData();n.Common.forguncyPost(s,c,function(o){o||(o={Items:[]});n.TableColumnsCacheManager.addCacheFromGetComboBindingOptionsResult(o.Items,r.CellType,c.itemQuery);e.ItemsInfo=o;t.setItemsCellTypeItems(i,r,e,u,o,f);e.haveLoadItems=!0;a&&h._endWaitingServerData()},f.id+" "+s)}else t.setItemsCellTypeItems(i,r,e,u,(l=e.ItemsInfo)!==null&&l!==void 0?l:{Items:[]},f)},t.initItemsQuery=function(i,r,u,f){if(!f.isInListview){var e=r.CellType,o=i;e.IsBounding&&n.DependenceCellValueChangeHelper.listenFormulaRefChanged(e.QueryConditionDependenceFormulas,function(){e.haveLoadItems=!1;t.initItems(i,r,u,f)},o.runTimePageName)}},t.getFormulaListRowInfo=function(t){var i=n.Common.getLocatedListview(t.runTimePageName,t.CellElement.Row,t.CellElement.Column);return n.SpreadJSView&&i instanceof n.SpreadJSView?i.getFormulaListRowInfo():null},t.getRequestDataInfo=function(i,r){var u,f,e,o=t.getFormulaListRowInfo(r);return{tableName:i.DataSource,valueColumnBindingInfo:(u=i.ValueColumnBindingInfo)===null||u===void 0?void 0:u.GUID,displayColumnBindingInfo:(f=i.DisplayColumnBindingInfo)===null||f===void 0?void 0:f.GUID,dropDownSubItems:(e=i.DropDownSubItems)===null||e===void 0?void 0:e.map(function(n){var t;return __assign(__assign({},n),{BindingInfo:(t=n.BindingInfo)===null||t===void 0?void 0:t.GUID})}),itemQuery:n.ConditionHelper.getComputedSqlConditionFormula(i.ItemsQuery,r.runTimePageName,i.NullFormulaValueQueryPolicy,0,0,o),itemSort:i.ItemsSort,offset:r.getOffsetCondition(),pageName:r.designerPageName,cacheSettingID:r.CellElement.ServerPropertiesId.CacheSetting}},t.setItemsCellTypeItems=function(i,r,u,f,e,o){var s;n.Common.typeContains(u,"UserCellType")?i.setItems(r,f,e,o):(t.initItemsOfItemsCell(r,e,u,(s=i.getOffsetCondition())===null||s===void 0?void 0:s.targetPage),n.Common.typeContains(u,"DropDownListCellType")?i.setItems(r,f,e,o):(i.setItems(r,f,e.Items,o),n.DomUtilities.setPropertyToDom(r,f,o,[1])))},t.initItemsOfItemsCell=function(t,i,r,u){for(var o,s,a,h,c=(r.IsBounding?r.AddNullItemWhenBinding:!1)&&!u,l=c?n.Common.getMultiLanguageWord(r.NoneItemText):"",f=(h=i===null||i===void 0?void 0:i.Items)!==null&&h!==void 0?h:[],e=f.length-1;e>=0;e--)n.Common.IsEmpty(f[e].Value)&&(f[e].Value=null,c=!1,n.Common.IsEmpty(f[e].DisplayValue)&&(f[e].DisplayValue=l)),n.Common.IsEmpty(f[e].DisplayValue)?f[e].DisplayValue="":t.StyleInfo.Formatter||(i.DisplayValueType===1?f[e].DisplayValue=n.FormatHelper.format("yyyy/M/d",f[e].DisplayValue).text:i.DisplayValueType===4&&(f[e].DisplayValue=n.FormatHelper.format("hh:mm",f[e].DisplayValue).text));if(c){if(o=null,n.Common.typeContains(r,"DropDownListCellType")&&(o={},r.DropDownSubItems))for(s=0;s<r.DropDownSubItems.length;s++)a=r.DropDownSubItems[s],a&&(o[a.GUID]=l);f.unshift({DisplayValue:l,Value:null,DropDownSubItemsList:o});i&&(i.addNullItem=!0)}else i&&(i.addNullItem=!1)},t.SetItemsByStringArray=function(n,t,i,r){typeof r=="string"&&(r=JSON.parse(r));var u=r.map(function(n){return{value:n,label:n}});this.SetItemsByObjectArray(n,t,i,u,"value","label")},t.SetItemsByObjectArray=function(n,i,r,u,f,e){typeof u=="string"&&(u=JSON.parse(u));e||(f=e);var o=u.map(function(n){return{Value:n[f],DisplayValue:n[e]}});t.setItemsCellTypeItems(n,n.CellElement,n.CellElement.CellType,i,{Items:o},r)},t.clearValueAfterQueryChanged=function(t,i){if(!i){var r=t.CellElement.CellType;r.IsBounding&&n.DependenceCellValueChangeHelper.listenFormulaRefChanged(r.QueryConditionDependenceFormulas,function(i){i&&n.ForguncyData.pageInfo.dataModel.normalCellDataModel.setValue(t.ID,{newValue:null,uiAction:!0},7)},t.runTimePageName)}},t}();n.ItemsCellTypeHelper=t})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__spreadArray=this&&this.__spreadArray||function(n,t,i){if(i||arguments.length===2)for(var r=0,f=t.length,u;r<f;r++)!u&&r in t||(u||(u=Array.prototype.slice.call(t,0,r)),u[r]=t[r]);return n.concat(u||Array.prototype.slice.call(t))},Forguncy;(function(n){var t=function(t){function i(i,r,u,f){var e=t.call(this,i,r,u,f)||this;return e._isPageLoaded=!1,e.toggles=[],e.toggleUIs=[],n.ItemsCellTypeHelper.prepareMetaData(i.CellType),e}return __extends(i,t),i.prototype.create=function(n){this._divContainer=n;t.prototype.create.call(this,n)},i.prototype.getOffsetCondition=function(){return null},i.prototype.getIsPageLoaded=function(){return this._isPageLoaded},i.prototype.onPageLoaded=function(n){return this._isPageLoaded=!0,t.prototype.onPageLoaded.call(this,n)},i.prototype.createContent=function(){var i=this._divContainer,r=this.CellElement,s=this.isInListview,e=this._getDomCreateInfo(),t=n.DomUtilities.createJqueryDomElement("div"),h,c,u,f,o;return n.ItemsCellTypeHelper.initItems(this,r,t,e),t.attr("id",this.ID),h=[5],n.DomUtilities.setPropertyToDom(r,t,e,h),c=n.DomUtilities.measureBrowserScrollbarWidth(),this._scrollbarWidth=c,u=n.DomUtilities.createAlignmentContainer(t,r.StyleInfo.HorizontalAlignment,r.StyleInfo.VerticalAlignment),i&&(i.css("overflow","auto"),i.css("position","relative"),i.css("z-index","0"),n.StaticData.IsCellTypeExporting&&i.css("overflow","hidden")),this.CellElement.StyleInfo.WordWrap?t.css("white-space","pre-wrap"):t.css("white-space","nowrap"),t.css("font-size","0"),s&&(f=n.DomUtilities.createAbsoluteContainerDiv(),f.css("overflow","hidden"),f.append(u),u=f),o=this.cellTypeData.getDefaultValue(),s||n.ForguncyData.pageInfo.dataModel.normalCellDataModel.setValue(this.ID,{newValue:o},1),this._setValue(t,o),n.ItemsCellTypeHelper.clearValueAfterQueryChanged(this,this.isInListview),n.ItemsCellTypeHelper.initItemsQuery(this,r,t,e),u},i.prototype.setItems=function(t,i,r,u){var l=this,f=t.CellType,e=i,w,b,d,s,y,g;e.empty();var o=__spreadArray([],r,!0),p=[],k=[],a={};f.AddOtherItem&&(a.DisplayValue=n.RS.groupCell_Other,o.push(a));var h=0,v=0,c=0;for(this.toggles=[],this.toggleUIs=[],f.LayoutMode===1&&(n.StaticData.IsCellTypeExporting?(b=n.DomUtilities.createTableContainer(o.length,f.ColumnCount),e.append(b),e=b):(w=n.DomUtilities.createGridContainer(f.ColumnCount),e.append(w),e=w)),d=function(i){var nt,w=o[i],b=n.Common.IsEmpty(w.DisplayValue)?"":w.DisplayValue,d,tt,y,r,v,it,h,g;if(k.push(b),d=void 0,t.StyleInfo.Formatter&&(tt=n.FormatHelper.format(t.StyleInfo.Formatter,b),d=tt.color,b=tt.text),y=s.createSingleItemToggle(b,null),s.toggles.push(y),r=s.createSingleItemUI(y),s.toggleUIs.push(r),v=r.container,u.isInListview&&(r.inputContainer.attr(n.StaticValues.isInListview,u.isInListview),r.inputContainer.css("outline","thin transparent")),r.inputContainer.attr("id",s.ID+"_input"+i),r.inputContainer.attr("name",s.ID),n.DomUtilities.setPropertyToDom(t,r.textContainer,s._getDomCreateInfo(),[0]),n.Common.IsEmpty(d)||(it=n.FormatColorClassManager.getClassName(d),r.textContainer.attr("useFormatColor",it),r.textContainer.addClass(it)),f.LayoutMode===1?(v=$(document.createElement("div")).append(r.container),n.StaticData.IsCellTypeExporting||n.DomUtilities.setGridRowAndColumn(v,f.ColumnCount,i),f.ColumnCount===1&&i===o.length-1||v.css("margin-bottom",f.ItemSpace)):(i!==o.length-1&&(r.container.css("margin-right",f.ItemSpace),c+=f.ItemSpace),f.IsSameWidth?r.container.css("float","left"):r.container.css("float","none")),!u.isInListview)y.on("PropertyChanged",function(n,t){t==="isChecked"&&(l._onValueChanged(),l.validate())});if(n.StaticData.IsCellTypeExporting&&f.LayoutMode===1?$(e.find("td")[i]).append(v):e.append(v),w===a){h=$(document.createElement("input")).attr((nt={type:"text",otherText:"otherText",dir:"auto"},nt["aria-label"]="Other:",nt));g=f.OtherItemTextBoxWidthSetting;s._otherTextBox=h;s._otherTextBoxWidth=g;h.attr("id",s.ID+"_input_other");h.css("width",g);f.LayoutMode===1&&(f.ColumnCount>=1?n.DomUtilities.setGridRowAndColumn(h,f.ColumnCount,o.length-1):r.container.css("display","inline-flex"));n.DomUtilities.setPropertyToDom(t,h,s._getDomCreateInfo(),[0]);c+=g+5;h.on("change keyup",function(){h.val()&&(y.isChecked=!0)});f.IsSameWidth===!0&&f.LayoutMode!==1&&(r.container.css("float","left"),h.css("float","left"));r.inputContainer.on("click",function(){h.focus()});if(!u.isInListview){h.on("change",function(){l._onValueChanged()});h.focusout(function(){l.isReadOnly()||(l._onValueChanged(),l.validate())})}r.inputContainer.attr("othercheck","otherCheck");f.LayoutMode===1?v.append(h):e.append(h);e.attr("hasotheritem","true");p.push(function(){var t=h.val();return n.Common.IsEmpty(t)?null:t})}else p.push(w.Value)},s=this,y=0;y<o.length;y++)d(y);g=n.DomUtilities.measureElementSizes(this.toggleUIs.map(function(n){return n.container}));g.forEach(function(n){f.LayoutMode===1?n.width>h&&(h=n.width):(f.IsSameWidth&&(n.width>h&&(h=n.width),n.height>v&&(v=n.height)),c+=n.width)});f.LayoutMode===1?c=h:f.IsSameWidth&&(c=(h+f.ItemSpace)*o.length);o[o.length-1]===a&&(c+=f.OtherItemTextBoxWidthSetting);this._widthBasis=Math.max(t.Width,c);f.LayoutMode!==1&&(o[o.length-1]===a?this.setMaxSizeToLabel(h,v,e,!0):this.setMaxSizeToLabel(h,v,e,!1));this.valueList=p;this.displayValueList=k;n.FocusMoveHelper.AllowMoveFocusByEnterKey(e.find("input"),this.isInListview);this.setTabIndexToElement(this.getElementTabIndex());this.isVisible()||this._setVisible(this.getContainer(),!1);this.isDisabled()&&this._disable(e);this.isReadOnly()&&this.updateReadOnlyStatus()},i.prototype.setMaxSizeToLabel=function(n,t,i,r){var f=i.children(".".concat("FUI-toggle")),e=f.length,u;for(r&&e--,u=0;u<e;u++)$(f[u]).css("width",n||""),$(f[u]).css("height",t||"")},i.prototype.hasFocus=function(){var t=$("#"+this.ID).find("[name='"+this.ID+"']"),n;if(t.length>0)for(n=0;n<t.length;n++)if(document.activeElement===t[n])return!0;return!1},i.prototype.setFocus=function(){var n=$("#"+this.ID).find("[name='"+this.ID+"']");n.length>0&&n[0].focus()},i.prototype.focus=function(){var n=$("#"+this.ID).find("input");n.length>0&&$(n[0]).focus()},i.prototype.setValueToElement=function(n,t){var r=n.find('[name="'+this.ID+'"]'),i=this.valueList;i&&(this.setValueToUIInternal(n,r,i,t),this.setOtherValue(n,i,t))},i.prototype.getValueFromElement=function(){var t=$("#"+this.ID),i,n;return t.length===0?null:(i=t.find('[name="'+this.ID+'"]'),n=this.valueList,!n)?null:this.getValueInternal(i,n)},i.prototype.setValueToUIInternal=function(){throw"need child class implement";},i.prototype.getValueInternal=function(){throw"need child class implement";},i.prototype.getOtherValue=function(){throw"need child class implement";},i.prototype.createSingleItemToggle=function(){throw new Error("Need override");},i.prototype.createSingleItemUI=function(){throw new Error("Need override");},i.prototype._getCellTypeData=function(t){return new n.GroupCellTypeData(t)},i.prototype._setOverflowHidden=function(){return},i.prototype.adjustForeColor=function(n){return t.prototype.adjustForeColor.call(this,n,null)},i.prototype.onFormatterChanged=function(){for(var r,i=$("#"+this.ID+" .FUI-toggle-text"),t=0;t<i.length;t++){var f={value:null},e=n.FormatHelper.formatValue(this.displayValueList[t],this.getFormatString(),f),u="";f.value&&(u=n.FormatColorClassManager.getClassName(f.value));r=$(i[t]).attr("useFormatColor");n.Common.IsEmpty(r)&&(r="");r!==u&&(n.Common.IsEmpty(r)||$(i[t]).removeClass(r),n.Common.IsEmpty(u)||$(i[t]).addClass(u));$(i[t]).attr("useFormatColor",u);$(i[t]).text(e)}},i.prototype._getPartsUseFontStyle=function(){return $("#"+this.ID+" .FUI-toggle-text,#"+this.ID+"_input_other")},i.prototype._disable=function(){this.updateDisabledProperty()},i.prototype._enable=function(){this.updateDisabledProperty()},i.prototype.updateReadOnlyStatus=function(){this.updateDisabledProperty()},i.prototype.updateDisabledProperty=function(){var n=!this.isDisabled()&&!this.isReadOnly(),t=this.getContainer().find("input");this.toggles.forEach(function(t){t.enabled=n});n?t.removeAttr("disabled"):t.attr("disabled","disabled")},i.prototype.containsOtherItem=function(){var n=this.CellElement.CellType;return n.AddOtherItem?!0:!1},i.prototype.setOtherValue=function(n,t,i){if(this.containsOtherItem()){var u=this.getOtherValue(t,i),f=n.find("[otherText]"),r=n.find("[othercheck]");u===undefined||u===null?f.val()!==""&&r[0].checked===!0&&(f.val(""),r[0].checked=!1,$(r[0]).trigger("change")):(f.val(u+""),r[0].checked=!0,$(r[0]).trigger("change"))}},i.prototype.setStyleInternal=function(t){var i=$("#"+this.ID).find("FUI-toggle-text");i.length<=0||n.DomUtilities.setPropertyToDom(t,i,this._getDomCreateInfo(),[0])},i.prototype.reload=function(){var t=this.CellElement.CellType;t.IsBounding&&(t.haveLoadItems=!1,n.ItemsCellTypeHelper.initItems(this,this.CellElement,$("#"+this.ID),this._getDomCreateInfo()))},i.prototype.getBindingTables=function(){var n=this.CellElement.CellType;return n.IsBounding?[n.DataSource]:null},i.prototype._getVisibleParts=function(n){return n.find("input")},i.prototype.onWindowResized=function(){var t=n.ForguncyData.getPageLayout(this._pageID,this.runTimePageName);t&&t.possibleStretchInColumns(this.CellElement.Layout)&&this.resizeOtherTextBox()},i.prototype.resizeOtherTextBox=function(){if(this._otherTextBox&&this._widthBasis){var n=this.getContainerWidth(),t=n-this._widthBasis,i=Math.max(this._otherTextBoxWidth,this._otherTextBoxWidth+t-this._scrollbarWidth);this._otherTextBox.width(i)}},i.prototype.getContainerWidth=function(){var n=this.getContainer();return n?n.width():0},i.prototype.destroy=function(){this._otherTextBox=null;t.prototype.destroy.call(this)},i.prototype.ReloadForCommand=function(){this.reload()},i.prototype.SetItemsByStringArray=function(t){n.ItemsCellTypeHelper.SetItemsByStringArray(this,$("#"+this.ID),this._getDomCreateInfo(),t);this.SyncValueForNewItems()},i.prototype.SetItemsByObjectArray=function(t,i,r){n.ItemsCellTypeHelper.SetItemsByObjectArray(this,$("#"+this.ID),this._getDomCreateInfo(),t,i,r);this.SyncValueForNewItems()},i.prototype.SyncValueForNewItems=function(){var t=n.ForguncyData.pageInfo.dataModel.normalCellDataModel.getValue(this.ID);this.setValue(t)},i.prototype.ClearOtherText=function(){if(this.containsOtherItem()){var n=this.getContainer(),i=n.find("[otherText]"),t=n.find("[othercheck]");i.val("");t[0].checked=!1;$(t[0]).trigger("change")}},i}(n.ListviewEditModeCellType);n.GroupCellTypeBase=t})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){function u(){return n.Platform.isMobile()}var i=function(t){function i(n){var i=t.call(this)||this;return i._mainStr="MAIN",i.TemplateNameParts=[i._mainStr],i.CellTypeString=n,i}return __extends(i,t),i.prototype.MapPartsNameToDom=function(n){return{MAIN:n.find(">div")}},i.prototype.OnTemplateStyleApplied=function(t,i){var r=this,u,f;t&&i&&(i.css("overflow","visible"),u=this.MapPartsNameToDom(i)[this._mainStr],u.css({overflow:"hidden",position:"relative"}),f=n.CellTypeStyleTemplateUtils.FormatTemplateStyleClassName(this.CellTypeString,t.Key,this._mainStr),n.CellTypeStyleTemplateUtils.AddFocusStyleToContainer(function(){var u=i.attr("data-applyedtemplatekey")||r._mainStr;return{add:[n.CellTypeStyleTemplateUtils.FormatTemplateStyleClassName(r.CellTypeString,t.Key,u)],remove:[n.CellTypeStyleTemplateUtils.FormatTemplateStyleClassName(r.CellTypeString,t.Key,n.CellTypeStyleTemplateHelperBase.ERROR_KEY),n.CellTypeStyleTemplateUtils.FormatTemplateStyleClassName(r.CellTypeString,t.Key,n.CellTypeStyleTemplateHelperBase.NORMAL_KEY),n.CellTypeStyleTemplateUtils.FormatTemplateStyleClassName(r.CellTypeString,t.Key,r._mainStr),]}},u),n.CellTypeStyleTemplateUtils.AddDiableCallbackToContainer(f,u))},i}(n.CellTypeStyleTemplateHelperBase),t,r,f,e,o,s;n.InputCellTypeStyleTemplateHelperBase=i;t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype._getCellTypeData=function(t){return new n.InputCellTypeData(t)},i.prototype._getPartsUseBackcolor=function(){return $("#".concat(this.ID,"_div > div"))},i.prototype.createContent=function(){var i=this,r=t.prototype.createContent.call(this),f=this.CellElement.CellType,u;if(f.IsSelectAllOnFocus){u=r.find("#"+this.ID);u.on("focusin",function(){n.Platform.isChrome()&&!n.Platform.isWeChatOrQQBrowser()?i.selectAll():n.DelayRefresh.setTimeout(function(){i.selectAll()})})}return r},i.prototype.onPageLoaded=function(n){var i=this,r=this.CellElement.CellType;this.onFormulaResultChanged(r.WaterMark,function(n){i._$input.attr("placeholder",n)},!0);return t.prototype.onPageLoaded.call(this,n)},i.prototype.addClassInSimulator=function(t){n.MetadataLoader.IsInMobileSimulatorFrame()&&t.addClass("in-simulator")},i.prototype.createCellContent=function(){var r=this.CellElement,t=n.DomUtilities.createJqueryDomElement(this.inputElementTagName()),i,f,u;return this._$input=t,i=n.CellDomCreateHelper.createControlContainer(),this._$container=i,i.append(t),n.CellDomCreateHelper.initalInputBox(r,t,this._getDomCreateInfo()),t.css("background-color","transparent"),t.css("text-align",n.DomUtilities.getHorizontalAlignmentText(r.StyleInfo.HorizontalAlignment)),this.initInputElement(t),f=r.CellType,this.isInListview||(this.bindValueChangedEvent(t),u=this,t.focusout(function(){u.isReadOnly()||u.validate()})),this.initDefaultValue(t,f),n.Platform.isMobile()||this.isInListview||n.FocusMoveHelper.AllowMoveFocusByEnterKey(t,this.isInListview),i},i.prototype.bindValueChangedEvent=function(n){var t=this;n.change(function(){t.isReadOnly()||t._onValueChanged()})},i.prototype.inputElementTagName=function(){return"input"},i.prototype.initInputElement=function(){},i.prototype.initDefaultValue=function(t){var i=this.cellTypeData.getDefaultValue();i!==null&&this._setValue(t,n.Common.getMultiLanguageWord(i))},i.prototype.setValueToElement=function(n,t){n.val(t);this.changeFormatElement()},i.prototype.getValueFromElement=function(){if(this._$input){var t=this._$input.val();return n.Common.IsEmpty(t)?null:t}return null},i.prototype._disable=function(n){n.find("#"+this.ID).attr("disabled","disabled");this._$container.attr("disabled","disabled");t.prototype._disable.call(this,this._$container)},i.prototype._enable=function(){this._$input&&this._$input.removeAttr("disabled");this._$container.removeAttr("disabled");t.prototype._enable.call(this,this._$container)},i.prototype.updateReadOnlyStatus=function(){this._$input&&(this.isReadOnly()?this._$input.attr("readonly","readonly"):this._$input.prop("readonly",!1))},i.prototype._getPartsUseFontStyle=function(){var n=t.prototype._getPartsUseFontStyle.call(this);return this._$input?this._$input.add(n):n},i.prototype.getValueToFormat=function(){return this._$input.val()},i.prototype.destroy=function(){this._$input.unbind();this._$input=null;t.prototype.destroy.call(this)},i.prototype.canInputChars=function(){return!this.isDisabled()&&!this.isReadOnly()},i.prototype.selectAll=function(){var n=$("#"+this.ID);n.length>0&&n.select()},i.prototype.setCaretAtLast=function(){var n=$("#"+this.ID),i=n.val(),t;i&&n.length>0&&(t=n[0],t.selectionStart=t.selectionEnd=i.length)},i.prototype.setCaretIndex=function(n){var i=$("#"+this.ID),t;i.length>0&&(t=i[0],t.selectionStart=t.selectionEnd=n)},i.prototype.setStyleInternal=function(t){var i=$("#"+this.ID);i.length<=0||(n.Common.IsEmpty(t.StyleInfo.Background)||i.css("background-color",n.ColorHelper.Convert(t.StyleInfo.Background)),n.DomUtilities.setPropertyToDom(t,i,this._getDomCreateInfo(),[0]))},i.prototype._getVisibleParts=function(n){return n.find("#"+this.ID)},i}(n.SupportFormatCellType);n.InputCellTypeBase=t;r=function(t){function r(){return t!==null&&t.apply(this,arguments)||this}return __extends(r,t),r.prototype.getStyleTemplateHelper=function(){return r.StyleTemplateHelper},r.prototype.createContent=function(){var u=this,e=t.prototype.createContent.call(this),r,f;this._$input.keydown(function(t){var f,e,o,i=u._$input[0];if(n.FormatHelper.isPercentageFormat((e=(f=u.CellElement)===null||f===void 0?void 0:f.StyleInfo)===null||e===void 0?void 0:e.Formatter)&&i&&(i.selectionStart===0||i.selectionStart===1&&i.value==="-")&&i.selectionEnd===((o=i===null||i===void 0?void 0:i.value)===null||o===void 0?void 0:o.length)){var r=t.keyCode,h=t.code,s=!1;event&&r&&!t.shiftKey&&(r>=96&&r<=105||r>=48&&r<=57)&&(s=!0);r===229&&!t.shiftKey&&h.length-h.replace(/[0-9]/,"").length>0&&(s=!0);s&&(i.selectionStart===1?u._$input.val("-%"):u._$input.val("%"),u.setCaretIndex(i.selectionStart-1))}});var o=this.CellElement.CellType,s=o.IconSize,i=n.ImageDataHelper.CreateImage(o.Icon,s);return i?(this._image=i,r=n.DomUtilities.createGridContainerEx(null,[s+10+"px","1fr"]),r.css("height","100%"),r.css("width","100%"),e.css("position","relative"),i.css("justify-self","center"),i.css("align-self","center"),i.css("-ms-grid-row-align","center"),i.css("-ms-grid-column-align","center"),r.append(i),r.append(e),n.DomUtilities.setGridItemPos(i,1,1),n.DomUtilities.setGridItemPos(e,1,2),f=n.DomUtilities.createJqueryDomElement("div"),f.css("width","100%").css("height","100%"),f.append(r),this._$container=f,f):e},r.prototype.createCellContent=function(){var i=this,r=t.prototype.createCellContent.call(this);return this._$input.keydown(function(t){t.which!==13||n.ForguncyData.pageInfo.moveFocusByEnter||i._onValueChanged()}),r},r.prototype._getPartsUseFontStyle=function(){var n=t.prototype._getPartsUseFontStyle.call(this);return this._image?this._image.add(n):n},r.prototype.initInputElement=function(n){n.attr("type","text");n.attr("autocomplete","off")},r.prototype.setValueToElement=function(i,r){var u,f=n.FormatHelper.getTextFromValue(r,(u=this.CellElement.StyleInfo)===null||u===void 0?void 0:u.Formatter);t.prototype.setValueToElement.call(this,i,f)},r.prototype.getValueFromElement=function(i){var u,r=t.prototype.getValueFromElement.call(this,i),f=(u=this.CellElement.StyleInfo)===null||u===void 0?void 0:u.Formatter;return f==="@"||i||(r=n.FormatHelper.getValueFromText(r)),n.Common.IsEmpty(r)&&(r=null),r},r.prototype._onValueChanged=function(){var i,u=(i=this.CellElement.StyleInfo)===null||i===void 0?void 0:i.Formatter,r;n.FormatHelper.isPercentageFormat(u)&&(r=n.FormatHelper.format(u,this.getValueFromElement(!1)).text,this._$input.val()!==r&&this._$input.val(r));t.prototype._onValueChanged.call(this)},r.prototype.destroy=function(){t.prototype.destroy.call(this);this._image=null},r.StyleTemplateHelper=new i("Forguncy.TextCellType"),r}(t);n.TextBoxCellType=r;f=function(t){function r(){var i=t!==null&&t.apply(this,arguments)||this;return i.onKeyDown=function(t){var u=i.isInListview?!0:i.cellTypeData.metaData.BreakLineWithEnter,r;if(t.keyCode===13)if(r=i.handleBreakLineWithEnter(t,u,n.ForguncyData.pageInfo.moveFocusByEnter),r===!0)t.preventDefault(),i.wrapMultilineText(t.target),t.stopImmediatePropagation(),i.tryToAutoFitFormatElement();else{if(r===!1)return!1;t.preventDefault();t.stopImmediatePropagation()}},i}return __extends(r,t),r.prototype.getStyleTemplateHelper=function(){return r.StyleTemplateHelper},r.prototype.createContent=function(){var i=t.prototype.createContent.call(this),r;if((this.shouldAutoFitInRows||this.shouldAutoFitInColumns)&&(i.addClass("fgc-container-relative"),r=$(document.createElement("div")),r.addClass("fgc-container-relative"),i.children().wrap(r),this._$input.addClass("fgc-container-absolute"),this._$input.css("position","absolute")),n.Platform.isIpad())this._$input.on("input",function(n){var i=n.originalEvent,t,r;i.type==="input"&&i.inputType==="insertLineBreak"&&(t=$(this).val(),r=t.slice(0,this.selectionStart-1)+t.slice(this.selectionStart),$(this).val(r))});return i},r.prototype.setValueToElement=function(i,r){var u=n.FormatHelper.getTextFromValue(r);t.prototype.setValueToElement.call(this,i,u);this.tryToAutoFitFormatElement()},r.prototype.enterPrintMode=function(){this._$input.css("overflow","hidden");this.tryToAutoFitFormatElement()},r.prototype.quitPrintMode=function(){this._$input.css("overflow","");this.tryToAutoFitFormatElement()},r.prototype.inputElementTagName=function(){return"textarea"},r.prototype.initInputElement=function(n){var t=this;n.css("resize","none");n.keydown(this.onKeyDown);this.isInListview||n.focusout(function(){t.isReadOnly()||t._onValueChanged()})},r.prototype.handleBreakLineWithEnter=function(t,i,r){function u(){return!0}function f(){return!1}function e(){return t.altKey?u():f()}return n.Platform.isMobile()?!0:i?u():r?e():t.altKey?u():undefined},r.prototype.getVerticalAlignmentForFormatLabel=function(){return n.CellVerticalAlignment.Top},r.prototype.shouldNeverShowFormatLabel=function(){return!0},r.prototype.getFormatterOfFormatLabel=function(){return"@"},r.prototype.getValueToFormat=function(){var t=this._$input.val();return n.Common.IsEmpty(t)?"":t+"@"},r.prototype.tryToAutoFitFormatElement=function(){(this.shouldAutoFitInRows||this.shouldAutoFitInColumns)&&(this.changeFormatElement(),this.shouldAutoFitInRows&&this._$input.css("overflow","hidden"))},r.prototype.wrapMultilineText=function(n){var t=n.selectionStart,i=n.value,r=i.substr(0,t),u=i.substr(n.selectionEnd);$(n).val(r+"\n"+u);t=t+1;n.setSelectionRange(t,t)},r.StyleTemplateHelper=new i("Forguncy.MultilineTextBox"),r}(t);n.MultilineTextBoxCellType=f;e=function(t){function r(){return t!==null&&t.apply(this,arguments)||this}return __extends(r,t),r.prototype.getStyleTemplateHelper=function(){return r.StyleTemplateHelper},r.prototype._getCellTypeData=function(t){return new n.NumberCellTypeData(t)},r.prototype.initInputElement=function(t){var i=this;t.attr("type","number");this.isInListview||t.focusout(function(){i.isReadOnly()||i.isDisabled()||!n.Platform.isIOSDevice()||i.getValueFromElement(!1)!==null||t.val(null);window.getSelection&&window.getSelection().empty&&window.getSelection().empty()})},r.prototype.getValueFromElement=function(i){var u=t.prototype.getValueFromElement.call(this,i),r;return n.Common.IsEmpty(u)?null:(r=Number(u),isNaN(r)?null:r)},r.StyleTemplateHelper=new i("Forguncy.NumberCellType"),r}(t);n.NumberCellType_Mobile=e;o=function(t){function r(){return t!==null&&t.apply(this,arguments)||this}return __extends(r,t),r.prototype.getStyleTemplateHelper=function(){return r.StyleTemplateHelper},r.prototype._getCellTypeData=function(t){return new n.DateCellTypeData(t)},r.prototype.initInputElement=function(n){n.attr("type","date");this.addClassInSimulator(n);var t=this;n.on("focus",function(){t.isReadOnly()&&$(this).trigger("blur")});n.on("touchstart",function(){if(t.isReadOnly())return!1})},r.prototype.bindValueChangedEvent=function(i){var r=this;n.Platform.isIOSDevice()?(i.blur(function(){r.isReadOnly()||r._onValueChanged()}),this.isInListview||i.focusout(function(){r.isReadOnly()||r.isDisabled()||setTimeout(function(){r._onValueChanged()},200)})):t.prototype.bindValueChangedEvent.call(this,i)},r.prototype.initDefaultValue=function(t){var i=this.cellTypeData.getDefaultValue();this._setValue(t,i);n.ForguncyData.pageInfo.dataModel.normalCellDataModel.setValue(this.ID,{newValue:i},1)},r.prototype.getValueFromElement=function(){var i,t;return this._$input?(i=this._$input.val(),n.Common.IsEmpty(i))?null:(t=new Date(i),isNaN(t.valueOf())?null:(t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),n.Convertor.fromDateToOADate(t))):null},r.prototype.setValueToElement=function(n,i){try{t.prototype.setValueToElement.call(this,n,this.getDateString(i))}catch(r){}},r.prototype.getDateString=function(t){var i;if(!n.DateHelper.isValidDateValue(t))return null;i=t;typeof t=="number"&&(i=n.Convertor.fromOADateToDate(t));var r=i.getMonth()+1,u=i.getDate(),f=(r<10?"0":"")+r,e=(u<10?"0":"")+u;return[i.getFullYear(),f,e].join("-")},r.StyleTemplateHelper=new i("Forguncy.DateCellType"),r}(t);n.DateCellType_Mobile=o;s=function(t){function r(){return t!==null&&t.apply(this,arguments)||this}return __extends(r,t),r.prototype.getStyleTemplateHelper=function(){return r.StyleTemplateHelper},r.prototype._getCellTypeData=function(t){return new n.TimeCellTypeData(t)},r.prototype.initInputElement=function(n){n.attr("type","time");this.addClassInSimulator(n);var t=this;n.on("focus",function(){t.isReadOnly()&&$(this).trigger("blur")});n.on("touchstart",function(){if(t.isReadOnly())return!1})},r.prototype.bindValueChangedEvent=function(i){var r=this;n.Platform.isIOSDevice()?(i.blur(function(){r.isReadOnly()||r._onValueChanged()}),this.isInListview||i.focusout(function(){r.isReadOnly()||r.isDisabled()||setTimeout(function(){r._onValueChanged()},200)})):t.prototype.bindValueChangedEvent.call(this,i)},r.prototype.initDefaultValue=function(t){var i=this.cellTypeData.getDefaultValue();this._setValue(t,i);n.ForguncyData.pageInfo.dataModel.normalCellDataModel.setValue(this.ID,{newValue:i},1)},r.prototype.getValueFromElement=function(){var t,i;return this._$input?(t=this._$input.val(),n.Common.IsEmpty(t))?null:n.Common.isValidateTime(t)?(typeof t=="string"&&(t=(t+"").split(".")[0]),i=new Date(n.FormatHelper.getValueFromText(t)),n.Convertor.fromDateToOADate(i)%1):null:null},r.prototype.setValueToElement=function(i,r){try{var u=r;typeof r=="number"&&(u=n.Convertor.fromOADateToDate(r));t.prototype.setValueToElement.call(this,i,this.getTimeString(u))}catch(f){}},r.prototype.getTimeString=function(n){if(!(n instanceof Date))return null;var t=n.getHours(),i=n.getMinutes(),r=n.getSeconds(),u=(t<10?"0":"")+t,f=(i<10?"0":"")+i,e=(r<10?"0":"")+r;return[u,f,e].join(":")},r.prototype.shouldReserveRightSpace=function(){return!0},r.StyleTemplateHelper=new i("Forguncy.TimeCellType"),r}(t);n.TimeCellType_Mobile=s;n.CellTypeHelper.registerCellType("Forguncy.ReadingTextCellType, ServerDesignerCommon",r,u);n.CellTypeHelper.registerCellType("Forguncy.TextCellType, ServerDesignerCommon",r,function(t){return(n.Platform.isMobile()||!t.CellType.ReadingTextInfo)&&!t.CellType.ShowPassword});n.CellTypeHelper.registerCellType("Forguncy.MultilineTextBox, ServerDesignerCommon",f,function(t){return n.Platform.isMobile()||!t.CellType.ReadingTextInfo});n.CellTypeHelper.registerCellType("Forguncy.NumberCellType, ServerDesignerCommon",e,u);n.CellTypeHelper.registerCellType("Forguncy.DateCellType, ServerDesignerCommon",o,u);n.CellTypeHelper.registerCellType("Forguncy.TimeCellType, ServerDesignerCommon",s,u)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){function u(){return n.Platform.isMobile()}var i=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.OnTemplateStyleApplied=function(t,i){if(n.prototype.OnTemplateStyleApplied.call(this,t,i),t&&i){var r=i.find("select");r.length>0&&(r.css("outline","none"),r[0].style.color===""&&r.css("color","inherit"))}},t}(n.InputCellTypeStyleTemplateHelperBase),t,r;n.MobileComboBoxCellTypeStyleTemplateHelper=i;t=function(t){function r(i,r,u,f){var e=t.call(this,i,r,u,f)||this;return e._dataName="item",e._initingValues=!1,e._isPageLoaded=!1,e.supportedEvents=["selectionchanged"],n.ItemsCellTypeHelper.prepareMetaData(i.CellType),e}return __extends(r,t),r.prototype.getStyleTemplateHelper=function(){return r.StyleTemplateHelper},r.prototype._getPartsUseBackcolor=function(){return $("#".concat(this.ID,"_div > div"))},r.prototype._getCellTypeData=function(t){return new n.InputCellTypeData(t)},r.prototype.getOffsetCondition=function(){return null},r.prototype.getIsPageLoaded=function(){return this._isPageLoaded},r.prototype.onPageLoaded=function(n){return this._isPageLoaded=!0,t.prototype.onPageLoaded.call(this,n)},r.prototype.createCellContent=function(){var u=this.CellElement,t=n.DomUtilities.createJqueryDomElement("select"),f,r,i;return this._$select=t,f=n.CellDomCreateHelper.createControlContainer(),f.append(t),n.CellDomCreateHelper.initalInputBox(u,t,this._getDomCreateInfo()),t.css("background-color","transparent"),n.ItemsCellTypeHelper.initItems(this,u,t,this._getDomCreateInfo()),r=this.cellTypeData.getDefaultValue(),n.Common.IsEmpty(r)||(n.ForguncyData.pageInfo.dataModel.normalCellDataModel.setValue(this.ID,{newValue:r},1),this._setValue(t,r)),n.ItemsCellTypeHelper.initItemsQuery(this,u,t,this._getDomCreateInfo()),this.isInListview||(i=this,t.change(function(){i._initingValues||i.isReadOnly()||(i._onValueChanged(),n.Page&&i.trigger("selectionchanged",{}))}),t.focusout(function(){i.isReadOnly()||i.validate()})),f},r.prototype.getValueToFormat=function(){var n=this.getSelectedItem();return n?n.DisplayValueBeforeFormat:null},r.prototype.setItems=function(t,i,r){var o=this.getItems(r,this.CellElement.StyleInfo.Formatter),s=i,h,e,u,f;this._initingValues=!0;try{for(s.empty(),h=o.length,e=0;e<h;e++)u=o[e],f=n.DomUtilities.createJqueryDomElement("option"),n.Common.IsEmpty(u.DisplayValue)&&(u.DisplayValue=""),f.append(n.Common.htmlEncode(u.DisplayValue)),n.Common.IsEmpty(u.Forecolor)?f.css("color","black"):f.css("color",n.ColorHelper.Convert(u.Forecolor)),f.data(this._dataName,u),s.append(f)}finally{this._initingValues=!1}this.updateValue(o)},r.prototype.getItems=function(t,i){return n.ComboCellHelper.getFormattedItems(t.Items,i)},r.prototype.updateValue=function(t){for(var r,f,u=n.ForguncyData.pageInfo.dataModel.normalCellDataModel.getValue(this.ID),e=t.length,i=0;i<e;i++)if(n.Common.isEquals(u,t[i].Value)){if(n.Common.IsEmpty(u)&&i>0)continue;return}r=n.ForguncyData.pageInfo.dataModel.normalCellDataModel.getValueType(this.ID);(r===0||r===1)&&(f=t.length===0?null:t[0].Value,n.ForguncyData.pageInfo.dataModel.normalCellDataModel.setValue(this.ID,{newValue:f},r))},r.prototype.setValueToElement=function(t,i){var r;if(t.length===0)return null;var u=t[0],f=u.options,o=f.length,e=-1;for(r=0;r<o;r++)if(n.ComboCellHelper.isComboBoxItemEqual(i,$(f[r]).data(this._dataName).Value)){e=r;break}u.selectedIndex=e;this.changeFormatElement()},r.prototype.getValueFromElement=function(){var n=this.getSelectedItem();return n?n.Value:null},r.prototype.getSelectedItem=function(){var i=this._$select,n,t,r;return i?(n=i[0],t=n.selectedIndex,t<0)?null:(r=$(n.options[t]),r.data(this._dataName)):null},r.prototype.reload=function(){var t=this.CellElement.CellType;t.IsBounding&&(t.haveLoadItems=!1,n.ItemsCellTypeHelper.initItems(this,this.CellElement,this._$select,this._getDomCreateInfo()))},r.prototype.getBindingTables=function(){var n=this.CellElement.CellType;return n.IsBounding?[n.DataSource]:null},r.prototype._endWaitingServerData=function(){t.prototype._endWaitingServerData.call(this);this._$select&&this.changeFormatElement()},r.prototype.setForeColorToInput=function(t){var i=this._$select;i&&(t?i.css("color",n.ColorHelper.Convert(t)):i.css("color",""))},r.prototype._getPartsUseFontStyle=function(){var n=t.prototype._getPartsUseFontStyle.call(this);return this._$select?this._$select.add(n):n},r.prototype._disable=function(n){this.updateSelectDisabledProperty();t.prototype._disable.call(this,n)},r.prototype._enable=function(n){this.updateSelectDisabledProperty();t.prototype._enable.call(this,n)},r.prototype.updateReadOnlyStatus=function(){this.updateSelectDisabledProperty()},r.prototype.updateSelectDisabledProperty=function(){if(this._$select){var n=!this.isDisabled()&&!this.isReadOnly();n?this._$select.removeAttr("disabled"):this._$select.attr("disabled","disabled")}},r.prototype.getHorizontalAlignmentForFormatLabel=function(){return n.CellHorizontalAlignment.Left},r.prototype.destroy=function(){this._$select=null;t.prototype.destroy.call(this)},r.prototype.getListviewNoneEditModeText=function(i,r,u,f){f===void 0&&(f=null);var e=n.ComboCellHelper.getDisplayValue(this.CellElement.CellType,i,r,this.CellElement.StyleInfo.Formatter,this.designerPageName,this.runTimePageName,f);return e!==null?e:t.prototype.getListviewNoneEditModeText.call(this,i,r,u,f)},r.prototype.onFormatterChanged=function(){t.prototype.onFormatterChanged.call(this);var i=$("#"+this.ID);i.length===1&&n.ItemsCellTypeHelper.initItems(this,this.CellElement,i,this._getDomCreateInfo())},r.prototype.GetDisplayTextForCommand=function(){var n=this.getSelectedItem();return{DisplayText:n===null||n===void 0?void 0:n.DisplayValue}},r.prototype.ReloadForCommand=function(){this.reload()},r.prototype.SetItemsByStringArray=function(t){n.ItemsCellTypeHelper.SetItemsByStringArray(this,this._$select,this._getDomCreateInfo(),t)},r.prototype.SetItemsByObjectArray=function(t,i,r){n.ItemsCellTypeHelper.SetItemsByObjectArray(this,this._$select,this._getDomCreateInfo(),t,i,r)},r.StyleTemplateHelper=new i("Forguncy.DropDownListCellType"),r}(n.SupportFormatCellType);n.ComboBoxCellType_Mobile=t;r=function(t){function r(n,i,r,u){var f=t.call(this,n,i,r,u)||this,e;return f.NAME="Name",f.FULLNAME="FullName",f.EMAIL="Email",e=n.CellType,e.haveLoadItems=!1,f}return __extends(r,t),r.prototype.getStyleTemplateHelper=function(){return r.StyleTemplateHelper},r.prototype.getItems=function(t){var r=[],f=this.CellElement.CellType,i,o,s,u,e,h;if(f.AddNullItemWhenBinding&&r.push({Value:null,DisplayValue:n.Common.IsEmpty(f.NoneItemText)?"":n.Common.getMultiLanguageWord(f.NoneItemText)}),i=t.Properties.users,!i||i.length===0)return r;for(o=this.CellElement.CellType.MobileDisplayColumnName,s=i.length,u=0;u<s;u++)e=i[u],h=this.getUserInfoProperty(e,o),r.push({Value:e.UserName,DisplayValue:h});return r},r.prototype.getUserInfoProperty=function(t,i){if(n.Common.IsEmpty(i))return t.UserName;switch(i){case this.NAME:return t.UserName;case this.FULLNAME:return t.FullName;case this.EMAIL:return t.Email;default:return n.UserInfoHelper.getUserPropertyValue(t,i)}},r.prototype.reload=function(){},r.prototype.getListviewNoneEditModeText=function(i,r,u,f){f===void 0&&(f=null);var e=n.UserSelectorCellHelper.getDisplayValue(this.CellElement.CellType,i,r);return e!==null?e:t.prototype.getListviewNoneEditModeText.call(this,i,r,u,f)},r.StyleTemplateHelper=new i("Forguncy.UserCellType"),r}(t);n.UserSelectorCellType_Mobile=r;n.CellTypeHelper.registerCellType("Forguncy.DropDownListCellType, ServerDesignerCommon",t,u);n.CellTypeHelper.registerCellType("Forguncy.UserCellType, ServerDesignerCommon",r,u)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var i=function(){function t(){}return t.preDestroySubPage=function(t,i){if(!n.Common.IsEmpty(t)){var r=n.PageManager.getNestedRunTimePageNames([t,i]);n.ForguncyData.pageInfo.formulaManager.preDestroyRunTimePage(r)}},t.destroySubPage=function(t,i){if(!n.Common.IsEmpty(t)){var r=[t,i].filter(function(n){return!!n});n.ForguncyData.pageInfo.pageElementManager&&n.ForguncyData.pageInfo.pageElementManager.cells.getAllContainerCells(r).forEach(function(n){n.cellType.destroyAllPages()});n.ForguncyData.pageInfo.formulaManager.destroyRunTimePage(r);n.ForguncyData.pageInfo.pageElementManager.destroyRunTimePage(r);n.HubManager.destroyRunTimePage(r)}},t}(),u,r,f,t,e,o,s;n.SubPageHelper=i;u=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype._getPartsUseFontStyle=function(){return null},t.prototype._getContainerOverflowValueStr=function(n){switch(n){case 0:return"visible";case 1:return"auto";default:return"hidden"}},t.prototype.getTabIndexDom=function(){return null},t}(n.CellTypeBaseWithSimplebar);n.ContainerCellTypeBase=u;r=function(t){function r(n,i,r,u){var f=t.call(this,n,i,r,u)||this;return f.subPageInfos=[],f.supportedEvents=["subpagechanged"],f}return __extends(r,t),r.prototype.needValidate=function(){return!1},r.prototype._loadContent=function(t,i,r){var u,f;if(r===void 0&&(r=!1),u=this,n.Common.IsEmpty(t)){u._emptyContent(i);return}if(u.isCircularReferencePage(t)){f=n.Common.format(n.RS.ContainerCellType_Error_CircularReference,t);alert(f);u._emptyContent(i);n.ErrorHelper.printErrorStr(f);return}n.MetadataLoader.GetMetadataRequest(t,{isSubPage:!0,isUserControl:r},function(f){if(!f){u._emptyContent(i);return}if(n.ForguncyData.pageInfo.pageID===u._pageID){var e=f;u.needQueryAutoID(e)?n.HomeController.GetAutoGeneratedIDsOfPage(e.pageName,function(n){e.autoGeneratedIDs=n;u._createSubPage(t,f,i,r)}):u._createSubPage(t,f,i,r)}})},r.prototype.needQueryAutoID=function(t){var i,u,r,f;if(!t.autoGeneratedIDs)return!1;for(i in t.autoGeneratedIDs)for(u in t.autoGeneratedIDs[i])if((r=t.autoGeneratedIDs[i][u],!r.Fields)&&!r.ID)if(f=n.ForguncyData.pageInfo.autoIDManager.getAutoIDByBindingInfo({TableName:i,ColumnName:u}),f)r.ID=f.id;else return!0;return!1},r.prototype._emptyContent=function(n){this.subPageInfos[n]=undefined;this.onPageIsReady(n);this.trigger("pageingInfoChanged",{tabIndex:n});this.trigger("loaded",{tabIndex:n});this.trigger("pagedefaultdataloaded",{tabIndex:n})},r.prototype.getChildrenCells=function(){var t=[],n,i,r;if(this.subPageInfos)for(n=0,i=this.subPageInfos;n<i.length;n++)r=i[n],r&&t.push.apply(t,r.childrens);return t},r.prototype._createSubPage=function(t,r,u,f){var c,l,a,v,o,e,y,w;if(f===void 0&&(f=!1),o=this,e=n.MetadataHelper.createPageMetadata(r),n.MetadataHelper.checkError(e)===!1){o._emptyContent(u);return}if(!f&&e.pageName!==t&&n.BuiltInPageManager.isBuiltInPage(e.pageName)){y=!1;n.Common.forguncyPostSync("Home/PageNameExisted",{PageName:t,IsUserControl:f},function(n){y=n});y?o._navigateToNewPage(e,t):(o._emptyContent(u),alert(n.Common.format(n.RS.ContainerCellType_Error_NoExistedPage,t)));return}var p=n.PageManager.getUniquePageName(),s=p.runTimeNormalPageName,h=p.runTimeMasterPageName;i.preDestroySubPage((c=o.subPageInfos[u])===null||c===void 0?void 0:c.runTimeNormalPageName,(l=o.subPageInfos[u])===null||l===void 0?void 0:l.runTimeMasterPageName);o.subPageInfos[u]={runTimeNormalPageName:s,runTimeMasterPageName:h,designerPageName:e.PageSettings.Name,designerPageTitle:n.Common.getMultiLanguageWord(e.PageSettings.Title),designerMasterPageName:e.MasterPage?e.MasterPage.PageSettings.Name:null,pageLoadedCommand:e.PageSettings.PageLoadedCommandList,propertyValueChangedCommand:e.PageSettings.PropertyValueChangedCommand,masterPageLoadedCommand:(v=(a=e.masterPageMetaDataObj)===null||a===void 0?void 0:a.PageSettings)===null||v===void 0?void 0:v.PageLoadedCommandList,isLoading:!0,childrens:[]};o.trigger("pageingInfoChanged",{tabIndex:u});n.ForguncyData.pageInfo.enableTabIndex=n.ForguncyData.pageInfo.enableTabIndex||{};e.PageSettings.EnableTabIndex&&(n.ForguncyData.pageInfo.enableTabIndex[s]=e.PageSettings.EnableTabIndex);w=new n.ForguncyDataSetter(e,n.ForguncyData.pageInfo,s,h,3);w.setPageInfoByMetadata();var b=function(){o.onPageContentAppended(e,u)},k=n.PageBuilder.loadUserJavaScript(e,b),d={subPageInfo:o.subPageInfos[u],ownerCell:o.owner},g=n.Presentation.PageContentCreator.create(e,s,h,3,2,d);this.appendPage(e,g,u);n.PageBuilder.onLoad([s,h]);k&&b()},r.prototype.getNestedRunTimePageNames=function(t){if(this.subPageInfos[t]){var i=[this.subPageInfos[t].runTimeNormalPageName,this.subPageInfos[t].runTimeMasterPageName];return n.PageManager.getNestedRunTimePageNames(i)}return null},r.prototype.appendPage=function(n,t,i){var r=this.getSubPageContainerID(i);$("#"+r).append(t)},r.prototype._navigateToNewPage=function(t,i){var r;n.Common.IsEmpty(t.ReturnUrl)||(t.ReturnUrl=((r=n.ForguncyData.pageInfoStack)===null||r===void 0?void 0:r.length)>0?n.ForguncyData.pageInfoStack[0].pageName:n.ForguncyData.pageInfo.pageName,t.noPermissionPage=i);n.PageBuilder.pageCover.show();n.Common.initalTimeStamp();n.PageBuilder.createPage(t,null)},r.prototype.getSubPageContainerID=function(){return null},r.prototype.containRunTimePage=function(n){return this.subPageInfos.some(function(t){return t&&(t.runTimeMasterPageName===n||t.runTimeNormalPageName===n)})},r.prototype.getAllRunTimePageNames=function(){var n=[];return this.subPageInfos.forEach(function(t){t&&(n.push(t.runTimeNormalPageName),n.push(t.runTimeMasterPageName))}),n},r.prototype.getDirectRunTimePageNames=function(){return this.subPageInfos.filter(function(n){return!!n}).map(function(t){return n.Common.IsEmpty(t.designerMasterPageName)?t.runTimeNormalPageName:t.runTimeMasterPageName})},r.prototype.getDesignerPageName=function(n,t){for(var i,r=0;r<this.subPageInfos.length;r++)if(i=this.subPageInfos[r],i){if(i.runTimeNormalPageName===n)return i.designerPageName;if(i.runTimeMasterPageName===n)return t?i.designerPageName:i.designerMasterPageName}return null},r.prototype.getDesignerPageTitle=function(n){for(var t,i=0;i<this.subPageInfos.length;i++)if((t=this.subPageInfos[i],t)&&(t.runTimeNormalPageName===n||t.runTimeMasterPageName===n))return t.designerPageTitle;return null},r.prototype.getRunTimePageName=function(n){for(var t,i=0;i<this.subPageInfos.length;i++)if(t=this.subPageInfos[i],t){if(t.designerPageName===n)return t.runTimeNormalPageName;if(t.designerMasterPageName===n)return t.runTimeMasterPageName}return null},r.prototype.getTabIndex=function(n){for(var i,t=0;t<this.subPageInfos.length;t++)if(i=this.subPageInfos[t],i&&(i.runTimeNormalPageName===n||i.runTimeMasterPageName===n))return t;return-1},r.prototype.onPageContentAppended=function(t,i){var r=this.subPageInfos[i];if(this.InitDefaultDataAndModels(t,r),this.trigger("loaded",{tabIndex:i}),n.PageBuilder.hasCallOnPageLoaded)n.PageBuilder.onPageLoaded([r.runTimeNormalPageName,r.runTimeMasterPageName]);n.PageBuilder.hasExecutePageLoadedCommand&&this.initBindingDataAndExecutePageLoadedCommand(i)},r.prototype.InitDefaultDataAndModels=function(t,i){n.PageBuilder.initDefaultDataAndModels(t,i.runTimeNormalPageName,i.runTimeMasterPageName)},r.prototype.initBindingDataAndExecutePageLoadedCommand=function(t){var r=this.subPageInfos[t],i=[r.runTimeNormalPageName,r.runTimeMasterPageName];n.ForguncyData.pageInfo.currentRowInfoCollection.list.forEach(function(t){var r=n.ForguncyData.pageInfo.pageElementManager.cells.getAllCells(i),u;r.forEach(function(n){return n.onCurrentRowInfoChanged(t.currentTable)});u=n.ForguncyData.pageInfo.pageElementManager.backgroundImages.getBackgroundImages(i);(r.some(function(n){return n.bindingInfo})||u.some(function(n){return n.bindingInfo}))&&n.ForguncyData.pageInfo.normalCellBindingManager.getBindingValuesFromServer(t.currentTable,t.query)});n.PageBuilder.fillAllListviewData(i);this.executeOneTabLoadedCommand(t)},r.prototype.executePageLoadedCommand=function(){var n=this;this.subPageInfos.forEach(function(t,i){return n.executeOneTabLoadedCommand(i)})},r.prototype.executeOneTabLoadedCommand=function(t){var r=this,i=this.subPageInfos[t],u,f;if(!i){r.trigger("pagedefaultdataloaded",{tabIndex:t});return}u=[i.runTimeNormalPageName,i.runTimeMasterPageName];f=function(){n.PageBuilder.delayFillAllListviewData(u);n.DelayOperateHelper.Push(null,function(){n.DelayRefresh.Push(null,function(){n.ForguncyData.pageInfo.defaultFormulaManager.clearDefaultFormula(u)},"clearDefaultFormula"+i.runTimeNormalPageName);r.onPageIsReady(t);$(document).trigger("initPageData");r.trigger("pagedefaultdataloaded",{tabIndex:t});r.resizeUIElement(t);i.isLoading=!1},2)};this._executePageLoadedCommands(i.runTimeMasterPageName,i.masterPageLoadedCommand,i.runTimeNormalPageName,i.pageLoadedCommand,f)},r.prototype._executePageLoadedCommands=function(t,i,r,u,f){if(!n.ForguncyData.commandExecutor){f();return}var o=i&&i.length>0,e=u&&u.length>0;if(!o&&!e){f();return}o&&n.ForguncyData.commandExecutor.executeCommand(i,{runTimePageName:t,commandTrigger:null,commandID:t,eventType:"pageloaded",callbackOnCommandCompleted:function(){e||f()}});e&&n.ForguncyData.commandExecutor.executeCommand(u,{runTimePageName:r,commandTrigger:null,commandID:r,eventType:"pageloaded",callbackOnCommandCompleted:function(){f()}})},r.prototype.onPageIsReady=function(){},r.prototype.triggerPageLoadedEvent=function(){var n=this;n.subPageInfos.forEach(function(t,i){n.trigger("loaded",{tabIndex:i})})},r.prototype.isLoading=function(n){for(var t,i=0,r=this.subPageInfos;i<r.length;i++)if(t=r[i],t&&(t.runTimeNormalPageName===n||t.runTimeMasterPageName===n))return t.isLoading;return!1},r.prototype.isCircularReferencePage=function(t){var i=n.PageManager.getLocatedNormalPageNames(this.runTimePageName);return i.indexOf(t)>=0},r.prototype.destroyAllPages=function(){this.subPageInfos.forEach(function(n){n&&i.destroySubPage(n.runTimeNormalPageName,n.runTimeMasterPageName)})},r.prototype.resizeUIElement=function(t){var i=this.getNestedRunTimePageNames(t);i&&n.ForguncyData.pageInfo.pageElementManager.resizePageElements(i)},r}(u);n.SubPageContainerCellTypeBase=r;f=function(r){function u(){var n=r!==null&&r.apply(this,arguments)||this;return n._oldSubPageInfos=[],n._oldSubPageContainerIDs=[],n.loading=!1,n}return __extends(u,r),u.prototype.prepareCreateNewPage=function(){this.loading=!0;this.getContainer().css("pointer-events","none");this._oldSubPageContainerIDs.push(this._subPageContainerID);this._oldSubPageInfos.push(this.subPageInfos[0]);this._subPageContainerID=this.createNewSubPageContainerID();var n=$("#"+this.ID);this.createContentContainer(n);$("#"+this.getSubPageContainerID(0)).css("display","none")},u.prototype.createContentContainer=function(t){var i=n.DomUtilities.createJqueryDomElement("div");i.css("height","100%");i.attr("id",this.getSubPageContainerID(0));t.append(i)},u.prototype.onPageIsReady=function(t){if(this.getContainer().scrollLeft(0).scrollTop(0),this.destroyOldPage(),this.getContainer().css("pointer-events",""),!n.PageBuilder.pageIsLoading){var i=this.subPageInfos[t];if(i)n.ForguncyData.pageDirtyCheckManager.onSubPageLoaded([i.runTimeNormalPageName,i.runTimeMasterPageName])}this.loading=!1},u.prototype.destroyOldPage=function(){var t=this._oldSubPageContainerIDs.shift(),n=this._oldSubPageInfos.shift();$("#"+this.getSubPageContainerID(0)).css("display","");n&&i.destroySubPage(n.runTimeNormalPageName,n.runTimeMasterPageName);t&&$("#"+t).remove()},u.prototype.createNewSubPageContainerID=function(){return t._index++,this.ID+"_content"+t._index},u.prototype._setVisible=function(n,t){var u,i;if(r.prototype._setVisible.call(this,n,t),t&&((u=this.subPageInfos)===null||u===void 0?void 0:u.length)>0)for(i=0;i<this.subPageInfos.length;i++)this.resizeUIElement(i)},u.prototype.getSubPageContainerID=function(){return this._subPageContainerID},u.prototype.createContent=function(){var r=this,t,i;return this._subPageContainerID=this.createNewSubPageContainerID(),t=n.DomUtilities.createJqueryDomElement("div"),t.attr("id",this.ID),t.addClass("fgc-adjust-container"),this.createContentContainer(t),i=this.getDefaultPageName(),this._pageName=i,n.DelayRefresh.setTimeout(function(){r._pageName===i&&r.loadSubPage(i)}),t},u.prototype.loadSubPage=function(n){this._pageName=n;this._loadContent(this._pageName,0,this.isUserControl())},u.prototype.getDefaultPageName=function(){return null},u.prototype._setOverflowHidden=function(t){n.DomUtilities.setContainerOverFlow(t,this._getContainerOverflowValueStr(this.CellElement.CellType.OverflowMode))},u.prototype.isUserControl=function(){return!1},u.prototype.appendPage=function(t,i,u){var f=t.PageSettings.PageLoadingMode;f===0&&(f=n.ForguncyData.GlobalSettings.PageLoadingMode);f===1&&this.destroyOldPage(f);r.prototype.appendPage.call(this,t,i,u)},u}(r);n.SinglePageContainerCellType=f;t=function(t){function i(n,i,r,u){var f=t.call(this,n,i,r,u)||this;return f.supportedEvents=["loaded","pagedefaultdataloaded","subpagechanged"],f}return __extends(i,t),i.prototype.getDefaultValue=function(){var t=this.CellElement.CellType.PageName;return{Value:n.Common.IsEmpty(t)?null:t}},i.prototype.getDefaultPageName=function(){return this.CellElement.CellType.PageName},i.prototype._isSamePage=function(t,i){return n.Common.IsEmpty(t)&&n.Common.IsEmpty(i)?!0:t===i},i.prototype.setValueToElement=function(t,i){if(!this._isSamePage(i,this._pageName)){this.prepareCreateNewPage();var r=n.Common.IsEmpty(i)?null:i+"";this.subPageInfos.length&&this.subPageInfos[0]&&n.PageStatistics.instance.leavePage(this.subPageInfos[0].runTimeNormalPageName);this.loadSubPage(r)}},i._index=0,i}(f);n.ContentContainerCellType=t;e=function(n){function t(){var t=n.call(this)||this;return t.CellTypeString="Forguncy.TabControlCellType",t.TemplateNameParts=["TabControlHeader","TabControlContainer"],t}return __extends(t,n),t.prototype.MapPartsNameToDom=function(n){var t,i=n.find("li[tabid] > a"),r=n.find(".tab-content");return t={},t.TabControlHeader=i,t.TabControlContainer=r,t},t}(n.CellTypeStyleTemplateHelperBase);n.TabControlCellTypeStyleTemplateHelper=e;o=function(t){function i(){var n=t!==null&&t.apply(this,arguments)||this;return n._defaultActiveTabIndex=0,n._tabs=[],n._tabCount=0,n._subPageIsLoading=[],n}return __extends(i,t),i.prototype.getStyleTemplateHelper=function(){return i.StyleTemplateHelper},i.prototype.createContent=function(){var f=this,t=this,r=this.CellElement.CellType,i=r.Tabs,u;return!i||i.length<=0?null:(t._subPageIsLoading=new Array(i.length).fill(!1),t._tabCount=i.length,t._defaultActiveTabIndex=r.ActiveTabIndex,t.initStyleInfo(),u=t.createContainer(i.length),r.HideHeader||s.addCSSRule(t.ID,t.designerPageName,u,t._styles,this.CellElement.StyleInfo),this.CellElement.CellType.LazyLoading?t._subPageIsLoading[t._defaultActiveTabIndex]=!0:t._subPageIsLoading.fill(!0),n.DelayRefresh.setTimeout(function(){f.CellElement.CellType.LazyLoading?t._loadContent(i[t._defaultActiveTabIndex],t._defaultActiveTabIndex):i.forEach(function(n,i){return t._loadContent(n,i)})}),u)},i.prototype._setOverflowHidden=function(n){this.setContainerOverFlow(n)},i.prototype.setContainerOverFlow=function(t){this.CellElement.CellType.OverflowMode===0?n.DomUtilities.setContainerOverFlow(t,this._getContainerOverflowValueStr(this.CellElement.CellType.OverflowMode)):n.DomUtilities.setContainerOverFlow(t,"hidden")},i.prototype.getTabCount=function(){return this._tabCount},i.prototype.createContainer=function(t){var i=n.DomUtilities.createJqueryDomElement("div"),r;return i.attr("id",this.ID),i.css("box-sizing","border-box"),i.css("height","100%"),i.css("display","flex"),i.css("flex-direction","column"),this.setContainerOverFlow(i),r=this.createHeaderPart(t),i.append(r),i.append(this.createContentPart(t)),this.CellElement.CellType.HideHeader&&r.css("display","none"),i},i.prototype.createHeaderPart=function(t){var e,r=n.DomUtilities.createJqueryDomElement("UL"),f,u;for(r.css("display","inline-flex"),r.css("flex-wrap","wrap"),r.css("justify-content","flex-start"),r.css("align-items","baseline"),r.css("margin-top",0),r.css("width","100%"),r.addClass("nav"),r.addClass("nav-tabs"),r.addClass("tabCell-nav-tabs"),f=0;f<t;f++)r.append(this.createHeaderLI(f));return u=n.DomUtilities.createJqueryDomElement("li"),u.attr(i._tabIndexStr,t),u.attr("id",this.getRemainedLiID()),u.css("flex",1),u.css("border-bottom",n.ColorHelper.ConvertBorder((e=this._styles.HeaderStyle.NormalStyle.BorderBottomString)!==null&&e!==void 0?e:this._styles.HeaderStyle.NormalStyle.BorderString)),u.css("opacity",this._styles.HeaderStyle.NormalStyle.Opacity),u.css("align-self","flex-end"),r.append(u),r},i.prototype.createHeaderLI=function(t){var f=this,u=n.DomUtilities.createJqueryDomElement("li"),r;return u.attr(i._tabIndexStr,t),r=this.createHeaderText(this.getHeaderID(t),this.getSubPageContainerID(t),t),function(n){r.click(function(){return f.showTab(n,this),!1})}(t),n.DomUtilities.setTabIndex(r,-1),u.append(r),u},i.prototype.createHeaderText=function(t,i,r){var u=n.DomUtilities.createJqueryDomElement("a"),f;return u.attr("data-toggle","_tab"),u.attr("href","#"+i),u.attr("id",t),u.css("height","100%"),u.css("width","100%"),u.css("display","flex"),u.css("flex-direction","column-reverse"),n.DomUtilities.setPropertyToDom(this.CellElement,u,this._getDomCreateInfo(),[0]),u.css("color",""),this.CellElement.CellType.LazyLoading&&(f=this,n.MetadataLoader.GetMetadataRequest(this.CellElement.CellType.Tabs[r],{isSubPage:!0,isUserControl:!1},function(t){var o=t,e=n.MetadataHelper.createPageMetadata(o),s=f.CellElement.CellType.Tabs[r],i;if(e.pageName!==s){u.css("display","none");return}i=n.DomUtilities.createJqueryDomElement("span");i.text(n.Common.getMultiLanguageWord(e.PageSettings.Title));u.append(i)})),u},i.prototype.createContentPart=function(t){var f,e,o,s,i=n.DomUtilities.createJqueryDomElement("div"),r,u;for(i.addClass("tab-content"),i.css("box-sizing","border-box"),i.css("flex","1"),this.CellElement.CellType.HideHeader?i.css("border","none"):(r=this._styles.ContainerStyle.NormalStyle,i.css("border","none"),i.css("border-top",n.ColorHelper.ConvertBorder((f=r.BorderTopString)!==null&&f!==void 0?f:r.BorderString)),i.css("border-left",n.ColorHelper.ConvertBorder((e=r.BorderLeftString)!==null&&e!==void 0?e:r.BorderString)),i.css("border-right",n.ColorHelper.ConvertBorder((o=r.BorderRightString)!==null&&o!==void 0?o:r.BorderString)),i.css("border-bottom",n.ColorHelper.ConvertBorder((s=r.BorderBottomString)!==null&&s!==void 0?s:r.BorderString))),this.setContainerOverFlow(i),u=0;u<t;u++)i.append(this.createTabContent(u));return i},i.prototype.createTabContent=function(t){var i=n.DomUtilities.createJqueryDomElement("div");return i.attr("id",this.getSubPageContainerID(t)),i.addClass("tab-pane"),i.addClass("fade"),i.css("height","100%"),n.DomUtilities.setContainerOverFlow(i,this._getContainerOverflowValueStr(this.CellElement.CellType.OverflowMode)),i.css("margin","0px"),t===0&&(i.addClass("in"),i.addClass("active")),i},i.prototype.getSubPageContainerID=function(n){return this.ID+"tab"+n},i.prototype.getHeaderID=function(n){return this.ID+"header"+n},i.prototype.getRemainedLiID=function(){return this.ID+"remainedLi"},i.prototype.onPageContentAppended=function(i,r){if(!this.CellElement.CellType.LazyLoading){var f=this.getHeaderID(r),u=n.DomUtilities.createJqueryDomElement("span");u.text(n.Common.getMultiLanguageWord(i.PageSettings.Title));$("#"+f).append(u)}t.prototype.onPageContentAppended.call(this,i,r)},i.prototype.combineStyle=function(t,i){var r=Object.keys(i);r.forEach(function(r){n.Common.IsEmpty(t[r])?t[r]=i[r]:n.Common.IsEmpty(i[r])||n.Common.isEquals(t[r],i[r])||(t[r]=i[r])})},i.prototype.initStyleInfo=function(){var f,r=n.Common.clone(i._defaultStyles),t,u;((f=this.CellElement.StyleTemplate)===null||f===void 0?void 0:f.Styles)&&(t=this.CellElement.StyleTemplate.Styles.TabControlHeader,(t===null||t===void 0?void 0:t.NormalStyle)&&(this.combineStyle(r.HeaderStyle.NormalStyle,t.NormalStyle),this.combineStyle(r.HeaderStyle.HoverStyle,t.NormalStyle),this.combineStyle(r.HeaderStyle.ActiveStyle,t.NormalStyle),this.combineStyle(r.HeaderStyle.SelectedStyle,t.NormalStyle)),(t===null||t===void 0?void 0:t.HoverStyle)&&this.combineStyle(r.HeaderStyle.HoverStyle,t.HoverStyle),(t===null||t===void 0?void 0:t.SelectedStyle)&&this.combineStyle(r.HeaderStyle.SelectedStyle,t.SelectedStyle),(t===null||t===void 0?void 0:t.ActiveStyle)&&this.combineStyle(r.HeaderStyle.ActiveStyle,t.ActiveStyle),u=this.CellElement.StyleTemplate.Styles.TabControlContainer,(u===null||u===void 0?void 0:u.NormalStyle)&&this.combineStyle(r.ContainerStyle.NormalStyle,u.NormalStyle));this._styles=r},i.prototype.onLoad=function(){this.showTab(this._defaultActiveTabIndex)},i.prototype.showTab=function(t,i){if(!(t<0)&&!(t>=this._tabCount)&&$("#"+this.getHeaderID(t))[0].style.display!=="none"){if(this._subPageIsLoading[t]||(this._loadContent(this.CellElement.CellType.Tabs[t],t),this._subPageIsLoading[t]=!0),!this._tabs[t]){if(i||(i=$("#"+this.getHeaderID(t))[0]),!i)return;this._tabs[t]=new n.Tab(i)}this._tabs[t].show();this.onTabVisible(t)}},i.prototype.displayOrHideRemainedTab=function(){for(var i,r,t=!0,n=0;n<this._tabCount;n++)if(i=$("#"+this.getHeaderID(n))[0],i.style.display!="none"){t=!1;break}r=$("#"+this.getRemainedLiID())[0];r.style.display=t?"none":"flex"},i.prototype.hideTab=function(n){if(!(n<0)&&!(n>=this._tabCount)){if(n===0){var t=$("#"+this.getHeaderID(1)).closest("li")[0];t&&(t.style.marginLeft="0px")}$("#"+this.getHeaderID(n))[0].style.display="none";this.displayOrHideRemainedTab()}},i.prototype.displayTab=function(n){n<0||n>=this._tabCount||($("#"+this.getHeaderID(n))[0].style.display="flex",this.CellElement.CellType.HideHeader&&this.showTab(n),this.displayOrHideRemainedTab())},i.prototype.onTabVisible=function(t){if(this.getActiveTabIndex()===t){var i=this;if($("#"+this.getSubPageContainerID(t)).css("display")==="none"){n.DelayRefresh.setTimeout(function(){i.onTabVisible(t)},50);return}this.resizeUIElement(t);this.reValidate(t)}},i.prototype.reValidate=function(t){var i,r;$("#"+this.getSubPageContainerID(t)).find(".tooltip-arrow").length<=0||(i=this.getNestedRunTimePageNames(t),n.ValidationMananger.validateAllCells(!1,i),r=n.ListviewBase.getAllListviews(i),r.forEach(function(n){n.stopEditingActiveCell()}))},i.prototype.getActiveTabIndex=function(){var n=Number($("#"+this.ID).children("ul").find(".active").attr(i._tabIndexStr));return isNaN(n)?-1:n},i.prototype._setVisible=function(n,i){var r,u;t.prototype._setVisible.call(this,n,i);i&&((r=this.subPageInfos)===null||r===void 0?void 0:r.length)>0&&(u=this.getActiveTabIndex(),u>=0&&this.resizeUIElement(u))},i.prototype.SetActiveTabIndex=function(n){this.showTab(n-1)},i.prototype.getSplitIndexs=function(n){var t=[],i;return n.toString().includes(",")?(i=n.toString().split(","),t=i.map(function(n){return Number.isNaN(Number(n))?-1:Number(n)})):t.push(Number.isNaN(Number(n))?-1:Number(n)),t},i.prototype.HideTabIndex=function(n){var e=this,r=this.getSplitIndexs(n.toString()),u,f,t,i;for(r.forEach(function(n){e.hideTab(n-1)}),u=function(n){return r.some(function(t){return t-1-n==0})?"continue":($("#"+f.getHeaderID(n))[0].click(),{value:void 0})},f=this,t=0;t<this._tabCount;t++)if(i=u(t),typeof i=="object")return i.value},i.prototype.ShowTabIndex=function(n){var t=this,i=this.getSplitIndexs(n.toString());i.forEach(function(n){t.displayTab(n-1)})},i._defaultStyles={HeaderStyle:{NormalStyle:{FontColor:"",BorderString:""},ActiveStyle:{FontColor:"",BorderString:""},HoverStyle:{FontColor:"",BorderString:""},SelectedStyle:{FontColor:"",BorderString:""}},ContainerStyle:{NormalStyle:{BorderString:""}}},i.StyleTemplateHelper=new e,i._tabIndexStr="tabid",i}(r);n.TabControlCellType=o;s=function(){function t(n,t,i){this._className=n;this._styles=t;this._styleInfo=i}return t.addCSSRule=function(n,i,r,u,f){var e=t.getClassName(i,n),o;r.addClass(e);t._classNameCache.indexOf(e)===-1&&(t._classNameCache.push(e),o=new t(e,u,f),o.addStyle())},t.getClassName=function(i,r){var f=n.Common.parseIDStr(r),u=t._pageNameCache.indexOf(i);return u===-1&&(u=t._pageNameCache.length,t._pageNameCache.push(i)),"tabControlStyle"+u+"_"+f.row+"_"+f.col},t.prototype.addStyle=function(){var t=[this.getNormalStatusCssStr(),this.getHoverStatusCssStr(),this.getSelectedStatusCssStr(),this.getActiveStatusCssStr(),];n.CSSHelper.addCSSRules(t,this._className)},t.prototype.getFontStatusCssStr=function(){var i=t._style,r=n.ColorHelper.Convert(i.FontColor);return t._isNormalStyle&&this._styleInfo.Foreground&&(r=n.ColorHelper.Convert(this._styleInfo.Foreground))," color: "+r+"; font-weight: "+(i.Bold?"bold":"normal")+"; font-style: "+(i.Italic?"italic":"normal")+";"},t.prototype.getPaddingStatusCssStr=function(){var i,r,u,f,n=t._style,e=(i=n.PaddingTop)!==null&&i!==void 0?i:0,o=(r=n.PaddingLeft)!==null&&r!==void 0?r:0,s=(u=n.PaddingRight)!==null&&u!==void 0?u:0,h=(f=n.PaddingBottom)!==null&&f!==void 0?f:0;return" padding-top: "+e+"px !important; padding-left: "+o+"px !important; padding-right: "+s+"px !important; padding-bottom: "+h+"px !important;"},t.prototype.getBorderStatusCssStr=function(){var r,u,f,e,i=t._style;return" border:none; border-top: "+n.ColorHelper.ConvertBorder((r=i.BorderTopString)!==null&&r!==void 0?r:i.BorderString)+"; border-left: "+n.ColorHelper.ConvertBorder((u=i.BorderLeftString)!==null&&u!==void 0?u:i.BorderString)+"; border-right: "+n.ColorHelper.ConvertBorder((f=i.BorderRightString)!==null&&f!==void 0?f:i.BorderString)+"; border-bottom: "+n.ColorHelper.ConvertBorder((e=i.BorderBottomString)!==null&&e!==void 0?e:i.BorderString)+";"},t.prototype.getBackgroudStatusCssStr=function(){var i,r=t._style;return"background: "+((i=n.ColorHelper.Convert(r.Background))!==null&&i!==void 0?i:"transparent")+";"},t.prototype.getBorderRadiusCssStr=function(){var n,i=t._style;return"border-radius: "+((n=i.BorderRadiusString)!==null&&n!==void 0?n:"0px")+";"},t.prototype.getOpacityCssStr=function(){var n,i=t._style;return"opacity: "+((n=i.Opacity)!==null&&n!==void 0?n:"1")+";"},t.prototype.getBoxShadowCssStr=function(){var i,r=t._style;return"box-shadow: "+n.ColorHelper.ConvertShadow((i=r.BoxShadowString)!==null&&i!==void 0?i:"")+";"},t.prototype.getOverrideCssRule=function(){return this.getFontStatusCssStr()+this.getBorderStatusCssStr()+this.getBackgroudStatusCssStr()+this.getBorderRadiusCssStr()+this.getPaddingStatusCssStr()+this.getOpacityCssStr()+this.getBoxShadowCssStr()},t.prototype.getCssStrForSelector=function(n){return n+"{"+this.getOverrideCssRule()+"}"},t.prototype.getNormalStatusCssStr=function(){return t._style=this._styles.HeaderStyle.NormalStyle,t._isNormalStyle=!0,this.getCssStrForSelector("."+this._className+" > .nav-tabs > li > a ")},t.prototype.getHoverStatusCssStr=function(){return t._style=this._styles.HeaderStyle.HoverStyle,t._isNormalStyle=!1,this.getCssStrForSelector("."+this._className+" > .nav-tabs > li > a:hover")},t.prototype.getActiveStatusCssStr=function(){return t._style=this._styles.HeaderStyle.ActiveStyle,t._isNormalStyle=!1,this.getCssStrForSelector("."+this._className+" > .nav-tabs > li > a:active")},t.prototype.getSelectedStatusCssStr=function(){return t._style=this._styles.HeaderStyle.SelectedStyle,t._isNormalStyle=!1,this.getCssStrForSelector("."+this._className+" > .nav-tabs > li.active > a")+this.getCssStrForSelector("."+this._className+" > .nav-tabs > li.active > a:active")+this.getCssStrForSelector("."+this._className+" > .nav-tabs > li.active > a:hover")},t._pageNameCache=[],t._classNameCache=[],t._isNormalStyle=!1,t}();n.CellTypeHelper.registerCellType("Forguncy.ContentContainerCellType, ServerDesignerCommon",t);n.CellTypeHelper.registerCellType("Forguncy.TabControlCellType, ServerDesignerCommon",o)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__awaiter=this&&this.__awaiter||function(n,t,i,r){function u(n){return n instanceof i?n:new i(function(t){t(n)})}return new(i||(i=Promise))(function(i,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?i(n.value):u(n.value).then(o,s)}e((r=r.apply(n,t||[])).next())})},__generator=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=e[0]&2?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[e[0]&2,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i,e;return e={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e},Forguncy;(function(n){var r="Fgc-Listview-Selection-State-Column",f=function(f){function o(t,i,r,e){var o=f.call(this,t,i,r,e)||this;return o._runTimePageNames=[],o._hasNewRow=!1,o._suspendLoadOnDemand=!0,o._refreshSuspendCount=0,o._ignoreListviewValueChanged=!1,o._repeaterCellTypeStyleTemplateHelper=new u,o._needUpdateWaitingBlockWhenScroll=!1,o._hasError=!1,o._refreshWaitList=[],o._listviewDataID=0,o._eventTriggerID=0,o._waitingList=[],o.supportedEvents=["subpagechanged"],o._needUpdateWaitingBlockWhenScroll=n.PageManager.getPageStretchInfo(o.runTimePageName).StretchMode===4,o}return __extends(o,f),o.prototype.create=function(t){f.prototype.create.call(this,t);n.DomUtilities.setContainerOverFlow(t,this._getContainerOverflowValueStr(this.CellElement.CellType.OverflowMode))},o.prototype.needLoadOnDemand=function(){var u,f,e;if(this._suspendLoadOnDemand)return!1;var n=this.CellElement.CellType,o=n.DisplayMode===t.Vertical||n.DisplayMode===t.Flow&&n.FlowDirection===i.Row,r=0;if(o){if(u=this._scrollElement.scrollTop(),f=this.getItemsTotalLength(),u===0||f===0)return!1;r=u+this._scrollElement.height()-f}else{if(e=this._scrollElement.scrollLeft(),e===0)return!1;r=e+this._scrollElement.width()-this._scrollElement[0].scrollWidth}return r>-5?!0:!1},o.prototype.getItemsTotalLength=function(){var u,f,r,s,h,e,c,l,a,o,n,v,y;if(!this._container||(u=this._container.children(".repeater-item"),f=u.length,f<=0))return 0;r=u[f-1];s=this.CellElement.CellType;switch(s.DisplayMode){case t.Vertical:return r.offsetTop+r.offsetHeight;case t.Horizontal:return r.offsetLeft+r.offsetWidth;case t.Flow:if(s.FlowDirection===i.Column){for(h=r.offsetLeft,e=h+r.offsetWidth,n=f-2;n>=0;n--){if(c=u[n].offsetLeft,h!==c)break;l=c+u[n].offsetWidth;e<l&&(e=l)}return e}for(a=r.offsetTop,o=a+r.offsetHeight,n=f-2;n>=0;n--){if(v=u[n].offsetTop,a!==v)break;y=v+u[n].offsetHeight;o<y&&(o=y)}return o;default:return 0}},o.prototype.createContent=function(){var n=this.CellElement.CellType;return this._listviewName=n.RealListviewName,this._container=this.createContainer(n),this._container},o.prototype.getRowData=function(t){var u=n.Common.clone(this.getDefaultNewRowData()),c=this._getListData().getColumnCount(),f=this.getTemplateCellRelations(),e,i,r;if(f&&this._runTimePageNames.length>t)for(e=this._runTimePageNames[t],i=0;i<c;i++)if(r=f[i],r&&r.length!==0){var o=r[r.length-1],s=n.Common.getIdStr(o.Row,o.Column,e),h=n.ForguncyData.pageInfo.dataModel.normalCellDataModel.getValueType(s);h!==0&&h!==1&&(u[i]=n.ForguncyData.pageInfo.dataModel.normalCellDataModel.getValue(s))}return u},o.prototype.getDefaultNewRowData=function(){var r,o,t,i,u,s;if(this._defaultValues)return this._defaultValues;var f=[],h=this._getListData().getColumnCount(),e=this.getTemplateCellRelations();if(e)for(o=this._runTimePageNames[this._runTimePageNames.length-1],t=0;t<h;t++)(i=e[t],i&&i.length!==0)&&(u=i[i.length-1],s=n.Common.getIdStr(u.Row,u.Column,o),f[t]=(r=n.ForguncyData.pageInfo.pageElementManager.cells.getCell(s))===null||r===void 0?void 0:r.getDefaultValue());return this._defaultValues=f,this._defaultValues},o.prototype.initPageByMetaDataData=function(t){var f=this,r,u,i;if(t){if(t.metaData&&!t.metaDataObj&&(u=JSON.parse(t.metaData),t.metaDataObj=u),((r=t.metaDataObj)===null||r===void 0?void 0:r.Modules)&&!n.ModuleLoader.IsModuleLoaded(t.metaDataObj.Modules)){n.ModuleLoader.LoadModels(t.metaDataObj.Modules,n.ForguncyData.ForguncyRoot).done(function(){f.initPageByMetaDataData(t)});return}(i=n.MetadataHelper.createPageMetadata(t),n.MetadataHelper.checkError(i)!==!1)&&n.ForguncyData.pageInfo.pageID===this._pageID&&(this.updatePageStretchMode(i),this._templatePage=i,this._refresh(null))}},o.prototype.updatePageStretchMode=function(t){var u=n.PageManager.getPageStretchInfo(this.runTimePageName),i=t.PageSettings.PageResponsiveMode,r=i;i===0&&(r=n.Presentation.StretchCommon.getPageResponsiveMode(u.StretchMode));t.PageSettings.PageResponsiveMode=r},o.prototype.createContainer=function(r){var u=n.DomUtilities.createJqueryDomElement("div");u.attr("id",this.ID);u.css("display","flex");u.addClass("repeater-container");switch(r.DisplayMode){case t.Vertical:u.css("flex-wrap","nowrap");u.css("flex-direction","column");this.CellElement.StyleInfo.HorizontalAlignment===n.CellHorizontalAlignment.Center?u.css("align-items","center"):this.CellElement.StyleInfo.HorizontalAlignment===n.CellHorizontalAlignment.Right&&u.css("align-items","flex-end");break;case t.Horizontal:u.css("flex-wrap","nowrap");u.css("align-items","flex-start");break;case t.Flow:u.css("flex-wrap","wrap");u.css("align-content","flex-start");r.FlowDirection===i.Column?u.css("flex-direction","column"):u.css("flex-direction","row")}return u.css("height","100%"),u.css("width","100%"),this._containerDisplayMode=u.css("display"),u},o.prototype.onPageLoaded=function(){var t=this,r,u,i=this.CellElement.CellType.TemplatePageName,f;this._itemsPart=this._container;this.onFormulaResultChanged((u=(r=this.CellElement.CellType)===null||r===void 0?void 0:r.NoItemSetting)===null||u===void 0?void 0:u.TextForNoItem,function(n){t._textForNoItem=n;t.updateNoItemText()});if(n.Common.IsEmpty(i)||n.Common.IsEmpty(this._listviewName)||!this.listview){this._hasError=!0;this.updateNoItemImage();return}this._onValueChangedEventHandler=function(n,i){if(i.calcName)t.onListviewValueChanged(i);else t.onNormalCellValueChanged(i.arg)};n.ForguncyData.pageInfo.dataModel.bind("valuechanged",this._onValueChangedEventHandler);this._onCurrentRowInfoChangedEventHandler=function(n,i){t.refreshCurrentRowStyle(i.newSelectedRowIndex)};this.listview.bind("selectionchanged",this._onCurrentRowInfoChangedEventHandler);this._onSelectionChangedEventHandler=function(){t.onSelectedRowsChanged()};this.listview.bind("selectedrowschanged",this._onSelectionChangedEventHandler);this._currentRowHelper=new e(this.ID,this._container,this._pageID,this.listview);this._currentRowHelper.bind("RepeaterCurrentRowChanged",null,function(i,r){var u=t.listview,f;if(u)if(f=function(n){return!(n===-1||n===t.newRowIndex)},f(r.oldCurrentRowIndex)&&t.commitListviewRow(r.oldCurrentRowIndex),f(r.newCurrentRowIndex))u.selectRow(r.newCurrentRowIndex);else if(r.newCurrentRowIndex!==-1)if(u.getNewRowIndex()!==-1)u.selectRow(u.getNewRowIndex());else if(u instanceof n.DataSourceListview)u.onCurrentRowChanged(-1);else u.clearAllSelectedRows(),u.clearCurrentRow()});this._currentRowHelper.bind("click",null,function(i,r){if(!(r.rowIndex<0)&&r.rowIndex!==t.newRowIndex){var u=t.listview;u instanceof n.DataSourceListview||(u&&u.getCurrentRowIndex()===r.rowIndex&&(u instanceof n.HiddenListview||u.listviewData.getSelectionMode()===1)&&u.getSelectedRowsData().length===0&&u.addSelectedRow(r.rowIndex),u&&u.getCurrentRowIndex()===r.rowIndex&&u.getSelectedRowsData().length>1&&u.clearSelectionOutOfCurrentRow())}});this._scrollElement=this.getContainer();this.createSimpleBar();this._scrollElement[0].addEventListener("scroll",function(){var n;t._needUpdateWaitingBlockWhenScroll&&(t._needUpdateWaitingBlockWhenScroll=!1,t.showOrHideWaitingBlock());t.needLoadOnDemand()&&(t._suspendLoadOnDemand=!0,(n=t.listview)===null||n===void 0?void 0:n.loadOnDemand())});n.Common.IsEmpty(i)||n.Common.IsEmpty(this._listviewName)||(f=n.MetadataLoader.getMetadataFromCache(i),f?this.initPageByMetaDataData(f):n.MetadataLoader.GetPageDataRequest(i,n.ForguncyData.ForguncyRoot,n.StaticData.MetaDataVersion,!0).done(function(n){t.initPageByMetaDataData(n[i.toLowerCase()])}))},o.prototype.refreshCurrentRowStyle=function(n){var t,r,i;(this._currentRowInfo=this.listview.getListDataModel().getRowQuery(n),this._repeaterCellTypeStyleTemplateHelper.focusStyleName)&&(t=$(">.".concat("repeater-item"," >.").concat("repeater-style-item"),this._container),t.removeClass(this._repeaterCellTypeStyleTemplateHelper.focusStyleName),r=n>=0&&n<t.length,i=r?n:this.newRowIndex,i>=0&&$(t[i]).addClass(this._repeaterCellTypeStyleTemplateHelper.focusStyleName))},o.prototype.onSelectedRowsChanged=function(){var t=this.listview,n=t.getSelectedRowsIndexes();this.refreshSelectedCellsDataModel(n);this.refreshSelectedRowStyle(n)},o.prototype.refreshSelectedCellsDataModel=function(t){var r=this.getSelectedCellRelations(),u,i,f,e,o;if(r&&!(r.length<=0))try{for(this._refreshSuspendCount++,u={},i=0,f=t;i<f.length;i++)e=f[i],u[e]=1;o=n.ForguncyData.pageInfo.dataModel.normalCellDataModel;this._runTimePageNames.forEach(function(t,i){return r.forEach(function(r){var f;return o.setValue(n.Common.getIdStr(r.Row,r.Column,t),{newValue:(f=u[i])!==null&&f!==void 0?f:0,uiAction:!1},2)})})}finally{this._refreshSuspendCount--}},o.prototype.refreshSelectedRowStyle=function(n){var u=this._repeaterCellTypeStyleTemplateHelper.selectStyleName,t,i,f,r;if(u)for(t=$(">.".concat("repeater-item"," >.").concat("repeater-style-item"),this._container),t.removeClass(u),i=0,f=n;i<f.length;i++)r=f[i],r>=0&&r<t.length&&$(t[r]).addClass(u)},o.prototype.shouldValidateRow=function(){var t;return((t=n.ForguncyData.GlobalSettings)===null||t===void 0?void 0:t.TriggerTime)!==1||this.listview.GetDataCommitMode()===0},o.prototype.commitListviewRow=function(t){return __awaiter(this,void 0,void 0,function(){var i,r;return __generator(this,function(u){switch(u.label){case 0:return(i=this.listview,!this.shouldValidateRow())?[2]:[4,n.ValidationMananger.validateAllCellsAsync(!!n.ForguncyData.GlobalSettings.KeepFocusWhenDataValidationFailed,[this._runTimePageNames[t]])];case 1:return r=u.sent(),r&&(!i.listviewData.canEdit()||i.getCurrentRowIndex()===t)&&i.commitEditChange(!0,t),[2]}})})},o.prototype.onListviewValueChanged=function(n){var o=this,f,t,u,r,i,e;if(n.calcName===((f=this.listview)===null||f===void 0?void 0:f.getCalcSheetName())){if(t=n.arg,this._ignoreListviewValueChanged){this._eventTriggerID=Math.max(this._eventTriggerID,t.triggerID);return}if(u=this._eventTriggerID+1,r=t.triggerID,u<r){this._waitingList[r-u]=t;return}u>r&&(t=null);i=this._waitingList.filter(function(n){return!!n});this._waitingList=[];e=!t||t.actionType===0;this._eventTriggerID=Math.max(i.length>0?i[i.length-1].triggerID:-1,r);this._refresh(t);i.length>0&&!e&&i.forEach(function(n){return n&&o._refresh(n)})}},o.prototype.onNormalCellValueChanged=function(t){var o,i,f,u,e,s;if(!(this._refreshSuspendCount>0)&&(o=n.Common.parseIDStr(t.id),o)&&(i=this._runTimePageNames.indexOf(o.suffix),!(i<0))&&(f=n.ForguncyData.pageInfo.pageElementManager.cells.getCell(t.id),!n.Common.IsEmpty(f.templateCellSource))&&(u=this.listview,u))if(f.templateCellSource===r){if(i===this.newRowIndex)return;t.newValue===0||t.newValue===!1||n.Common.IsEmpty(t.newValue)?u.clearSelectedRow(i):u.addSelectedRow(i)}else{if(e=u.getColIndexOfNamedColumn(f.templateCellSource,!1),e===-1)return;if(i===this.newRowIndex)this.onValueChangedInNewRow(i,e,t.newValue);else s=this._getListData(),s.setValue(i,e,t.newValue,7)}},o.prototype.onValueChangedInNewRow=function(n,t,i){var r=this.getRowData(this._runTimePageNames.length-1);r[t]=i;this._ignoreListviewValueChanged=!0;try{this.listview.addNewRow(r,!1,!0,6);this.listview.selectRow(n);this.refreshDataModel(n,0,1,-1);this._hasNewRow=!1;this._refresh({cellRange:{Row:n+1,Column:-1,RowCount:0,ColumnCount:-1},oldRowCount:n,newRowCount:n+1,uiAction:!0,actionType:1,valueType:6,triggerID:-1})}finally{this._ignoreListviewValueChanged=!1}},o.prototype._refresh=function(n){if(!this._hasError){var t=this.addToRefreshList(n);t.refreshType===0&&this._listviewDataID++;this.doWaitingRefresh()}},o.prototype.addToRefreshList=function(n){var i,t={refreshType:(i=n===null||n===void 0?void 0:n.actionType)!==null&&i!==void 0?i:0,arg:n},r=this._refreshWaitList.some(function(n){return n.refreshType===0});return r?t:(t.refreshType===0?this._refreshWaitList=[t]:this._refreshWaitList.push(t),t)},o.prototype.doWaitingRefresh=function(){var r=this,t,i;if(!this._hasError&&this._refreshWaitList.length!==0&&!this._currentRefreshInfo){if(t=this._templatePage&&this._getListData(),!t){n.DelayRefresh.setTimeout(function(){r.doWaitingRefresh()},200);return}i=this._refreshWaitList.shift();this.doRefresh(i)}},o.prototype.doRefresh=function(n){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(i){switch(i.label){case 0:this._currentRefreshInfo={info:n,dataID:this._listviewDataID};t=n.refreshType;switch(t){case 0:return[3,1];case 1:return[3,3];case 4:return[3,3];case 2:return[3,5];case 3:return[3,6]}return[3,7];case 1:return[4,this._onListviewReload()];case 2:return i.sent(),[3,8];case 3:return[4,this._onListviewAddRows(n.arg)];case 4:return i.sent(),[3,8];case 5:return this._onListviewDeleteRows(n.arg),[3,8];case 6:return this._onListviewValueChanged(n.arg),[3,8];case 7:return[3,8];case 8:return this.updateSimpleBar(),this.trigger("subpagechanged",null),this._currentRefreshInfo=null,this.doWaitingRefresh(),[2]}})})},o.prototype._onListviewValueChanged=function(n){this.refreshDataModel(n.cellRange.Row,n.cellRange.Column,n.cellRange.RowCount,n.cellRange.ColumnCount)},o.prototype._onListviewAddRows=function(n){return __awaiter(this,void 0,void 0,function(){var t,i,r,u,f;return __generator(this,function(e){switch(e.label){case 0:return t=n.cellRange.Row,i=n.cellRange.RowCount,[4,this.addRows(t,i)];case 1:return(r=e.sent(),!r)?[2]:(this._suspendLoadOnDemand=!1,u=!this._hasNewRow&&this.listview.allowAddRow(),!u)?[3,3]:[4,this.addRows(null,1)];case 2:if(f=e.sent(),!f)return[2];this._hasNewRow=!0;e.label=3;case 3:return this.showHelpImagePart(),this.refreshDataModel(t,0,i,-1),this.onSelectedRowsChanged(),[2]}})})},o.prototype._onListviewDeleteRows=function(n){this.deleteRows(n.deleteRow,1);this.showHelpImagePart();this.onSelectedRowsChanged()},o.prototype.needScrollToTop=function(t){for(var r=t.getRowCount(),i=0;i<r;i++)if(n.Common.isQueryEqual(t.getRowQuery(i),this._currentRowInfo))return!1;return!0},o.prototype._onListviewReload=function(){return __awaiter(this,void 0,void 0,function(){var n,f,t,i,u,r,e,o,s;return __generator(this,function(h){switch(h.label){case 0:return(this._hasNewRow=this.listview.allowAddRow(),n=this._runTimePageNames.length,f=this._getListData(),t=f.getRowCount()+(this._hasNewRow?1:0),i=this.needScrollToTop(f),!(n>t))?[3,1]:(this.deleteRows(t,n-t),this.refreshDataModel(0,0,t,-1,!0),this.clearBackgroundImageInNewRow(),i&&this.resetScroll(),[3,5]);case 1:n&&this.refreshDataModel(0,0,n,-1,!0);u=t-n;r=Math.max(10,this.getFirstTimeLoadCount());e=n;h.label=2;case 2:return(u>0)?(o=Math.min(r,u),[4,this.addRows(null,o,25)]):[3,4];case 3:return(s=h.sent(),!s)?[2]:(this.refreshDataModel(e,0,o,-1),u-=r,e+=r,r=50,i&&(this.resetScroll(),this.hideNoItemImage(),this.hideWaitingBlock(),i=!1),[3,2]);case 4:i&&(this.resetScroll(),i=!1);h.label=5;case 5:return this._suspendLoadOnDemand=!1,this.refreshCurrentRowStyle(this.listview.getCurrentRowIndex()),this.refreshSelectedRowStyle(this.listview.getSelectedRowsIndexes()),this.showHelpImagePart(),[2]}})})},o.prototype.getFirstTimeLoadCount=function(){var n,i,r,u,f=this._container.width(),e=this._container.height(),o=(i=(n=this._templatePage)===null||n===void 0?void 0:n.PageSettings)===null||i===void 0?void 0:i.Width,s=(u=(r=this._templatePage)===null||r===void 0?void 0:r.PageSettings)===null||u===void 0?void 0:u.Height;if(f>0&&e>0&&s>0&&o>0)switch(this.CellElement.CellType.DisplayMode){case t.Horizontal:return Math.ceil(f/o);case t.Vertical:return Math.ceil(e/s);case t.Flow:return Math.ceil(f/o)*Math.ceil(e/s)}return 10},o.prototype.resetScroll=function(){var n=this.getScrollContentContainer();n.scrollTop(0);n.scrollLeft(0)},o.prototype.showHelpImagePart=function(){this.updateNoItemImage();this.showOrHideWaitingBlock()},o.prototype.updateNoItemImage=function(){var i=this,t;if(!n.ForguncyData.IsAutoTest){if(!n.PageBuilder.pageTotallyLoaded){setTimeout(function(){i.updateNoItemImage()},200);return}if(t=n.ForguncyData.pageInfo.pageElementManager.cells.getContainerCell(this.runTimePageName),(t===null||t===void 0?void 0:t.cellType)&&t.cellType instanceof n.SinglePageContainerCellType&&t.cellType.isLoading(this.runTimePageName)){setTimeout(function(){i.updateNoItemImage()},200);return}}this.needShowNoItemImage()?this.showNoItemImage():this.hideNoItemImage()},o.prototype.needShowNoItemImage=function(){return n.Common.needShowNoItemImage(this.CellElement.CellType.NoItemSetting,this._runTimePageNames.length)},o.prototype.showNoItemImage=function(){var i=this.CellElement.CellType.NoItemSetting,r=this._getDomCreateInfo(),t=n.Common.updateNoItemSettingToDom(i,this.getContainer(),r,this.noItemTextID,this._textForNoItem,this.ID,this.CellElement,this._noItemPart,this._itemsPart);this._noItemPart=t._noItemPart;this._itemsPart=t._itemsPart},o.prototype.hideNoItemImage=function(){this._noItemPart&&(this._noItemPart.css("display","none"),this._itemsPart.css("display",this._containerDisplayMode))},o.prototype._getPartsUseFontStyle=function(){var n=this._noItemPart;return n&&(n=n.add(n.find("#"+this.noItemTextID))),n},Object.defineProperty(o.prototype,"noItemTextID",{get:function(){return this.ID+"_noItemText"},enumerable:!1,configurable:!0}),o.prototype.updateNoItemText=function(){this._noItemPart&&this._noItemPart.find("#"+this.noItemTextID).text(this._textForNoItem)},o.prototype.getScrollContentContainer=function(){return this._scrollContent||this.getContainer()},o.prototype.createSimpleBar=function(){var t=this.CellElement.CellType;t.OverflowMode===1&&(this._simpleBar||(this._simpleBar=n.DomUtilities.applySimpleBar(this.getContainer()),this._simpleBar&&(this._scrollElement=$(this._simpleBar.getScrollElement()),this._scrollContent=$(this._simpleBar.getContentElement()),this._itemsPart=this.getContainer().find(".simplebar-wrapper"),this.updateContainerForSimplebar())))},o.prototype.updateSimpleBar=function(){var n;(n=this._simpleBar)===null||n===void 0?void 0:n.recalculate()},o.prototype.showOrHideWaitingBlock=function(){this._templatePage&&(this.needShowWaitingBlock()?this.showWaitingBlock():this.hideWaitingBlock())},o.prototype.needShowWaitingBlock=function(){var n,i=this.CellElement.CellType;if(i.OverflowMode!==1||!((n=this.listview)===null||n===void 0?void 0:n.allowLoadOnDemand()))return!1;switch(i.DisplayMode){case t.Flow:return!1;case t.Vertical:if(this.getContainer().height()>=this.getItemsTotalLength())return!1;break;case t.Horizontal:if(this.getContainer().width()>=this.getItemsTotalLength())return!1;break;default:return!1}return!0},o.prototype.showWaitingBlock=function(){var r=this.CellElement.CellType,i;this._waitingBlock||(i=n.DomUtilities.createJqueryDomElement("div"),i.css("background-image",'url("'+n.ForguncyData.ForguncyRoot+'Resources/Images/SiteBuiltInImages/fgc_loading.gif")'),i.attr("id",this.ID+"wait"),i.css("background-repeat","no-repeat"),i.css("background-position-x","50%"),i.css("background-position-y","50%"),i.css("flex-shrink","0"),r.DisplayMode===t.Vertical?(i.css("width","100%"),i.css("height","30px")):r.DisplayMode===t.Horizontal?(i.css("width","30px"),i.css("height","100%")):i.css("width","30px"),this._waitingBlock=i);this._container.append(this._waitingBlock);this._waitingBlock.css("display","block")},o.prototype.hideWaitingBlock=function(){this._waitingBlock&&this._waitingBlock.css("display","none")},o.prototype.addRows=function(n,t,i){return i===void 0&&(i=50),__awaiter(this,void 0,void 0,function(){var r=this;return __generator(this,function(){return[2,new Promise(function(u){r.addSomeRowsEachTime(n,t,i,function(n){u(n)})})]})})},o.prototype.addSomeRowsEachTime=function(t,i,r,u){var o=this,f,e;if(!this._currentRefreshInfo||this._currentRefreshInfo.dataID!==this._listviewDataID){u(!1);return}f=Math.min(i,r);this._refreshSuspendCount++;try{for(e=0;e<f;e++)this.addOneRow(t===null?null:t+e)}finally{this._refreshSuspendCount--}i-=f;i>0?n.DelayRefresh.setTimeout(function(){o.addSomeRowsEachTime(t===null?null:t+f,i,r,u)}):u(!0)},o.prototype.addOneRow=function(t){var nt=this,h,c,l,a,v,y,p,w,tt=n.PageManager.getUniquePageName(),r=tt.runTimeNormalPageName,b=tt.runTimeMasterPageName,f=n.Common.clone(this._templatePage),rt=new n.ForguncyDataSetter(f,n.ForguncyData.pageInfo,r,b,3),e,i,k,d,g;if(rt.setPageInfoByMetadata(),e=n.Presentation.PageContentCreator.create(f,r,b,2),e.css("flex-shrink",0),e.css("background-color",""),i=this.adjustSubPageDivForStretch(e,f.PageSettings.Width,f.PageSettings.Height,r),this.CellElement.StyleTemplate){this._repeaterCellTypeStyleTemplateHelper.ApplyTemplateStyle(this.CellElement.StyleTemplate,i,this.validateError);i.addClass("repeater-style-item");var u=n.DomUtilities.createJqueryDomElement("div"),o=this.CellElement.StyleTemplate.Styles.TEMPLATE.NormalStyle,it=((h=o.MarginLeft)!==null&&h!==void 0?h:0)+((c=o.MarginRight)!==null&&c!==void 0?c:0);i.css("min-width")==="100%"&&(it&&i.css("min-width","calc(100% - ".concat(it,"px)")),u.css("min-width","100%"));k=((l=o.MarginTop)!==null&&l!==void 0?l:0)+((a=o.MarginBottom)!==null&&a!==void 0?a:0);i.css("min-height")==="100%"&&(k&&i.css("min-height","calc(100% - ".concat(k,"px)")),u.css("min-height","100%"));d=i.css("width")+"";d.endsWith("%")&&(i.css("width",""),u.css("width",d));g=i.css("height")+"";g.endsWith("%")&&(i.css("height",""),u.css("height",g));u.append(i);i=u}i.addClass("repeater-item");var s=this.CellElement.CellType,ut=((v=s.Command)===null||v===void 0?void 0:v.Commands)&&((y=s.Command)===null||y===void 0?void 0:y.Commands.length)!==0,ft=((p=s.DblCommand)===null||p===void 0?void 0:p.Commands)&&((w=s.DblCommand)===null||w===void 0?void 0:w.Commands.length)!==0;if(ut||ft){i.addClass("repeater-item-command");i.addClass("fgc-clickHandler");i.on("click dblclick",function(n){var t=$(n.target),i;if(t.hasClass("repeater-item-command")){i=nt._container.children("div.repeater-item").index(t[0]);nt.onClickOrDblClickRepeaterItem(i,n.type==="click")}})}n.Common.IsEmpty(t)||t>=this._runTimePageNames.length?(this._container.append(i),this._runTimePageNames.push(r)):(i.insertBefore($(this._container.children(".repeater-item")[t])),this._runTimePageNames.splice(t,0,r));n.PageBuilder.onLoad([r]);n.ForguncyData.pageInfo.pageElementManager.initCellDefaultValue([r]);n.ForguncyData.pageInfo.formulaManager.init(f,n.ForguncyData.pageInfo.dataModel,r,b,null,null);n.ForguncyData.pageInfo.pageElementManager.onDefaultDataSetted([r]);if(n.PageBuilder.hasCallOnPageLoaded){n.PageBuilder.onPageLoaded([r]);n.PageBuilder.fillAllListviewData([r]);n.PageBuilder.delayFillAllListviewData([r])}},o.prototype.onClickOrDblClickRepeaterItem=function(n,t){var r,i,u,e,o;t===void 0&&(t=!0);this.updateCurrentRowIndex(n);var s=n===this.newRowIndex?this.getDefaultNewRowData():this.listview.getRowValue(n),h=this.listview.listviewData.getColumnCount(),f={};for(i=0;i<h;i++)(u=this.listview.listviewData.columnDataInfos[i],u.columnName)&&(f[u.columnName]=(r=s[i])!==null&&r!==void 0?r:null);e=t?this.CellElement.CellType.Command:this.CellElement.CellType.DblCommand;o=t?"click":"dblclick";this.executeCustomCommandObjectWithID(e,f,o,null,this.ID+"_"+n)},o.prototype.adjustSubPageDivForStretch=function(t,i,r,u){var f=n.PageManager.getPageStretchInfo(u),e;f.StretchMode===4&&(e=$(document.createElement("div")).addClass("repeater-item-wrapper"),e.css("position","relative"),t.css("position","absolute"),t.css("left","0"),t.css("top","0"),t.css("right","0"),t.css("bottom","0"),t.css("width",""),t.css("height",""),e.append(t),t=e);var h=n.Presentation.StretchCommon.canHorizontallyStretch(f.StretchMode),c=n.Presentation.StretchCommon.canVerticallyStretch(f.StretchMode),o=this.CellElement.Width||this.CellElement.FullWidth,s=this.CellElement.Height||this.CellElement.FullHeight;return h&&o>0&&(t.css("width",i*100/o+"%"),t.css("min-width",i)),c&&(f.StretchMode===4?o>0&&(t.css("height",0),t.css("padding-bottom",r*100/o+"%"),t.css("min-height",r)):s>0&&(t.css("height",r*100/s+"%"),t.css("min-height",r))),t},o.prototype.deleteRows=function(n,t){for(var r=this._container.children(".repeater-item"),i=0;i<t;i++)this.deleteOneRow(n+t-i-1,r)},o.prototype.deleteOneRow=function(t,i){var r=this._runTimePageNames[t];n.Common.IsEmpty(r)||(n.SubPageHelper.destroySubPage(r),$(i[t]).off("click"),$(i[t]).remove(),this._runTimePageNames.splice(t,1))},Object.defineProperty(o.prototype,"listview",{get:function(){return this._listview||(this._listview=n.ListviewBase.getListview(this._listviewName,this.runTimePageName)),this._listview},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"newRowIndex",{get:function(){return this._hasNewRow?this._runTimePageNames.length-1:-1},enumerable:!1,configurable:!0}),o.prototype._getListData=function(){return n.ForguncyData.pageInfo.dataModel.getListDataByListviewName(this._listviewName,this.runTimePageName)},o.prototype.getClearValueInfo=function(){var t={},i=this._runTimePageNames,u=this.getFormulaCells(),f=n.ForguncyData.pageInfo.dataModel.normalCellDataModel;return n.ForguncyData.pageInfo.pageElementManager.cells.getAllCells(i).forEach(function(n){if(n.templateCellSource!==r&&!u[n.row+","+n.column]&&f.getValueType(n.id)!==1){var i=n.getDefaultValue();t[n.id]={value:i===undefined?null:i,valueType:1}}}),t},o.prototype.refreshDataModel=function(n,t,i,r,u){r===void 0&&(r=-1);u===void 0&&(u=!1);this._refreshSuspendCount++;try{if(i!==0&&r!==0){var e=this._getListData(),o=Math.min(this._runTimePageNames.length,this._getListData().getRowCount()),s=e.getColumnCount(),h=o-n,f=s-t;i=Math.min(i,h);r=r===-1?f:Math.min(r,f)}(i>0&&r>0||u)&&this.refreshDataModelForCells(n,t,i,r,u);i>0&&r>0&&this.refreshDataModelForBackgroundImages(n,t,i,r)}finally{this._refreshSuspendCount--}},o.prototype.refreshDataModelForCells=function(t,i,r,u,f){var e=this.getUpdateValueInfo(t,i,r,u,f),s,o;if(Object.keys(e).length!==0){this.suspendBindingCombobox(t,r);s=n.ForguncyData.pageInfo.dataModel.normalCellDataModel;for(o in e)s.setValue(o,{newValue:e[o].value,uiAction:!1},e[o].valueType);this.cacheComboboxText(t,r)}},o.prototype.getUpdateValueInfo=function(t,i,r,u,f){var s=f?this.getClearValueInfo():{},c=this.getTemplateCellRelations(),l,e,h,a,v,o;if(!c||r===0||u===0)return s;for(l=this._getListData(),e=i;e<i+u;e++)if(h=c[e],h)for(a=function(t){var i=l.getValue(t,e),r=v._runTimePageNames[t];h.forEach(function(t){var u=n.Common.getIdStr(t.Row,t.Column,r);s[u]={value:i,valueType:2}})},v=this,o=t;o<t+r;o++)a(o);return s},o.prototype.suspendBindingCombobox=function(n,t){var i=this.getInfoOfComboboxNeedCacheText();i.length!==0&&this.enumComboboxCells(i,n,t,function(n){return n.suspendPaint()})},o.prototype.cacheComboboxText=function(t,i){var e=this,r=this.getInfoOfComboboxNeedCacheText(),u,f;if(r.length!==0){if(u=function(){e.enumComboboxCells(r,t,i,function(n){return n.resumePaint()})},f=this.createMultiComboBindingOptionsParam(t,i,r),!f){u();return}n.TableColumnsCacheManager.cacheComboboxText(f,u)}},o.prototype.enumComboboxCells=function(t,i,r,u){var f=this;t.forEach(function(t){for(var e=i;e<i+r;e++){var s=f._runTimePageNames[e],h=n.Common.getIdStr(t.cellLocation.Row,t.cellLocation.Row,s),o=n.ForguncyData.pageInfo.pageElementManager.cells.getCell(h);o&&u(o)}})},o.prototype.createMultiComboBindingOptionsParam=function(n,t,i){for(var r,s,u,f,e=[],h=[],o=0,c=i;o<c.length;o++)(r=c[o],s=this.getQueryAndValuesOfCombobox(n,t,r),s.length!==0)&&(h.push(r.cacheKey),e.push({lookupColumnBindingInfo:(u=r.metaData.ValueColumnBindingInfo)===null||u===void 0?void 0:u.GUID,resultColumnBindingInfo:(f=r.metaData.DisplayColumnBindingInfo)===null||f===void 0?void 0:f.GUID,queryAndValues:s}));return e.length===0?null:{pageName:i[0].pageName,data:e,cacheKeys:h}},o.prototype.getQueryAndValuesOfCombobox=function(t,i,r){for(var s=n.ForguncyData.pageInfo.dataModel.normalCellDataModel,f=[],e=[],u=t;u<t+i;u++){var o=this._runTimePageNames[u],h=n.Common.getIdStr(r.cellLocation.Row,r.cellLocation.Column,o),c=s.getValue(h),l=n.ConditionHelper.getComputedSqlConditionFormula(r.metaData.ItemsQuery,o,r.metaData.NullFormulaValueQueryPolicy);f.push(c);e.push(l)}return n.TableColumnsCacheManager.getQueryAndValuesOfCombobox(f,e,r.metaData,r.cacheKey)},o.prototype.getInfoOfComboboxNeedCacheText=function(){var f,t,i,u;if(this._comboboxCacheTextInfo)return this._comboboxCacheTextInfo;if(this._runTimePageNames.length===0)return[];for(f=n.ForguncyData.pageInfo.pageElementManager.cells.getAllCells([this._runTimePageNames[0]]),t=[],i=0,u=f;i<u.length;i++){var r=u[i],e=r.cellType.CellElement.CellType,o=n.TableColumnsCacheManager.getBindingValueCacheKey(e);o&&t.push({cellLocation:{Row:r.row,Column:r.column},metaData:e,cacheKey:o,pageName:r.designerPageName})}return this._comboboxCacheTextInfo=t,t},o.prototype.refreshDataModelForBackgroundImages=function(t,i,r,u){var s=this.getRelatedBackgroundImages(),h,f,o,c,l,e;if(s)for(h=this._getListData(),f=i;f<i+u;f++)if(o=s[f],o)for(c=function(t){var i=h.getValue(t,f),r=l._runTimePageNames[t];o.forEach(function(t){return n.ForguncyData.pageInfo.pageElementManager.backgroundImages.list.filter(function(n){return n.name===t&&n.runTimePageName===r}).forEach(function(n){return n.changePicture(i)})})},l=this,e=t;e<t+r;e++)c(e)},o.prototype.clearBackgroundImageInNewRow=function(){if(this._hasNewRow){var t=this._runTimePageNames[this._runTimePageNames.length-1];n.ForguncyData.pageInfo.pageElementManager.backgroundImages.list.filter(function(n){return n.relatedColumn&&n.runTimePageName===t}).forEach(function(n){return n.changePicture(null)})}},o.prototype.getTemplateCellRelations=function(){if(this._templateCellRelations)return this._templateCellRelations;var n=this.cacheCellRelations();return n?this._templateCellRelations:null},o.prototype.getSelectedCellRelations=function(){if(this._selectedCellRelations)return this._selectedCellRelations;var n=this.cacheCellRelations();return n?this._selectedCellRelations:null},o.prototype.cacheCellRelations=function(){var i;if(this._runTimePageNames.length===0||(i=this.listview,!i))return!1;var f=this.getFormulaCells(),e=n.ForguncyData.pageInfo.pageElementManager.cells.getAllCells([this._runTimePageNames[0]]),t=[],u=[];return e.forEach(function(e){var s,o;if(!n.Common.IsEmpty(e.templateCellSource)){if(s={Row:e.row,Column:e.column},e.templateCellSource===r){u.push(s);return}f[e.row+","+e.column]||(o=i.getColIndexOfNamedColumn(e.templateCellSource,!1),o!==-1)&&(t[o]||(t[o]=[]),t[o].push({Row:e.row,Column:e.column}))}}),this._templateCellRelations=t,this._selectedCellRelations=u,!0},o.prototype.getRelatedBackgroundImages=function(){if(this._relatedBackgroundImages)return this._relatedBackgroundImages;var n=this.cacheRelatedBackgroundImages();return n?this._relatedBackgroundImages:null},o.prototype.getFormulaCells=function(){var u,t,f,n,i,r;if(!((u=this._templatePage)===null||u===void 0?void 0:u.FormulaInfos))return{};if(!this._formulaCells)for(this._formulaCells={},t=0,f=this._templatePage.FormulaInfos[""];t<f.length;t++)if(n=f[t],n.RowCount===0||n.ColumnCount===0)this._formulaCells[n.RowIndex+","+n.ColumnIndex]=!0;else for(i=0;i<n.RowCount;i++)for(r=0;r<n.ColumnCount;r++)this._formulaCells[n.RowIndex+i+","+(n.ColumnIndex+r)]=!0;return this._formulaCells},o.prototype.cacheRelatedBackgroundImages=function(){var u=this,i,r,t;return this._runTimePageNames.length===0?!1:(i=this.listview,!i)?!1:(r=n.ForguncyData.pageInfo.pageElementManager.backgroundImages.list.filter(function(n){return n.runTimePageName===u._runTimePageNames[0]}),t=[],r.forEach(function(r){if(!n.Common.IsEmpty(r.relatedColumn)){var u=i.getColIndexOfNamedColumn(r.relatedColumn,!1);u!==-1&&(t[u]||(t[u]=[]),t[u].push(r.name))}}),this._relatedBackgroundImages=t,!0)},o.prototype.destroy=function(){this._onValueChangedEventHandler&&(n.ForguncyData.pageInfo.dataModel.unbind("valuechanged",this._onValueChangedEventHandler),this._onValueChangedEventHandler=null);this._onCurrentRowInfoChangedEventHandler&&(this.listview.unbind("selectionchanged",this._onCurrentRowInfoChangedEventHandler),this._onCurrentRowInfoChangedEventHandler=null);this._onSelectionChangedEventHandler&&(this.listview.unbind("selectedrowschanged",this._onSelectionChangedEventHandler),this._onSelectionChangedEventHandler=null);this._currentRowHelper&&(this._currentRowHelper.destroy(),this._currentRowHelper=null);this.getContainer().empty();this._container=null;this._itemsPart=null;this._waitingBlock=null;this._noItemPart=null;this._simpleBar=null},o.prototype.containRunTimePage=function(n){return this._runTimePageNames.indexOf(n)>=0},o.prototype.getDesignerPageName=function(n){return this.containRunTimePage(n)&&this._templatePage?this._templatePage.PageSettings.Name:null},o.prototype.getDesignerPageTitle=function(n){return this.containRunTimePage(n)&&this._templatePage?this._templatePage.PageSettings.Title:null},o.prototype.getRunTimePageName=function(n){return this._templatePage&&this._templatePage.pageName===n&&this._runTimePageNames.length>0?this._runTimePageNames[0]:null},o.prototype.getTabIndex=function(n){return this._runTimePageNames.indexOf(n)},o.prototype.getAllRunTimePageNames=function(){return this._runTimePageNames},o.prototype.getDirectRunTimePageNames=function(){return this._runTimePageNames},o.prototype.getNewRowRunTimePageName=function(){return this._hasNewRow?this._runTimePageNames[this._runTimePageNames.length-1]:null},o.prototype.getTemplateRowCount=function(){return this._templatePage?this._templatePage.PageSettings.RowCount:0},o.prototype.getTemplateColumnCount=function(){return this._templatePage?this._templatePage.PageSettings.ColumnCount:0},o.prototype.getAdditionalRowInfo=function(n){var i=this.getTabIndex(n),t;return i===-1?null:(t=this.listview,t===null)?null:t.isGroupMode()?null:t.getRowInfo(i)},o.prototype.updateCurrentRowIndex=function(n){this._currentRowHelper&&this._currentRowHelper.updateCurrentRowIndex(n)},o.prototype.onWindowResized=function(){f.prototype.onWindowResized.call(this);this.showOrHideWaitingBlock();this.updateSimpleBar();var n=this.CellElement.CellType;n.OverflowMode===1&&this._simpleBar&&this.updateContainerForSimplebar()},o.prototype.destroyAllPages=function(){this._runTimePageNames.forEach(function(t){n.SubPageHelper.destroySubPage(t)})},o}(n.ContainerCellTypeBase),u,t,i,e;n.RepeaterCellType=f;u=function(t){function i(){var n=t.call(this)||this;return n.CellTypeString="Forguncy.RepeaterCellType",n.TemplateNameParts=["TEMPLATE"],n}return __extends(i,t),i.prototype.MapPartsNameToDom=function(n){return{TEMPLATE:n}},i.prototype.OnTemplateStyleApplied=function(t,i){if(i){if(t.Styles.TEMPLATE.FocusStyle){var r=t.Key,u=n.CellTypeStyleTemplateUtils.FormatTemplateStyleClassName(this.CellTypeString,r,"TEMPLATE");this.focusStyleName=u+"-focus"}t.Styles.TEMPLATE.SelectedStyle&&(this.selectStyleName="selected")}},i.prototype.Clear=function(){t.prototype.Clear.call(this)},i}(n.CellTypeStyleTemplateHelperBase);n.RepeaterCellTypeStyleTemplateHelper=u,function(n){n[n.Vertical=0]="Vertical";n[n.Horizontal=1]="Horizontal";n[n.Flow=2]="Flow"}(t||(t={})),function(n){n[n.Row=0]="Row";n[n.Column=1]="Column"}(i||(i={}));e=function(t){function i(n,i,r,u){var f=t.call(this)||this;f._id=n;f._container=i;f._pageID=r;f._listview=u;f._currentRowIndex=-1;f._focusInEventName="focusin "+f._pageID+"repeater"+f._id;f._clickEventName="click "+f._pageID+"repeater"+f._id;f._focusInEventHandler=function(){f.onCurrentElementChanged(document.activeElement)};f._clickEventHandler=function(n){f.onCurrentElementChanged(n.target)};$(document).on(f._focusInEventName,f._focusInEventHandler);$(document).on(f._clickEventName,f._clickEventHandler);return f._onCurrentRowChangedEventHandler=function(n,t){f._currentRowIndex!==-1&&(f._currentRowIndex=t.newSelectedRowIndex)},f._listview.bind("selectionchanged",f._onCurrentRowChangedEventHandler),f}return __extends(i,t),i.prototype.onCurrentElementChanged=function(t){var r=$(t),e,o,f,u,s,i;if(this._pageID===n.ForguncyData.pageInfo.pageID){if(e=$("#pageWrapper_"+this._pageID),e[0]===t){this.updateCurrentRowIndex(-1);return}if(e.has(t).length===0){r.parents("#pagesContainer").length===1&&this.updateCurrentRowIndex(-1);return}if(this._container[0]===t){this.updateCurrentRowIndex(-1);return}if(t.id!==this._id+"wait"){for(o=r.parents(),i=0;i<o.length;i++)if($(o[i]).attr("fgcname")==="Fgc-Listview-Selection-State-Column")return;if(f=-1,this._container.has(t).length>0)for(u=r.parents("div.repeater-item"),r.hasClass("repeater-item")&&(u=u.add(r)),s=this._container.children("div.repeater-item"),i=0;i<u.length;i++)if(f=s.index(u[i]),f!==-1)break;this.updateCurrentRowIndex(f)}}},i.prototype.updateCurrentRowIndex=function(n){if(this.trigger("click",{rowIndex:n}),this._currentRowIndex!==n){var t=this._currentRowIndex;this._currentRowIndex=n;this.trigger("RepeaterCurrentRowChanged",{newCurrentRowIndex:n,oldCurrentRowIndex:t})}},i.prototype.destroy=function(){$(document).off(this._focusInEventName,this._focusInEventHandler);$(document).off(this._clickEventName,this._clickEventHandler);this._listview.unbind("selectionchanged",this._onCurrentRowChangedEventHandler);this._focusInEventHandler=null;this._clickEventHandler=null;this._onCurrentRowChangedEventHandler=null;this._listview=null;this._container=null},i}(n.EventClassBase);n.CellTypeHelper.registerCellType("Forguncy.RepeaterCellType, ServerDesignerCommon",f)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var r=GC.Spread.CalcEngine,t,i;n.UserControl_ValueBindingPropertyName="Fgc-UC-TwoWayBinding-Value-Column";t=function(t){function r(n,i,r,u){var f=t.call(this,n,i,r,u)||this;return f._propertyValues={},f._propertyRefers={},f._definedPropertyNames=[],f._privatePropertyNames=[],f.index=0,f.supportedEvents=["loaded","pagedefaultdataloaded","subpagechanged"],f}return __extends(r,t),r.prototype.getDefaultPageName=function(){return this.CellElement.CellType.UserControlPageName},r.prototype.isUserControl=function(){return!0},r.prototype.setValueToElement=function(t,i){var r,f,e,u,o,s;if(this.subPageInfos)for(r=0,f=this.subPageInfos;r<f.length;r++)if(e=f[r],e)for(u=0,o=e.childrens;u<o.length;u++)s=o[u],s.isUserControlTwoWayBindingCell()&&n.ForguncyData.pageInfo.dataModel.normalCellDataModel.setValue(s.id,{newValue:i,uiAction:!1},2)},r.prototype.InitDefaultDataAndModels=function(t,i){var k=this,s,h,c,l,r,u,f,a,e,v,p,w,o,y,b;if(this._definedPropertyNames=(h=(s=t.PageSettings.PropertyDefinitions)===null||s===void 0?void 0:s.map(function(n){return n.Name}))!==null&&h!==void 0?h:[],this._privatePropertyNames=(l=(c=t.PageSettings.PropertyDefinitions)===null||c===void 0?void 0:c.filter(function(n){return n.IsPrivate}).map(function(n){return n.Name}))!==null&&l!==void 0?l:[],this._definedMethod=t.PageSettings.MethodDefinitions,this.initPropertyRefers(),r=this.CellElement.CellType,u={},r.PropertyValues&&r.PropertyValues.length>0)for(f=0,a=r.PropertyValues;f<a.length;f++)e=a[f],this._privatePropertyNames.indexOf(e.Name)<0&&(u[e.Name]=this.evaluateFormula(e.Value));if(v=n.ForguncyData.pageInfo.dataModel.normalCellDataModel.getValue(this.ID),n.Common.IsEmpty(v)||(u[n.UserControl_ValueBindingPropertyName]=v),n.PageBuilder.initDefaultDataAndModels(t,i.runTimeNormalPageName,i.runTimeMasterPageName,{templateSourceDefaultValue:u,subPages:this.subPageInfos,definedProperties:this._definedPropertyNames,userControlCellType:this}),r.PropertyValues)for(p=function(t){w.onFormulaResultChanged(t.Value,function(i){n.DelayRefresh.setTimeout(function(){k.onPropertyChanged(t.Name,i,!1,4)},0)},!1)},w=this,o=0,y=r.PropertyValues;o<y.length;o++)b=y[o],p(b)},r.prototype.onPropertyChanged=function(t,i,r,u){var c,l,w=this._propertyValues[t],a,b,s,v,y,h,p,f,e,o;if(!n.Common.isFuzzyEquals(i,w)){for(this._propertyValues[t]=i,((c=this.subPageInfos[0])===null||c===void 0?void 0:c.runTimeNormalPageName)&&(a=n.ForguncyData.pageInfo.formulaManager.getCalcSource((l=this.subPageInfos[0])===null||l===void 0?void 0:l.runTimeNormalPageName),a instanceof n.PageCalcSource&&a.setUserControlCustomName(t,i)),b=this.getChildrenCells(),s=0,v=b;s<v.length;s++)y=v[s],y.templateCellSource===t&&n.ForguncyData.pageInfo.dataModel.normalCellDataModel.setValue(y.id,{newValue:i,uiAction:r},u);if(t!==n.UserControl_ValueBindingPropertyName)for(h=0,p=this.subPageInfos;h<p.length;h++)if(f=p[h],f.propertyValueChangedCommand){if(e={},e[f.propertyValueChangedCommand.ParamProperties.propertyName]=t,e[f.propertyValueChangedCommand.ParamProperties.oldValue]=w,e[f.propertyValueChangedCommand.ParamProperties.newValue]=i,o=f.propertyValueChangedCommand,!o||!o.Commands||o.Commands.length<=0)return;this.subPageInfos&&this.subPageInfos[0]&&this.subPageInfos[0].runTimeNormalPageName&&n.ForguncyData.commandExecutor.executeCommand(o.Commands,{runTimePageName:f.runTimeNormalPageName,commandTrigger:this,commandID:this.ID+"-"+(this.index++).toString(),eventType:"propertyChanged",initParams:e,locationString:n.FormulaHelper.getCellLogLocationString(this.ID,this.Name,this.runTimePageName)})}}},r.prototype.addCommandsToCurrentExecuteList=function(t,i){var u,f,r,e;this.CellElement.CellType.CommandHandlers&&(r=this.CellElement.CellType.CommandHandlers.find(function(n){return n.CommandName===t}),((f=(u=r===null||r===void 0?void 0:r.Commands)===null||u===void 0?void 0:u.Commands)===null||f===void 0?void 0:f.length)&&(e=r.Commands.Commands,n.ForguncyData.commandExecutor.insertCommandsToCurrentExecutingList(e,this.runTimePageName,i)))},r.prototype.getMethodDefinition=function(n){return this._definedMethod.find(function(t){return t.Name==n})},r.prototype.addMethodToCurrentExecuteList=function(t,i,r,u,f){var s,o=this.getMethodDefinition(t),h,e;((s=o===null||o===void 0?void 0:o.Commands)===null||s===void 0?void 0:s.length)&&(h=o.Commands,e=new n.CommandMethodTerminateParam,e.ResultErrorCodeTo=u,e.ResultMessageTo=f,r&&(e.ReturnPropertiesTo=Object.keys(r).map(function(n){return{Name:n,ResultTo:r[n]}})),n.ForguncyData.commandExecutor.insertCommandsToCurrentExecutingList(h.concat(e),this.subPageInfos[0].runTimeNormalPageName,i,!0))},r.prototype.GetSinglePropertyValue=function(n,t){t===void 0&&(t=!1);var i=this._propertyValues[n];return i===undefined&&this._definedPropertyNames.indexOf(n)>=0&&(i=null),t||this._privatePropertyNames.indexOf(n)===-1||(i=null),{Result:i}},r.prototype.getMethodLogText=function(t,i){var u=this,f,e,s,o;if(t===r.prototype.SetPropertyValue&&i.length>0)return f=i[0],f.$values.map(function(t){return u._definedPropertyNames.indexOf(t.PropertyName)<0?"{".concat(n.Common.format(n.RS.CannotFindProperty,u._pageName,t.PropertyName),"}"):u._privatePropertyNames.indexOf(t.PropertyName)!==-1?"{".concat(n.Common.format(n.RS.CannotSetPrivateProperty,u._pageName,t.PropertyName),"}"):"{".concat(t.PropertyName," = ").concat(u.evaluateFormula(t.PropertyValue),"}")}).join(", ");if(t===r.prototype.GetPropertyValue&&i.length>0)return f=i[0],f.$values.map(function(t){return u._definedPropertyNames.indexOf(t.PropertyName)<0?"{".concat(n.Common.format(n.RS.CannotFindProperty,u._pageName,t.PropertyName),"}"):u._privatePropertyNames.indexOf(t.PropertyName)!==-1?"{".concat(n.Common.format(n.RS.CannotGetPrivateProperty,u._pageName,t.PropertyName),"}"):"{".concat(t.PropertyName," = ").concat(u.GetSinglePropertyValue(t.PropertyName).Result,"}")}).join(", ");if(t===r.prototype.SetUserControlPage&&i.length>1){if(e=i[0],!e)return"";if(s=i[1],o=s.$values.map(function(n){return"{".concat(n.Name," = ").concat(u.evaluateFormula(n.Value),"}")}).join(", "),e&&o.length>0)return"".concat(e,": ").concat(o)}return""},r.prototype.GetUserControlPageName=function(){return this._pageName},r.prototype.GetPropertyValue=function(n){var i=this,t={};return n.$values.forEach(function(n){t[n.PropertyName]=i.GetSinglePropertyValue(n.PropertyName).Result}),t},r.prototype.SetSinglePropertyValue=function(n,t,i){if((i===void 0&&(i=!1),!(this._definedPropertyNames.indexOf(n)<0))&&(i||this._privatePropertyNames.indexOf(n)===-1))this.onPropertyChanged(n,t,!1,5)},r.prototype.SetPropertyValue=function(n){var t=this;n.$values.forEach(function(n){t.SetSinglePropertyValue(n.PropertyName,t.evaluateFormula(n.PropertyValue))})},r.prototype.SetPropertiesRefer=function(n,t,i){var u=this,r;i===void 0&&(i=!1);r="$values"in n?n.$values:n;r.forEach(function(n){u.SetPropertyRefer(n.PropertyName,n.PropertyValue,t,i)})},r.prototype.SetPropertyRefer=function(n,t,i,r){(r===void 0&&(r=!1),this._definedPropertyNames.indexOf(n)<0)||(r||this._privatePropertyNames.indexOf(n)===-1)&&typeof t=="string"&&t.startsWith("=")&&(this._propertyRefers[n]={referStr:t,runTimePageName:i})},r.prototype.SetUserControlPage=function(n,t,i){var r={UserControlPageName:n,PropertyValues:t===null||t===void 0?void 0:t.$values,CommandHandlers:i===null||i===void 0?void 0:i.$values};this.CellElement.CellType=r;this._definedPropertyNames=[];this._privatePropertyNames=[];this.initPropertyRefers();this.prepareCreateNewPage();this._propertyValues={};this.loadSubPage(n)},r.prototype.initPropertyRefers=function(){var t,i,n,r,u;if(this._propertyRefers={},(t=this.CellElement.CellType)===null||t===void 0?void 0:t.PropertyValues)for(n=0,r=(i=this.CellElement.CellType)===null||i===void 0?void 0:i.PropertyValues;n<r.length;n++)u=r[n],this.SetPropertyRefer(u.Name,u.Value,this.runTimePageName,!0)},r.prototype.destroyOldPage=function(t){var i=this,f=this._oldSubPageContainerIDs.shift(),e=this._oldSubPageInfos.shift(),o=t===1,r=$("#"+this.getSubPageContainerID(0)),u;r.css("display","");f&&(u=$("#"+f),u&&!o&&r.css("display","none"));o?this.destroyOldPageDom(u,r,e):n.DelayRefresh.Push(null,function(){var t;i.destroyOldPageDom(u,r,e);((t=i.subPageInfos)===null||t===void 0?void 0:t.length)>0&&i.subPageInfos[0]&&n.ForguncyData.pageInfo.pageElementManager.resizePageElements([i.subPageInfos[0].runTimeNormalPageName])},f)},r.prototype.destroyOldPageDom=function(t,i,r){r&&n.SubPageHelper.destroySubPage(r.runTimeNormalPageName,r.runTimeMasterPageName);t&&(t.remove(),i.css("display",""))},r.prototype.needUpdateReference=function(t){var r,f,u;return(t&&t.length>0&&t[0]==="="&&(t=t.substring(1)),!t)?!1:(r=this.getCurrentParamToExpression(),Object.keys(r).length&&t)?(f=n.FormulaHelper.parse(t),u=new i(r),u.visit(f,0,0),u.Updated):!1},r.prototype.propertyToReference=function(t){var u=t,s=!1,o,f,e,r;if(u&&u.length>0&&u[0]==="="&&(u=u.substring(1),s=!0),o=this.getCurrentParamToExpression(),Object.keys(o).length&&t)try{if(f=n.FormulaHelper.parse(t),e=new i(o),f=e.visit(f,0,0),e.Updated&&(r=n.FormulaHelper.unparse(f),r))return r[0]!=="="&&s&&(r="="+r),{referStr:r,runTimePageName:e.runTimePageName}}catch(h){return null}return null},r.prototype.CallUserControlPageMethod=function(n){var r=this,t,i;n&&(t={},n.ParameterValues.forEach(function(n){t[n.Name]=r.evaluateFormula(n.Value)}),i={},n.Returns.forEach(function(n){i[n.Name]=n.ResultTo}),this.addMethodToCurrentExecuteList(n.MethodName,t,i,n.MethodResultErrorCodeTo,n.MethodResultMessageTo))},r.prototype.getCurrentParamToExpression=function(){return this._propertyRefers},Object.defineProperty(r.prototype,"DefinedPropertyNames",{get:function(){return this._definedPropertyNames},enumerable:!1,configurable:!0}),r}(n.SinglePageContainerCellType);n.UserControlPageCellType=t;i=function(t){function i(n){var i=t.call(this)||this;return i._currentParamToReferDic=n,i.Updated=!1,i}return __extends(i,t),i.prototype.visit=function(n,i,u){if(!n)return n;var f=r.ExpressionType;return n.type===f.name?this.visitNameExpression(n):t.prototype.visit.call(this,n,i,u)},i.prototype.visitNameExpression=function(t){var i=this._currentParamToReferDic[t.value],r;if(i!==undefined)try{return r=n.FormulaHelper.parse(i.referStr),this.Updated=!0,this.runTimePageName=i.runTimePageName,r}catch(u){}return t},i}(n.ExpressionVisitor);n.CellTypeHelper.registerCellType("Forguncy.UserControlPageCellType, ServerDesignerCommon",t)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__assign=this&&this.__assign||function(){return __assign=Object.assign||function(n){for(var t,r,i=1,u=arguments.length;i<u;i++){t=arguments[i];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},__assign.apply(this,arguments)},Forguncy;(function(n){var i=function(t){function i(){var n=t.call(this)||this;return n.CellTypeString="Forguncy.AttachmentCelltype",n.TemplateNameParts=["ATTACHMENT_DELETE_BUTTON","ATTACHMENT_ADD_BUTTON","ATTACHMENT_LINK"],n}return __extends(i,t),i.prototype.MapPartsNameToDom=function(n){var t=n.find("button"),i=n.find(".deleteHyperCon").find("a"),r=n.find(".downloadHyperCon").find("a");return{ATTACHMENT_ADD_BUTTON:t,ATTACHMENT_DELETE_BUTTON:i,ATTACHMENT_LINK:r}},i.prototype.OnTemplateStyleApplied=function(t,i){if(i){i.css("overflow","hidden");var r=t.Key,u=n.CellTypeStyleTemplateUtils.FormatTemplateStyleClassName(this.CellTypeString,r,"ATTACHMENT_DELETE_BUTTON"),f=n.CellTypeStyleTemplateUtils.FormatTemplateStyleClassName(this.CellTypeString,r,"ATTACHMENT_LINK"),e=i.find(".deleteHyperCon").find("a"),o=i.find(".downloadHyperCon").find("a");e.each(function(t,i){n.CellTypeStyleTemplateUtils.AddFocusStyleToContainer(u,$(i));n.CellTypeStyleTemplateUtils.AddDiableCallbackToContainer(u,$(i))});o.each(function(t,i){n.CellTypeStyleTemplateUtils.AddFocusStyleToContainer(f,$(i));n.CellTypeStyleTemplateUtils.AddDiableCallbackToContainer(f,$(i))});n.ButtonCellTypeStyleTemplateHelper.adjustButtonBorder(t,this.CellTypeString,this.TemplateNameParts[1],"ATTACHMENT_ADD_BUTTON")}},i}(n.CellTypeStyleTemplateHelperBase),t;n.AttachmentCellTypeStyleTemplateHelper=i;t=function(t){function r(n,i,r,u){var f=t.call(this,n,i,r,u)||this;return f._indicatorCount=0,f.allowSetValueByUser=!1,f}return __extends(r,t),r.prototype._getCellTypeData=function(t){return new n.AttachmentCelltypeData(t)},r.prototype.getStyleTemplateHelper=function(){return r.StyleTemplateHelper},r.prototype._showLoadingIndicator=function(){this._indicatorCount++;this._indicatorContainer.css("display","")},r.prototype._hideLoadingIndicator=function(){this._indicatorCount--;this._indicatorCount<=0&&this._indicatorContainer.css("display","none")},r.prototype.createContent=function(){var e=this,o=this.CellElement,f=n.DomUtilities.createJqueryDomElement("div"),s,u,i,t;f.css("width","100%");f.css("height","100%");s=o.CellType;u=n.DomUtilities.createJqueryDomElement("div");u.css("width","100%");u.css("height","100%");u.css("display","flex");u.css("flex-direction","column");u.css("align-items","flex-start");f.append(u);i=n.DomUtilities.createJqueryDomElement("div");i.attr("data-wordWrap",!!this.CellElement.StyleInfo.WordWrap);i.css("width","100%");i.css("flex-grow","1");n.DomUtilities.setContainerOverFlow(i,"auto");i.attr("index",0);i.attr("forguncyAttachment","true");n.DomUtilities.setPropertyToDom(o,i,e._getDomCreateInfo(),[2,0]);u.append(i);t=n.DomUtilities.createJqueryDomElement("button");t.css("font-size",i.css("font-size"));t.attr("id",e.ID+"Add");t.attr("type","button");t.text(n.RS.addStr);u.append(t);t.on("click",{cellType:this,div:i},r._onAttachmentCellAddButtonClick);return n.Platform.isMobile()&&t.addClass("mobileButtonStyle"),t.css("flex-grow","0"),t.css("font-family","inherit"),n.Platform.isIOSDevice()&&t.css("-webkit-appearance","none"),n.Platform.isIpad()&&t.css("min-height","fit-content"),t.css("outline","none"),this._registerDragUpload(i,this),this._indicatorContainer=n.DomUtilities.createLoadingIndicator(),f.append(this._indicatorContainer),this.isDisabled()&&this._disable(f),this.isReadOnly()&&this.updateReadOnlyStatus(),f},r.prototype._getPartsUseFontStyle=function(){return $("#"+this.ID+",#"+this.ID+"_a_div a")},r._onAttachmentCellAddButtonClick=function(t){var i=t.data.cellType,r,u;i.isReadOnly()||i._checkMaxUploadCount()&&(r=i.CellElement.CellType.UploadLimit,u=r?r.ExtensionFilter:null,n.Common.updateFile(u,!0,function(n){var i=t.data.cellType;i._hideLoadingIndicator();i._addAttachmentToCell(t.data.div,n)},function(t,r){if(i._hideLoadingIndicator(),t){var u=r&&r.status===401?n.RS.UnauthorizedUpload:t;alert(u)}},r,i.CellElement.ServerPropertiesId.UploadLimit,function(){i._showLoadingIndicator()}))},r.prototype._setAttachmentCellValue=function(n,t){var r,u,e=(u=(r=t===null||t===void 0?void 0:t.toString)===null||r===void 0?void 0:r.call(t))!==null&&u!==void 0?u:"",f,i;for(n.empty(),n.attr("attachmentValue",""),f=e.split("|"),i=0;i<f.length;i++)this._addAttachmentToCell(n,f[i])},r.prototype._checkMaxUploadCount=function(){var i,r,u,t=this.CellElement.CellType;return((i=t===null||t===void 0?void 0:t.UploadLimit)===null||i===void 0?void 0:i.MaxUploadFileCount)&&(((r=t===null||t===void 0?void 0:t.UploadLimit)===null||r===void 0?void 0:r.MaxUploadFileCount)!==1||!((u=t===null||t===void 0?void 0:t.UploadLimit)===null||u===void 0?void 0:u.ReplaceWhenOneFile))&&this._getFileCount()>=t.UploadLimit.MaxUploadFileCount?(alert(n.RS.uploadFileBiggerThanMaxFileCount),!1):!0},r.prototype._getFileCount=function(){var n=this.getValue(!0),r,u,t,i;if(n){for(n=n+"",r=n.split("|"),u=0,t=0;t<r.length;t++)i=r[t],i&&i.length>37&&i.charAt(36)==="_"&&u++;return u}return 0},r.prototype._createHyper=function(t,i,r,u,f,e){var h=__assign(__assign({},this.CellElement),{StyleInfo:__assign(__assign({},this.CellElement.StyleInfo),{TextIndent:0})}),o=n.HyperlinkCellType.createHyperlinkControl(h,{id:t,isInListview:this.isInListview}),s;return o.css("display","inline-block"),o.css("min-width","auto"),o.css("vertical-align","bottom"),o.addClass(i),o.css("margin-right",10),s=o.find("#"+t),this.CellElement.StyleInfo.Foreground&&o.css("color",f.css("color")),s.text(u),e!==0&&s.attr("tabindex",e),s.attr("href",r),o},r.prototype._addAttachmentToCell=function(t,i){var h,c,l,a,v,y,p,o=t.attr("attachmentValue"),w=t.attr("id"),b=t.attr("index"),u,d;if(o||(o=""),i&&i.length>37&&i.charAt(36)==="_"){if(!this._checkMaxUploadCount())return;u=n.DomUtilities.createJqueryDomElement("div");u.attr("id",w+"_a_div");u.css("margin","2px 0");u.css("display","flex");u.css("align-items","center");var it=w+b+"Download",s=i.substring(37),k=i,rt=n.Helper.SpecialPath.getFileDownloadUrl(k),f=this._createHyper(it,"downloadHyperCon",rt,s,t,this.getElementTabIndex());s&&s.toLowerCase().endsWith(".pdf")?f.find("a").attr("target","_blank"):f.find("a").attr("download",s);u.append(f);var g=w+b+"Delete",e=this._createHyper(g,"deleteHyperCon","#",n.RS.deleteStr,t,this.getElementTabIndex()),nt=e.find("#"+g);if((c=(h=this.cellTypeData)===null||h===void 0?void 0:h.metaData)===null||c===void 0?void 0:c.TemplateKey){var tt=((l=this.cellTypeData)===null||l===void 0?void 0:l.metaData).TemplateKey,ut=n.CellTypeStyleTemplateUtils.FormatTemplateStyleClassName(r.StyleTemplateHelper.CellTypeString,tt,"ATTACHMENT_DELETE_BUTTON"),ft=n.CellTypeStyleTemplateUtils.FormatTemplateStyleClassName(r.StyleTemplateHelper.CellTypeString,tt,"ATTACHMENT_LINK");f.find("a").addClass(ft);e.find("a").addClass(ut)}this.CellElement.StyleInfo.WordWrap?(f.find("a").css("display","inline"),f.find("div").append(e),e.css("margin","0 0 0 10px"),n.Platform.isIOSDevice()&&(f.css("height","initial"),e.css("height","initial"))):u.append(e);nt.attr("fileName",k);e.attr("isDelete",1);this._attachDeleteEventHandler(nt,u,t,k);n.Platform.isMobile()&&u.addClass("mobileButtonStyle");d=((v=(a=this.CellElement.CellType)===null||a===void 0?void 0:a.UploadLimit)===null||v===void 0?void 0:v.MaxUploadFileCount)===1&&((p=(y=this.CellElement.CellType)===null||y===void 0?void 0:y.UploadLimit)===null||p===void 0?void 0:p.ReplaceWhenOneFile);d&&t.empty();t.append(u);t.attr("attachmentValue",(d?"":o)+i+"|");t.attr("index",Number(b)+1);this.isDisabled()&&this._disable(t.parent());this.isVisible()||this._setVisible(this.getContainer(),!1);this.isReadOnly()&&this.updateReadOnlyStatus();this._onValueChanged();this.validate()}else i.indexOf("<")>=0&&(t.append($("<div>".concat(n.RS.AttachmentCell_NotSupportedFile,"<\/div>"))),t.attr("attachmentValue",o+i+"|"))},r.prototype._attachDeleteEventHandler=function(n,t,i,r){var u=this;n.on("click",{cellType:this,itemContainer:t,div:i,url:r},function(n){var t,i;return u.isReadOnly()?!1:(t=n.data,t.div.focus(),t.itemContainer.remove(),i=t.div.attr("attachmentValue"),t.div.attr("attachmentValue",i.replace(t.url+"|","")),t.cellType._onValueChanged(),t.cellType.validate(),!1)})},r.prototype.setValueToElement=function(n,t){this._setAttachmentCellValue(n,t)},r.prototype.getValueFromElement=function(){var n=$("#"+this.ID);return n.length>0?n.attr("attachmentValue")?n.attr("attachmentValue"):null:null},r.prototype._disable=function(t){var f=t.find(".deleteHyperCon"),e=t.find(".downloadHyperCon"),r,i,u;f.attr("disabled","disabled");e.attr("disabled","disabled");r=t.find("#"+this.ID+"Add");r.attr("disabled","disabled");i=t.find("a");i.attr("disabled","disabled");i.off("click");i.on("click",function(){return!1});u=$("#"+this.ID);n.DragFileToUploadHelper.unRegister(u);i.css("cursor","default")},r.prototype._enable=function(){var s=$("#"+this.ID+"Add"),t,r,u,n,f,o;s.removeAttr("disabled");t=$("#"+this.ID+"_div").find("a");t.removeAttr("disabled");t.off("click");t.css("cursor","pointer");var e=$("#"+this.ID),i=e.find(".deleteHyperCon"),h=e.find(".downloadHyperCon");for(i.removeAttr("disabled"),h.removeAttr("disabled"),r=i.find("a"),u=$("#"+this.ID),n=r.length-1;n>=0;n--)f=$(r[n]),o=$(i[n]),this._attachDeleteEventHandler(f,o.parent(),u,f.attr("fileName"));this._registerDragUpload(u,this)},r.prototype._registerDragUpload=function(t,i){var r=this;n.DragFileToUploadHelper.register(t,function(u){return i._checkMaxUploadCount()?i.isReadOnly()?!1:(r._showLoadingIndicator(),n.Common.uploadFileByHTML5(u,function(n){i._addAttachmentToCell(t,n);r._hideLoadingIndicator()},function(n){r._hideLoadingIndicator();n&&alert(n)},i.CellElement.CellType.UploadLimit,i.CellElement.ServerPropertiesId.UploadLimit),!0):!1})},r.prototype._getVisibleParts=function(n){return n.find("a,button")},r.prototype.updateReadOnlyStatus=function(){var n=this.getContainer().find("div[isDelete],button");this.isReadOnly()?n.css("display","none"):n.css("display","")},r.prototype._setFontStyle=function(n){if(t.prototype._setFontStyle.call(this,n),this.CellElement.StyleTemplate){var u=this.getContainer(),f=u.find(".deleteHyperCon"),e=u.find(".downloadHyperCon"),i,r;f.find('a[href="#"]').each(function(n,t){i=t.style.color;$(t).css("white-space","")});e.find('a:not([href="#"])').each(function(n,t){r=t.style.color});i&&i!=="inherit"&&f.css("color",i);r&&r!=="inherit"&&e.css("color",r)}},r.StyleTemplateHelper=new i,r}(n.CellTypeBase);n.AttachmentCellType=t;n.CellTypeHelper.registerCellType("Forguncy.AttachmentCelltype, ServerDesignerCommon",t)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var r=function(t){function i(){var n=t.call(this)||this;return n.CellTypeString="Forguncy.ButtonCellType",n.TemplateNameParts=["BUTTON"],n}return __extends(i,t),i.prototype.MapPartsNameToDom=function(n){return{BUTTON:n.find("button")}},i.prototype.OnTemplateStyleApplied=function(n,t){if(t){var r=t.find("button");i.adjustButtonBorder(n,this.CellTypeString,this.TemplateNameParts[0],"BUTTON");r.css("outline","none");t.css("overflow","visible");r.css("overflow","hidden")}},i.adjustButtonBorder=function(t,i,r,u){var f,e,c;if(t&&t.Styles&&t.Styles[u]&&t.Styles[u].NormalStyle&&(f=t.Styles[u].NormalStyle,!f.BorderString)){e=[];f.BorderTopString||e.push("border-top:none");f.BorderRightString||e.push("border-right:none");f.BorderBottomString||e.push("border-bottom:none");f.BorderLeftString||e.push("border-left:none");var s=n.CellTypeStyleTemplateUtils.FormatTemplateStyleClassName(i,t.Key,r),o=document.getElementById(s),h="".concat(u,"-style-updated");o&&!o.getAttribute(h)&&(c=".".concat(s," { ").concat(e.join(";"),"; }"),o.innerText="".concat(c).concat(o.innerText),o.setAttribute(h,"true"))}},i}(n.CellTypeStyleTemplateHelperBase),i,t;n.ButtonCellTypeStyleTemplateHelper=r;i=function(i){function u(n,t,r,u){var f=i.call(this,n,t,r,u)||this;return f.supportedEvents=["click","mouseenter","mouseleave"],f}return __extends(u,i),u.prototype.needValidate=function(){return!1},u.prototype.getStyleTemplateHelper=function(){return u.StyleTemplateHelper},u.prototype.createContent=function(){var t=this.CellElement,i=n.DomUtilities.createJqueryDomElement("button").css({display:"flex",height:"100%"}),r,u;return i.css("margin",0),i.attr("id","".concat(this.ID,"_btn")),i.addClass("fgc-btn"),i.addClass(n.DomUtilities.getFlexHorizontalAlignmentClass(t.StyleInfo.HorizontalAlignment)),i.addClass(n.DomUtilities.getFlexVerticalAlignmentClass(t.StyleInfo.VerticalAlignment)),n.DomUtilities.setPropertyToDom(t,i,this._getDomCreateInfo(),[3,5]),r=n.DomUtilities.createJqueryDomElement("div").css({display:"flex",overflow:"hidden"}),r.addClass(n.DomUtilities.getHorizontalAlignmentClass(t.StyleInfo.HorizontalAlignment)),r.addClass(n.DomUtilities.getFlexVerticalAlignmentClass(n.CellVerticalAlignment.Center)),n.DomUtilities.setPropertyToDom(t,r,this._getDomCreateInfo(),[1,]),u=n.DomUtilities.createJqueryDomElement("label").css({overflow:"hidden"}),this._label=u,u.text(n.Common.IsEmpty(t.Value)?"":t.Value),n.DomUtilities.setPropertyToDom(t,u,this._getDomCreateInfo(),[4,2,3,0]),i.append(r.append(u)),this.set_Icon(t.CellType.Icon),this.set_RightIcon(t.CellType.RightIcon),t.StyleInfo.Background&&!n.Platform.isIpad()&&i.css("background-color",n.ColorHelper.Convert(t.StyleInfo.Background)),t.CellType.AutoExecute||i.attr("type","button"),i},u.prototype.setValueToElement=function(n,t){this._updateText(n,t)},u.prototype._updateText=function(t,i){var r={value:null},u=n.FormatHelper.formatValue(i,this.getFormatString(),r);n.GeneralCellType.setValueToLabel(t,u,this.isDisabled()?null:r.value,this.CellElement);this._image&&this._image.css("margin-right",n.Common.IsEmpty(i)?0:5);this._rightImage&&this._rightImage.css("margin-left",n.Common.IsEmpty(i)?0:5)},u.prototype.getValueFromElement=function(){return null},u.prototype.onFormatterChanged=function(){var t=$("#".concat(this.ID)),i;t.length===1&&(i=n.ForguncyData.pageInfo.dataModel.normalCellDataModel.getValue(this.ID),this._updateText(t,i))},u.prototype._setFontStyle=function(n){i.prototype._setFontStyle.call(this,n);n.Underline===!1&&this.getContainer().find("button").css("text-decoration","none")},u.prototype._disable=function(n){var t=n;t.attr("disabled","disabled")},u.prototype._getPartsUseBackcolor=function(){return $("#".concat(this.ID,"_btn"))},u.prototype._getVisibleParts=function(n){return n.find("#".concat(this.ID,"_btn"))},u.prototype._enable=function(){var n=$("#".concat(this.ID,"_btn"));n.removeAttr("disabled")},u.prototype._getClickableDomId=function(){return"".concat(this.ID,"_btn")},u.prototype.shouldDisplayInListviewNewRow=function(){return!1},u.prototype.destroy=function(){this._autoExecuteHandler&&$(document).off("keydown",this._autoExecuteHandler);this._image=null;this._rightImage=null;i.prototype.destroy.call(this)},u.prototype._getPartsUseFontStyle=function(){var n=i.prototype._getPartsUseFontStyle.call(this);return n=this._image?n.add(this._image):n,this._rightImage?n.add(this._rightImage):n},u.prototype.ExecuteCommand=function(){var t=this.CellElement.CellType.CommandList;n.ForguncyData.commandExecutor.insertCommandsToCurrentExecutingList(t,this.runTimePageName)},u.prototype.set_Icon=function(n){this._setIconInternal(t.LEFT,n)},u.prototype.set_RightIcon=function(n){this._setIconInternal(t.RIGHT,n)},u.prototype._setIconInternal=function(i,r){var e,o,s=this.CellElement,f,u;switch(i){case t.LEFT:(e=this._image)===null||e===void 0?void 0:e.remove();break;case t.RIGHT:(o=this._rightImage)===null||o===void 0?void 0:o.remove();break;default:throw new Error("error button iocn direcytion");}if(f=s.CellType.IconSize,u=n.ImageDataHelper.CreateImage(r,f,function(n,t){n.css({width:f,height:f,position:"static"});t.css("display","flex")},!0),u){switch(i){case t.LEFT:this._image=u;u.css("margin-right",n.Common.IsEmpty(this._label.text())?0:5);u.insertBefore(this._label);break;case t.RIGHT:this._rightImage=u;u.css("margin-left",n.Common.IsEmpty(this._label.text())?0:5);u===null||u===void 0?void 0:u.insertAfter(this._label)}s.StyleInfo.Foreground&&u.css("color",s.StyleInfo.Foreground)}return u},u.StyleTemplateHelper=new r,u}(n.ClickableCellTypeBase);n.ButtonCellType=i,function(n){n.LEFT="LEFT";n.RIGHT="RIGHT"}(t||(t={}));n.CellTypeHelper.registerCellType("Forguncy.ButtonCellType, ServerDesignerCommon",i)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){function r(t,r){return(r instanceof i||n.SpreadJSViewBarcodeCellType&&r instanceof n.SpreadJSViewBarcodeCellType)&&(t=u(t)+"",t=f(t)),t}function u(n){for(var t,i=[],r=0;r<n.length;r++)t=n.charCodeAt(r),t<128?i.push(t):t<2048?i.push(192|t>>6,128|t&63):t<55296||t>=57344?i.push(224|t>>12,128|t>>6&63,128|t&63):(r++,t=65536+((t&1023)<<10|n.charCodeAt(r)&1023),i.push(240|t>>18,128|t>>12&63,128|t>>6&63,128|t&63));return i}function f(n){for(var i="",u=0,e=n.length,r,f,o;u<e;){if(r=n.charCodeAt(u++)&255,u===e){i+=t.charAt(r>>2);i+=t.charAt((r&3)<<4);i+="==";break}if(f=n.charCodeAt(u++),u===e){i+=t.charAt(r>>2);i+=t.charAt((r&3)<<4|(f&240)>>4);i+=t.charAt((f&15)<<2);i+="=";break}o=n.charCodeAt(u++);i+=t.charAt(r>>2);i+=t.charAt((r&3)<<4|(f&240)>>4);i+=t.charAt((f&15)<<2|(o&192)>>6);i+=t.charAt(o&63)}return i}var i=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.createContent=function(){var t=n.DomUtilities.createJqueryDomElement("div");return t.addClass("fgc-barcode"),n.DomUtilities.setPropertyToDom(this.CellElement,t,this._getDomCreateInfo(),[2,5]),this.image=t,t},i.prototype.needValidate=function(){return!1},i.prototype.setValueToElement=function(t,r){var f=this.CellElement.CellType,u=this;if(r===""||r===undefined){u.image.empty();u.image.css("background-image","");return}n.Common.forguncyPost("Barcode/GetBarcode",i.GetRequestParam(r,f,this.CellElement.FullWidth,this.CellElement.FullHeight,this.CellElement.StyleInfo.Background,this.CellElement.StyleInfo.Foreground,u),function(t){u.image.empty();u.image.css("background-image",'url("'+t+'")');n.ImageHelper.appendInnerImage(u.image,t)},"GetBarcode "+this.ID)},i.GetRequestParam=function(t,i,u,f,e,o,s){return{value:r(t+"",s),codeType:i.CodeType,width:u,height:f,background:n.ColorHelper.Convert(e),connection:n.Common.IsEmpty(i.Connection)?!1:i.Connection,connectionNo:n.Common.IsEmpty(i.ConnectionNo)?0:i.ConnectionNo,version:n.Common.IsEmpty(i.Version)?-1:i.Version,checkDigit:n.Common.IsEmpty(i.CheckDigit)?!1:i.CheckDigit,checkDigitAlgorithm:n.Common.IsEmpty(i.CheckDigitAlgorithm)?"Modulus16":i.CheckDigitAlgorithm,foreground:n.ColorHelper.Convert(o)}},i.prototype.shouldDisplayInListviewNewRow=function(){return!1},i.prototype.clickable=function(){return!1},i.prototype.destroy=function(){t.prototype.destroy.call(this);this.image=null},i}(n.CellTypeBase),t;n.BarcodeCellType=i;n.ConvertThenEncode=r;t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";n.CellTypeHelper.registerCellType("Forguncy.BarcodeCellType, ServerDesignerCommon",i)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var h=function(t){function h(){return t!==null&&t.apply(this,arguments)||this}return __extends(h,t),h.prototype.create=function(i){t.prototype.create.call(this,i);var r=this.CellElement,u=r.CellType;u.Style!==3||n.StaticData.IsCellTypeExporting||i.css("overflow","initial");i.css("font-size",0)},h.prototype.createContent=function(){var w=this,v,y,c=this.CellElement,t=c.CellType,a,l,h,p;if(this.checkbox=t.Style!==3||n.StaticData.IsCellTypeExporting?new i(""):new r(""),this.checkbox.isChecked=this.cellTypeData.getDefaultValue()===!0,this.checkbox.primaryColor=t.PrimaryColor?n.ColorHelper.Convert(t.PrimaryColor):"",this.checkbox.secondaryColor=t.SecondaryColor?n.ColorHelper.Convert(t.SecondaryColor):"",a=this._getDomCreateInfo(),a.id+="checkBoxLabel",this.checkbox.id=a.id,t.Style!==3||n.StaticData.IsCellTypeExporting||(this.checkbox.horizontalAlignment=c.StyleInfo.HorizontalAlignment,this.checkbox.verticalAlignment=c.StyleInfo.VerticalAlignment,this.checkbox.textIndent=c.StyleInfo.TextIndent),l=f,t.Style===1?l=e:t.Style===2?l=o:t.Style===3&&(l=s),n.StaticData.IsCellTypeExporting&&(l=u),h=this.checkbox.createUI(l),this.ui=h,this.isDesignerPreview&&(this.checkbox.text=(y=(v=t.Caption)===null||v===void 0?void 0:v.toString())!==null&&y!==void 0?y:""),this.isInListview)h.textContainer.css("overflow","hidden"),h.inputContainer.attr(n.StaticValues.isInListview,this.isInListview),h.inputContainer.css("outline","thin transparent");else{this.checkbox.on("PropertyChanged",function(n,t){t==="isChecked"&&w.commitValue()});n.FocusMoveHelper.AllowMoveFocusByEnterKey(h.inputContainer,this.isInListview)}return n.DomUtilities.setPropertyToDom(c,h.inputContainer,this._getDomCreateInfo(),[2,5]),t.Style!==3||n.StaticData.IsCellTypeExporting?(p=n.CellDomCreateHelper.createTextElement(c,h.container,a,!0,!1,!0),h.container.css("display",""),p):h.container},h.prototype.onPageLoaded=function(n){var i=this,r=this.CellElement.CellType;this.onFormulaResultChanged(r.Caption,function(n){var t;i.checkbox.text=(t=n===null||n===void 0?void 0:n.toString())!==null&&t!==void 0?t:""});return t.prototype.onPageLoaded.call(this,n)},h.prototype.setValueToElement=function(n,t){this.checkbox.isChecked=h.isChecked(t)},h.prototype.getValueFromElement=function(){return this.checkbox.isChecked?1:0},h.prototype.validateValue=function(i,r,u){return u===void 0&&(u=!1),n.Common.IsEmpty(i)||typeof i=="boolean"||typeof i=="number"&&(i===1||i===0)?t.prototype.validateValue.call(this,i,r,u):{status:1,message:n.RS.ListViewAddNewRowError_CantConvertToBool}},h.prototype.destroy=function(){t.prototype.destroy.call(this);this.checkbox.dispose()},h.prototype._getCellTypeData=function(t){return new n.CheckBoxCellTypeData(t)},h.prototype._enable=function(){this.updateCheckboxEnabled()},h.prototype._disable=function(){this.updateCheckboxEnabled()},h.prototype._getPartsUseFontStyle=function(){return this.ui.textContainer},h.prototype.setStyleInternal=function(t){n.DomUtilities.setPropertyToDom(t,this.ui.container,this._getDomCreateInfo(),[0])},h.prototype._getVisibleParts=function(){return this.ui.container},h.prototype.updateReadOnlyStatus=function(){this.updateCheckboxEnabled()},h.prototype.updateCheckboxEnabled=function(){this.checkbox.enabled=!this.isReadOnly()&&!this.isDisabled()},h.isChecked=function(t){return n.Common.isEquals(!0,t)||n.Common.isEquals(1,t)},h.count=0,h}(n.ListviewEditModeCellType),i,t,r,u,f,e,o,s,c;n.CheckBoxCellType=h;i=function(n){function i(r){var u=n.call(this,r)||this;return u.defaultUI=t,u.styleId=(i.count++).toString(),u.registProperty("styleId"),u.registProperty("foreColor"),u.registProperty("primaryColor"),u.registProperty("secondaryColor"),u}return __extends(i,n),i.count=0,i}(n.UI.CheckBox);n.DefaultCheckBox=i;t=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),Object.defineProperty(t.prototype,"styleId",{set:function(n){this.container.attr("styleid",n)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"foreColor",{set:function(n){this.textContainer.css("color",n)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"extraCssName",{get:function(){return""},enumerable:!1,configurable:!0}),t.prototype.createContainer=function(){n.prototype.createContainer.call(this);this.container.addClass(this.extraCssName)},t}(n.UI.CheckBoxUI);n.DefaultCheckBoxUI=t;r=function(n){function t(t){var i=n.call(this,t)||this;return i.registProperty("horizontalAlignment"),i.registProperty("verticalAlignment"),i.registProperty("textIndent"),i}return __extends(t,n),t}(i);n.ButtonCheckBox=r;u=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),Object.defineProperty(t.prototype,"extraCssName",{get:function(){return"fgc-toggle-exporting"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isChecked",{set:function(n){this.inputContainer[0].checked=n;this.container.toggleClass("FUI-checked",n);this.svgContainer.empty();n?this.svgContainer.append('<svg t="1599122510588" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2706" width="14" height="14"><path d="M1024 1024H0V0h1024zM85.333333 938.666667h853.333334V85.333333H85.333333z" p-id="2707"><\/path><path d="M421.568 783.552 149.952 512 240.512 421.44 421.504 602.496 783.552 240.448 874.048 331.008Z" p-id="10034"><\/path><\/svg>'):this.svgContainer.append('<svg t="1599122510588" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2706" width="14" height="14"><path d="M1024 1024H0V0h1024zM85.333333 938.666667h853.333334V85.333333H85.333333z" p-id="2707"><\/path><\/svg>')},enumerable:!1,configurable:!0}),t.prototype.createInnerContainer=function(){n.prototype.createInnerContainer.call(this);this.svgContainer=$("<span><\/span>");this.innerContainer.append(this.svgContainer)},t}(t);n.ExportingCheckBoxUI=u;f=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),Object.defineProperty(t.prototype,"extraCssName",{get:function(){return"fgc-checkbox-system"},enumerable:!1,configurable:!0}),t}(t);n.SystemCheckBoxUI=f;e=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),Object.defineProperty(i.prototype,"extraCssName",{get:function(){return"fgc-checkbox-modern"},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"primaryColor",{set:function(t){this.innerContainer.css("color",t);var r=".".concat("FUI-checkbox",'[styleId="').concat(this.target.styleId,'"].').concat("FUI-checked",".").concat("FUI-focus"," > .").concat("FUI-toggle-inner"),i=document.createElement("style");i.appendChild(document.createTextNode("".concat(r,"{box-shadow: 0 0 3px 2px ").concat(n.ColorHelper.UpdateTint(t,0,128),"}")));this.container.append($(i))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"secondaryColor",{set:function(n){var t=document.createElement("style");t.appendChild(document.createTextNode(".".concat("FUI-checkbox",'[styleid="').concat(this.target.styleId,'"] >.').concat("FUI-toggle-inner","::after{color:").concat(n," !important}<\/style>")));this.container.append($(t))},enumerable:!1,configurable:!0}),i}(t);n.ModernCheckBoxUI=e;o=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),Object.defineProperty(i.prototype,"extraCssName",{get:function(){return"fgc-toggle-switch"},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"primaryColor",{set:function(t){this.innerContainer.css("color",t);var r=".".concat("FUI-checkbox",'[styleId="').concat(this.target.styleId,'"].').concat("FUI-focus"," > .").concat("FUI-toggle-inner"),i=document.createElement("style");i.appendChild(document.createTextNode("".concat(r,"{box-shadow: 0 0 3px 2px ").concat(n.ColorHelper.UpdateTint(t,0,128),"}")));this.container.append($(i))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"secondaryColor",{set:function(n){var t=document.createElement("style");t.appendChild(document.createTextNode(".".concat("FUI-checkbox",'[styleId="').concat(this.target.styleId,'"] > .').concat("FUI-toggle-inner","::after{color:").concat(n," !important}")));this.container.append($(t))},enumerable:!1,configurable:!0}),i}(t);n.SwitchCheckBoxUI=o;s=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),Object.defineProperty(i.prototype,"extraCssName",{get:function(){return"fgc-toggle-button"},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"primaryColor",{set:function(t){this.container.css("color",t);var r=".".concat("FUI-checkbox",'[styleId="').concat(this.target.styleId,'"].').concat("FUI-checked",".").concat("FUI-focus"),i=document.createElement("style");i.appendChild(document.createTextNode("".concat(r,"{box-shadow: 0 0 3px 2px ").concat(n.ColorHelper.UpdateTint(t,0,128),"}")));this.container.append($(i))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"secondaryColor",{set:function(n){var t=document.createElement("style");t.appendChild(document.createTextNode(".".concat("FUI-checkbox",'[styleid="').concat(this.target.styleId,'"].').concat("FUI-checked"," > .").concat("FUI-toggle-text","{color:").concat(n," !important}")));this.container.append($(t))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"horizontalAlignment",{set:function(t){switch(t){case n.CellHorizontalAlignment.Left:this.container.css("justify-content","flex-start");break;case n.CellHorizontalAlignment.Distributed:this.container.css("justify-content","flex-start");break;case n.CellHorizontalAlignment.General:case n.CellHorizontalAlignment.Center:this.container.css("justify-content","center");break;case n.CellHorizontalAlignment.Right:this.container.css("justify-content","flex-end")}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"verticalAlignment",{set:function(t){switch(t){case n.CellVerticalAlignment.Top:this.container.css("align-items","flex-start");break;case n.CellVerticalAlignment.Center:this.container.css("align-items","center");break;case n.CellVerticalAlignment.Bottom:this.container.css("align-items","flex-end")}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"textIndent",{set:function(t){if(t!==undefined&&t!==null){var i=this.target.horizontalAlignment;i===n.CellHorizontalAlignment.General||i===n.CellHorizontalAlignment.Left||i===n.CellHorizontalAlignment.Distributed?this.textContainer.css("text-indent",t):i===n.CellHorizontalAlignment.Right&&this.textContainer.css("padding-right",t)}},enumerable:!1,configurable:!0}),i}(t);n.ButtonCheckBoxUI=s;c=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),Object.defineProperty(i.prototype,"extraCssName",{get:function(){return"".concat("fgc-toggle-button"," ").concat("fgc-toggle-groupbutton")},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"text",{set:function(t){n.Common.IsEmpty(t)?this.textContainer.text(" "):this.textContainer.text(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"primaryColor",{set:function(t){this.container.css("color",t);var i=".".concat("FUI-checkbox",'[styleId="').concat(this.target.styleId,'"].').concat("FUI-checked",".").concat("FUI-focus");this.container.append("<style>".concat(i,"{box-shadow: 0 0 3px 2px ").concat(n.ColorHelper.UpdateTint(t,0,128)," }<\/style>"))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"secondaryColor",{set:function(n){this.container.append("<style>.".concat("FUI-checkbox",'[styleId="').concat(this.target.styleId,'"].').concat("FUI-checked"," > .").concat("FUI-toggle-text","{color:").concat(n," !important}<\/style>"))},enumerable:!1,configurable:!0}),i}(t);n.GroupButtonCheckBoxUI=c;n.CellTypeHelper.registerCellType("Forguncy.CheckBoxCellType, ServerDesignerCommon",h)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var i=function(t){function i(){var n=t.call(this)||this;return n.CellTypeString="Forguncy.HyperlinkCellType",n.TemplateNameParts=["LINK"],n}return __extends(i,t),i.prototype.MapPartsNameToDom=function(n){return{LINK:n}},i.prototype.OnTemplateStyleApplied=function(t,i){var u,f,r;i&&(u=i.find("a"),n.Platform.isIOSDevice()&&i.find("*").css({textDecoration:"inherit"}),u.css({fontSize:"inherit",color:"inherit",fontWeight:"inherit",fontStyle:"inherit",outline:"none"}),f=t.Key,r=n.CellTypeStyleTemplateUtils.FormatTemplateStyleClassName(this.CellTypeString,f,"LINK"),n.CellTypeStyleTemplateUtils.AddFocusStyleToContainer(r,i),n.CellTypeStyleTemplateUtils.AddDiableCallbackToContainer(r,i))},i.prototype.Clear=function(){t.prototype.Clear.call(this)},i}(n.CellTypeStyleTemplateHelperBase),t;n.HyperlinkCellTypeStyleTemplateHelper=i;t=function(t){function r(){return t!==null&&t.apply(this,arguments)||this}return __extends(r,t),r.prototype.getStyleTemplateHelper=function(){return r.StyleTemplateHelper},r.prototype.create=function(n){t.prototype.create.call(this,n);var i=this.CellElement.CellType;i&&!i.IsDisabled&&i.ClickMode===1&&n.css("cursor","pointer")},r.prototype.adjustForeColor=function(i,r){return i=t.prototype.adjustForeColor.call(this,i,r),n.Common.IsEmpty(i)?"inherit":i},r.prototype.needValidate=function(){return!1},r.prototype.createContent=function(){return r.createHyperlinkControl(this.CellElement,this._getDomCreateInfo())},r.createHyperlinkControl=function(t,i){var r=n.DomUtilities.createJqueryDomElement("a");r.attr("href","#");r.on("contextmenu",function(n){n.preventDefault()});return t.StyleInfo.Underline||(t.StyleInfo.Underline=!1),n.DomUtilities.setPropertyToDom(t,r,i,[5]),n.CellDomCreateHelper.createTextElement(t,r,i)},r.prototype.setValueToElement=function(n,t){this._updateText(n,t)},r.prototype._updateText=function(t,i){var r={value:null},u=n.FormatHelper.formatValue(i,this.getFormatString(),r);n.GeneralCellType.setValueToLabel(t,u,r.value,this.CellElement)},r.prototype.onFormatterChanged=function(){var t=$("#"+this.ID),i;t.length===1&&(i=n.ForguncyData.pageInfo.dataModel.normalCellDataModel.getValue(this.ID),this._updateText(t,i))},r.prototype.getValueFromElement=function(){return null},r.prototype._getClickableDomId=function(){var n=this.CellElement.CellType;return n&&n.ClickMode===1?this.ID+"_div":this.ID},r.prototype._getVisibleParts=function(n){return n.find("a")},r.prototype._disable=function(n){var r=n.find("a"),i;r.attr("disabled","disabled").css("cursor","default");i=this.getContainer();i.css("cursor","");i.attr("disabled","disabled");t.prototype._disable.call(this,i)},r.prototype._enable=function(){var i=$("#"+this.ID),n;i.removeAttr("disabled");i.css("cursor","");n=this.getContainer();n.css("cursor","pointer");n.removeAttr("disabled");t.prototype._enable.call(this,n)},r.prototype._getPartsUseBackcolor=function(){var n=$("#"+this.ID+"_backColor");return n.length===0?t.prototype._getPartsUseBackcolor.call(this):n},r.prototype.shouldDisplayInListviewNewRow=function(){return!1},r.prototype.hasFocus=function(){var n=$("#"+this.ID);return n.length>0&&document.activeElement===n[0]?!0:!1},r.prototype.setFocus=function(){var n=$("#"+this.ID);n.length>0&&n[0].focus()},r.prototype._setFontStyle=function(n){var i,u,f;t.prototype._setFontStyle.call(this,n);n.Underline===!1&&this.getContainer().css("text-decoration","none");this._needAdaptIosUnderlineinherit(r.StyleTemplateHelper.TemplateNameParts[0])&&(u=this.getContainer(),f=u.find("a"),((i=f[0])===null||i===void 0?void 0:i.style.textDecoration)==="none"&&(f.css("text-decoration","inherit"),u.find(".fgc-align,.fgc-align__inner").css("text-decoration","inherit")))},r.prototype.ExecuteCommand=function(){var t=this.CellElement.CellType.CommandList;n.ForguncyData.commandExecutor.insertCommandsToCurrentExecutingList(t,this.runTimePageName)},r.StyleTemplateHelper=new i,r}(n.ClickableCellTypeBase);n.HyperlinkCellType=t;n.CellTypeHelper.registerCellType("Forguncy.HyperlinkCellType, ServerDesignerCommon",t)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var i=function(t){function i(){var n=t.call(this)||this;return n.CellTypeString="Forguncy.ImageCellType",n.TemplateNameParts=["CONTAINER"],n}return __extends(i,t),i.prototype.MapPartsNameToDom=function(n){return{CONTAINER:n}},i.prototype.OnTemplateStyleApplied=function(t,i){if(t&&i){var r=n.CellTypeStyleTemplateUtils.FormatTemplateStyleClassName(this.CellTypeString,t.Key,"CONTAINER");n.CellTypeStyleTemplateUtils.AddDiableCallbackToContainer(r,i)}},i}(n.CellTypeStyleTemplateHelperBase),r,t,u;n.ImageCellTypeStyleTemplateHelper=i;r=function(n){function t(){var t=n.call(this)||this;return t.CellTypeString="Forguncy.UploadImageCellType",t}return __extends(t,n),t}(i);n.UploadImageCellTypeStyleTemplateHelper=r;t=function(t){function r(){return t!==null&&t.apply(this,arguments)||this}return __extends(r,t),r.prototype.getStyleTemplateHelper=function(){return r.StyleTemplateHelper},r.prototype.isEditable=function(){return!1},r.prototype.needValidate=function(){return t.prototype.needValidate.call(this)&&this.isEditable()},r.prototype.create=function(n){n.css("margin",0);t.prototype.create.call(this,n)},r.prototype.createContent=function(){var o=this,u=this.CellElement,l=this.isInListview,f,s,v,c,e,h;l||(u.Value=null);f=n.DomUtilities.createJqueryDomElement("div");f.addClass("fgc-container-relative");var t=u.CellType,y=n.ImageHelper.getImageSrcFromCellContentElement(u),i=n.DomUtilities.createJqueryDomElement("div"),r={},a=this.isEditable();return l||a||(s=null,t.ImagePath&&(s=n.ImageHelper.getImageUrlFromImagePath(t.BuiltIn,t.ImagePath,!1)),i.attr("imagename",s),n.ForguncyData.pageInfo.dataModel.normalCellDataModel.setValue(o.ID,{newValue:s},1)),t.ImageSizeMode===undefined||t.ImageSizeMode===0?(r.backgroundRepeat="no-repeat",i.attr("forguncyImage","true")):"background-size"in i[0].style||"backgroundSize"in i[0].style?(r.backgroundRepeat="no-repeat",r.backgroundSize=t.ImageSizeMode===1?"contain":"100% 100%",i.attr("forguncyImage","true")):i=n.DomUtilities.createJqueryDomElement("img"),r.width="100%",r.height="100%",this._image=i,(t.HorizontalAlignment===n.CellHorizontalAlignment.Center||t.HorizontalAlignment===undefined||t.HorizontalAlignment===null)&&(r.backgroundPositionX="50%"),t.HorizontalAlignment===n.CellHorizontalAlignment.Right&&(r.backgroundPositionX="100%"),(t.VerticalAlignment===n.CellVerticalAlignment.Center||t.VerticalAlignment===undefined||t.VerticalAlignment===null)&&(r.backgroundPositionY="50%"),t.VerticalAlignment===n.CellVerticalAlignment.Bottom&&(r.backgroundPositionY="100%"),i.addClass(n.CSSHelper.getClassName(r)),this.updateImageSource(y,i),v=[5,2,3],n.DomUtilities.setPropertyToDom(u,i,o._getDomCreateInfo(),v),f.append(i),t.Text&&!a&&(e=n.DomUtilities.createAbsoluteContainerDiv(),e.css("top",0),u.Value=n.Common.getMultiLanguageWord(t.Text),h=o._getDomCreateInfo(),h.id=o.ID+"_text",c=n.GeneralCellType.createLabelElement(u,h),n.DomUtilities.setPropertyToDom(u,e,h,[3]),this._textElement=c,e.append(c),f.append(e),u.Value=null),f},r.prototype.onPageLoaded=function(i){var r=this,u=this.CellElement.CellType;this.onFormulaResultChanged(u.ToolTip,function(t){var i=n.Common.IsEmpty(r._textElement)?r._image:r._textElement;i.attr("title",t)});this.onFormulaResultChanged(u.Text,function(n){r._textElement&&$("label",r._textElement).text(n)});return t.prototype.onPageLoaded.call(this,i)},r.prototype.setValueToElement=function(t,i){var r,u;i!==this.getValue(!1)&&(t.attr("imagename",i),n.Common.isForguncyFile(i)&&(i=i+n.ImageQueryHelper.getImageQueryString(this.CellElement.FullWidth,this.CellElement.FullHeight,i)),t.empty(),r=i,n.Common.IsEmpty(i)&&(r=n.ImageHelper.getImageSrcFromElementImagePath(this.CellElement)),n.Common.isForguncyFile(r)&&(r=n.ImageHelper.getUploadImageSrc(r)),u=this.updateImageSource(r,t,i),u&&(t.attr("forguncyImage")?t.css("background-image",""):t.attr("src","")))},r.prototype.updateImageSource=function(t,i,r){var u=this,f;return r===void 0&&(r=null),n.ImageDataHelper.IsSvg(t)?(this._svgSrc=t,f=this.CellElement.CellType,n.ImageDataHelper.AppendSvg(i,t,f.Color,f.UseCellForeColor,function(n){return u.isInListview?!1:u._svgSrc!==n},function(n,t){u.updateSvgSize(n[0],t[0],u.CellElement)}),!0):(this._svgSrc=null,n.ImageHelper.setImageSource(i,n.Common.IsEmpty(r)?t:r),!1)},r.prototype.updateSvgSize=function(n,t,i){var r=i.CellType.Size||0,u;r&&(u={width:r,height:r},t.style.display="flex",n.style.position="relative",n.style.width=u.width+"px",n.style.height=u.height+"px",n.style.maxWidth="100%",n.style.maxHeight="100%",this.updateSvgCellHorizontalAlignment(t,i.CellType.HorizontalAlignment),this.updateSvgCellVerticalAlignment(t,i.CellType.VerticalAlignment))},r.prototype.updateSvgCellVerticalAlignment=function(t,i){t.style.alignItems=i===n.CellVerticalAlignment.Center?"center":i===n.CellVerticalAlignment.Bottom?"flex-end":"flex-start"},r.prototype.updateSvgCellHorizontalAlignment=function(t,i){t.style.justifyContent=i===n.CellHorizontalAlignment.Center?"center":i===n.CellHorizontalAlignment.Right?"flex-end":"flex-start"},r.prototype.getValueFromElement=function(){var n=$("#"+this.ID);return n.length>0&&n.attr("imagename")?n.attr("imagename"):null},r.prototype._getClickableDomId=function(){return this.ID+"_div"},r.prototype._enable=function(n){this.getContainer().removeAttr("disabled");this.updateCursor(n,!0);t.prototype._enable.call(this,this.getContainer())},r.prototype._disable=function(n){this.getContainer().attr("disabled","disabled");this.updateCursor(n,!1);t.prototype._disable.call(this,this.getContainer())},r.prototype.shouldDisplayInListviewNewRow=function(){return!1},r.prototype._getPartsUseFontStyle=function(){var n=$("#"+this.ID+"_text");return this._image?this._image.add(n):n},r.prototype.updateReadOnlyStatus=function(){this.updateCursor(this.getContainer(),!this.isDisabled())},r.prototype.updateCursor=function(n,t){var i=n.find("#"+this.ID).parent().children(),r=n.find("label");this.usePointerCursor(t)?(i.css("cursor","pointer"),r.css("cursor","pointer")):(i.css("cursor",""),r.css("cursor",""))},r.prototype.usePointerCursor=function(n){return n?this.isEditable()?!this.isReadOnly():!!this.CellElement.CellType.CommandList:!1},r.prototype.destroy=function(){t.prototype.destroy.call(this);this._image=null;this._textElement=null},r.prototype.clickable=function(){var n;return((n=this.CellElement.CellType.CommandList)===null||n===void 0?void 0:n.length)>0},r.prototype.ExecuteCommand=function(){var t=this.CellElement.CellType.CommandList;n.ForguncyData.commandExecutor.insertCommandsToCurrentExecutingList(t,this.runTimePageName)},r.StyleTemplateHelper=new i,r}(n.ClickableCellTypeBase);n.ImageCellType=t;u=function(t){function i(n,i,r,u){var f=t.call(this,n,i,r,u)||this;return f.allowSetValueByUser=!1,f.supportedEvents=[],f}return __extends(i,t),i.prototype.getStyleTemplateHelper=function(){return i.StyleTemplateHelper},i.prototype._getCellTypeData=function(t){return new n.UploadImageCellTypeData(t)},i.prototype.isEditable=function(){return!0},i.prototype._disable=function(i){var r=i.find("#"+this.ID);r.off("click");n.DragFileToUploadHelper.unRegister(r);r.css("cursor","default");t.prototype._disable.call(this,this.getContainer())},i.prototype._enable=function(){var i=$("#"+this.ID);i.on("click",{cellType:this,image:i},this._onUploadImageClick);n.ImageUploadHelper.registerDragFile(i,this);i.css("cursor","pointer");t.prototype._enable.call(this,this.getContainer())},i.prototype._getClickableDomId=function(){return null},i.prototype.shouldDisplayInListviewNewRow=function(){return!0},i.prototype.showUploadingIndicator=function(){this._indicatorContainer.css("display","")},i.prototype.hideUploadingIndicator=function(){this._indicatorContainer.css("display","none")},i.prototype._onUploadImageClick=function(t){var i=t.data.cellType,u,r;!i.isEditable()||i.isDisabled()||i.isReadOnly()||(u=t.data.image,r=i.CellElement.CellType.UploadImageLimit,n.Common.uploadImageByFileSelector(r,r===null||r===void 0?void 0:r.AllowExtensions,function(t){i.hideUploadingIndicator();n.ImageUploadHelper.uploadSuccess(t,u,i)},i.CellElement.ServerPropertiesId.UploadLimit,function(t,r){if(i.hideUploadingIndicator(),t){var u=(r===null||r===void 0?void 0:r.status)===401?n.RS.UnauthorizedUpload:t;alert(u)}},function(){i.showUploadingIndicator()}))},i.prototype.createContent=function(){var r=t.prototype.createContent.call(this),u=this.isEditable(),i;if(u){i=r.children("[forguncyimage]");i.on("click",{cellType:this,image:i},this._onUploadImageClick);n.ImageUploadHelper.registerDragFile(i,this);i.css("cursor","pointer")}return this._indicatorContainer=n.DomUtilities.createLoadingIndicator(),r.append(this._indicatorContainer),r},i.prototype.disable=function(){t.prototype.disable.call(this);this.refreshClickable()},i.prototype.enable=function(){t.prototype.enable.call(this);this.refreshClickable()},i.prototype.setReadOnly=function(n){t.prototype.setReadOnly.call(this,n);this.refreshClickable()},i.prototype.clickable=function(){return!this.isReadOnly()&&!this.isDisabled()},i.StyleTemplateHelper=new r,i}(t);n.UploadImageCellType=u;n.CellTypeHelper.registerCellType("Forguncy.ImageCellType, ServerDesignerCommon",t);n.CellTypeHelper.registerCellType("Forguncy.UploadImageCellType, ServerDesignerCommon",u)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.getStyleTemplateHelper=function(){return i.StyleTemplateHelper},i.prototype._getCellTypeData=function(t){return new n.InputCellTypeData(t)},i.prototype.createCellContent=function(){var r=this,s=this.CellElement,c=this.isInListview,t=n.DomUtilities.createJqueryDomElement("input"),f,o,u,e,i,h;if(t.attr("type","password"),t.css("display","block"),n.CellDomCreateHelper.initalInputBox(s,t,this._getDomCreateInfo()),this._input=t,f=s.CellType,c||(t.change(function(){r.isReadOnly()||r._onValueChanged()}),t.focusout(function(){r.isReadOnly()||r.validate()}),n.FocusMoveHelper.AllowMoveFocusByEnterKey(t,this.isInListview)),o=this.cellTypeData.getDefaultValue(),n.Common.IsEmpty(o)||this._setValue(t,o),u=n.CellDomCreateHelper.createControlContainer(),u.append(t),e=f.IconSize,i=n.ImageDataHelper.CreateImage(f.Icon,e),this._image=i,i&&(i.css("margin","0px 5px"),i.css("position","absolute"),i.css("top","calc(50% - "+e/2+"px)"),u.append(i),this.CellElement.StyleInfo.HorizontalAlignment!==n.CellHorizontalAlignment.Center&&t.css("padding-left",e+10)),f.IsSelectAllOnFocus){h=u.find("#"+this.ID);h.on("focusin",function(){n.Platform.isChrome()?r.selectAll():n.DelayRefresh.setTimeout(function(){r.selectAll()})})}return u},i.prototype.onPageLoaded=function(n){var i=this,r=this.CellElement.CellType;this.onFormulaResultChanged(r.WaterMark,function(n){i._input.attr("placeholder",n)},!0);return t.prototype.onPageLoaded.call(this,n)},i.prototype._getPartsUseFontStyle=function(){var n=t.prototype._getPartsUseFontStyle.call(this);return this._image?this._image.add(n):n},i.prototype.shouldNeverShowFormatLabel=function(){return!0},i.prototype.getValueToFormat=function(){var n=this._input.val();if(n)return n.toString().split("").map(function(){return"●"}).join("")},i.prototype.getFormatterOfFormatLabel=function(){return"@"},i.prototype.setValueToElement=function(n,t){n.val(t)},i.prototype.getValueFromElement=function(){var n=$("#"+this.ID);return n.length>0?n.val():null},i.prototype.setBackColor=function(n){var i=$("#"+this.ID);i.css("background-color","transparent");t.prototype.setBackColor.call(this,n)},i.prototype.getListviewNoneEditModeText=function(t,i,r,u){return(u===void 0&&(u=null),!n.Common.IsEmpty(t)&&this.CellElement.CellType.ShowPassword)?"******":""},i.prototype.canInputChars=function(){return!this.isDisabled()&&!this.isReadOnly()},i.prototype.selectAll=function(){var n=$("#"+this.ID);n.length>0&&n.select()},i.prototype.setCaretAtLast=function(){var n=$("#"+this.ID),i=n.val(),t;i&&n.length>0&&(t=n[0],t.selectionStart=t.selectionEnd=i.length)},i.prototype.setStyleInternal=function(t){var i=$("#"+this.ID);i.length<=0||(n.Common.IsEmpty(t.StyleInfo.Background)||i.css("background-color",n.ColorHelper.Convert(t.StyleInfo.Background)),n.DomUtilities.setPropertyToDom(t,i,this._getDomCreateInfo(),[0]))},i.prototype._disable=function(n){n.find("#"+this.ID).attr("disabled","disabled");t.prototype._disable.call(this,n)},i.prototype._enable=function(n){$("#"+this.ID).removeAttr("disabled");t.prototype._enable.call(this,n)},i.prototype.updateReadOnlyStatus=function(){var n=this.getContainer().find("#"+this.ID);this.isReadOnly()?n.attr("readonly","readonly"):n.prop("readonly",!1)},i.prototype._getVisibleParts=function(n){return n.find("#"+this.ID)},i.prototype.getIgnoreKeysInListview=function(){return[37,39]},i.prototype.destroy=function(){t.prototype.destroy.call(this);this._image=null;this._input=null},i.StyleTemplateHelper=new n.InputCellTypeStyleTemplateHelperBase("Forguncy.TextCellType"),i}(n.SupportFormatCellType);n.PasswordCellType=t;n.CellTypeHelper.registerCellType("Forguncy.TextCellType, ServerDesignerCommon",t,function(n){return n.CellType.ShowPassword})})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.needValidate=function(){return!1},i.prototype.createContent=function(){var r=this,u=this.CellElement,e=n.DomUtilities.createJqueryDomElement("div"),t=u.CellType,h=i.AddImage(e,t.FirstImage,t,u),c=i.AddImage(e,t.PreviousImage,t,u),f,o,s,l;return t.ShowText&&(f=n.DomUtilities.createJqueryDomElement("div"),f.attr("id",r.ID+"Textdiv"),f.css("display","inline-block"),r.AddText(f,t.RecordDataTable,u,"currentIndexLabel","0",r.ID+"CurrentRow"),r.AddText(f,t.RecordDataTable,u,"","/",r.ID+"Slash"),r.AddText(f,t.RecordDataTable,u,"currentCountLabel"," 0",r.ID+"TotalRow"),i.AddRecordNavigationCellSpace(f,t,u),e.append(f)),o=i.AddImage(e,t.NextImage,t,u),s=i.AddImage(e,t.LastImage,t,u),i.AddGoToCommand(h,t.RecordDataTable,r.ID+"first",2,this),i.AddGoToCommand(c,t.RecordDataTable,r.ID+"previous",0,this),i.AddGoToCommand(o,t.RecordDataTable,r.ID+"next",1,this),i.AddGoToCommand(s,t.RecordDataTable,r.ID+"last",3,this),this._firstImage=h,this._lastImage=s,this._preImage=c,this._nextImage=o,l=n.DomUtilities.createAlignmentContainer(e,u.StyleInfo.HorizontalAlignment,u.StyleInfo.VerticalAlignment),e.css("white-space","nowrap"),l},i.AddGoToCommand=function(t,i,r,u,f){if(t){var e=[{$type:"Forguncy.Model.GoToRecordCommand, ServerDesignerCommon",TableName:i,TargetRecord:u}];t.attr("id",r);n.DomUtilities.addCustomCommand(t,e,r,f)}},i.AddImage=function(t,r,u,f){var o=u.ImageSize?u.ImageSize:16,e=n.ImageDataHelper.CreateImage(r,o);if(e)return e.css("display","inline-block"),i.AddRecordNavigationCellSpace(e,u,f),t.append(e),e},i.AddRecordNavigationCellSpace=function(t,i,r){var u=i.Space?i.Space:5;r.StyleInfo.HorizontalAlignment===n.CellHorizontalAlignment.Left?t.css("margin-right",u):r.StyleInfo.HorizontalAlignment===n.CellHorizontalAlignment.Center?(t.css("margin-left",u/2),t.css("margin-right",u/2)):t.css("margin-left",u)},i.prototype.AddText=function(t,i,r,u,f,e){var o=n.DomUtilities.createJqueryDomElement("span");return o.text(f),o.attr("id",e),i||(i=""),u&&o.attr(u,i),o.css("min-width",50),n.DomUtilities.setPropertyToDom(r,o,this._getDomCreateInfo(),[0]),o.css("vertical-align","middle"),t.append(o),o},i.prototype._getPartsUseFontStyle=function(){var n=$("#"+this.ID+"_div span");return n=this._firstImage?n.add(this._firstImage):n,n=this._nextImage?n.add(this._nextImage):n,n=this._preImage?n.add(this._preImage):n,this._lastImage?n.add(this._lastImage):n},i.prototype.getValueFromElement=function(){return null},i.prototype.onCurrentRowInfoChanged=function(n){var t=this.CellElement.CellType.RecordDataTable;t&&t!==n||i.updateNavigationCellTypeText("currentIndexLabel",i._updateCurrentIndexLabel)},i._updateCurrentIndexLabel=function(n,t){t.text(i.getRecordID(n))},i.getRecordID=function(t){if(!t)return 0;var r=0,u=i.getRelatedListview(t.currentTable);return u?(r=u.getCurrentRowIndex()+1,(i.isInvalidNumber(r)||r>u.getActualDataLength())&&(r=0)):t&&!n.Common.IsEmpty(t.recordID)&&(r=1+Number(t.recordID),i.isInvalidNumber(r)&&(r=0)),r},i.isInvalidNumber=function(n){return typeof n!="number"||isNaN(n)||n<0},i.getRelatedListview=function(t){for(var r=n.ListviewBase.getAllListviews(),i=0;i<r.length;i++)if(r[i].getDataTableName()===t)return r[i];return null},i.updateCurrentCountLabel=function(t,r){var u,f;if(!t)return r.text("0");if(u=i.getRelatedListview(t.currentTable),u)f=u.getActualDataLength(),r.text(f);else{var e=n.ForguncyData.pageInfo.commandQuerys[t.currentTable],o=n.ForguncyData.pageInfo.getFilterInfoWithBinding(t.listviewLocation),s=n.ForguncyData.pageInfo.runtimeQueryConditionDataCache[t.listviewLocation];n.HomeController.GetRowCount({queryCommandInfo:e,currentRowInfo:t,columnFilterQueries:o,runtimeQueryConditionData:s},function(t){n.Common.IsEmpty(t)||r.text(t)},"GetRowCount "+r.attr("id"))}},i.updateNavigationCellTypeText=function(t,i){for(var f,r,s=$("#centerDiv_"+n.ForguncyData.pageInfo.pageID).find("["+t+"]"),o=0;o<s.length;o++){var h=$(s[o]),e=h.attr(t),u=n.ListviewBase.getAllListviews();if(!e&&u&&u.length>0)for(r=0;r<u.length;r++)if(!u[r].isGroupMode()){e=u[r].getDataTableName();break}if(f=null,e){if(f=n.ForguncyData.pageInfo.currentRowInfoCollection.getCurrentRowInfo(e),!f&&u)for(r=0;r<u.length;r++)u[r].isGroupMode()||u[r].getDataTableName()===e&&(f=u[r].getRowInfo())}else n.ForguncyData.pageInfo.currentRowInfoCollection.list.length>0&&(f=n.ForguncyData.pageInfo.currentRowInfoCollection.list[0]);i(f,h)}},i.prototype.destroy=function(){this._firstImage=null;this._nextImage=null;this._lastImage=null;this._preImage=null;t.prototype.destroy.call(this)},i}(n.CellTypeBase);n.RecordNavigationCellType=t;n.CellTypeHelper.registerCellType("Forguncy.RecordNavigationCellType, ServerDesignerCommon",t)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.needValidate=function(){return!1},i.prototype.onLoad=function(){var i=this,r=this.CellElement.CellType,t;this._listview=n.Page.getListViews(!0).filter(function(n){return n.getName()===r.PageingListviewName&&n.getRunTimePageName()===i.runTimePageName})[0];this._pagingChangedCallBack=function(n,t){r.PageLimitRowCount=t.MaxRowCountOfOnePage;i.onPagingInfoChanged(t)};this._listview.bind(n.ListViewEvents.PageingInfoChanged,this._pagingChangedCallBack);t=this._listview.getPaginationInfo();this.updateText(t.PageIndex,t.MaxRowCountOfOnePage,t.TotalRowCount)},i.prototype.initPagingInfo=function(){this._listviewLocation=n.ListviewBase.getLocationString(this.runTimePageName,this.getListviewName());n.ForguncyData.pageingInfoList.Init(this._listviewLocation,this.getLimit())},i.suspendCellTypeCommand=function(){this._isSusspend=!0},i.resumeCellTypeCommand=function(){this._isSusspend=!1},i.prototype.createContent=function(){var t=this,o,s,l;this.initPagingInfo();var r=this.CellElement,f=n.DomUtilities.createJqueryDomElement("div"),u=r.CellType;this._pageIndexID=t.ID+"currentPageIndexID";this._pageCountID=t.ID+"currentPageCountID";var h=i.addImage(f,u.FirstImage,u,r),c=i.addImage(f,u.PreviousImage,u,r),e=n.DomUtilities.createJqueryDomElement("div");e.attr("id",t.ID+"Textdiv");e.css("display","inline-block");var a=t.addTextBox(e,r,1..toString(),this._pageIndexID);return i.addInputGoToCommand(a,this._pageIndexID,this),t.addText(e,r,"/",t.ID+"Slash"),t.addText(e,r," 1",this._pageCountID),i.addPageNavigateCellSpace(e,u,r),f.append(e),o=i.addImage(f,u.NextImage,u,r),s=i.addImage(f,u.LastImage,u,r),i.addImageGoToCommand(h,t.ID+"first",0,this),i.addImageGoToCommand(c,t.ID+"previous",1,this),i.addImageGoToCommand(o,t.ID+"next",2,this),i.addImageGoToCommand(s,t.ID+"last",3,this),this._firstImage=h,this._lastImage=s,this._preImage=c,this._nextImage=o,l=n.DomUtilities.createAlignmentContainer(f,r.StyleInfo.HorizontalAlignment,r.StyleInfo.VerticalAlignment),f.css("white-space","nowrap"),l},i.prototype.onPagingInfoChanged=function(n){this.updateText(n.CurrentPageIndex,n.MaxRowCountOfOnePage,n.TotalRowCount)},i.prototype.destroy=function(){this._listview&&this._listview.unbind(n.ListViewEvents.PageingInfoChanged,this._pagingChangedCallBack);this._firstImage=null;this._nextImage=null;this._lastImage=null;this._preImage=null;t.prototype.destroy.call(this)},i.prototype.setPageIndex=function(t){if(!isNaN(t)){var i=n.ForguncyData.pageingInfoList.GetInfo(this._listviewLocation).getPageCount();return t>i?t=i:t<=0&&(t=1),this.getCurrentPageIndexLabel().val(t)}},i.prototype.setPageCount=function(n){return this.getCurrentPageCountLabel().text(" "+n)},i.prototype.getPageIndex=function(){return Number(this.getCurrentPageIndexLabel().val())},i.prototype.getListviewName=function(){return this.CellElement.CellType.PageingListviewName},i.prototype.getLimit=function(){return this.CellElement.CellType.PageLimitRowCount},i.addImageGoToCommand=function(t,i,r,u){if(t){t.attr("id",i);t.css("cursor","pointer");t.on("click",function(){if(!u.isDisabled()){var t=[{$type:"Forguncy.Model.GoToPageCommand, ServerDesignerCommon",targetPageKind:r,ListviewName:u.getListviewName(),TargetPageIndex:u.getPageIndex(),Limit:u.getLimit()}];n.ForguncyData.commandExecutor.executeCommand(t,{runTimePageName:u.runTimePageName,commandTrigger:u,commandID:i,eventType:"click"})}return!1})}},i.addInputGoToCommand=function(t,i,r){this._isSusspend!==!0&&t&&(t.focusout(function(){if(!r.isDisabled()){r.setPageIndex(r.getPageIndex());var t=[{$type:"Forguncy.Model.GoToPageCommand, ServerDesignerCommon",targetPageKind:4,ListviewName:r.getListviewName(),TargetPageIndex:r.getPageIndex(),Limit:r.getLimit()}];n.ForguncyData.commandExecutor.executeCommand(t,{runTimePageName:r.runTimePageName,commandTrigger:r,commandID:i,eventType:"click"})}}),t.keydown(function(n){r.isDisabled()||n.keyCode!==13||$(this).blur()}))},i.addImage=function(t,r,u,f){var o=u.ImageSize?u.ImageSize:16,e=n.ImageDataHelper.CreateImage(r,o);if(e)return e.css("display","inline-block"),i.addPageNavigateCellSpace(e,u,f),t.append(e),e},i.addPageNavigateCellSpace=function(t,i,r){var u=i.Space?i.Space:5;r.StyleInfo.HorizontalAlignment===n.CellHorizontalAlignment.Left?t.css("margin-right",u):r.StyleInfo.HorizontalAlignment===n.CellHorizontalAlignment.Center?(t.css("margin-left",u/2),t.css("margin-right",u/2)):t.css("margin-left",u)},i.prototype.addText=function(t,i,r,u){var f=n.DomUtilities.createJqueryDomElement("span");return f.text(r),f.attr("id",u),f.css("min-width",50),n.DomUtilities.setPropertyToDom(i,f,this._getDomCreateInfo(),[0]),f.css("vertical-align","middle"),t.append(f),f},i.prototype.addTextBox=function(t,i,r,u){var f=n.DomUtilities.createJqueryDomElement("input"),e,o;return f.val(r),f.attr("id",u),e=n.MeasureHelper.getWidth(null,null,i.StyleInfo.FontSize,i.StyleInfo.FontFamily,"000000"),o=e,f.css("width",o),n.DomUtilities.setPropertyToDom(i,f,this._getDomCreateInfo(),[0]),f.css("vertical-align","middle"),f.css("text-align","center"),f.css("margin-right","10px"),t.append(f),f},i.prototype._getPartsUseFontStyle=function(){var n=$("#"+this.ID+"_div span");return n=this._firstImage?n.add(this._firstImage):n,n=this._nextImage?n.add(this._nextImage):n,n=this._preImage?n.add(this._preImage):n,this._lastImage?n.add(this._lastImage):n},i.prototype.getValueFromElement=function(){return null},i.prototype.getCurrentPageIndexLabel=function(){return $("#"+this._pageIndexID)},i.prototype.getCurrentPageCountLabel=function(){return $("#"+this._pageCountID)},i.prototype.updateText=function(n,t,i){var r=this.getPageIndexFromPagingInfo(n,t),u=Math.max(1,Math.ceil(i/t));this.setPageCount(u);this.setPageIndex(r)},i.prototype.getPageIndexFromPagingInfo=function(n,t){return n>0&&t>0?Math.max(1,Math.ceil(n*t/this.getLimit())):1},i}(n.CellTypeBase);n.PageNavigateCellType=t;n.CellTypeHelper.registerCellType("Forguncy.PageNavigateCellType, ServerDesignerCommon",t)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var r=function(t){function r(n,i,r,u){var f=t.call(this,n,i,r,u)||this;return f.userLabelWidth=0,f.currentUserLabel=null,f.allowSetValueByUser=!1,f}return __extends(r,t),r.prototype.createContent=function(){var n=this.CellElement;return i.CreateCurrentUserCellType(n,this._getDomCreateInfo(),this)},r.prototype.onWindowResized=function(){this.setCurrentUserLabelEllipsis()},r.prototype.setCurrentUserLabelEllipsis=function(){var t=this,i,r,u,f,e,o;n.Common.IsEmpty(this.currentUserLabel)||(i=0,r=this.getContainer().find(".avator"),r.length>0&&(i=r[0].offsetWidth+10),u=0,f=this.getContainer().find(".arrow"),f.length>0&&(u=f[0].offsetWidth),e=this.getContainer()[0].offsetWidth-i-u,o=this.userLabelWidth,o>e?(this.currentUserLabel.attr("title",this.currentUserLabel.text()),n.DomUtilities.SetTextEllipsis(this.currentUserLabel,e,function(){t.currentUserLabel.css("padding-left","2px")})):n.DomUtilities.ClearTextEllipsis(this.currentUserLabel,function(){t.currentUserLabel.css("padding-left","0px");t.currentUserLabel.css("white-space","pre")}))},r.prototype._setOverflowHidden=function(){return},r.prototype._disable=function(n){r.disableCurrentUserCell(n,this.ID)},r.disableCurrentUserCell=function(n,t){var i=n.find("a"),r;i&&i.length&&(i.attr("disabled","disabled"),i.css("cursor","default"));r=n.find("#"+t+"_dropdown");r.length>0&&r.attr("data-toggle")==="dropdown"&&r.removeAttr("data-toggle")},r.prototype._enable=function(){r.enableCurrentUserCell(this.ID)},r.enableCurrentUserCell=function(n){var t=$("#"+n+"_div").find("a"),i;t&&t.length&&(t.removeAttr("disabled"),t.css("cursor",""));i=$("#"+n+"_dropdown");i.length>0&&i.attr("data-toggle","dropdown")},r.prototype._getPartsUseFontStyle=function(){return $("#"+this.ID+" label,#"+this.ID+"_login")},r.prototype._setDropDownButtonVisible=function(n){var i=$("#"+this.ID+"_dropdown"),t;i.length>0&&(t=i.find("span[currentUserDropDownButton = show]"),t.length>0&&(n?t.css("display",""):t.css("display","none")))},r.prototype.enterPrintMode=function(){this._setDropDownButtonVisible(!1)},r.prototype.quitPrintMode=function(){this._setDropDownButtonVisible(!0)},r.prototype._getVisibleParts=function(n){return n.find("a")},r.prototype.getBindingTables=function(){var t=this.CellElement.CellType;return t.ShowNotification?n.ForguncyData.GlobalSettings.WorkflowTables:null},r.prototype.reload=function(){n.DelayRefresh.Push(r,function(){i.UpdateAllNotificationIcon()},"RefreshNotifications")},r.prototype.destroy=function(){t.prototype.destroy.call(this);this.currentUserLabel=null},r.prototype.needValidate=function(){return this.CellElement.CellType.IsGenerateByKeyWord?!1:t.prototype.needValidate.call(this)},r.prototype.onClick=function(n){var t,i;if(this.hasCommandsSet()){var r=this.CellElement.CellType.ClickCommand,u=r.ParamProperties.clickArea,f=r.ParamProperties.notificationNumber,e=(i=this.getContainer().find("[notificationIcon]").attr("notificationNumber"))!==null&&i!==void 0?i:0;this.executeCustomCommandObject(r,(t={},t[u]=n,t[f]=Number(e),t))}},r.prototype.hasCommandsSet=function(){var n=this.CellElement.CellType.ClickCommand;return n&&n.Commands&&n.Commands.length>0&&n.Commands.some(function(n){return!n.Disabled})?!0:!1},r}(n.CellTypeBase),i,u,t;n.CurrentUserCellType=r;i=function(){function i(){}return i.CreateCurrentUserCellType=function(r,u,f){var o=r.CellType,g=n.ForguncyData.AuthenticationType===3,ft=n.ForguncyData.AuthenticationType===4,et=n.ForguncyData.SecurityProviderValidateType===3,ot=n.ForguncyData.SecurityProviderValidateType===4,st=ft&&(et||ot),ht=n.ForguncyData.AuthenticationType===1,ct=n.ForguncyData.SecurityProviderValidateType===2,s,h,e,c,b,rt,a,v,k,d,ut,y,p,w;if(!n.Page.getUserName()){if(g)return s=i._createLoginLinkForForm(r,f,u),n.DomUtilities.setPropertyToDom(r,s,u,[2]),s;if(ht||ct)return s=i._createWinLoginLinkForForm(r,f,u),n.DomUtilities.setPropertyToDom(r,s,u,[2]),s;if(st)return s=i._createLoginLinkForSecurityProvider(r,f,u),n.DomUtilities.setPropertyToDom(r,s,u,[2]),s}h=n.DomUtilities.createJqueryDomElement("div");h.css("width","100%");h.css("height","100%");e=n.DomUtilities.createJqueryDomElement("table");e.css("border-spacing",0);c=n.DomUtilities.createJqueryDomElement("tr");e.append(c);e.css("height","100%");n.DomUtilities.setPropertyToDom(r,e,u,[1]);var l=o.ShowUserPicture&&g,nt=o.ShowDropDown&&n.ForguncyData.AllowLogout&&n.Page.getUserName(),tt=!l||o.ShowUserDisplayName,lt=l&&o.ShowNotification,it=nt||f.hasCommandsSet();if(it&&h.css("cursor","pointer"),l&&(rt=i._createUserImage(r,f),b=rt.imageTd,c.append(b)),tt&&(k=i._createUserDisplayName(r,f),a=k.labelTd,v=k.displayName,n.DomUtilities.setPropertyToDom(r,v,u,[0]),i._setVerticalAlign(a,r.StyleInfo.VerticalAlignment),!l&&o.ShowNotification&&a.css("position","relative"),it&&v.css("cursor","pointer"),c.append(a)),d=null,nt&&(ut=i._createPopupDropdownArrow(r,f),d=ut.arrowTd,c.append(d)),o.ShowNotification){if(y=i._createNoificationIcon(l,f.ID),p=lt?b:a,p.append(y),o.NavigatePageNameForNotification){p.data("allowNavigate",!0);p.on("click",function(){if(y.css("display")!=="none"){var i={NavigateType:"normal",DeleteCachedQuery:!0,PageName:o.NavigatePageNameForNotification},t=new n.NavigateCommand;return t.CommandParam=i,t.execute(),!1}})}else if(f.hasCommandsSet())y.on("click",function(){if(y.css("display")!=="none")f.onClick(t.Notification)});f.reload()}if(i._setHorizonalAlign(e,r.StyleInfo.HorizontalAlignment),o.ShowDropDown&&n.ForguncyData.AllowLogout&&!f.hasCommandsSet()&&(e=n.DomUtilities.createDropDownListForFormUser(r,e,f),i.setDropdownMenuStyle(e,r)),n.DomUtilities.setPropertyToDom(r,e,u,[2]),tt&&(w=f,w.currentUserLabel=v,n.DelayRefresh.setTimeout(function(){w.userLabelWidth=v[0].offsetWidth;w.setCurrentUserLabelEllipsis()},0)),f.hasCommandsSet())h.on("click",function(){f.onClick(t.Name)});return h.append(e),h},i.setDropdownMenuStyle=function(t,i){i.StyleInfo.HorizontalAlignment===n.CellHorizontalAlignment.Center&&t.find(".dropdown-menu").css({left:"50%","-webkit-transform":"translateX(-50%)","-ms-transform":"translateX(-50%)",transform:"translateX(-50%)"})},i.UpdateAllNotificationIcon=function(){i._updateNotificationIcon($("[notificationIcon]"))},i._updateNotificationIcon=function(t){var i,r;if(t&&t.length!==0&&(n.ForguncyData.GlobalSettings.HasWorkflow||n.ForguncyData.GlobalSettings.HasProcess)){if(n.Common.IsEmpty((i=n.ForguncyData.userInfo)===null||i===void 0?void 0:i.UserName)){t.css("display","none");return}r=function(i){var r,f,u;if(!n.Common.IsEmpty(i))for(r=Number(i),t.attr("notificationNumber",r),f=t.parent(),r>99?t.text("99+"):t.text(r),r>0?t.css("display","inline"):t.css("display","none"),u=0;u<f.length;u++)$(f[u]).data("allowNavigate")&&(r>0?$(f[u]).css("cursor","pointer"):$(f[u]).css("cursor",""))};n.ForguncyData.GlobalSettings.HasWorkflow?n.Common.forguncyPost("WorkflowApi/GetNotificationNum",null,r,"GetNotificationNum"):n.ForguncyData.GlobalSettings.HasProcess&&n.BPM.Engine.taskQueryService.getProcessNotificationNumAsync().then(function(n){r(n)})}},i._createUserImage=function(i,r){var e=n.DomUtilities.createJqueryDomElement("td"),u=n.DomUtilities.createJqueryDomElement("img").addClass("avator"),h=i.Height-2,f=Math.max(h,0),c=i.CellType.ShowCircleUserPicture,o,s;if(c?(u.css("height",f),u.css("width",f),u.css("object-fit","cover"),u.css("border-radius","50%")):(u.css("max-height",f),u.css("max-width",f)),u.css("margin-top",1),u.css("margin-bottom",1),u.css("padding",0),u.css("margin-right",10),u.css("vertical-align","text-bottom"),u.attr("id",r.ID+"_image"),n.ForguncyData.userInfo.HasPicture?(s="",n.ForguncyData.UserProfileAvatorVersion&&(s="&v="+n.ForguncyData.UserProfileAvatorVersion),o=n.ForguncyData.ForguncyRoot+"Account/UserImage?userName="+n.ForguncyData.userInfo.UserName+s):o=n.ForguncyData.ForguncyRoot+"Resources/Images/SiteBuiltInImages/DefaultCurrentUser.png",n.ImageHelper.setImageSource(u,o),e.append(u),r.hasCommandsSet())e.on("click",function(){r.onClick(t.Avatar)});return{imageTd:e,image:u}},i._createUserDisplayName=function(i,r){var f=n.DomUtilities.createJqueryDomElement("td"),u=n.DomUtilities.createJqueryDomElement("label");u.attr("id",r.ID+"_name");var e=n.ForguncyData.AuthenticationType===3,o=i.CellType.ShowUserPicture&&e,s=i.CellType.ShowUserDisplayName;if(s?n.ForguncyData.userInfo.FullName?u.text(n.ForguncyData.userInfo.FullName):u.text(n.ForguncyData.userInfo.UserName):o||u.text(n.Page.getUserName()),f.append(u),r.hasCommandsSet())f.on("click",function(){r.onClick(t.Name)});return{labelTd:f,displayName:u}},i._createLoginLinkForForm=function(t,i,r){var u=n.DomUtilities.createJqueryDomElement("a"),f;u.attr("href","#");u.on("contextmenu",function(n){n.preventDefault()});return u.attr("id",i.ID+"_login"),u.text(n.RS.login),n.DomUtilities.setPropertyToDom(t,u,r,[0,1]),f=n.DomUtilities.createAlignmentContainer(u,t.StyleInfo.HorizontalAlignment,t.StyleInfo.VerticalAlignment),n.DomUtilities.createNavigateCommand(u,n.BuiltInPageManager.builtInPages[n.BuiltInPageType.Login],i.ID+"login",i),f},i._createWinLoginLinkForForm=function(t,i,r){var u=n.DomUtilities.createJqueryDomElement("a"),f=window.location.href,e=f.includes("?")?"&":"?",o=f+e+"fgc_win_action=9a9896edd86b4ca383b124f94cf0b39b&fgc_device_info="+encodeURIComponent(n.MFAHelper.GetDeviceInfo());u.attr("href",o);u.on("contextmenu",function(n){n.preventDefault()});return u.attr("id",i.ID+"_login"),u.text(n.RS.login),n.DomUtilities.setPropertyToDom(t,u,r,[0,1]),n.DomUtilities.createAlignmentContainer(u,t.StyleInfo.HorizontalAlignment,t.StyleInfo.VerticalAlignment)},i._createLoginLinkForSecurityProvider=function(t,i,r){var u=n.DomUtilities.createJqueryDomElement("a");return u.attr("href",n.ForguncyData.ForguncyRoot+"1C3E7540-99F6-4BE2-9654-47BE0FB82280/"+n.ForguncyData.pageInfo.pageName),u.attr("id",i.ID+"_login"),u.text(n.RS.login),n.DomUtilities.setPropertyToDom(t,u,r,[0,1]),n.DomUtilities.createAlignmentContainer(u,t.StyleInfo.HorizontalAlignment,t.StyleInfo.VerticalAlignment)},i._setVerticalAlign=function(t,i){t.css("vertical-align",n.DomUtilities.getVerticalAlignmentText(i))},i._setHorizonalAlign=function(t,i){i===n.CellHorizontalAlignment.Center?t.css("margin","auto"):i===n.CellHorizontalAlignment.Right&&t.css("margin-left","auto")},i._createPopupDropdownArrow=function(r,u){var e=n.DomUtilities.createJqueryDomElement("td"),f=$(document.createElement("span")).addClass("caret").addClass("arrow");if(f.attr("currentUserDropDownButton","show"),f.css("height",4),f.css("margin",4),r.StyleInfo&&typeof r.StyleInfo.Foreground!="undefined"&&f.css("color",n.ColorHelper.Convert(r.StyleInfo.Foreground)),e.append(f),i._setVerticalAlign(e,r.StyleInfo.VerticalAlignment),u.hasCommandsSet())e.on("click",function(){u.onClick(t.DropdownIcon)});return{arrowTd:e,arrow:f}},i._createNoificationIcon=function(t,i){var r=n.DomUtilities.createJqueryDomElement("span");return t?r.addClass("fgc-notification-icon"):r.addClass("fgc-notification-name-icon"),r.css("font-family",n.LocaleFonts.default),r.css("display","none"),r.attr("notificationIcon",""),r.attr("id",i+"_notification"),r},i}();n.CurrentUserCellTypeBuilder=i,function(n){n[n.KeepCurrentPage=0]="KeepCurrentPage";n[n.GoToHomePage=1]="GoToHomePage";n[n.GoToSpecificPage=2]="GoToSpecificPage";n[n.GoToURL=3]="GoToURL";n[n.None=4]="None"}(u=n.NavigateWhenLogoutMode||(n.NavigateWhenLogoutMode={})),function(n){n.Avatar="avatar";n.Name="name";n.DropdownIcon="dropdown-icon";n.Notification="notification"}(t=n.ClickArea||(n.ClickArea={}));n.CellTypeHelper.registerCellType("Forguncy.CurrentUserCellType, ServerDesignerCommon",r)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var u="label",t="div",k="processCellTypeTargetTable",e="FontInfo",o="cellTypeInfo",s="getUsersResult",h="GetHistoryResult",c="1px solid rgb(160, 160, 160)",l="_changeAssigneeBtn",a="_stateBtn",d="_createBy",g="_modifyBy",nt="_action_",v="_assignTo",tt="_nextStatus",y="_comment",it="_ok",rt="_cancel",ut="_assignToTitle",p="_assignee_",ft="_radio_assignee_",et="_history",ot="_row_",st="_operator",ht="_time",ct="_action",lt="_td",at="_endStatus",vt="3F47E3C5-01F5-41D3-AEDC-0F20EC5C560F",r="version",yt="_ActionPopup",pt="_HistoryPopup",wt="_AssignToPopup",bt="_ActionDiv",w="_AssigneeDiv",b=function(b){function kt(){return b!==null&&b.apply(this,arguments)||this}return __extends(kt,b),kt.prototype.needValidate=function(){return!1},kt.prototype.createContent=function(){return this.createProcessBarCellType(this.CellElement,this.isInListview)},kt.prototype.onWindowResized=function(){n.Platform.isMobile()||i.closePopup()},kt.prototype._getPartsUseFontStyle=function(){return $("#"+this.ID+",#"+this.ID+" label")},kt.prototype._disable=function(n){var t=n.find("button");t.attr("disabled","disabled");t.css("cursor","default")},kt.prototype._enable=function(){var n=$("#"+this.ID).find("button");n.removeAttr("disabled");n.css("cursor","pointer")},kt.prototype._getVisibleParts=function(n){return n.find("button")},kt.prototype.onCurrentRowInfoChanged=function(n){this.CellElement.CellType.TableName===n&&this.refresh($("#"+this.ID))},kt.prototype.createProcessBarCellType=function(i){var s=this,h=this,u=n.DomUtilities.createJqueryDomElement(t),r,f;return u.attr("id",this.ID),r={},r.StyleInfo={},r.StyleInfo.FontWeight=i.StyleInfo.FontWeight,r.StyleInfo.FontFamily=i.StyleInfo.FontFamily,r.StyleInfo.FontSize=i.StyleInfo.FontSize,r.StyleInfo.Foreground=n.ColorHelper.Convert(i.StyleInfo.Foreground),r.StyleInfo.Underline=i.StyleInfo.Underline,r.StyleInfo.FontStyle=i.StyleInfo.FontStyle,r.StyleInfo.Strikethrough=i.StyleInfo.Strikethrough,r.StyleInfo.Underline=i.StyleInfo.Underline,n.DomUtilities.setPropertyToDom(r,u,h._getDomCreateInfo(),[0]),delete r.StyleInfo.Foreground,u.data(e,r),f=i.CellType,u.attr(k,f.TableName),u.data(o,f),u=n.DomUtilities.createAlignmentContainer(u,null,i.StyleInfo.VerticalAlignment),n.DependenceCellValueChangeHelper.listenFormulaRefChanged(i.DependenceCells,function(){s.reload()},this.runTimePageName),u},kt.prototype.getBindingTables=function(){var n=this.CellElement.CellType;return[n.TableName]},kt.prototype.reload=function(){var n=$("#"+this.ID);this.refresh(n)},kt.prototype.refresh=function(t){var f=n.Common.getUniqueNumber(),i,u,e;if(t.data(r,f),!n.ForguncyData.userInfo.UserName){t.empty();return}if(i=t.data(o),u=n.ForguncyData.pageInfo.currentRowInfoCollection.getCurrentRowInfo(i.TableName),!u||!u.query){t.empty();return}e=this;n.Common.forguncyPost("WorkflowApi/GetWorkflowInfo",{currentInfo:u,needEditStatusInfo:i.ShowCreateBy||i.ShowModifyBy,needRecordInfo:i.ShowCurrentSate||i.ShowCurrentAssignTo},function(n){n&&t.data(r)===f&&e._createProcessBarByWorkflowInfo(t,i,n)},"GetWorkflowInfo"+this.ID)},kt.prototype._createProcessBarByWorkflowInfo=function(i,r,u){var f=this,s=this.getElementTabIndex(),h=i.data(e),o=n.DomUtilities.createJqueryDomElement(t),c=u.EditStatusInfo;i.data("creator",u.Creator);i.data("lastModifier",u.LastModifier);f._createCreatorInfoPart(r,c,o);f._createModifierInfoPart(r,c,o);f._createStateButton(r,u,o,h,s);f._createCurrentAssignToPart(r,u,o,h,s);f._createActionButtonPart(r,u,o,h,s);i.empty();i.append(o);f.isDisabled()&&f._disable(i);f.isVisible()||f._setVisible(f.getContainer(),!1)},kt.prototype._createCreatorInfoPart=function(t,i,r){if(t.ShowCreateBy&&i.CreateDate){var f=n.DomUtilities.createJqueryDomElement(u);f.attr("id",this.ID+d);f.css("margin","5px 2px");f.append(n.Common.format(n.RS.ProcessBarCell_CreateBy,kt._getNameText(i.Creator),kt._getDateString(i.CreateDate)));f.css("float","right");f.css("clear","right");r.append(f)}},kt.prototype._createModifierInfoPart=function(t,i,r){if(t.ShowModifyBy&&i.LastModifyDate){var f=n.DomUtilities.createJqueryDomElement(u);f.attr("id",this.ID+g);f.css("margin","5px 2px");f.text(n.Common.format(n.RS.ProcessBarCell_LastModifyBy,kt._getNameText(i.LastModifier),kt._getDateString(i.LastModifyDate)));f.css("float","right");f.css("clear","right");r.append(f)}},kt.prototype._createStateButton=function(t,i,r,u,f){var o=this,e;if(t.ShowCurrentSate){if(e=o._createButton(n.Common.format(n.RS.ProcessBarCell_Status,i.RecordInfo.State),t.ShowHistory,u,!t.ShowHistory,f),e.attr("id",this.ID+a),t.ShowHistory)e.on("click",function(){return o._onStateButtonClick(t.TableName,u),!1});e.css("float","right");e.css("clear","right");t.ShowActionButton&&e.css("margin-bottom","2px");r.append(e)}},kt.prototype._createCurrentAssignToPart=function(t,i,r,u,f){var y=this,l,e,h,o,a,c,s;if(t.ShowCurrentAssignTo&&(l=!1,e=i.RecordInfo.AssignTo,e&&e.length>0&&(l=kt._isAssignToMe(e),!l||e.length>1))){if(h="",l)h=n.RS.ProcessBarCell_AssignedTo_me;else for(o=0;o<e.length;o++)if(e[o].FullName!==undefined&&e[o].FullName!==null){h=String(e[o].FullName||e[o].UserName);break}a="";c=!1;e.length>1?(c=!0,a=n.RS.ProcessBarCell_AssignedTo+": "+n.Common.format(n.RS.ProcessBarCell_AssignedToMultiUser,h,e.length-1)):a=n.RS.ProcessBarCell_AssignedTo+": "+h;s=y._createButton(a,c,u,!c,f);c&&s.click(function(){return y._showAssignToPopup(s,e,u),!1});s.attr("id",this.ID+v);s.css("float","left").css("margin-bottom","2px");r.append(s)}},kt.prototype._createActionButtonPart=function(i,r,u,f,e){var h=this,o=n.DomUtilities.createJqueryDomElement(t),c,s,a,v;if(o.attr("id",this.ID+bt),c=h._createActionButton(o,i,r,f,e),r.IsAdminOrAllowPermission){s=h._createButton(n.RS.ProcessBarCell_ChangeAssignee,!1,f,!1,e);kt._notOnlyHasActionButton(i)&&s.css("margin-bottom","2px");s.attr("id",h.ID+l);s.on("click",function(){return h._onChangeAssigneeButtonClick(i.TableName,f,r.RecordInfo.AssignTo),!1});o.append(s);c=!0}c&&(o.css({float:"left",clear:"left",display:"flex","flex-wrap":"wrap","align-items":"center"}),u.append(o),o.children().length>0&&(a=o.children().first(),v=o.children().last(),a.css("margin-left",0),v.css("margin-right",0)))},kt._notOnlyHasActionButton=function(n){return n.ShowCreateBy||n.ShowCurrentAssignTo||n.ShowCurrentSate||n.ShowHistory||n.ShowModifyBy},kt.prototype._createActionButton=function(t,i,r,u,f){var s=this,v=!1,o,h;if(i.ShowActionButton)for(o=0;o<r.PossibleAction.length;o++){var c=r.PossibleAction[o],e=null,l=c.Action.ActionName===""?" ":c.Action.ActionName,a=l,y=this.CellElement.CellType.CustomizeButtonDisplayText;if(n.Common.IsEmpty(y)||(a=this.evaluateFormula(y.replace("{{Title}}",l))),h=kt._getActionButtonMergedStyle(i,l),h){if(!h.Visible)continue;e=s._createStyledButtonOrLink(h,a,u,f)}else e=s._createButton(a,!1,u,!1,f);kt._notOnlyHasActionButton(i)&&e.css("margin-bottom","2px");e.attr("id",s.ID+nt+o.toString());e.possibleAction=c,function(t,i,r){t.on("click",function(){return s._showChangeStatePopup(t,t.possibleAction,i,n.RS.ProcessBarCell_ActionPopup_Title,!0,r,u,null),!1})}(e,i.TableName,i.AllowEditComments);t.append(e);v=!0}return v},kt._getActionButtonMergedStyle=function(n,t){var u,i,r;return n.ActionButtonStyleInfo?(u=n.ActionButtonStyleInfo.CommonStyle,kt._addDefaultColor(u),i=null,n.ActionButtonStyleInfo.SpecialStyleMap&&(i=n.ActionButtonStyleInfo.SpecialStyleMap[t]),!u)?(i&&kt._addDefaultColor(i),i):i?(r=$.extend(!0,{},u),kt._addDefaultColor(i),i.IsDefaultSize||(r.IsDefaultSize=!1,r.Width=i.Width,r.Height=i.Height),r.Visible=i.Visible,i.IsDefaultGap||(r.IsDefaultGap=!1,r.Gap=i.Gap),i.IsDefaultFont||(r.IsDefaultFont=!1,r.FontFamily=i.FontFamily,r.FontSize=i.FontSize,r.FontWeight=i.FontWeight,r.FontStyle=i.FontStyle,r.IsUnderline=i.IsUnderline,r.IsStrikeThrough=i.IsStrikeThrough),i.IsDefaultColor||(r.IsDefaultColor=!1,r.ForegroundColor=i.ForegroundColor,r.BackgroundColor=i.BackgroundColor),i.IsDefaultBorder||(r.IsDefaultBorder=!1,r.BorderColor=i.BorderColor,r.BorderWidth=i.BorderWidth),r.DisplayType=i.DisplayType,i.CssClassName&&(r.CssClassName=i.CssClassName),r):u:null},kt._addDefaultColor=function(n){n.ForegroundColor||(n.ForegroundColor="#000");n.BackgroundColor||(n.BackgroundColor="#d3d3d3");n.BorderColor||(n.BorderColor="#000")},kt.prototype._createStyledButtonOrLink=function(t,i,r,u){var s=this;t||(t={DisplayType:f.ShowAsButton,IsDefaultBorder:!0,IsDefaultColor:!0,IsDefaultFont:!0,IsDefaultGap:!0,IsDefaultSize:!0});var h=t.DisplayType===f.ShowAsButton,o=null,e=null;return e=h?n.DomUtilities.createJqueryDomElement("button"):n.DomUtilities.createJqueryDomElement("a"),e.css("display","flex").css("justify-content","center").css("align-items","center").css("vertical-align","bottom").css("box-sizing","border-box").css("cursor","pointer").css("overflow","hidden").css("margin","0 2px"),n.Platform.isMobile()?e.addClass("mobileButtonStyle"):e.css("padding","1px 6px"),o=n.DomUtilities.createJqueryDomElement("span"),n.DomUtilities.setPropertyToDom(r,o,s._getDomCreateInfo(),[0]),o.text(i),e.append(o),u!==0&&e.attr("tabindex",u),n.ForguncyData.pageInfo&&n.ForguncyData.pageInfo.moveFocusByEnter&&e.attr("type","button"),t.IsDefaultSize||(t.Width>0&&e.css("width",t.Width+"px"),t.Height>0&&e.css("height",t.Height+"px")),!t.IsDefaultGap&&t.Gap>=0&&e.css("margin-right",t.Gap+"px"),t.IsDefaultFont||(t.FontFamily&&o.css("font-family",t.FontFamily),t.FontSize&&o.css("font-size",t.FontSize),t.FontWeight&&o.css("font-weight",t.FontWeight),t.FontStyle&&o.css("font-style",t.FontStyle),t.IsUnderline&&o.css("text-decoration","underline")),t.IsDefaultColor||(t.ForegroundColor&&e.css("color",n.ColorHelper.Convert(t.ForegroundColor)),t.BackgroundColor&&e.css("background-color",n.ColorHelper.Convert(t.BackgroundColor))),t.IsDefaultBorder||t.BorderColor&&t.BorderWidth&&e.css("border",t.BorderWidth+"px solid "+n.ColorHelper.Convert(t.BorderColor)),t.CssClassName&&e.addClass(t.CssClassName),e},kt.prototype._createButton=function(t,i,r,u,f){var v=this,e=n.DomUtilities.createJqueryDomElement("button"),o,s,h;e.css("margin","auto 2px");n.Platform.isMobile()?e.addClass("mobileButtonStyle"):e.css("padding","1px 6px");o=n.DomUtilities.createJqueryDomElement("table");o.css("border-spacing","0px");var c=n.DomUtilities.createJqueryDomElement("tr"),l=n.DomUtilities.createJqueryDomElement("td"),a=n.DomUtilities.createJqueryDomElement("span");if(n.DomUtilities.setPropertyToDom(r,a,v._getDomCreateInfo(),[0]),a.text(t),l.css("padding","0px"),l.append(a),c.append(l),i&&(s=n.DomUtilities.createJqueryDomElement("td"),h=n.DomUtilities.createJqueryDomElement("span"),h.addClass("caret"),h.css("height","4px"),s.css("padding","0px"),s.append(h),c.append(s)),u){e.css("cursor","default");e.on("click",function(){return!1})}else e.css("cursor","pointer");return o.append(c),e.append(o),f!==0&&e.attr("tabindex",f),n.ForguncyData.pageInfo&&n.ForguncyData.pageInfo.moveFocusByEnter&&e.attr("type","button"),e},kt._getWorkflowCommand=function(n,t,i,r){return{$type:"WorkflowCommand.WorkflowCommand, WorkflowCommand",ActionGUID:n.Action.GUID,AssignTo:r?r.join(","):"",WorkflowComments:i,TableName:t,ReloadAfterSucceed:!0}},kt.prototype._getCommands=function(t,i,r,u,f){var e,o,s;return typeof t=="string"?(!n.Common.IsEmpty(r)&&r.toString()&&(e=r.toString().replace(/\,/g,";"),t=t.replace(new RegExp("%AssignTo%","g"),e)),o=$("#"+this.ID).data("creator"),s=$("#"+this.ID).data("lastModifier"),t=t.replace(new RegExp("%Creator%","g"),o),t=t.replace(new RegExp("%LastModifier%","g"),s),t=t.replace(new RegExp(/\[%Comment%\]/,"g"),escape(u)),t=t.replace(new RegExp("618EABB7-87A4-4BE8-B2E0-912BE75F321B","g"),f),JSON.parse(t)):[]},kt.prototype._createNextStatePart=function(i,r){var u=n.DomUtilities.createJqueryDomElement(t);u.append(n.RS.ProcessBarCell_ActionPopup_NextStatus);u.css("margin","0px 0px 10px 0px");u.css("font-weight","bold");i.append(u);u=n.DomUtilities.createJqueryDomElement(t);u.attr("id",this.ID+tt);u.append(r.ToSateName);u.css("margin","0px 0px 15px 0px");i.append(u)},kt.prototype._createAssigneePart=function(i,r,u,f){var o=[],e;return r.AssignTo&&r.AssignTo.length>0&&(e=n.DomUtilities.createJqueryDomElement(t),e.attr("id",this.ID+ut),e.css("margin","0px 0px 5px 0px"),e.css("font-weight","bold"),e.append(r.Policy==="Choose"?n.RS.ProcessBarCell_ActionPopup_Assignto_Choose:n.RS.ProcessBarCell_ActionPopup_Assignto_All),i.append(e),e=n.DomUtilities.createJqueryDomElement(t),e.attr("id",this.ID+w),e.css("border-width","0px"),e.css("overflow","auto"),e.css("max-height","150px"),r.Policy==="Choose"?o=this._createChooseModeAssigneePart(e,r,f):this._createAllModeAssigneePart(e,r,u),i.append(e)),o},kt.prototype._createChooseModeAssigneePart=function(i,r,f){for(var s,c,e,h,l=this,a=[],v=n.Common.getUniqueNumber().toString(),o=0;o<r.AssignTo.length;o++)s=n.DomUtilities.createJqueryDomElement(t),n.Platform.isMobile()?s.css("margin","10px 0px 0px 0px"):o===0?s.css("margin","5px 0px 0px 0px"):s.css("margin","5px 0px 5px 0px"),c=l.ID+ft+o.toString(),e=n.DomUtilities.createJqueryDomElement("input"),e.css("margin","0px 0px 3px 0px"),e.css("padding","0px"),e.attr("type","radio"),e.attr("id",c),e.attr("ignoreFocusInPopup","true"),e.val(r.AssignTo[o].UserName),e.attr("name",v),r.Action.GUID===vt?f&&f.length>0?r.AssignTo[o].UserName===f[0].UserName&&e.prop("checked",!0):r.AssignTo[o].UserName||e.prop("checked",!0):o===0&&e.prop("checked",!0),a.push(e),s.append(e),h=n.DomUtilities.createJqueryDomElement(u),h.attr("id",l.ID+p+o.toString()),h.text(kt._getNameText(n.Common.IsEmpty(r.AssignTo[o].FullName)?r.AssignTo[o].UserName:r.AssignTo[o].FullName)),h.attr("for",c),s.append(h),i.append(s);return a},kt.prototype._createAllModeAssigneePart=function(n,t,i){var r=this._getListWithBlackSquare(t.AssignTo,i);n.append(r)},kt.prototype._createCommentPart=function(i,r){var f=n.DomUtilities.createJqueryDomElement(t),u;return f.append(n.RS.ProcessBarCell_ActionPopup_Comments),f.css("margin","15px 0px 10px 0px"),f.css("font-weight","bold"),i.append(f),u=n.DomUtilities.createJqueryDomElement("textarea"),n.DomUtilities.setPropertyToDom(r,u,this._getDomCreateInfo(),[0]),u.attr("id",this.ID+y),u.attr("ignoreFocusInPopup","true"),u.css("margin","0px"),u.css("border",c),u.css("padding","2px"),u.css("resize","none"),u.width(244),u.height(100),i.append(u),u},kt.prototype._showChangeStatePopup=function(i,r,u,f,e,o,s,h){var l=this,c=n.DomUtilities.createJqueryDomElement(t),v,a;c.css("white-space","pre-wrap");c.css("padding","10px");c.width(264);e&&this._createNextStatePart(c,r);v=this._createAssigneePart(c,r,s,h);a=o?this._createCommentPart(c,s):null;l._showPopup(i,c,f,s,l.ID+yt,function(){var t,i;if(r.Policy==="Choose")t=kt._getRadiosValue(v);else for(t=[],i=0;i<r.AssignTo.length;i++)t.push(r.AssignTo[i].UserName);var f=a?a.val():null,e=l._getCommands(r.PreCommands,r,t,f,u),o=l._getCommands(r.Commands,r,t,f,u),s=kt._getWorkflowCommand(r,u,f,t);n.ForguncyData.commandExecutor.executeCommand(e.concat(s,o),{runTimePageName:l.runTimePageName,commandTrigger:null,commandID:null,eventType:"click"})})},kt.prototype._getListWithBlackSquare=function(t,i){var c=this,s=n.DomUtilities.createJqueryDomElement("table"),r,f,e,o,h;for(n.DomUtilities.setPropertyToDom(i,s,c._getDomCreateInfo(),[0]),s.css("white-space","pre-wrap"),r=0;r<t.length;r++)f=n.DomUtilities.createJqueryDomElement("tr"),r===0?f.css("margin","5px 0px 0px 0px"):f.css("margin","5px 0px 5px 0px"),e=n.DomUtilities.createJqueryDomElement("td"),o=n.DomUtilities.createJqueryDomElement("div"),o.width(4),o.height(4),o.css("background-color","black"),e.append(o),f.append(e),e=n.DomUtilities.createJqueryDomElement("td"),h=n.DomUtilities.createJqueryDomElement(u),h.attr("id",c.ID+p+r.toString()),h.text(kt._getNameText(n.Common.IsEmpty(t[r].FullName)?t[r].UserName:t[r].FullName)),e.append(h),f.append(e),s.append(f);return s},kt._getNameText=function(n){return n===undefined||n===null?"":String(n)},kt.prototype._showPopup=function(r,u,f,e,o,s){var v=this,y=n.DomUtilities.createJqueryDomElement(t),w,a,p,h,l;if(n.DomUtilities.setPropertyToDom(e,y,v._getDomCreateInfo(),[0]),w=n.DomUtilities.createJqueryDomElement(t),w.css("margin","5px 2px"),w.append(f),y.append(w),a=n.DomUtilities.createJqueryDomElement(t),a.css("background-color","white"),a.css("border",c),a.css("padding","2px"),a.css("margin","2px"),a.css("border-radius","4px"),a.append(u),y.append(a),s!==undefined){p=n.DomUtilities.createJqueryDomElement(t);p.css("margin","2px");h=n.DomUtilities.createJqueryDomElement("button");h.attr("id",v.ID+it);n.DomUtilities.setPropertyToDom(e,h,v._getDomCreateInfo(),[0]);h.text(n.RS.ProcessBarCell_OK);h.css("margin","2px 2px 2px 0px");h.attr("ignoreFocusInPopup","true");h.on("click",function(){i.closePopup();s()});p.append(h);l=n.DomUtilities.createJqueryDomElement("button");l.attr("id",v.ID+rt);n.DomUtilities.setPropertyToDom(e,l,v._getDomCreateInfo(),[0]);l.text(n.RS.ProcessBarCell_Cancel);l.css("margin","2px");l.attr("ignoreFocusInPopup","true");l.on("click",function(){i.closePopup()});p.append(l);n.Platform.isMobile()&&(h.addClass("mobileButtonStyle"),l.addClass("mobileButtonStyle"));y.append(p)}i.showPopup(r,y,o)},kt.prototype._onStateButtonClick=function(t,i){var u=this,s=$("#"+u.ID).data(r),f=$("#"+u.ID+a),e,o;f.length===1&&(e=f.data(h),e===undefined?(o=n.ForguncyData.pageInfo.currentRowInfoCollection.getCurrentRowInfo(t),n.Common.forguncyPost("WorkflowApi/GetHistory",{currentInfo:o},function(n){s===$("#"+u.ID).data(r)&&(f.data(h,n),u._showHistoryPopup(f,t,i,n))},"GetHistory "+u.ID)):u._showHistoryPopup(f,t,i,e))},kt.prototype._showHistoryPopup=function(t,r,u,f){i.closePopup();var e=this._createHistoryPopupContent(f,u);this._showPopup(t,e,n.RS.ProcessBarCell_HistoryPopup_Title,u,this.ID+pt)},kt.prototype._createHistoryPopupContent=function(i,r){var a=this,f=n.DomUtilities.createJqueryDomElement(t),s,e,h,l,o,u,c,p;if(f.css("max-height","300px"),f.css("overflow","auto"),i&&i.length>0){for(s=n.DomUtilities.createJqueryDomElement("table"),s.attr("id",a.ID+et),n.DomUtilities.setPropertyToDom(r,s,a._getDomCreateInfo(),[0]),s.addClass("proceeBarHistoryTable"),e=n.DomUtilities.createJqueryDomElement("tr"),h=r.StyleInfo.FontWeight===n.StaticValues.FontWeight_Bold,kt._addTh(e,n.RS.ProcessBarCell_History_Operator,h),kt._addTh(e,n.RS.ProcessBarCell_History_Time,h),kt._addTh(e,n.RS.ProcessBarCell_History_ActionName,h),kt._addTh(e,n.RS.ProcessBarCell_History_EndStatus,h),kt._addTh(e,n.RS.ProcessBarCell_AssignedTo,h),kt._addTh(e,n.RS.ProcessBarCell_History_Comments,h),s.append(e),l=0;l<i.length;l++)o=i[l],u=n.DomUtilities.createJqueryDomElement("tr"),l%2==1&&u.css("background-color","#fafaf8"),c=a.ID+ot+l.toString(),kt._addTd(u,c+st,kt._getNameText(o.Who),0),kt._addTd(u,c+ht,kt._getDateString(o.When),0),kt._addTd(u,c+ct,o.ActionName,0),kt._addTd(u,c+at,o.State,0),kt._addTd(u,c+v,kt._getAssignToStr(o.AssignTo),0,kt._getAssignToTooltipStr(o.AssignTo)),kt._addTd(u,c+y,o.Comments,200),s.append(u);f.append(s)}else p=n.DomUtilities.createJqueryDomElement(t),p.append(n.RS.None),f.css("min-width","130px"),f.css("text-align","center"),f.css("padding","20px 0px"),f.append(p);return f},kt._getAssignToStr=function(t){if(t&&t.length>0){if(t.length>1){var i=kt._getFistAssigneeNameText(t);return n.Common.format(n.RS.ProcessBarCell_AssignedToMultiUser,i,t.length-1)}return t[0]}return n.RS.None},kt._getFistAssigneeNameText=function(n){if(n&&n.length)for(var t=0;t<n.length;t++)if(n[t]!==undefined&&n[t]!==null)return String(n[t]);return""},kt._getAssignToTooltipStr=function(n){var i,t;if(n&&n.length>0){for(i="",t=0;t<n.length;t++)i+=kt._getNameText(n[t])+(t===n.length-1?"":"\r\n");return i}return null},kt._addTh=function(t,i,r){var u=n.DomUtilities.createJqueryDomElement("th");r||u.css("font-weight","normal");u.text(i);t.append(u)},kt._addTd=function(i,r,u,f,e){var s=n.DomUtilities.createJqueryDomElement("td"),o,h;s.attr("id",r+lt);o=n.DomUtilities.createJqueryDomElement(t);h=n.DomUtilities.createJqueryDomElement("label");h.attr("id",r);h.text(u);o.append(h);f&&o.css("width",f+"px");o.css("max-height","50px");o.css("vertical-align","middle");o.css("overflow-x","hidden");o.css("word-break","break-word");o.css("text-overflow","ellipsis");s.attr("title",e?e:u);s.append(o);i.append(s)},kt.prototype._showAssignToPopup=function(i,r,u){var f=n.DomUtilities.createJqueryDomElement(t),e;f.css("white-space","pre-wrap");f.css("padding","10px");f.css("max-height","200px");f.css("min-width","200px");f.css("overflow","auto");f.attr("id",this.ID+w);e=this._getListWithBlackSquare(r,u);f.append(e);this._showPopup(i,f,n.RS.ProcessBarCell_AssignedToPopup_Title,u,this.ID+wt)},kt.prototype._onChangeAssigneeButtonClick=function(t,i,u){var f=this,h=$("#"+f.ID).data(r),e=$("#"+f.ID+l),o;e.length===1&&(o=e.data(s),o===undefined?n.Common.forguncyPost("Account/GetUsers",{role:"",columns:3,sortedByFullName:!0,id:f.CellElement.ServerPropertiesId.OwnerPage},function(o){var l,c;h===$("#"+f.ID).data(r)&&o&&o.Result&&(l=o.Properties.users,l&&(c={},c.FullName=n.RS.None,c.UserName=null,l.unshift(c)),e.data(s,o),f._showChangeAssigneePopup(e,t,i,o,u))},"GetUsers "+f.ID):f._showChangeAssigneePopup(e,t,i,o,u))},kt.prototype._showChangeAssigneePopup=function(t,i,r,u,f){var e=u.Properties.users;t.possibleAction={Action:{ActionName:n.RS.ProcessBarCell_ChangeAssignee,GUID:"3F47E3C5-01F5-41D3-AEDC-0F20EC5C560F"},Policy:"Choose",AssignTo:e};this._showChangeStatePopup(t,t.possibleAction,i,n.RS.ProcessBarCell_ChangeAssignee,!1,!0,r,f)},kt._getRadiosValue=function(n){var i=[],t;if(n)for(t=0;t<n.length;t++)n[t][0].checked&&i.push(n[t].val());return i},kt._isAssignToMe=function(t){var r,i;if(t&&t.length>0&&n.ForguncyData.userInfo.UserName)for(r=n.ForguncyData.userInfo.UserName.toLowerCase(),i=0;i<t.length;i++)if(t[i].UserName.toLowerCase()===r)return!0;return!1},kt._getDateString=function(t){return typeof t=="number"?n.FormatHelper.getTextFromValue(n.Convertor.fromOADateToDate(t)):n.FormatHelper.getTextFromValue(t)},kt.prototype.destroy=function(){i.closePopup();b.prototype.destroy.call(this)},kt}(n.CellTypeBase),f,i;n.ProcessBarCellType=b,function(n){n[n.ShowAsButton=0]="ShowAsButton";n[n.ShowAsHyperLink=1]="ShowAsHyperLink"}(f||(f={}));i=function(){function t(){}return t.showPopup=function(i,r,u){var l=$(document.body),s=n.Common.getPageConver("#FFF",.01),f,e,h,c,o,a;s.attr("FGCPopup","true");s.css("z-index",-1);f=n.DomUtilities.createJqueryDomElement("div");e=n.DomUtilities.createJqueryDomElement("div");e.css("padding",5);e.css("background-color","#e0e0e0");e.css("border","1px solid #a0a0a0");e.css("border-radius","4px");f.css("overflow","auto");f.css("position","absolute");f.css("z-index","100");f.attr("id",u);h=t._createIndicator(!0);f.append(h);e.append(r);f.append(e);c=t._createIndicator(!1);f.append(c);l.append(s);l.append(f);f.attr("FGCPopup","true");o=i.offset();/webkit.*mobile/i.test(navigator.userAgent)&&!/iPhone|iPad/i.test(navigator.userAgent)&&n.ForguncyData.pageInfo.allowZoomScreen&&(o.top=o.top-window.scrollY,o.left=o.left-window.scrollX);a={x:o.left,y:o.top,width:i.outerWidth(),height:i.outerHeight()};t._updatePosition(f,h,c,a);n.DelayRefresh.setTimeout(function(){s.css("z-index",99)},0);f.on("click",function(){return!0});s.on("click",function(){t.closePopup()})},t._updatePosition=function(n,i,r,u){var c=$(window).outerWidth(),a=$(window).outerHeight(),f=n.outerWidth(),e=t._setLeft(n,f,u,c),s,h,o,l;f=n.outerWidth();(e>u.x+u.width-20||e+f<u.x+20)&&(e=t._setLeft(n,f,u,c));s=Math.ceil(n.outerHeight())+10;t._isPopupPlaceDown(a,s,u)?(h=u.y+u.height+i.outerHeight(),$(n.children()[1]).css("margin-top",10),o=i):(h=Math.floor(u.y-s),n.css("padding-bottom",10),o=r);n.css("top",h);o.css("display","");l=n.outerWidth()-30;o.css("margin-left",Math.min(l,u.x-e+u.width/3-10))},t._setLeft=function(n,t,i,r){var u=i.x+(i.width-t)/3,f=$(document).scrollLeft();return u=Math.min(u,r-t-10+f),u=Math.max(f,u),n.css("left",u),u},t._isPopupPlaceDown=function(n,t,i){return n-(i.y+i.height-window.pageYOffset)>t||i.y-window.pageYOffset<t},t._createIndicator=function(i){var u=n.DomUtilities.createJqueryDomElement("div"),f,r;return i?u.css("top",1):u.css("margin-top",-1),t._setArrowProperty(u,"#e0e0e0",i),f=n.DomUtilities.createJqueryDomElement("div"),t._setArrowProperty(f,"#a0a0a0",i),r=n.DomUtilities.createJqueryDomElement("div"),r.append(f),r.append(u),r.css("display","none"),r},t._setArrowProperty=function(n,t,i){n.width(0);n.height(0);n.css(i?"border-bottom":"border-top","10px solid "+t);n.css("border-left","10px solid transparent");n.css("border-right","10px solid transparent");n.css("position","absolute")},t.closePopup=function(){var n=$("[FGCPopup]");n.off("click");n.remove()},t}();n.CellTypeHelper.registerCellType("Forguncy.ProcessBarCellType, ServerDesignerCommon",b)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.createSingleItemToggle=function(t,i){var u=this.CellElement.CellType,r=new n.DefaultCheckBox(n.Common.getMultiLanguageWord(t));return r.foreColor=i,r.primaryColor=n.ColorHelper.Convert(u.PrimaryColor),r.secondaryColor=n.ColorHelper.Convert(u.SecondaryColor),r},i.prototype.createSingleItemUI=function(t){var r=this.CellElement.CellType,i=n.SystemCheckBoxUI;return r.Style===1?i=n.ModernCheckBoxUI:r.Style===2?i=n.SwitchCheckBoxUI:r.Style===3&&(i=n.GroupButtonCheckBoxUI),n.StaticData.IsCellTypeExporting&&(i=n.ExportingCheckBoxUI),t.createUI(i)},i.prototype.setValueToUIInternal=function(t,i,r,u){var s=n.Common.IsEmpty(u)?null:u.toString().split(","),o=null,h,c,e,f;if(s){for(h=s.length-1,e=h;e>=0;e--)s[e]=n.Common.trimStr(s[e]);for(f=0;f<r.length;f++){if(typeof r[f]!="string")if(n.Common.IsEmpty(r[f]))continue;else u=r[f]+"";else u=n.Common.trimStr(r[f]);for(c=!1,e=h;e>=0;e--)if(s[e]===u){c=!0;break}o=i[f];o.checked=c;$(o).trigger("change")}}else for(f=0;f<r.length;f++)typeof r[f]!="function"&&(o=i[f],o.checked=!1,$(o).trigger("change"))},i.prototype.getValueInternal=function(t,i){for(var u,e,o=i.length,r="",f=0;f<o;f++)t[f].checked&&(u=i[f],typeof u=="function"?u()&&(r.length>0&&(r+=","),r+=u()):(r.length>0&&(r+=","),e=n.Common.IsEmpty(u)?"":u.toString(),r+=e));return n.Common.IsEmpty(r)?null:r},i.prototype.getOtherValue=function(n,t){var r,f,i,u;if(this.containsOtherItem()&&t)for(r=t.toString().split(","),f=function(t){var i=(r[t]+"").trim(),u=!1;return $(n).each(function(){if((this||this===0)&&(this+"").trim()===i)return u=!0,!1}),u?void 0:{value:i}},i=0;i<r.length;i++)if(u=f(i),typeof u=="object")return u.value},i.prototype.allowFormatValue=function(){return!1},i.prototype.getListviewNoneEditModeText=function(n,i,r,u){var e,o,f;for(u===void 0&&(u=null),e=this.getValuesToFormat(n),o=[],f=0;f<e.length;f++)o.push(t.prototype.getListviewNoneEditModeText.call(this,e[f],null,r,u));return o.join(",")},i.prototype.getValuesToFormat=function(t){var s=[],u=this.CellElement.CellType,f,e,o,h,c,i,r;if(!n.Common.IsEmpty(t)&&u.haveLoadItems&&u.ItemsInfo&&(f=t.toString().split(","),f)){for(e=u.ItemsInfo.Items,o=0;o<f.length;o++)for(i=e.length-1;i>=0;i--)n.Common.isFuzzyEquals(e[i].Value,f[o])&&s.push(e[i].DisplayValue);if(this.containsOtherItem()){for(h=[],c=u.ItemsInfo.Items,i=0;i<c.length;i++)h.push(c[i].Value);r=this.getOtherValue(h,t);n.Common.IsEmpty(r)||(r=r+"",n.Common.IsEmpty(r)||s.push(r))}}return s},i}(n.GroupCellTypeBase);n.CheckBoxGroupCellType=t;n.CellTypeHelper.registerCellType("Forguncy.CheckBoxGroupCellType, ServerDesignerCommon",t)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var s=function(t){function s(){return t!==null&&t.apply(this,arguments)||this}return __extends(s,t),s.prototype.createSingleItemToggle=function(t,r){var f=this.CellElement.CellType,u=new i(n.Common.getMultiLanguageWord(t));return u.foreColor=r,u.primaryColor=n.ColorHelper.Convert(f.PrimaryColor),u.secondaryColor=n.ColorHelper.Convert(f.SecondaryColor),u},s.prototype.createSingleItemUI=function(t){var s=this.CellElement.CellType,i=u;return s.Style===1?i=f:s.Style===2?i=e:s.Style===3&&(i=o),n.StaticData.IsCellTypeExporting&&(i=r),t.createUI(i)},s.prototype.setValueToUIInternal=function(t,i,r,u){for(var e,f=0;f<r.length;f++)e=i[f],e.checked=n.Common.isEquals(r[f],u),$(e).trigger("change")},s.prototype.getValueInternal=function(n,t){for(var r,u=t.length,i=0;i<u;i++)if(n[i].checked)return r=t[i],typeof r=="function"?r():r;return null},s.prototype.getOtherValue=function(t,i){var u,r,f;if(this.containsOtherItem()){for(u=n.Common.IsEmpty(i)?"":i.toString(),r=0;r<t.length;r++)if(f=n.Common.IsEmpty(t[r])?"":t[r].toString(),u===f)return;return i}},s.prototype.getListviewNoneEditModeText=function(n,i,r,u){return u===void 0&&(u=null),n=this.getValueToFormat(n),t.prototype.getListviewNoneEditModeText.call(this,n,i,r,u)},s.prototype.getValueToFormat=function(t){var u=this.CellElement.CellType,r,i;if(u.haveLoadItems&&u.ItemsInfo)for(r=u.ItemsInfo.Items,i=0;i<r.length;i++)if(n.Common.isFuzzyEquals(r[i].Value,t))return r[i].DisplayValue;return this.containsOtherItem()?t:""},s}(n.GroupCellTypeBase),i,t,r,u,f,e,o;n.RadioGroupCellType=s;i=function(n){function i(r){var u=n.call(this,r)||this;return u.defaultUI=t,u.styleId=(i.count++).toString(),u.registProperty("styleId"),u.registProperty("foreColor"),u.registProperty("primaryColor"),u.registProperty("secondaryColor"),u}return __extends(i,n),i.count=0,i}(n.UI.Radio);n.DefaultRadio=i;t=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),Object.defineProperty(t.prototype,"styleId",{set:function(n){this.container.attr("styleid",n)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"foreColor",{set:function(n){this.textContainer.css("color",n)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"extraCssName",{get:function(){return""},enumerable:!1,configurable:!0}),t.prototype.createContainer=function(){n.prototype.createContainer.call(this);this.container.addClass(this.extraCssName)},t}(n.UI.RadioUI);n.DefaultRadioUI=t;r=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),Object.defineProperty(t.prototype,"extraCssName",{get:function(){return"fgc-toggle-exporting"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isChecked",{set:function(n){this.inputContainer[0].checked=n;this.container.toggleClass("FUI-checked",n);this.svgContainer.empty();n?this.svgContainer.append('<svg t="1599123147130" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3561" width="14" height="14"><path d="M506.892 81.849c-241.603 0-439.276 197.674-439.276 439.276 0 241.598 197.674 439.271 439.276 439.271 241.598 0 439.269-197.674 439.269-439.271 0-241.603-197.674-439.276-439.269-439.276z m0 834.618c-219.637 0-395.348-175.709-395.348-395.342 0-219.637 175.709-395.348 395.348-395.348 219.633 0 395.342 175.709 395.342 395.348-0.001 219.633-175.711 395.342-395.342 395.342z m0 0z" p-id="3562"><\/path><path d="M287.253 521.124c0 28.751 5.714 57.488 16.719 84.049 11.002 26.562 27.28 50.929 47.611 71.255 20.331 20.331 44.69 36.609 71.255 47.612 26.559 11.006 55.301 16.718 84.053 16.718 28.751 0 57.488-5.714 84.049-16.718 26.562-11.003 50.929-27.282 71.255-47.612 20.331-20.327 36.609-44.69 47.612-71.255 11.006-26.56 16.718-55.299 16.718-84.049 0-28.752-5.714-57.494-16.718-84.053-11.003-26.563-27.282-50.925-47.612-71.255-20.327-20.331-44.69-36.609-71.255-47.611-26.56-11.007-55.299-16.719-84.049-16.719-28.752 0-57.494 5.714-84.053 16.719-26.563 11.002-50.925 27.28-71.255 47.611-20.331 20.331-36.609 44.69-47.611 71.255-11.007 26.559-16.719 55.301-16.719 84.053z m0 0z" p-id="3563"><\/path><\/svg>'):this.svgContainer.append('<svg t="1599123147130" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3561" width="14" height="14"><path d="M506.892 81.849c-241.603 0-439.276 197.674-439.276 439.276 0 241.598 197.674 439.271 439.276 439.271 241.598 0 439.269-197.674 439.269-439.271 0-241.603-197.674-439.276-439.269-439.276z m0 834.618c-219.637 0-395.348-175.709-395.348-395.342 0-219.637 175.709-395.348 395.348-395.348 219.633 0 395.342 175.709 395.342 395.348-0.001 219.633-175.711 395.342-395.342 395.342z m0 0z" p-id="3562"><\/path><\/svg>')},enumerable:!1,configurable:!0}),t.prototype.createInnerContainer=function(){n.prototype.createInnerContainer.call(this);this.svgContainer=$("<span><\/span>");this.innerContainer.append(this.svgContainer)},t}(t);n.ExportingRadioUI=r;u=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),Object.defineProperty(t.prototype,"extraCssName",{get:function(){return"fgc-radio-system"},enumerable:!1,configurable:!0}),t}(t);n.SystemRadioUI=u;f=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),Object.defineProperty(i.prototype,"extraCssName",{get:function(){return"fgc-radio-modern"},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"primaryColor",{set:function(t){this.innerContainer.css("color",t);var r=".".concat("FUI-radio",'[styleId="').concat(this.target.styleId,'"].').concat("FUI-checked",".").concat("FUI-focus"," > .").concat("FUI-toggle-inner"),i=document.createElement("style");i.appendChild(document.createTextNode("".concat(r,"{box-shadow: 0 0 3px 2px ").concat(n.ColorHelper.UpdateTint(t,0,128),"}")));this.container.append($(i))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"secondaryColor",{set:function(n){var t=document.createElement("style");t.appendChild(document.createTextNode(".".concat("FUI-radio",'[styleid="').concat(this.target.styleId,'"] >.').concat("FUI-toggle-inner","::after{background-color:").concat(n," !important}")));this.container.append($(t))},enumerable:!1,configurable:!0}),i}(t);n.ModernRadioUI=f;e=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),Object.defineProperty(i.prototype,"extraCssName",{get:function(){return"fgc-toggle-switch"},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"primaryColor",{set:function(t){this.innerContainer.css("color",t);var r=".".concat("FUI-radio",'[styleId="').concat(this.target.styleId,'"].').concat("FUI-focus"," > .").concat("FUI-toggle-inner"),i=document.createElement("style");i.appendChild(document.createTextNode("".concat(r,"{box-shadow: 0 0 3px 2px ").concat(n.ColorHelper.UpdateTint(t,0,128),"}")));this.container.append($(i))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"secondaryColor",{set:function(n){var t=document.createElement("style");t.appendChild(document.createTextNode(".".concat("FUI-radio",'[styleid="').concat(this.target.styleId,'"] > .').concat("FUI-toggle-inner","::after{color:").concat(n," !important}")));this.container.append($(t))},enumerable:!1,configurable:!0}),i}(t);n.SwitchRadioUI=e;o=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),Object.defineProperty(i.prototype,"extraCssName",{get:function(){return"".concat("fgc-toggle-button"," ").concat("fgc-toggle-groupbutton")},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"text",{set:function(t){n.Common.IsEmpty(t)?this.textContainer.text(" "):this.textContainer.text(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"primaryColor",{set:function(t){this.container.css("color",t);var r=".".concat("FUI-radio",'[styleId="').concat(this.target.styleId,'"].').concat("FUI-checked",".").concat("FUI-focus"),i=document.createElement("style");i.appendChild(document.createTextNode("".concat(r,"{box-shadow: 0 0 3px 2px ").concat(n.ColorHelper.UpdateTint(t,0,128),"}")));this.container.append($(i))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"secondaryColor",{set:function(n){var t=document.createElement("style");t.appendChild(document.createTextNode(".".concat("FUI-radio",'[styleid="').concat(this.target.styleId,'"].').concat("FUI-checked"," > .").concat("FUI-toggle-text","{color:").concat(n," !important}")));this.container.append($(t))},enumerable:!1,configurable:!0}),i}(t);n.ButtonRadioUI=o;n.CellTypeHelper.registerCellType("Forguncy.RadioGroupCellType, ServerDesignerCommon",s)})(Forguncy||(Forguncy={}))
;var __assign=this&&this.__assign||function(){return __assign=Object.assign||function(n){for(var t,r,i=1,u=arguments.length;i<u;i++){t=arguments[i];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},__assign.apply(this,arguments)},__spreadArray=this&&this.__spreadArray||function(n,t,i){if(i||arguments.length===2)for(var r=0,f=t.length,u;r<f;r++)!u&&r in t||(u||(u=Array.prototype.slice.call(t,0,r)),u[r]=t[r]);return n.concat(u||Array.prototype.slice.call(t))},Forguncy;(function(n){var f=function(){function t(){}return t.initialize=function(){$(document).on("initPageData",function(){t.OnRowCountChanged()});$(window).on("ForguncyRowCountChanged",function(){t.OnRowCountChanged()});n.Platform.isIOSDevice&&(window.onpageshow=function(n){n.persisted&&($("body").remove(),window.location.reload())});$(window).resize(function(){n.PageBuilder.onWindowResize(!1,!1,!0)});$(window).on("popstate",function(r){var o,f,s,e,u,h;if(i.pagesContainer.length&&r.originalEvent.state){if(f=r.originalEvent.state,f.isPopup&&f.commandParam&&f.parentPages===n.ForguncyData.getParentPages()){s=JSON.parse(f.commandParam);s.hasPushState=!0;n.ForguncyData.commandExecutor.executeCommand([s],{runTimePageName:n.ForguncyData.pageInfo.runTimeNormalPage,commandTrigger:null,commandID:n.Common.getUniqueNumber().toString(),eventType:null,initParams:JSON.parse((o=f.params)!==null&&o!==void 0?o:"null"),locationString:n.RS.CommandLog_BrowserHistoryChangeShowPopup});return}if(n.ForguncyData.isMobileCoverPage()){n.ClosePopupCommand.ClosePopup(!0);return}if(e=r.originalEvent.state,e.pageName===t.getRootPageName())return;if(u=JSON.parse(e.pageContext),!n.Platform.isIOSDevice()&&(t.tryToCommitActvieElement(),h=n.ForguncyData.pageDirtyCheckManager.shouldCancelByPageDirty(!1,!0,"Window: popstate event"),h)){n.ForguncyData.historyIndex>(u===null||u===void 0?void 0:u.historyIndex)?history.forward():history.back();return}u&&(u.querys=undefined,u.passValues=undefined,u.sortInfoCache=undefined,u.columnFilterQueryCache=undefined,u.runtimeQueryConditionDataCache=undefined,e.pageContext=JSON.stringify(u));n.SessionStorageManager.pageContext=n.Common.JsonUrlSwitch(e.pageContext);n.PageBuilder.loadPage(e.pageName,u);n.SessionStorageManager.pageContext=null;n.Platform.isIOSDevice()&&window.location.reload()}});$(window).on("beforeunload",function(r){var u,f;if(!i.isDownloading)return(t.tryToCommitActvieElement(),u=n.ForguncyData.pageDirtyCheckManager.getDirtyElement(!1,!1),!u)?void 0:(n.ForguncyData.pageDirtyCheckManager.consoleWithNewLog(u,"Window: beforeunload event",null),f=n.RS.LeaveSiteConfirm,r&&(r.returnValue=f),f)});n.DomUtilities.applyPentrableEvent();n.PageZoomHelper.disablePageZoomForMobile()},t.getRootPageName=function(){var t;return((t=n.ForguncyData.pageInfoStack)===null||t===void 0?void 0:t.length)>0?n.ForguncyData.pageInfoStack[0].pageName:n.ForguncyData.pageInfo.pageName},t.tryToCommitActvieElement=function(){var i,t;document.activeElement&&(t=(i=n.ForguncyData.pageInfo.pageElementManager.cells.getCell(document.activeElement.id))===null||i===void 0?void 0:i.cellType,(t===null||t===void 0?void 0:t.shouldCheckDirtyWhenLeavePage())&&t.commitValue())},t.OnRowCountChanged=function(){n.RecordNavigationCellType.updateNavigationCellTypeText("currentCountLabel",n.RecordNavigationCellType.updateCurrentCountLabel)},t}(),r,i,t,u;n.GlobalEventManager=f;r=function(){function t(){}return t.isBuiltInPage=function(i){for(var r in n.BuiltInPageType)if(t.builtInPages[r]===i)return!0;return!1},t}();n.BuiltInPageManager=r;i=function(){function i(){}return Object.defineProperty(i,"pagesContainer",{get:function(){return $("#pagesContainer")},enumerable:!1,configurable:!0}),Object.defineProperty(i,"pageDebugWarningInfoNumberContainer",{get:function(){return $("#fgc-debug-warning-info-num-container")},enumerable:!1,configurable:!0}),Object.defineProperty(i,"pageCover",{get:function(){return $("#pageCover")},enumerable:!1,configurable:!0}),Object.defineProperty(i,"pageLoadingCover",{get:function(){return $("#pageLoadingCover")},enumerable:!1,configurable:!0}),Object.defineProperty(i,"pageLoadingText",{get:function(){return $("#pageLoadingText")},enumerable:!1,configurable:!0}),i.hidePageLoadingCover=function(){var n;(n=i===null||i===void 0?void 0:i.pageLoadingCover)===null||n===void 0?void 0:n.hide()},i.showPageLoadingCover=function(t){var r,u,f,e,o,s;(f=(u=(r=n.ForguncyData===null||n.ForguncyData===void 0?void 0:n.ForguncyData.pageInfo)===null||r===void 0?void 0:r.pageElementManager)===null||u===void 0?void 0:u.listviewCollection)===null||f===void 0?void 0:f.loseAllFocus();(e=i===null||i===void 0?void 0:i.pageLoadingCover)===null||e===void 0?void 0:e.css("background-color",t!==null&&t!==void 0?t:this.DefaultLoadingCoverColor);(o=i===null||i===void 0?void 0:i.pageLoadingCover)===null||o===void 0?void 0:o.css("opacity",1);(s=i===null||i===void 0?void 0:i.pageLoadingCover)===null||s===void 0?void 0:s.show()},i.isLoadingConverShow=function(){return i.pageLoadingCover.css("display")!=="none"},i.init=function(){if(n.MetadataLoader.IsInMobileSimulatorFrame()){var i=document.createElement("style");i.innerHTML="\n::-webkit-scrollbar {\n    height: 0px;\n    width: 0px;\n}";document.head.appendChild(i);$("#simpleBarContainer").css("overflow","hidden")}f.initialize();n.MetadataLoader.GetMetaDataResult(function(i){var r=t.createPageMetadata(i);n.PageBuilder.createPage(r,n.Common.getPageContext())})},i.executePageLoadedCommand=function(t,i,r,u,f){if(!n.ForguncyData.commandExecutor){f();return}var o=i&&i.length>0,s=u&&u.length>0,e=function(){n.ForguncyData.pageInfo.pageElementManager.cells.getAllContainerCells().filter(function(t){return t.cellType instanceof n.SubPageContainerCellTypeBase}).forEach(function(n){return n.cellType.executePageLoadedCommand()});s?n.ForguncyData.commandExecutor.executeCommand(u,{runTimePageName:r,commandTrigger:null,commandID:r,eventType:"pageloaded",callbackOnCommandCompleted:function(){f()}}):f()};o?n.ForguncyData.commandExecutor.executeCommand(i,{runTimePageName:t,commandTrigger:null,commandID:t,eventType:"pageloaded",callbackOnCommandCompleted:function(){e()}}):e()},i.loadPage=function(r,u,f){i.pageCover.show();n.Common.initalTimeStamp();n.MetadataLoader.GetMetadataRequest(r,{isSubPage:!1},function(e){var s,o;e&&(o=t.createPageMetadata(e),f&&i.shouldCancelPopup(r,o===null||o===void 0?void 0:o.pageName)&&(n.Common.IsEmpty(o.ReturnUrl)||(o.ReturnUrl=((s=n.ForguncyData.pageInfoStack)===null||s===void 0?void 0:s.length)>0?n.ForguncyData.pageInfoStack[0].pageName:n.ForguncyData.pageInfo.pageName),f=null),n.PageBuilder.createPage(o,u,f))})},i.shouldCancelPopup=function(t,i){return n.Common.IsEmpty(t)||n.Common.IsEmpty(i)||t.toLowerCase()===i.toLowerCase()?!1:r.isBuiltInPage(i)},i.reloadPage=function(){var u=n.ForguncyData.pageInfo.pageName,i=n.Common.getPageContext(),r=n.ForguncyData.pageInfo.pageElementManager.getCurrentPageContext(),t;if(n.MetadataLoader.globalSettingsInited=!1,n.CellTypeStyleTemplateUtils.CellTypeTemplateStyleCache){for(t in n.CellTypeStyleTemplateUtils.CellTypeTemplateStyleCache)n.CellTypeStyleTemplateUtils.PrePageCellTypeTemplateStyleCache[t]=!0;n.CellTypeStyleTemplateUtils.CellTypeTemplateStyleCache={}}if(i)for(t in r)r[t]&&(i[t]=r[t]);else i=r;n.ForguncyData.pageInfoStack=[];n.ForguncyData.pageingInfoList=new n.PageingInfoList;this.loadPage(u,i,null);n.CellTypeStyleTemplateUtils.PrePageCellTypeTemplateStyleCache={}},i.closePopup=function(t,r,u){var h,a,e,c,o,l,f,s,v;for(n.Common.initalTimeStamp(),h=n.ForguncyData.pageInfo.currentRowInfoCollection.list,n.PageBuilder.prepareForShowNewPage(2),a=n.ForguncyData.pageInfoStack,e=a.pop(),n.PageInfo.setCurrentPageInfo(e),n.Page._popupState(),this.updateWarningInfoNumber(),n.PageZoomHelper.initPageZoomInfo(),n.ForguncyData.updatePopupCoverVisbility(!1),c=n.ForguncyData.pageInfo.pageElementManager.cells.getAllCells(),f=0;f<c.length;f++)(o=c[f],o.cellType&&o.cellType.CellElement)&&(l=o.cellType.CellElement.CellType,l&&l.CommandExcuteKind===1&&o.cellType.initValueWhenTriggerValueChangedCommand());for(n.PageBuilder._restoreParentPageElements(i.pagesContainer.find("#centerDiv_"+e.pageID)),n.ListviewBase.onPageCreated(),f=0;f<h.length;f++)n.Common.isPageContainsTableBinding(e.pageName,h[f].currentTable)&&e.currentRowInfoCollection.setCurrentRowInfo(h[f],!1);if(u&&t&&t.querys)for(s in t.querys)n.ForguncyData.pageInfo.commandQuerys[s]!==t.querys[s]&&(n.ForguncyData.pageInfo.commandQuerys[s]=t.querys[s],r=!0);n.NormalCellBindingManager.reloadData(null,r);t&&t.passValues&&(v=t.passValues,n.DelayOperateHelper.Push(null,function(){n.ForguncyData.pageInfo.pageElementManager.initPassedValues(v,!0)},2));n.DelayOperateHelper.Push(null,function(){var f,i,r,u,e,o;if(n.Page._trigger("popupclosed"),t===null||t===void 0?void 0:t.closePopupCallbackContext){for(i=t.closePopupCallbackContext,r={},r[i.ClosePopupCallbackCommand.ParamProperties.IsOK]=i.ClosePopupResult===n.ClosePopupResult.Ok?1:0,u=0,e=i.ClosePopupReturnValues;u<e.length;u++)o=e[u],r[o.Name]=o.Value;n.ForguncyData.commandExecutor.executeCommand(i.ClosePopupCallbackCommand.Commands,{runTimePageName:(f=i.runTimePageName)!==null&&f!==void 0?f:n.ForguncyData.pageInfo.runTimeNormalPage,commandTrigger:null,commandID:n.Common.generateID(),eventType:"popupclosed",initParams:r,locationString:n.RS.ClosePopupCallbackCommand})}},2);i.pageCover.hide()},i.getHistoryIndex=function(t){var r,u,i=t===null||t===void 0?void 0:t.historyIndex,f;return n.Common.IsEmpty(i)?(f=(r=history.state)===null||r===void 0?void 0:r.pageContext,n.Common.IsEmpty(f)||(i=(u=JSON.parse(f))===null||u===void 0?void 0:u.historyIndex),!n.Common.IsEmpty(i))?i:history.length:i},i.shouldKeepMasterPage=function(t,i){var r,u,f,e,o,s,h,c=(f=(u=(r=i.MasterPage)===null||r===void 0?void 0:r.PageSettings)===null||u===void 0?void 0:u.Name)!==null&&f!==void 0?f:"";return!n.ForguncyData.alwaysUsePAsRunTimePageName()&&!t&&((e=n.ForguncyData.pageInfoStack)===null||e===void 0?void 0:e.length)<=0&&!n.Common.IsEmpty(c)&&n.ForguncyData.pageInfo.masterPageName===c&&((o=i.storageUserName)!==null&&o!==void 0?o:"")===((h=(s=n.ForguncyData.userInfo)===null||s===void 0?void 0:s.UserName)!==null&&h!==void 0?h:"")&&n.Common.IsEmpty(i.ReturnUrl)},i.createPage=function(r,f,e){var b=this,p,h,o,a,w,v,y;if(t.checkError(r)!==!1){if(h=[],r.Modules&&(h=h.concat(r.Modules)),((p=r===null||r===void 0?void 0:r.MasterPage)===null||p===void 0?void 0:p.Modules)&&(h=h.concat(r.MasterPage.Modules)),!n.ModuleLoader.IsModuleLoaded(h)){n.ModuleLoader.LoadModels(h,n.ForguncyData.ForguncyRoot).done(function(){b.createPage(r,f,e)});return}i.pageIsLoading=!0;i.pageTotallyLoaded=!1;i.hasCallOnPageLoaded=!1;i.hasExecutePageLoadedCommand=!1;n.ForguncyData.enterHistoryCount=history.length;o=!!(e===null||e===void 0?void 0:e.isShowAsPopup);o||(n.ForguncyData.historyIndex=this.getHistoryIndex(f));var nt=n.ForguncyData.pageInfo.runTimeNormalPage,tt=n.ForguncyData.pageInfo.runTimeMasterPage,c=i.shouldKeepMasterPage(o,r);c?(f||(f={}),i.saveMaterPageContext(f),i.prepareForShowNewPageWhenKeepMasterPage()):i.prepareForShowNewPage(o?1:0);var k=i.getNewPageRunTimePageNames(),s=k.runTimeNormalPageName,l=k.runTimeMasterPageName;c&&(l=tt);a=3;o&&(a=2,e.popupDisplayMode===4&&(a=3),e.popupDisplayMode===3&&(e.drawerDirection===1||e.drawerDirection===0?a=0:(e.drawerDirection===2||e.drawerDirection===3)&&(a=1)));w=new u(r,n.ForguncyData.pageInfo,s,l,a);w.initForguncyData(o,c);n.ForguncyData.isDebugMode()&&(this.initWarningInfoNumberContainer(),n.ForguncyData.pageInfo.dataModel.debugWarningInfoDataModel.bind("collectionchanged",function(){b.updateWarningInfoNumber()}));w.setPageInfoByMetadata();var d=n.ForguncyData.pageInfo.pageID,g=function(){i.initDefaultDataAndModels(r,s,c?null:l);var u=n.ForguncyData.pageInfo.pageElementManager.cells.getAllContainerCells().some(function(t){return t.cellType instanceof n.SubPageContainerCellTypeBase}),t=(e===null||e===void 0?void 0:e.popupDisplayMode)===0;u?n.DelayOperateHelper.Push(null,function(){i.initPageDataAndExecutePageLoadedCommand(r,f,o,s,l,t,d,c)},2):i.initPageDataAndExecutePageLoadedCommand(r,f,o,s,l,t,d,c)},it=n.PageBuilder.loadUserJavaScript(r,g);if(n.PageZoomHelper.initPageZoomInfo(),v=r.PageSettings.PageLoadingMode,v===0&&(v=n.ForguncyData.GlobalSettings.PageLoadingMode),v===1&&(y=document.createElement("style"),y.innerHTML=".disableAnimationWhenLoad,.disableAnimationWhenLoad * { transition : 0s !important}",document.head.appendChild(y)),c){i._createPageElementsWhenKeepMasterPage(r,s,nt);i.onLoad([s])}else{i._createPageElements(r,e,s,l,a);i.onLoad([s,l]);n.ListviewBase.onPageCreated()}it&&g();n.HomeController.Operate();$(document).trigger("forguncyPageloaded");v===1&&window.requestAnimationFrame(function(){y.remove()})}},i.getNewPageRunTimePageNames=function(){return n.ForguncyData.alwaysUsePAsRunTimePageName()?{runTimeNormalPageName:n.StaticValues.RunTimeNormalPagePrefix,runTimeMasterPageName:n.StaticValues.RunTimeMasterPagePrefix}:n.PageManager.getUniquePageName()},i.saveMaterPageContext=function(t){var i=n.PageManager.getNestedRunTimePageNames([n.ForguncyData.pageInfo.runTimeMasterPage]).map(function(t){return n.PageManager.getDesignerPageName(t,!1)});n.NavigateCommandBase.addCurrentInfosToPageContext(t,i);n.NavigateCommandBase.addCommandQuerysToPageContext(t,i);n.NavigateCommandBase.addSortInfoToPageContext(t,i);n.NavigateCommandBase.addColumnFilterQueriesToPageContext(t,i);n.NavigateCommandBase.addRuntimeQueryConditionDataToPageContext(t,i)},i.initWarningInfoNumberContainer=function(){var r=this,t=this.pageDebugWarningInfoNumberContainer,f,u;t.css("position","fixed");t.css("right","20px");t.css("bottom","20px");t.css("display","flex");t.css("cursor","pointer");t.css("background-color","white");t.css("border","1px solid #D9D9D9");t.css("padding","3px 5px");f=t.find(".warning-info-icon");f.css("width","14px");f.css("height","14px");u=t.find(".warning-info-num");u.css("color","#595959");u.css("font-size","12px");u.css("padding-left","3px");t.off("click");t.on("click",function(){var u=n.ForguncyData.pageInfo.dataModel.debugWarningInfoDataModel.list,t=n.PopupHelper.createPopupDom(i.pagesContainer,r.warningPopupDialogContent,n.Common.format(n.RS.DebugWarningChecker_PopupTitle,u.length),{popupDisplayMode:3,drawerDirection:3,closeWhenClickGrayArea:!0,anchor:null,dialogLocation:"50%",showDrawerHeader:!0});t.target.off("Close");t.target.on("Close",function(){t.target.hide();n.ForguncyData.pageInfo.dataModel.debugWarningInfoDataModel.bind("collectionchanged",function(){r.updateWarningInfoNumber()});r.updateWarningInfoNumber()});n.ForguncyData.pageInfo.dataModel.debugWarningInfoDataModel.unbind("collectionchanged");r.pageDebugWarningInfoNumberContainer.hide();t.target.show()});this.updateWarningInfoNumber()},Object.defineProperty(i,"warningPopupDialogContent",{get:function(){var i=n.ForguncyData.pageInfo.dataModel.debugWarningInfoDataModel.list,t=$("<div><\/div>");return t.css("max-width","300px"),t.css("font-size","12px"),t.css("color","#9B4804"),i.forEach(function(i){var r=$('<div class="warning-content-div"><\/div>'),u,f;r.css("background-color","#FFFBE6");r.css("padding","3px 10px");r.css("display","flex");u=$('<img src="'.concat(n.Helper.SpecialPath.getBaseUrl(),'Resources/Images/ConfirmDialog/Warning.png"><\/img>'));u.css("width","14px");u.css("height","14px");f=$("<span>".concat(i.message,"<\/span>"));f.css("margin-left","3px");r.append(u);r.append(f);t.append(r)}),t},enumerable:!1,configurable:!0}),i.updateWarningInfoNumber=function(){var t=n.ForguncyData.pageInfo.dataModel.debugWarningInfoDataModel.list;t.length>0?(this.pageDebugWarningInfoNumberContainer.find(".warning-info-num").html("".concat(t.length)),this.pageDebugWarningInfoNumberContainer.show()):this.pageDebugWarningInfoNumberContainer.hide()},i.onWindowResize=function(t,r,u){t?n.PageBuilder._reallyResize(r,u):(n.PageBuilder._resizeTimer&&(n.DelayRefresh.clearTimeout(n.PageBuilder._resizeTimer),n.PageBuilder._resizeTimer=null),n.PageBuilder._resizeTimer=n.DelayRefresh.setTimeout(function(){window.requestAnimationFrame(function(){n.PageBuilder._reallyResize(r,u)})},20));i.adjustBackgroundImageSize(!0)},i.adjustBackgroundImageSize=function(n){var f=$("[".concat("FitToBrowserHeight","]")),e=$("[".concat("FitToBrowserWidth","]")),o=$("[".concat("fgc-page-mainpart","]")),t;for(f.css("position","relative"),e.css("position","relative"),t=0;t<f.length;t++){var r=$(f[t]),c=r.offset(),s=r.css("top"),a=s.endsWith("px")?Number(s.substr(0,s.length-2)):0,l=parseFloat(o.css("padding-bottom"));r.css("top",a-c.top);r.css("height",Math.max(i.pagesContainer.height(),o.height(),r.parent().height(),isNaN(l)?0:l))}for(t=0;t<e.length;t++){var u=$(e[t]),c=u.offset(),h=u.css("left"),v=h.endsWith("px")?Number(h.substr(0,h.length-2)):0;u.css("left",v-c.left);u.css("width",Math.max(i.pagesContainer.width(),u.parent().width(),o.width()))}n&&f.length>0&&i.adjustBackgroundImageSize(!1)},i._reallyResize=function(t,i){var r,u;i&&n.ForguncyData.pageInfoStack.forEach(function(t){var i;(t.isPopup||n.PageManager.whetherExistPageStretch(t))&&((i=t===null||t===void 0?void 0:t.pageElementManager)===null||i===void 0?void 0:i.resizePageElements(null,!1))});(t||n.ForguncyData.pageInfo.isPopup||n.PageManager.whetherExistPageStretch(n.ForguncyData.pageInfo))&&((u=(r=n.ForguncyData.pageInfo)===null||r===void 0?void 0:r.pageElementManager)===null||u===void 0?void 0:u.resizePageElements(null,t));n.PageBuilder._resizeTimer=null},i.prepareForShowNewPageWhenKeepMasterPage=function(){n.DelayRefresh.RunNow();n.ForguncyData.pageInfoStack.push(n.PageInfo.getCurrentPageInfo());n.ForguncyData.pageDirtyCheckManager.boforePageCreate(0);n.ForguncyData.commandExecutor&&n.ForguncyData.commandExecutor.init();n.ForguncyData.pageInfo.formulaManager&&n.ForguncyData.pageInfo.formulaManager.destroy(0);n.ForguncyData.pageInfo.dialogUI=null;n.ForguncyData.pageInfo.commandQuerys={};n.ForguncyData.pageInfo.sortInfoCache={};n.ForguncyData.pageInfo.columnFilterQueryCache={};n.ForguncyData.pageInfo.runtimeQueryConditionDataCache={};n.SubPageHelper.preDestroySubPage(n.ForguncyData.pageInfo.runTimeNormalPage);n.Page._elements.destroy(n.PageManager.getNestedRunTimePageNames([n.ForguncyData.pageInfo.runTimeNormalPage]));n.ForguncyData.pageInfo.currentRowInfoCollection.list=[];n.ForguncyData.pageInfo.dataModel.debugWarningInfoDataModel.unbindAll();n.ForguncyData.pageInfo.dataModel.debugWarningInfoDataModel=new n.DebugWarningInfoDataModel;n.DelayRefresh.Init()},i.prepareForShowNewPage=function(t){t===1&&(n.ListviewBase.getAllListviews().forEach(function(n){return n.focus(!1)}),$(document.activeElement).blur());t!==2&&(n.DelayRefresh.RunNow(),n.ForguncyData.pageInfoStack.push(n.PageInfo.getCurrentPageInfo()),n.Page._pushCurrentState());n.ForguncyData.pageDirtyCheckManager.boforePageCreate(t);n.ForguncyData.commandExecutor&&n.ForguncyData.commandExecutor.init();n.ForguncyData.pageInfo.pageID&&n.ListviewBase.onPageDestroyed();t===2&&i._destroyOldPageElements(n.ForguncyData.pageInfo);i.clearForguncyData(t);n.Page._init();n.DelayRefresh.Init()},i.clearForguncyData=function(t){n.ForguncyData.pageInfo.pageElementManager&&(n.ForguncyData.pageInfo.pageElementManager=undefined);n.ForguncyData.pageInfo.formulaManager&&(n.ForguncyData.pageInfo.formulaManager.destroy(t),n.ForguncyData.pageInfo.formulaManager=undefined);n.ForguncyData.pageInfo.dialogUI=null;n.ForguncyData.pageInfo.commandQuerys={};n.ForguncyData.pageInfo.sortInfoCache={};n.ForguncyData.pageInfo.columnFilterQueryCache={};n.ForguncyData.pageInfo.runtimeQueryConditionDataCache={};n.ForguncyData.pageInfo.dataModel=new n.DataModel},i._destroyOldPageElements=function(n){n&&n.pageElementManager&&(n.releaseDialog(),n.pageElementManager.destroy(n))},i._changeParentPageElements=function(t){t.length!==0&&(n.ForguncyData.alwaysUsePAsRunTimePageName()&&(i._changeElementIdAndName(t),i._recoverySvgElementId(t)),i._changeElementAttr(t,"fgcname","fgcname_temp",!1,null),i._changeElementAttr(t,"tabindex","tabindex_temp",!1,-1))},i._recoverySvgElementId=function(n){for(var i,r=n.find("svg").find("[id_temp]"),t=0;t<r.length;t++)i=r[t],i.id=i.getAttribute("id_temp")},i._changeElementIdAndName=function(n){for(var t,r=n.find("[id]"),u=r.length,i=0;i<u;i++)t=$(r[i]),t.attr("id_temp",t.attr("id")),t.attr("name_temp",t.attr("name")),t.attr("id",null),t.attr("name",null)},i._changeElementAttr=function(n,t,i,r,u){for(var f,o=n.find("["+t+"]"),s=o.length,e=0;e<s;e++)f=$(o[e]),f.attr(i,f.attr(t)),r?f.removeAttr(t):f.attr(t,u)},i._restoreParentPageElements=function(t){var f,e,u,r;if(t.length!==0){if(n.ForguncyData.alwaysUsePAsRunTimePageName())for(f=t.find("[id_temp]"),e=f.length,u=0;u<e;u++)r=$(f[u]),r.attr("id",r.attr("id_temp")),r.attr("name",r.attr("name_temp")),r.attr("id_temp",null),r.attr("name_temp",null);i._changeElementAttr(t,"fgcname_temp","fgcname",!1,null);i._changeElementAttr(t,"tabindex_temp","tabindex",!0,null)}},i._createPageElementsWhenKeepMasterPage=function(t,r,u){var s=n.ForguncyData.pageInfo.pageID,e=$("#centerDiv_"+s).children("#placeHolderDiv"),o=t.PageSettings.PageLoadingMode,f;o===0&&(o=n.ForguncyData.GlobalSettings.PageLoadingMode);o!==2&&(n.ForguncyData.pageInfo.releaseDialog(),n.SubPageHelper.destroySubPage(u),n.ForguncyData.pageInfoStack=[],e.empty(),(i===null||i===void 0?void 0:i.pageLoadingCover)&&i.pageLoadingCover.css("opacity","0"),n.KeyWords.updatePageNameAndTitle());e.css("overflow-y")===""&&n.Presentation.PlaceHolderElementPresenter.updatePlaceHolderOverflow(e,t,!1);f=n.Presentation.PageContentCreator.createPagePartDiv(t,null,r,r,3,2,null);f.attr("id",r);o===2&&(f.attr("oldDisplay",f.css("display")),f.css("display","none"));e.append(f);n.CurrentUserCellTypeBuilder.UpdateAllNotificationIcon()},i._createPageElements=function(t,r,u,f,e){var l=i.pagesContainer,b=n.ForguncyData.pageInfoStack,k=b.length,d,g,o,s,y,nt,a,tt,v,p,w,c;if(k>0&&(d=b[k-1].pageID,n.PageBuilder._changeParentPageElements(l.find("#centerDiv_"+d))),g=n.ForguncyData.pageInfo.pageID,o=$(document.createElement("form")).attr({method:"post",id:"".concat("pageWrapper_"+g)}),o.addClass("fgc-page-wrapper"),o.submit(function(){return!1}),s=t.PageSettings.PageLoadingMode,s===0&&(s=n.ForguncyData.GlobalSettings.PageLoadingMode),y=!1,r&&r.isShowAsPopup)nt=n.Common.getMultiLanguageWord(t.PageSettings.Title),a=n.PopupHelper.createPopupDom(l,o,nt,r),s===2&&(a.target.opacity=0),a.zIndex=n.ForguncyData.pageInfoStack.length,n.ForguncyData.pageInfo.dialogUI=a,n.ForguncyData.pageInfo.dialogUI.target.show();else{if(o.css("z-index",n.ForguncyData.pageInfoStack.length),o.addClass("fgc-container-absolute"),s===2)o.css("opacity","0");else{for(tt=n.ForguncyData.pageInfoStack.length,v=0;v<tt;v++)i._destroyOldPageElements(n.ForguncyData.pageInfoStack[v]);n.ForguncyData.pageInfoStack=[];l.empty();(i===null||i===void 0?void 0:i.pageLoadingCover)&&i.pageLoadingCover.css("opacity","0");y=!0}l.append(o)}n.ForguncyData.pageInfo.normalCellBindingManager=new n.NormalCellBindingManager(n.ForguncyData.pageInfo.dataModel.normalCellDataModel);n.PageBuilder.initalPageElementManager();var it=i.createPageContent(t,u,f,r&&r.isShowAsPopup,e),ut=t.MasterPage?f:u,ft=n.PageManager.getPageStretchInfo(ut);if(i.updatePageWrapperLayout(o,it,ft,t),o.append(it),y&&i.adjustBackgroundImageSize(!1),o.append($(document.createElement("input")).css("display","none")),p=t.TrailMessage,!p||r&&r.isShowAsPopup||(n.RS.Culture==="cn"?o.append("<a href='https://www.grapecity.com.cn/solutions/huozige?utm_source=exe&utm_medium=huozige' target='_blank' style='color:black; text-decoration: none;'><div style='display:flex; align-items:center; justify-content: center; text-align: center; background-color:#F1F3F4; font-size:12px; position:fixed; bottom:0; width:100%; height:30px;'><img src='"+n.ForguncyData.ForguncyRoot+"Resources/Images/SiteBuiltInImages/huozigeLogo.png' width='16' height='16' /><span style='margin-left:5px;'>本系统由活字格免费版开发<\/span><\/div><\/a>"):n.RS.Culture==="en"?o.append("<a href='https://www.forguncy.net/' target='_blank' style='color:black; text-decoration: none;'><div style='display:flex; align-items:center; justify-content: center; text-align: center; background-color:#F1F3F4; font-size:12px; position:fixed; bottom:0; width:100%; height:30px; font-family: Calibri'><span style='margin-left:5px;'>This application is running on an unlicensed Forguncy server. Visit www.forguncy.net to purchase the server license.<\/span><\/div><\/a>"):(w=$("<div style='color:red;text-align: center;position:relative;z-index:1000'>"+p+"<div>"),n.Presentation.GridRender.renderElement(w[0],{rowStart:1,rowEnd:2,columnStart:1,columnEnd:4},null),o.prepend(w))),n.ForguncyData.forceMobileChild&&!(r&&r.isShowAsPopup)){var rt=375,h=rt/o.children().width();h>1&&(h=1);c=$("#fgc-mobile-iframe",window.parent.document);c.css("transform","scale("+h+")");c.css("transform-origin","left top");c.width(rt/h);c.height(667/h)}},i.createPageContent=function(t,i,r,u,f){var e=n.Presentation.PageContentCreator.create(t,i,r,u?1:0,f);return e.attr("id","centerDiv_"+n.ForguncyData.pageInfo.pageID),e.attr("fgc-page-mainpart","true"),e},i.updatePageWrapperLayout=function(t,i,r,u){var f=new n.Presentation.Grid;f.rows=["auto","1fr"];f.columns=this.getColumnsStyle(r,u);n.Presentation.GridRender.renderContainer(t[0],f);n.Presentation.GridRender.renderElement(i[0],{rowStart:2,rowEnd:3,columnStart:2,columnEnd:3},null)},i.getColumnsStyle=function(t,i){var r=null,f=(i.MasterPage||i).PageSettings,e=f.ColumnDefinitions.some(function(n){return n.Mode===2}),o=n.Presentation.StretchCommon.canHorizontallyStretch(t.StretchMode)||e,u=o?"100%":"auto";switch(n.ForguncyData.GlobalSettings.MainPageHorizontalAlignment){case 1:r=["1fr",u,"1fr"];break;case 2:r=["1fr",u,"0"];break;default:r=["0",u,"1fr"]}return r},i.onLoad=function(t){var r=n.ListviewBase.getAllListviews(t),i;r.forEach(function(n){return n.onLoad()});i=n.ForguncyData.pageInfo.pageElementManager.cells.getAllCells(t);i.forEach(function(n){return n.onLoad()})},i.onPageLoaded=function(t){n.ForguncyData.pageInfo.pageElementManager.onPageLoaded(t)},i.initDefaultDataAndModels=function(t,i,r,u){var f=[i,r].filter(function(n){return!!n}),e;n.ForguncyData.pageInfo.autoIDManager.cacheFieldCells();n.ForguncyData.pageInfo.pageElementManager.initCellDefaultValue(f);n.ForguncyData.pageInfo.autoIDManager.initAutoGeneratedID(f);e=n.DataSourceListview.getFormulaInfos(i);n.ForguncyData.pageInfo.formulaManager.init(t,n.ForguncyData.pageInfo.dataModel,i,r,e,u);n.ForguncyData.pageInfo.defaultFormulaManager.setDefaultFormula(f);n.ForguncyData.pageInfo.pageElementManager.initUserControlDefaultValues(u);n.ForguncyData.pageInfo.pageElementManager.onDefaultDataSetted(f)},i.initPageDataAndExecutePageLoadedCommand=function(t,r,u,f,e,o,s,h){var p=this,l,a,c,v,y;n.Page._trigger("loaded");i.hasCallOnPageLoaded=!0;c=h?n.PageManager.getNestedRunTimePageNames([f]):null;i.onPageLoaded(c);v=n.ForguncyData.pageInfo.pageElementManager.cells.getAllContainerCells(c).filter(function(t){return t.cellType instanceof n.SubPageContainerCellTypeBase}).map(function(n){return n.cellType});v.forEach(function(n){return n.triggerPageLoadedEvent()});n.ForguncyData.pageInfo.pageElementManager.setPrePageContext(r);this.fillAllListviewData((r===null||r===void 0?void 0:r.DeleteCachedQuery)===!0?null:c);n.DelayOperateHelper.Push(null,function(){if(r&&r.passValues){var t=r.passValues;n.ForguncyData.pageInfo.pageElementManager.initPassedValues(t,!1)}u||n.ForguncyData.pageInfo.pageElementManager.initPluginPassValue()},2);y=n.ForguncyData.pageInfoStack;u||(n.Page._clearState(),n.ForguncyData.pageInfoStack=[]);i.hasExecutePageLoadedCommand=!0;i.executePageLoadedCommand(e,(a=(l=t.masterPageMetaDataObj)===null||l===void 0?void 0:l.PageSettings)===null||a===void 0?void 0:a.PageLoadedCommandList,f,t.PageSettings.PageLoadedCommandList,function(){p.delayFillAllListviewData((r===null||r===void 0?void 0:r.DeleteCachedQuery)===!0?null:c);n.DelayOperateHelper.Push(null,function(){n.DelayRefresh.Push(null,function(){n.ForguncyData.pageInfo.defaultFormulaManager.clearDefaultFormula(h?[f]:[f,e])},"clearDefaultFormula"+f);i.showNewPage(t,u,s,y,o,h,f);i.pageIsLoading=!1},2)});$(document).trigger("initPageData")},i.fillAllListviewData=function(t){var i=n.ListviewBase.getAllListviews(t);i.forEach(function(n){n.firstLoadData()})},i.delayFillAllListviewData=function(t){n.ListviewBase.getAllListviews(t).filter(function(n){return!n.hasRequestData&&n.listviewData.getDelayLoadData()}).forEach(function(n){n.fillData(null,!0)})},i.showNewPage=function(t,r,u,f,e,o,s){n.DelayRefresh.Push(null,function(){if(u===n.ForguncyData.pageInfo.pageID||n.ForguncyData.pageInfoStack.some(function(n){return n.pageID===u})){i.hidePageLoadingCover();i.pageCover.hide();i.pageTotallyLoaded=!0;r||i.prepareShowNewPageDivContainer(u,f,n.Common.getMultiLanguageWord(t.PageSettings.Title),o,s);n.Page._trigger("pagedefaultdataloaded");n.PageBuilder.onWindowResize(!0,!1,!1);if(n.ForguncyData.pageDirtyCheckManager.onPageLoaded(),r){if(e){var h=n.ForguncyData.pageInfo.dialogUI;h===null||h===void 0?void 0:h.setPopupDialogLocation(h.target)}i.showNewPopupDivContainer(u)}else i.showNewPageDivContainer(u,o,s);i.showSimplebarInSimulator()}},"showNewPage"+u)},i.prepareShowNewPageDivContainer=function(t,r,u,f,e){var c,h,s,o;if(f)r.length===1&&(n.ForguncyData.pageInfo.releaseDialog(),n.SubPageHelper.destroySubPage(r[0].runTimeNormalPage),n.KeyWords.updatePageNameAndTitle());else for(c=r.length,o=0;o<c;o++)i._destroyOldPageElements(r[o]);for(document.title=u,i.onDocumentTitleChanged(),f?(h=e,s=$("#centerDiv_"+t).children("#placeHolderDiv").children()):(h="pageWrapper_"+t,$("#"+h).css("z-index","0"),s=i.pagesContainer.children()),o=0;o<s.length-1;o++){if(s[o].id===h)break;$(s[o]).remove()}window.scrollTo(0,0)},i.showNewPopupDivContainer=function(t){n.ForguncyData.updatePopupCoverVisbility(!0);var i=n.ForguncyData.pageInfoStack.filter(function(n){return n.pageID===t});i&&i.length>0?i[0].dialogUI.target.opacity=1:n.ForguncyData.pageInfo.dialogUI.target.opacity=1},i.showNewPageDivContainer=function(t,i,r){var u,f,e;i?(u=$(".fgc-page-container #"+r),u.css("display",u.attr("oldDisplay")),f=n.PageManager.getNestedRunTimePageNames([r]),n.ForguncyData.pageInfo.pageElementManager.resizePageElements(f)):(e="pageWrapper_"+t,$("#"+e).css("opacity",""))},i.showSimplebarInSimulator=function(){if(n.MetadataLoader.IsInMobileSimulatorFrame()){var t=$("#simpleBarContainer");t.css("overflow")==="hidden"&&(new SimpleBar(t[0]),t.css("overflow","auto"))}},i.onDocumentTitleChanged=function(){if(window!==window.top)try{window.parent.location.origin===location.origin&&window.parent.postMessage({type:"TITLE CHANGED",message:{title:window.document.title,url:window.location.href,uid:window.name}},window.location.origin)}catch(n){}},i.loadUserJavaScript=function(t,i){var u,f,r;return n.Common.IsEmpty(t.PageSettings.Script)?!0:(u="userScript_"+t.PageSettings.Name,document.getElementById(u))?!0:(f=document.getElementsByTagName("head")[0],r=document.createElement("script"),r.setAttribute("type","text/javascript"),r.setAttribute("id",u),r.setAttribute("src",n.Common.format("{0}GeneratedResources/UserJavaScript/{1}?v={2}",n.ForguncyData.ForguncyRoot,t.PageSettings.Script,n.StaticData.MetaDataVersion)),r.readyState==="loaded")?(f.appendChild(r),!0):(r.onload=r.onreadystatechange=function(){r.ready||r.readyState&&r.readyState!=="loaded"&&r.readyState!=="complete"||(r.ready=!0,i())},f.appendChild(r),!1)},i.initalPageElementManager=function(){n.ForguncyData.pageInfo.currentRowInfoCollection=new n.CurrentRowInfoCollection(n.ForguncyData.pageInfo.normalCellBindingManager);var t=new n.PageElementManager(n.ForguncyData.pageInfo.currentRowInfoCollection,n.ForguncyData.pageInfo.dataModel);n.ForguncyData.pageInfo.pageElementManager=t},i.DefaultLoadingCoverColor="rgba(255, 255, 255, 0.70)",i.pageIsLoading=!1,i.hasCallOnPageLoaded=!1,i.hasExecutePageLoadedCommand=!1,i.pageTotallyLoaded=!1,i.isDownloading=!1,i._resizeTimer=null,i}();n.PageBuilder=i;t=function(){function t(){}return t.checkError=function(t){var r=t?t.ErrorMessage:"",u,f;return r==="UserLoginedInOtherPlace"?(n.ForguncyData&&n.ForguncyData.userInfo&&n.ForguncyData.userInfo.UserName&&alert(n.Common.format("账号{0}已经在其他计算机上登录",n.ForguncyData.userInfo.UserName)),location.reload(),!1):r==="YouHaveBeKickoffed"?(alert(n.RS.ConcurrentLicenseError_Kickoffed),i.hidePageLoadingCover(),!1):(r&&r.indexOf("1C3E7540-99F6-4BE2-9654-47BE0FB82280")!==-1&&(location.href=n.ForguncyData.ForguncyRoot+r),r&&r.indexOf("DoNotHaveEnoughConcurrencyLicense")===0)?(u=r.split("|"),f="",u.length>=2&&(f=u[1]),n.SendEmailHelper.appendSendEmailConfirm({email:f}),!1):!0},t.createPageMetadata=function(i){var e,o,r,s,f,u;return typeof i=="string"?{ErrorMessage:i}:(r=i,r.globalSettings&&(n.ForguncyData.initGlobalSettings(r.globalSettings),s=(o=(e=n.ForguncyData.GlobalSettings)===null||e===void 0?void 0:e.ThemeFont)!==null&&o!==void 0?o:"",f=n.MultipleLanguageHelper.getMultipleLanguageFontFamily(),t.applyGlobalFontFamilyAndTextColor(f!==null&&f!==void 0?f:s),t.applyGlobalCSSColorVariables()),u=r.metaDataObj,u.MasterPage=r.masterPageMetaDataObj,u=__assign(__assign({},r),u),t.preProcess(u),u)},t.preProcess=function(i){this.updateMasterPageRowDefinition(i);this.updateMetadataOverflowCellBackgrounds(i);this.updateMetadataOverflowCellBackgrounds(i.MasterPage);t.referStyles(i);t.referStyles(i.MasterPage);n.CellTypeStyleTemplateUtils.PrepareTemplateStyles(n.ForguncyData.GlobalSettings.CellTypeStyleTemplates);n.ListViewStyleTemplateUtils.ListViewStyleTemplates=n.ForguncyData.GlobalSettings.ListViewTemplates},t.updateMetadataOverflowCellBackgrounds=function(t){t&&(t.OverflowCellBackgrounds=t.Cells.map(function(t){return n.OverflowHelper.needAdjustDom(t)?{Layout:n.Common.clone(t.Layout)}:null}).filter(function(n){return n!==null}))},t.updateMasterPageRowDefinition=function(n){var i,t,r;if(n.MasterPage&&(i=n.PageSettings.Height,t=n.MasterPage.PlaceHolders[0],t&&t.Height<i&&(r=this.rowDefinitionsContainsAutoOrRange(n),!r))){var f=t.Layout.Row+t.Layout.RowSpan-1,e=n.MasterPage.PageSettings.RowDefinitions[f],u=i-t.Height;e.DesignLengthInPixel+=u;n.MasterPage.PageSettings.Height+=u;n.MasterPage.PageSettings.hasLengthenHeight=!0}},t.rowDefinitionsContainsAutoOrRange=function(n){for(var f,i,r=n.MasterPage.PlaceHolders[0],u=!1,t=0;t<r.Layout.RowSpan;t++)if(f=r.Layout.Row+t,i=n.MasterPage.PageSettings.RowDefinitions[f],i.Mode===1||i.Mode===2){u=!0;break}return u},t.getDefaultFonts=function(t){return t=t!==null&&t!==void 0?t:n.LocaleFonts[n.RS.Culture],n.RS.Culture==="cn"?'"'.concat(t,'","PingFangSC","Helvetica neue","Hiragino sans gb","Arial","Microsoft YaHei UI","Microsoft YaHei","SimSun","sans-serif"'):n.RS.Culture==="ja"?'"'.concat(t,'","Meiryo","ヒラギノ角ゴ Pro W3","Hiragino Kaku Gothic Pro","ＭＳ Ｐゴシック","Arial","sans-serif"'):n.RS.Culture==="kr"?'"'.concat(t,'","Malgun Gothic","돋움","Dotum","Helvetica Neue","Helvetica","Arial","sans-serif"'):'"'.concat(t,'","Calibri","Segoe UI","Arial","sans-serif"')},t.applyGlobalFontFamilyAndTextColor=function(i,r){if(r===void 0&&(r=!1),!t.isGlobalFontFamilyExisted||r){t.isGlobalFontFamilyExisted=!0;var u=t.getDefaultFonts(i),f=n.ColorHelper.Convert("Text 1");$("#fgc-global-style").remove();$(document.head).append($('<style id="fgc-global-style">html {font-family: '.concat(u,"; color:").concat(f,";}<\/style>")))}},t.applyGlobalCSSColorVariables=function(){var t=document.createElement("style");t.type="text/css";t.id="FGC_CSS_Color_Variables";t.innerHTML="\n                :root {\n                  ".concat("--FGC_Accent1",": ").concat(n.ColorHelper.GetThemeColor("Accent 1"),";\n                  ").concat("--FGC_ButtonPrimary",": ").concat(n.ColorHelper.GetThemeColor("Accent 1"),";\n                  ").concat("--FGC_ButtonHover",": ").concat(n.ColorHelper.GetThemeColor("Accent 1 20"),";\n                  ").concat("--FGC_ButtonActive",": ").concat(n.ColorHelper.GetThemeColor("Accent 1 -20"),";\n                  ").concat("--FGC_Accent1_RGB_Number",": ").concat(n.ColorHelper.GetRGBNumberString("Accent 1"),";\n                  ").concat("--FGC_ButtonPrimary_RGB_Number",": ").concat(n.ColorHelper.GetRGBNumberString("Accent 1"),";\n                  ").concat("--FGC_ButtonHover_RGB_Number",": ").concat(n.ColorHelper.GetRGBNumberString("Accent 1 20"),";\n                  ").concat("--FGC_ButtonActive_RGB_Number",": ").concat(n.ColorHelper.GetRGBNumberString("Accent 1 -20"),";\n                }");document.getElementsByTagName("head")[0].appendChild(t)},t.referStyles=function(i){var u,r;if(i)for(u=0;u<i.Cells.length;u++)r=i.Cells[u],r.StyleIndex>=0&&(r.StyleInfo=n.Common.clone(i.StyleMetaDatas[r.StyleIndex])),t.referStyleTemplateMetadata(r,n.ForguncyData.GlobalSettings.CellTypeStyleTemplates)},t.referStyleTemplateMetadata=function(t,i){if(t.CellType&&t.CellType.TemplateKey){var r=t.CellType.$type.split(",")[0],u=t.CellType.TemplateKey;t.StyleTemplate=n.CellTypeStyleTemplateUtils.GetStyleTemplateByKey(r,u,i)}},t.getPageStretchInfo=function(t,i){var r={StretchMode:0},u;return i===2?r:n.Common.IsEmpty(t)?r:(u=t.PageSettings,r.StretchMode=n.Presentation.StretchCommon.getStretchMode(u.PageResponsiveMode,i),r)},t}();n.MetadataHelper=t;u=function(){function i(n,t,i,r,u){this.pageMetadata=n;this.pageInfo=t;this.runTimeNormalPageName=i;this.runTimeMasterPageName=r;this.drawerFitContent=u}return i.prototype.initForguncyData=function(t,i){var r=this.pageMetadata;n.ForguncyData.userInfo=new n.UserInfoImp;n.ForguncyData.userInfo.UserName=r.storageUserName?r.storageUserName:"";n.ForguncyData.userInfo.FullName=r.fullName?r.fullName:"";n.ForguncyData.userInfo.HasPicture=r.hasPicture?r.hasPicture:!1;n.ForguncyData.userInfo.Email=r.email?r.email:"";n.ForguncyData.userInfo.Role=r.role;n.ForguncyData.userInfo.InheritedPermissionRoles=r.inheritedRoles;n.ForguncyData.AllowLogout=r.allowLogout;n.ForguncyData.AutoDisconnectTimeout=r.autoDisconnectTimeout;n.ForguncyData.EnableSession=r.enableSession;n.ForguncyData.SessionKeepTime=r.sessionKeepTime;n.ForguncyData.IsDebugModeOnServer=r.isDebugModeOnServer;n.ForguncyData.IsConcurrenyUserLicense=r.isConcurrenyUserLicense;n.ForguncyData.AllowUserChangeMFAStatus=r.allowUserChangeMFAStatus;this.initPageInfo(t,i)},i.prototype.initPageInfo=function(t,i){var r=this.pageInfo,u=this.pageMetadata;r.runTimeNormalPage=this.runTimeNormalPageName;r.runTimeMasterPage=this.runTimeMasterPageName;r.pageName=u.PageSettings.Name;r.pageTitle=u.PageSettings.Title;r.masterPageName=u.MasterPage?u.MasterPage.PageSettings.Name:"";r.enableTabIndex=r.enableTabIndex||{};u.PageSettings.EnableTabIndex&&(r.enableTabIndex[this.runTimeNormalPageName]=u.PageSettings.EnableTabIndex);r.moveFocusByEnter=n.ForguncyData.GlobalSettings.MoveFocusByEnter;i||(r.pageID=n.Common.getUniqueNumber());r.PrimaryTableForeignKeyInfo={};r.ReturnUrl=n.Common.IsEmpty(u.ReturnUrl)?null:u.ReturnUrl;r.noPermissionPage=n.Common.IsEmpty(u.noPermissionPage)?null:u.noPermissionPage;i||(r.formulaManager=new n.FormulaManager(n.ForguncyData.pageInfo.dataModel),r.defaultFormulaManager=new n.DefaultFormulaManager,r.dependenceCellValueChangedEventHandlers={},r.pageStretchInfos={},r.pageLayouts={},r.autoIDManager=new n.AutoIDManager);r.isPopup=t;r.extraDialogCount=0;r.allowZoomScreen=!n.Platform.isMobile()||u.AllowZoomScreen;r.masterPageName&&this._mergePageConditionalFormattingMetadata(u.MasterPage.PageSettings.ConditionalFormattingMetadata)},i.prototype.setPageInfoByMetadata=function(){this.pageInfo.autoIDManager.setAutoGeneratedIDsFromMetaData(this.pageMetadata.autoGeneratedIDs);this._setPageStretchInfos();this._setPrimaryTableForeignKeyInfo();this._mergePageConditionalFormattingMetadata(this.pageMetadata.PageSettings.ConditionalFormattingMetadata);n.ForguncyData.pageDirtyCheckManager.setDirtyInfoFromMetaData(this.pageMetadata)},i.prototype._mergePageConditionalFormattingMetadata=function(t){var i;this.pageInfo.ConditionalFormattingMetadata?t&&(t.Rules&&(this.pageInfo.ConditionalFormattingMetadata.Rules?(i=this.pageInfo.ConditionalFormattingMetadata.Rules).push.apply(i,t.Rules):this.pageInfo.ConditionalFormattingMetadata.Rules=__spreadArray([],t.Rules,!0)),t.DependenceCells&&(this.pageInfo.ConditionalFormattingMetadata.DependenceCells=this.pageInfo.ConditionalFormattingMetadata.DependenceCells?__assign(__assign({},this.pageInfo.ConditionalFormattingMetadata.DependenceCells),t.DependenceCells):__assign({},t.DependenceCells))):this.pageInfo.ConditionalFormattingMetadata=n.Common.clone(t)},i.prototype._setPageStretchInfos=function(){this.pageInfo.pageStretchInfos||(this.pageInfo.pageStretchInfos={});this.pageInfo.pageStretchInfos[this.runTimeNormalPageName]=t.getPageStretchInfo(this.pageMetadata,this.drawerFitContent);this.pageInfo.pageStretchInfos[this.runTimeMasterPageName]=t.getPageStretchInfo(this.pageMetadata.MasterPage,this.drawerFitContent)},i.prototype._setPrimaryTableForeignKeyInfo=function(){var n=__assign(__assign({},this.pageInfo.PrimaryTableForeignKeyInfo),this.pageMetadata.PrimaryTableForeignKeyInfo);this.pageMetadata.MasterPage&&(n=__assign(__assign({},n),this.pageMetadata.MasterPage.PrimaryTableForeignKeyInfo));this.pageInfo.PrimaryTableForeignKeyInfo=n},i}();n.ForguncyDataSetter=u})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t;(function(t){var u,f,y=function(){function i(){}return i.create=function(n,t,i,r,u,f){return u===void 0&&(u=2),f===void 0&&(f=null),n.MasterPage?this.createPagePartDiv(n.MasterPage,n,i,t,r,u,f):this.createPagePartDiv(n,null,t,t,r,u,f)},i.createPagePartDiv=function(i,r,u,f,e,o,s){var p=this,c=n.DomUtilities.createJqueryDomElement("div"),a,v,h;c.css("position","relative");c.addClass("fgc-page-container");c.attr("fgc-page-name",i.pageName);n.ForguncyData.GlobalSettings.IsPageInContainerBackgroundHardCodeWhite&&c.css("background-color","white");var y=n.PageManager.getPageStretchInfo(u),w=e===2?0:y.StretchMode,l=t.StretchLayout.adjustMainDiv(c,w,i,e);return l.addClass("fgc-page-elements-container"),a=$(document.createElement("div")).attr("fgc-border-spliter-start","").css("display","none"),v=$(document.createElement("div")).attr("fgc-border-spliter-end","").css("display","none"),l.append(a),l.append(v),n.ForguncyData.pageInfo.pageLayouts[u]||(n.ForguncyData.pageInfo.pageLayouts[u]=new t.PageLayout(l,i,y,e,o)),h=n.ForguncyData.pageInfo.pageLayouts[u],h.addElementHandler=function(n,t){t<6?n.insertBefore(a):t===6?n.insertBefore(v):l.append(n)},h.createElementHandler=function(n,t,o){var c=p.createUIElement(n,i,r,u,f,t,e,s);return n.runtimeContainer=c,o&&h.addElementHandler(c,t),c},h.getPlaceHolderMetaData=function(){return r},h.generateElements(),h.locateElements(),this.createDataSourceListview(i,u),c},i.createDataSourceListview=function(t,i){if(t.DataSourceListViews){var r=t.PageSettings.Name,u=n.ForguncyData.pageInfo.pageElementManager.listviewCollection;t.DataSourceListViews.forEach(function(n){u.addDataSourceListview(n,i,r)})}},i.createUIElement=function(n,t,i,u,f,y,p,w){var b,d=(b={},b[0]=s,b[1]=h,b[2]=c,b[3]=e,b[4]=l,b[5]=o,b[6]=a,b[7]=v,b[8]=r,b),g=d[y],k=new g(n,t,i,u,f,p);return k instanceof o&&k.setContainerInfo(w),k instanceof e&&k.setContainerInfo(w),k.create()},i}(),i,s,h,c,e,l,o,a,v,r;t.PageContentCreator=y;i=function(){function t(t,i,r,u,f,e){this.element=t;this.pageMetadata=i;this.placeholderContent=r;this.runTimePageName=u;this.runTimePlaceholderPageName=f;this.pageContentType=e;this.pageStretchInfo=n.PageManager.getPageStretchInfo(u)}return t.prototype.create=function(){var i,t=n.DomUtilities.createJqueryDomElement("div"),u={},r;return this.createInternal(t,u),r=(i=this.innerContainer)!==null&&i!==void 0?i:t,this.name&&r.attr("fgcname",this.name),this.cssName&&r.addClass(this.cssName),this.clickable()||t.addClass("fgc-penetrable"),t.addClass(n.CSSHelper.getClassName(u)),t},t.prototype.clickable=function(){return!1},t.prototype.createInternal=function(){},t}();t.PageElementPresenter=i;s=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.clickable=function(){var n;return((n=this.element.CommandList)===null||n===void 0?void 0:n.length)>0},i.prototype.createInternal=function(n,t){r.setImageContainerStyle(t,this.element);this.createBackgroundImage(n,this.element,this.pageContentType,this.runTimePageName)},i.prototype.createBackgroundImage=function(t,i,u,f){var s,o,e,h,c;if(t.attr("fgc-gui","isBgImg"),i.DisplayName&&t.attr("fgc-gui-bgname",i.DisplayName),o=n.DomUtilities.createJqueryDomElement("div"),e={flex:"1"},i.FitToBrowserHeight&&u===0&&t.attr("FitToBrowserHeight","true"),i.FitToBrowserWidth&&u===0&&t.attr("FitToBrowserWidth","true"),h=i.ImageSrc||i.PictureName,r.setBackground(t,e,i),r.applyBackgroundLayoutProperties(e,i.Repeat,i.Stretch),h&&r.applyImageSource(this.element,e),((s=i.CommandList)===null||s===void 0?void 0:s.length)>0){t.addClass("fgc-clickHandler");t.on("click",r.getImageClickFunction(i,f))}o.addClass(n.CSSHelper.getClassName(e));t.append(o);c=n.ForguncyData.pageInfo.pageElementManager.backgroundImages.addBackgroundImage(new n.BackgroundImageItem(f,this.pageMetadata.PageSettings.Name,n.ForguncyData.pageInfo.pageID,o,i));t.attr("id",c)},i}(i);t.BackgroundImageElementPresenter=s;h=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.createInternal=function(n){this.createBackground(n,this.element)},i.prototype.createBackground=function(t,i){t.css("background-color",n.ColorHelper.Convert(i.Color))},i}(i);t.BackgroundElementPresenter=h;c=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.createInternal=function(n){this.createOverflowCellBackground(n,this.element,this.runTimePageName)},i.prototype.createOverflowCellBackground=function(t,i,r){var u=n.Common.getIdStr(this.element.Layout.Row,i.Layout.Column,r);t.attr("id",u+"_backgrounddiv")},i}(i);t.OverflowCellBackgroundElementPresenter=c;e=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.clickable=function(){return!0},i.prototype.createInternal=function(t){this.createPlaceHolder(t,this.placeholderContent);n.ForguncyData.pageInfo.pageElementManager.placeHolders.push(new n.PlaceHolderElement(this.runTimePageName,this.runTimePlaceholderPageName,this.element.Layout.Row,this.element.Layout.Column))},i.prototype.createPlaceHolder=function(t,r){var f,e,u;t.attr("id","placeHolderDiv");f=n.PageManager.getPageLayout(this.runTimePageName);e=f.possibleStretch(this.element.Layout);i.updatePlaceHolderOverflow(t,r,e);u=y.createPagePartDiv(r,null,this.runTimePlaceholderPageName,this.runTimePlaceholderPageName,3,2,this._containerInfo);u.attr("id",this.runTimePlaceholderPageName);this.element.BackgroundColor&&t.css("background-color",n.ColorHelper.Convert(this.element.BackgroundColor));t.append(u)},i.prototype.setContainerInfo=function(n){this._containerInfo=n},i.updatePlaceHolderOverflow=function(n,t,i){i?(n.css("overflow-x","auto"),n.css("overflow-y","auto")):(n.css("overflow-y",""),t.PageOverflowMode===0?n.css("overflow-x",""):t.PageOverflowMode===2?n.css("overflow-x","hidden"):t.PageOverflowMode===1&&n.css("overflow-x","auto"))},i}(i);t.PlaceHolderElementPresenter=e;l=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.clickable=function(){return!0},i.prototype.createInternal=function(n){this.name=this.element.Data.Name;this.createListView(n,this.element,this.runTimePageName,this.pageMetadata.PageSettings.Name)},i.prototype.createListView=function(t,i,r,u){var y=i.Width>0&&i.Height>0,p,o,f,s,h,e,c,l,a,w,b,v;y||t.css("display","none");n.ListviewMetadataHelper.resolve(i.Data);p=n.ListviewBase.getLocationString(r,i.Data.Name);o=i.Data;(i.Data.CacheListviewStatus||i.Data.CacheColumnFilterAndSort)&&(f=n.ListviewStatusCacheHelper.getMetadataCacheDataForListviewCreate(u,o.Name));i.Data.CacheListviewStatus?(s=f.columns,s&&n.ListviewStatusCacheHelper.syncListviewColumnsMetadataFromCache(o,s)):(h=n.ListviewMetadataHelper.restore(p),h&&(o=h));e=new n.ListviewData(o,r,u);t.attr("id",e.name);t.attr("fgc-uielement","listview");c=n.ForguncyData.pageInfo.pageElementManager.listviewCollection;l=y?c.addSpreadJSView(t[0],e,r,u,i.Layout):c.addHiddenListview(t[0],e,r,u);i.Data.CacheColumnFilterAndSort&&(a=l.getLocationString(),f.columnFilter&&(w=n.ListviewStatusCacheHelper.filterListviewColumnFilterFromCache(e,f.columnFilter),n.ForguncyData.pageInfo.columnFilterQueryCache[a]=w),f.sort&&(b=n.ListviewStatusCacheHelper.filterListviewColumnSortFromCache(e,f.sort),n.ForguncyData.pageInfo.sortInfoCache[a]=b));v=l.getRangeInfo();t.attr(n.StaticValues.InnerID,n.Common.getIdStr(v.Row,v.Column,r))},i}(i);t.ListViewElementPresenter=l;o=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.clickable=function(){return!0},i.prototype.createInternal=function(n,t){this.name=this.getNormalCellFgcName(this.element);this.cssName=this.element.CssClassName;var i=this.createCell(n,this.element,this.pageStretchInfo,this.runTimePageName,t);this.cell=i},i.prototype.getNormalCellFgcName=function(t){var i,r;return((r=(i=this._containerInfo)===null||i===void 0?void 0:i.ownerCell)===null||r===void 0?void 0:r.cellType)instanceof n.UserControlPageCellType?(t.Name&&t.Name.length)>0?t.Name[0]:null:n.Common.IsEmpty(t.TemplateCellSource)?(t.Name&&t.Name.length)>0?t.Name[0]:null:t.TemplateCellSource},i.prototype.createCell=function(t,i,r,u){var o=n.Common.getIdStr(i.Row,i.Column,u),f,s,e,h;return t.attr("id",o+"_outerdiv"),f=$(document.createElement("div")),s={},f.attr("id",o+"_div"),f.attr(n.StaticValues.InnerID,o),t.append(f),e=new n.NormalCell(i,0,o,u,this.pageMetadata.PageSettings.Name),e.setContainerInfo(this._containerInfo),n.ForguncyData.pageInfo.pageElementManager.cells.addCell(e),e.create(f),s.width="100%",s.height="100%",h=n.CSSHelper.getClassName(s),h&&f.addClass(h),this.innerContainer=f,e},i.createCellForPreview=function(t,i,r,u){var s,o,e,f;return u===void 0&&(u=[]),s=n.StaticData.CellTypeStyleTemplates,n.MetadataHelper.referStyleTemplateMetadata(i,s),o=n.StaticValues.RunTimeNormalPagePrefix,e=n.Common.getIdStr(i.Row,i.Column,o),t.attr("id",e+"_div"),t.attr(n.StaticValues.InnerID,e),f=new n.NormalCell(i,0,e,o,r),f.cellType.isDesignerPreview=!0,f.cellType.designerPreviewCustomArgs=u,f.cellType.showDesignerPreviewError=function(n){var i=$(document.createElement("div"));i.css("display","flex").css("width","100%").css("height","100%").css("justify-content","center").css("align-items","center").css("font-size","12px").css("color","red").text(n);t.children().remove();t.append(i)},n.ForguncyData.pageInfo.pageElementManager.cells.addCell(f),f.create(t),f},i.prototype.setContainerInfo=function(n){this._containerInfo=n},i}(i);t.CellContentElementPresenter=o;a=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.createInternal=function(n,t){this.createBorder(n,t,this.element)},i.prototype.createBorder=function(t,r,u){var o,s,e=u.Layout,f=this.pageMetadata.BorderStyles[u.StyleIndex],c=i.borderPositionMap[(o=u.Position)!==null&&o!==void 0?o:0],l=f.BorderWidth+"px ",a=i.borderStyleMap[(s=f.Style)!==null&&s!==void 0?s:2],v=n.ColorHelper.Convert(f.Color),h;r.pointerEvents="none";r[c]="".concat(l," ").concat(a," ").concat(v);u.Position===0?(u.topSpace&&(r.top=-u.topSpace/2+"px"),u.bottomSpace&&(r.bottom=-u.bottomSpace/2+"px"),r.left=-f.BorderWidth/2+"px",u.topSpace+u.bottomSpace&&(r.height="calc(100% + ".concat((u.topSpace+u.bottomSpace)/2,"px)"))):u.Position===1?(u.leftSpace&&(r.left=-u.leftSpace/2+"px"),u.rightSpace&&(r.right=-u.rightSpace/2+"px"),r.top=-f.BorderWidth/2+"px",u.leftSpace+u.rightSpace&&(r.width="calc(100% + ".concat((u.leftSpace+u.rightSpace)/2,"px)"))):u.Position===2?(u.topSpace&&(r.top=-u.topSpace/2+"px"),u.bottomSpace&&(r.bottom=-u.bottomSpace/2+"px"),r.right=-f.BorderWidth/2+"px",u.topSpace+u.bottomSpace&&(r.height="calc(100% + ".concat((u.topSpace+u.bottomSpace)/2,"px)"))):u.Position===3&&(u.leftSpace&&(r.left=-u.leftSpace/2+"px"),u.rightSpace&&(r.right=-u.rightSpace/2+"px"),r.bottom=-f.BorderWidth/2+"px",u.leftSpace+u.rightSpace&&(r.width="calc(100% + ".concat((u.leftSpace+u.rightSpace)/2,"px)")));r.position="absolute";t.attr("isborder",!0);h="".concat(this.runTimePageName,"-").concat(e.Row,"-").concat(e.RowSpan,"-").concat(e.Column,"-").concat(e.ColumnSpan);t.addClass(h)},i.borderStyleMap=(u={},u[0]="dotted",u[1]="dashed",u[2]="solid",u[3]="double",u),i.borderPositionMap=(f={},f[0]="border-left",f[1]="border-top",f[2]="border-right",f[3]="border-bottom",f),i}(i);t.BorderElementPresenter=a;v=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.clickable=function(){var n,t;return((t=(n=this.element.ChartCommandMetadata)===null||n===void 0?void 0:n.Commands)===null||t===void 0?void 0:t.length)>0},i.prototype.createInternal=function(n){this.createChart(n,this.element,this.runTimePageName)},i.prototype.createChart=function(t,i,r){var u=n.ForguncyData.pageInfo.pageElementManager.chartCollection.createChart(i,r);t.append(u)},i}(i);t.ChartElementPresenter=v;r=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.clickable=function(){var n;return((n=this.element.CommandList)===null||n===void 0?void 0:n.length)>0},i.prototype.createInternal=function(n,t){i.setImageContainerStyle(t,this.element);this.createImage(n,this.element,this.runTimePageName)},i.prototype.createImage=function(t,r,u){var e,o,f;if(t.attr("fgc-gui","isImg"),o=n.DomUtilities.createJqueryDomElement("div"),f={flexGrow:"1"},i.setBackground(t,f,r),(r.ImageSrc||r.PictureName)&&(i.applyImageSource(this.element,f),i.applyBackgroundLayoutProperties(f,!1,2)),((e=r.CommandList)===null||e===void 0?void 0:e.length)>0){t.addClass("fgc-clickHandler");t.on("click",i.getImageClickFunction(r,u))}o.addClass(n.CSSHelper.getClassName(f));t.append(o)},i.getImageClickFunction=function(t,i){return function(){var r;n.ForguncyData.commandExecutor.executeCommand(t.CommandList,{runTimePageName:i,commandTrigger:null,commandID:((r=t.DisplayName)!==null&&r!==void 0?r:t.PictureName)+"_"+i,eventType:"click"})}},i.applyImageSource=function(t,r){var u=i.getImageUrl(t),f,e,o;n.ImageDataHelper.IsSvg(u)?(f=n.ImageDataHelper.GetColoredSvgRectInfo(u,t.Color),r.backgroundImage='url("'+f.value+'")'):(e=n.ImageHelper.encodeImageUrl(u),o=n.Helper.preProcessImageSrc(e),r.backgroundImage='url("'+o+'")');r.fontSize="0"},i.applyBackgroundLayoutProperties=function(n,t,i){if(t)n.backgroundSize="auto",n.backgroundRepeat="repeat";else{n.backgroundRepeat="no-repeat";switch(i){case 1:n.backgroundSize="100% 100%";break;case 2:n.backgroundSize="contain";n.backgroundPosition="50% 50%";break;case 3:n.backgroundSize="cover";break;case 0:n.backgroundSize="auto";n.backgroundPosition="50% 50%"}}},i.getImageUrl=function(t){return t.PictureName?n.ImageHelper.getImageUrlBySourceType(t.SourceType,t.PictureName):n.ForguncyData.ForguncyRoot+"GeneratedResources/Images/GenerateImages/FlowingImages/"+t.ImageSrc},i.setBackground=function(t,i,r){var u,f,e;r.Background&&(u=n.ColorHelper.Convert(r.Background),u.includes("gradient")?(f=n.DomUtilities.createJqueryDomElement("div"),e={background:u,width:"100%",height:"100%",position:"absolute"},i.position="absolute",i.width="100%",i.height="100%",f.addClass(n.CSSHelper.getClassName(e)),f.attr("fgc-gui","imagebg"),t.append(f)):i.background=u)},i.setImageContainerStyle=function(t,i){var r;t.overflow="hidden";t.display="flex";t.flex="1";t.boxSizing="border-box";i.BoxShadow&&(t.boxShadow=n.ColorHelper.ConvertShadow(i.BoxShadow));i.Border&&(t.border=n.ColorHelper.ConvertBorder(i.Border));i.CornerRadius>0&&(t.borderRadius=i.CornerRadius+"px");i.Transparency<1&&(t.opacity=(r=i.Transparency)===null||r===void 0?void 0:r.toString())},i}(i);t.ImageElementPresenter=r})(t=n.Presentation||(n.Presentation={}))})(Forguncy||(Forguncy={}))
;var __spreadArray=this&&this.__spreadArray||function(n,t,i){if(i||arguments.length===2)for(var r=0,f=t.length,u;r<f;r++)!u&&r in t||(u||(u=Array.prototype.slice.call(t,0,r)),u[r]=t[r]);return n.concat(u||Array.prototype.slice.call(t))},Forguncy;(function(n){var t;(function(t){var u=function(){function n(){}return n.prototype.initialize=function(n){this.generateDefinitions();this.generateAreas(n)},n.prototype.generateDefinitions=function(){var n=this;this.rows=this.rowDefinitions.map(function(t){return n.getGridColumnRowDefinitionValue(t,n.rowUnit)});this.columns=this.columnDefinitions.map(function(t){return n.getGridColumnRowDefinitionValue(t,n.columnUnit)})},n.prototype.generateAreas=function(n){var t=this;this.areas=n.map(function(n){var r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,i=n.Layout,ut=i.Row+1,ft=i.Row+i.RowSpan+1,st=i.IsLeftOverflow?(r=i.leftOverflowOffset)!==null&&r!==void 0?r:0:0,et=i.Column+1-st,ht=i.IsRightOverflow?(u=i.rightOverflowOffset)!==null&&u!==void 0?u:0:0,ot=i.Column+i.ColumnSpan+1+ht,ct=i.Column+1,lt=i.Column+i.ColumnSpan+1,nt=(e=(f=n.Layout)===null||f===void 0?void 0:f.PaddingLeft)!==null&&e!==void 0?e:0,tt=(s=(o=n.Layout)===null||o===void 0?void 0:o.PaddingRight)!==null&&s!==void 0?s:0,it=(c=(h=n.Layout)===null||h===void 0?void 0:h.PaddingTop)!==null&&c!==void 0?c:0,rt=(a=(l=n.Layout)===null||l===void 0?void 0:l.PaddingBottom)!==null&&a!==void 0?a:0;(n===null||n===void 0?void 0:n.FitToBrowserHeight)===!0&&(ut=1,ft=t.rowDefinitions.length+1,it=0,rt=0);(n===null||n===void 0?void 0:n.FitToBrowserWidth)===!0&&(et=1,ot=t.columnDefinitions.length+1,nt=0,tt=0);((v=t.rowDefinitions[i.Row])===null||v===void 0?void 0:v.IsHidden)&&(it=0);((y=t.rowDefinitions[i.Row+i.RowSpan-1])===null||y===void 0?void 0:y.IsHidden)&&(rt=0);((p=t.columnDefinitions[i.Column])===null||p===void 0?void 0:p.IsHidden)&&(nt=0);((w=t.columnDefinitions[i.Column+i.ColumnSpan-1])===null||w===void 0?void 0:w.IsHidden)&&(tt=0);var at=((b=t.columnDefinitions[i.Column])===null||b===void 0?void 0:b.Mode)===2?"fr":t.columnUnit,vt=((k=t.columnDefinitions[i.Column+i.ColumnSpan-1])===null||k===void 0?void 0:k.Mode)===2?"fr":t.columnUnit,yt=((d=t.rowDefinitions[i.Row])===null||d===void 0?void 0:d.Mode)===2?"fr":t.columnUnit,pt=((g=t.rowDefinitions[i.Row+i.RowSpan-1])===null||g===void 0?void 0:g.Mode)===2?"fr":t.columnUnit;return{rowStart:ut,rowEnd:ft,columnStart:et,columnEnd:ot,columnStartWithoutOverflow:ct,columnEndWithoutOverflow:lt,paddingLeft:nt,paddingRight:tt,paddingTop:it,paddingBottom:rt,paddingLeftUnit:at,paddingRightUnit:vt,paddingTopUnit:yt,paddingBottomUnit:pt,element:n}})},n.prototype.getGridColumnRowDefinitionValue=function(n,t){var r,u,f,e,o,i,s;if(n.IsHidden)return"0";if(t==="fr")return i=n.DesignLengthInPixel,s=n.DesignLengthInPixel,"minmax(".concat(i,"px, ").concat(s,"fr)");if(n.Mode===1)return"auto";if(n.Mode===2){var h=((r=n.MaxLength)===null||r===void 0?void 0:r.Unit)===2?"fr":t,i=(f=(u=n.MinLength)===null||u===void 0?void 0:u.Value)!==null&&f!==void 0?f:0,s=(o=(e=n.MaxLength)===null||e===void 0?void 0:e.Value)!==null&&o!==void 0?o:Math.max(i,n.DesignLengthInPixel);return"minmax(".concat(i).concat("px",", ").concat(s).concat(h,")")}return"".concat(n.DesignLengthInPixel,"px")},n}(),i,f,r;t.Grid=u;i=function(){function n(){}return n.renderContainer=function(n,t){var r=t.rows.join(" "),u=t.columns.join(" "),i=n.style;i.display="grid";i.gridTemplateRows=r;i.gridTemplateColumns=u;i.alignContent="start";i.justifyContent="start";i.display="-ms-grid";i.msGridRows=r;i.msGridColumns=u},n.renderFullSizeElement=function(n,t,i,r){var u=document.createElement("div"),f;$(u).addClass("fgc-penetrable");n.appendChild(u);f={rowStart:1,rowEnd:t,columnStart:1,columnEnd:i};this.renderElement(u,f,r);this.renderElementPosition(u)},n.renderElement=function(n,t){var i=n.style;i.gridRowStart=t.rowStart+"";i.gridRowEnd=t.rowEnd+"";i.gridColumnStart=t.columnStart+"";i.gridColumnEnd=t.columnEnd+"";i.msGridRow=t.rowStart+"";i.msGridRowSpan=t.rowEnd-t.rowStart+"";i.msGridColumn=t.columnStart+"";i.msGridColumnSpan=t.columnEnd-t.columnStart+""},n.renderElementPosition=function(n){n.classList.add("fgc-container-relative")},n.renderElementMargin=function(n,t){var i,r,u;(t.paddingLeft||t.paddingRight||t.paddingTop||t.paddingBottom)&&(i=n.style,i.width="auto",i.height="auto",r=t.paddingLeft+t.element.FullWidth+t.paddingRight,u=r,i.marginTop=t.paddingTopUnit==="px"?t.paddingTop+"px":t.paddingTop/u*100+"%",i.marginBottom=t.paddingBottomUnit==="px"?t.paddingBottom+"px":t.paddingBottom/u*100+"%",i.marginLeft=t.paddingLeftUnit==="px"?t.paddingLeft+"px":t.paddingLeft/r*100+"%",i.marginRight=t.paddingRightUnit==="px"?t.paddingRight+"px":t.paddingRight/r*100+"%")},n.updateVisibility=function(n,t,i){var r=n.style,u=i.rowDefinitions.slice(t.rowStart-1,t.rowEnd-1),f=i.columnDefinitions.slice(t.columnStartWithoutOverflow-1,t.columnEndWithoutOverflow-1),e=u.length>0&&u.every(function(n){return n.IsHidden||n.DesignLengthInPixel===0}),o=f.length>0&&f.every(function(n){return n.IsHidden||n.DesignLengthInPixel===0});e||o?r.display!=="none"&&(r.display="none"):r.display==="none"&&(r.display="")},n}();t.GridRender=i;f=function(){function t(t,i,u,f,e){this.drawerFitContent=2;this.parentElement=t;this.metadata=i;this.pageStretchInfo=u;this.pageContentType=f;this.drawerFitContent=e;this.rowDefinitions=n.Common.clone(this.metadata.PageSettings.RowDefinitions);this.columnDefinitions=n.Common.clone(this.metadata.PageSettings.ColumnDefinitions);this.preProcessDefinitions();this.borderLayout=new r;this.borderLayout.generateRuntimeCells(i,this.rowDefinitions,this.columnDefinitions)}return t.prototype.preProcessDefinitions=function(){this.pageContentType===1&&((this.drawerFitContent===2||this.drawerFitContent===0)&&this.rowDefinitions.filter(function(n){return n.Mode===2}).forEach(function(n){return n.Mode=0}),(this.drawerFitContent===2||this.drawerFitContent===1)&&this.columnDefinitions.filter(function(n){return n.Mode===2}).forEach(function(n){return n.Mode=0}))},t.prototype.generateElements=function(){var n,i=this.metadata,t=(n={},n[0]=i.BackgroundImages.map(function(n){return{type:0,value:n}}),n[1]=i.Backgrounds.map(function(n){return{type:1,value:n}}),n[2]=i.OverflowCellBackgrounds.map(function(n){return{type:2,value:n}}),n[3]=i.PlaceHolders.map(function(n){return{type:3,value:n}}),n[4]=i.ListViews.map(function(n){return{type:4,value:n}}),n[5]=i.Cells.map(function(n){return{type:5,value:n}}),n[6]=[],n[7]=i.Charts.map(function(n){return{type:7,value:n}}),n[8]=i.Images.map(function(n){return{type:8,value:n}}),n),f=__spreadArray(__spreadArray(__spreadArray([],t[3],!0),t[4],!0),t[5],!0),u,e,r,o,s;for(f.sort(function(n,t){return n.value.Layout.Row-t.value.Layout.Row||n.value.Layout.Column-t.value.Layout.Column}),u=__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray([],t[0],!0),t[1],!0),t[2],!0),f,!0),t[6],!0),t[7],!0),t[8],!0),e=u.length,r=0;r<e;r++)o=u[r].value,s=u[r].type,this.createElementHandler(o,s,!0)},t.prototype.locateElements=function(t){var e;t===void 0&&(t=!1);this.refreshRuntimeBorders();var o=this.getAllElements(this.metadata),r=new u,f=this.pageStretchInfo.StretchMode;if(r.rowUnit=f===0||f===1?"px":"fr",r.columnUnit=f===0||f===2?"px":"fr",r.rowDefinitions=this.rowDefinitions,r.columnDefinitions=this.columnDefinitions,r.initialize(o),e=this.parentElement[0],i.renderContainer(e,r),r.areas.forEach(function(n){var t=n.element.runtimeContainer,u;i.renderElement(t[0],n,r.columnDefinitions);i.renderElementPosition(t[0]);i.updateVisibility(t[0],n,r);u=t.children()[0];u&&i.renderElementMargin(t[0],n)}),(this.pageContentType===0||this.pageContentType===1)&&this.borderLayout.updateContainerLeftTopPadding(e),this.pageContentType!==2&&this.borderLayout.updateContainerRightBottomPadding(e),t)n.PageBuilder.onWindowResize(!0,!0,!1)},t.prototype.lazyLocateElements=function(t){var i=this;this._resizeTimer&&(n.DelayRefresh.clearTimeout(this._resizeTimer),this._resizeTimer=null);this._resizeTimer=n.DelayRefresh.setTimeout(function(){window.requestAnimationFrame(function(){i.locateElements(!0);t===null||t===void 0?void 0:t()})},20)},t.prototype.changeRowVisibility=function(n,t){this.rowDefinitions[n].IsHidden=!t},t.prototype.changeColumnVisibility=function(n,t){this.columnDefinitions[n].IsHidden=!t},t.prototype.changeRowHeight=function(n,t){this.rowDefinitions[n]=t;this.metadata.PageSettings.RowDefinitions[n]=t},t.prototype.changeColumnWidth=function(n,t){this.columnDefinitions[n]=t;this.metadata.PageSettings.ColumnDefinitions[n]=t},t.prototype.possibleStretch=function(n){return this.possibleStretchInRows(n)||this.possibleStretchInColumns(n)},t.prototype.possibleStretchInRows=function(n){var t=n?n.Row:0,i=n?n.Row+n.RowSpan:this.rowDefinitions.length,r=this.rowDefinitions.slice(t,i);return r.some(function(n){return n.Mode===2})},t.prototype.possibleStretchInColumns=function(n){var t=n?n.Column:0,i=n?n.Column+n.ColumnSpan:this.columnDefinitions.length,r=this.columnDefinitions.slice(t,i);return r.some(function(n){return n.Mode===2})},t.prototype.possibleAutoFit=function(n){return this.possibleAutoFitInRows(n)||this.possibleAutoFitInColumns(n)},t.prototype.possibleAutoFitInRows=function(n){var t=n?n.Row:0,i=n?n.Row+n.RowSpan:this.rowDefinitions.length,r=this.rowDefinitions.slice(t,i);return r.some(function(n){return n.Mode===1})},t.prototype.possibleAutoFitInColumns=function(n){var t=n?n.Column:0,i=n?n.Column+n.ColumnSpan:this.columnDefinitions.length,r=this.columnDefinitions.slice(t,i);return r.some(function(n){return n.Mode===1})},t.prototype.isVisible=function(n){return this.isVisibleInRows(n)&&this.isVisibleInColumns(n)},t.prototype.isVisibleInRows=function(n){var t=n?n.Row:0,i=n?n.Row+n.RowSpan:this.rowDefinitions.length,r=this.rowDefinitions.slice(t,i);return r.some(function(n){return!n.IsHidden&&!(n.Mode==0&&n.DesignLengthInPixel===0)})},t.prototype.isVisibleInColumns=function(n){var t=n?n.Column:0,i=n?n.Column+n.ColumnSpan:this.columnDefinitions.length,r=this.columnDefinitions.slice(t,i);return r.some(function(n){return!n.IsHidden&&!(n.Mode==0&&n.DesignLengthInPixel===0)})},t.prototype.getColumnWidth=function(n,t){for(var r,f,u=0,e=n+t,i=n;i<e;i++)r=this.columnDefinitions[i],f=r.IsHidden?0:r.DesignLengthInPixel,u+=f;return u},t.prototype.getRowHeight=function(n,t){for(var r,f,u=0,e=n+t,i=n;i<e;i++)r=this.rowDefinitions[i],f=r.IsHidden?0:r.DesignLengthInPixel,u+=f;return u},t.prototype.getAllElements=function(n){return[].concat(n.Backgrounds,n.BackgroundImages,n.OverflowCellBackgrounds,n.Cells,n.ListViews,n.PlaceHolders,this.borderLayout.runtimeBorders,n.Charts,n.Images)},t.prototype.refreshRuntimeBorders=function(){var t,i,n;for(this.borderLayout.refreshRuntimeBorders(this.metadata,this.rowDefinitions,this.columnDefinitions),t=this.borderLayout.runtimeBorders,i=t.length,n=0;n<i;n++)this.createElementHandler(t[n],6,!0)},t}();t.PageLayout=f;r=function(){function t(){this.runtimeBorders=[];this.paddingTop=0;this.paddingBottom=0;this.paddingLeft=0;this.paddingRight=0}return t.prototype.generateRuntimeCells=function(t,i,r){var u=this,f=r.length,e=i.length;this.runtimeLayoutCells=new n.Array2(f,e);t.Borders.forEach(function(n){for(var i,e,f,t=n.Layout,r=t.Row;r<t.Row+t.RowSpan;r++)for(i=t.Column;i<t.Column+t.ColumnSpan;i++)e=u.runtimeLayoutCells.get(i,r),e?e[n.Position]=n:u.runtimeLayoutCells.set(i,r,(f={},f[n.Position]=n,f))})},t.prototype.refreshRuntimeBorders=function(n,t,i){this.clearOldRuntimeBorders();this.createRowBorders(n,t,i);this.createColBorders(n,t,i);this.sortBorders(n)},t.prototype.updateContainerLeftTopPadding=function(n){n.style.paddingLeft=this.paddingLeft/2+"px";n.style.paddingTop=this.paddingTop/2+"px"},t.prototype.updateContainerRightBottomPadding=function(n){n.style.paddingRight=this.paddingRight/2+"px";n.style.paddingBottom=this.paddingBottom/2+"px"},t.prototype.clearOldRuntimeBorders=function(){this.runtimeBorders.forEach(function(n){n.runtimeContainer.remove()});this.runtimeBorders=[]},t.prototype.sortBorders=function(n){this.runtimeBorders.sort(function(t,i){return n.BorderStyles[t.StyleIndex].Order-n.BorderStyles[i.StyleIndex].Order})},t.prototype.createRowBorders=function(t,i,r){var b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st,ht,ct,lt,at,vt,l=t.BorderStyles,yt=i.map(function(n,t){return{rawIndex:t,isHidden:n.IsHidden}}).filter(function(n){return!n.isHidden}),f=r.map(function(n,t){return{rawIndex:t,isHidden:n.IsHidden}}).filter(function(n){return!n.isHidden}),kt,e,a,c,w;for(this.paddingLeft=0,this.paddingRight=0,kt=yt.length,e=0;e<kt+1;e++){var pt=(k=(b=yt[e-1])===null||b===void 0?void 0:b.rawIndex)!==null&&k!==void 0?k:-1,o=(g=(d=yt[e])===null||d===void 0?void 0:d.rawIndex)!==null&&g!==void 0?g:-1,u=void 0,ni=f.length;for(a=0;a<ni+1;a++){var v=a,s=(tt=(nt=f[v])===null||nt===void 0?void 0:nt.rawIndex)!==null&&tt!==void 0?tt:-1,y=(it=this.runtimeLayoutCells.get(s,pt))===null||it===void 0?void 0:it[3],p=(rt=this.runtimeLayoutCells.get(s,o))===null||rt===void 0?void 0:rt[1],h=void 0;(h=y&&p?l[y.StyleIndex].Order>l[p.StyleIndex].Order?y:p:y||p,h&&u&&h.StyleIndex===u.StyleIndex)||(u&&(u.Layout.ColumnSpan=((ft=(ut=f[v])===null||ut===void 0?void 0:ut.rawIndex)!==null&&ft!==void 0?ft:f.slice(-1)[0].rawIndex+1)-u.Layout.Column,w=(ot=(et=f[v-1])===null||et===void 0?void 0:et.rawIndex)!==null&&ot!==void 0?ot:-1,u.rightSpace=this.getMaxBorderLeftRightSpace(t,s,o,w,pt),this.runtimeBorders.push(u),u=null),h&&!u&&(c=n.Common.clone(h),c.Layout.Column=s,c.Layout.ColumnSpan=1,w=(ht=(st=f[v-1])===null||st===void 0?void 0:st.rawIndex)!==null&&ht!==void 0?ht:-1,c.leftSpace=this.getMaxBorderLeftRightSpace(t,s,o,w,pt),u=c))}var ti=(lt=(ct=f[0])===null||ct===void 0?void 0:ct.rawIndex)!==null&&lt!==void 0?lt:-1,wt=this.runtimeLayoutCells.get(ti,o),dt=wt===null||wt===void 0?void 0:wt[0];dt&&(this.paddingLeft=Math.max(this.paddingLeft,l[dt.StyleIndex].BorderWidth));var ii=(vt=(at=f[f.length-1])===null||at===void 0?void 0:at.rawIndex)!==null&&vt!==void 0?vt:-1,bt=this.runtimeLayoutCells.get(ii,o),gt=bt===null||bt===void 0?void 0:bt[2];gt&&(this.paddingRight=Math.max(this.paddingRight,l[gt.StyleIndex].BorderWidth))}},t.prototype.createColBorders=function(t,i,r){for(var a,h,w,gt,kt,ni,dt,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st,ht,ct,lt,at,vt,yt,pt,c=t.BorderStyles,f=i.map(function(n,t){return{rawIndex:t,isHidden:n.IsHidden}}).filter(function(n){return!n.isHidden}),wt=r.map(function(n,t){return{rawIndex:t,isHidden:n.IsHidden}}).filter(function(n){return!n.isHidden}),ti=wt.length,l=0;l<ti+1;l++){var bt=(k=(b=wt[l-1])===null||b===void 0?void 0:b.rawIndex)!==null&&k!==void 0?k:-1,e=(g=(d=wt[l])===null||d===void 0?void 0:d.rawIndex)!==null&&g!==void 0?g:-1,u=void 0,ii=f.length;for(a=0;a<ii+1;a++){var v=a,o=(tt=(nt=f[v])===null||nt===void 0?void 0:nt.rawIndex)!==null&&tt!==void 0?tt:-1,y=(it=this.runtimeLayoutCells.get(bt,o))===null||it===void 0?void 0:it[2],p=(rt=this.runtimeLayoutCells.get(e,o))===null||rt===void 0?void 0:rt[0],s=void 0;(s=y&&p?c[y.StyleIndex].Order>c[p.StyleIndex].Order?y:p:y||p,s&&u&&s.StyleIndex===u.StyleIndex)||(u&&(u.Layout.RowSpan=((ft=(ut=f[v])===null||ut===void 0?void 0:ut.rawIndex)!==null&&ft!==void 0?ft:f.slice(-1)[0].rawIndex+1)-u.Layout.Row,w=(ot=(et=f[v-1])===null||et===void 0?void 0:et.rawIndex)!==null&&ot!==void 0?ot:-1,u.bottomSpace=this.getMaxBorderTopBottomSpace(t,e,o,bt,w),this.runtimeBorders.push(u),u=null),s&&!u&&(h=n.Common.clone(s),h.Layout.Row=o,h.Layout.RowSpan=1,w=(ht=(st=f[v-1])===null||st===void 0?void 0:st.rawIndex)!==null&&ht!==void 0?ht:-1,h.topSpace=this.getMaxBorderTopBottomSpace(t,e,o,bt,w),u=h))}gt=(lt=(ct=f[0])===null||ct===void 0?void 0:ct.rawIndex)!==null&&lt!==void 0?lt:-1;kt=(at=this.runtimeLayoutCells.get(e,gt))===null||at===void 0?void 0:at[1];kt&&(this.paddingTop=Math.max(this.paddingTop,c[kt.StyleIndex].BorderWidth));ni=(yt=(vt=f[f.length-1])===null||vt===void 0?void 0:vt.rawIndex)!==null&&yt!==void 0?yt:-1;dt=(pt=this.runtimeLayoutCells.get(e,ni))===null||pt===void 0?void 0:pt[3];dt&&(this.paddingBottom=Math.max(this.paddingBottom,c[dt.StyleIndex].BorderWidth))}},t.prototype.getMaxBorderLeftRightSpace=function(n,t,i,r,u){var e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,f=n.BorderStyles,ft=(c=(h=f[(s=(o=(e=this.runtimeLayoutCells.get(r,u))===null||e===void 0?void 0:e[2])===null||o===void 0?void 0:o.StyleIndex)!==null&&s!==void 0?s:-1])===null||h===void 0?void 0:h.BorderWidth)!==null&&c!==void 0?c:0,et=(p=(y=f[(v=(a=(l=this.runtimeLayoutCells.get(t,u))===null||l===void 0?void 0:l[0])===null||a===void 0?void 0:a.StyleIndex)!==null&&v!==void 0?v:-1])===null||y===void 0?void 0:y.BorderWidth)!==null&&p!==void 0?p:0,ot=(g=(d=f[(k=(b=(w=this.runtimeLayoutCells.get(r,i))===null||w===void 0?void 0:w[2])===null||b===void 0?void 0:b.StyleIndex)!==null&&k!==void 0?k:-1])===null||d===void 0?void 0:d.BorderWidth)!==null&&g!==void 0?g:0,st=(ut=(rt=f[(it=(tt=(nt=this.runtimeLayoutCells.get(t,i))===null||nt===void 0?void 0:nt[0])===null||tt===void 0?void 0:tt.StyleIndex)!==null&&it!==void 0?it:-1])===null||rt===void 0?void 0:rt.BorderWidth)!==null&&ut!==void 0?ut:0;return[ft,et,ot,st].sort(function(n,t){return t-n})[0]},t.prototype.getMaxBorderTopBottomSpace=function(n,t,i,r,u){var e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,f=n.BorderStyles,ft=(c=(h=f[(s=(o=(e=this.runtimeLayoutCells.get(r,u))===null||e===void 0?void 0:e[3])===null||o===void 0?void 0:o.StyleIndex)!==null&&s!==void 0?s:-1])===null||h===void 0?void 0:h.BorderWidth)!==null&&c!==void 0?c:0,et=(p=(y=f[(v=(a=(l=this.runtimeLayoutCells.get(r,i))===null||l===void 0?void 0:l[1])===null||a===void 0?void 0:a.StyleIndex)!==null&&v!==void 0?v:-1])===null||y===void 0?void 0:y.BorderWidth)!==null&&p!==void 0?p:0,ot=(g=(d=f[(k=(b=(w=this.runtimeLayoutCells.get(t,u))===null||w===void 0?void 0:w[3])===null||b===void 0?void 0:b.StyleIndex)!==null&&k!==void 0?k:-1])===null||d===void 0?void 0:d.BorderWidth)!==null&&g!==void 0?g:0,st=(ut=(rt=f[(it=(tt=(nt=this.runtimeLayoutCells.get(t,i))===null||nt===void 0?void 0:nt[1])===null||tt===void 0?void 0:tt.StyleIndex)!==null&&it!==void 0?it:-1])===null||rt===void 0?void 0:rt.BorderWidth)!==null&&ut!==void 0?ut:0;return[ft,et,ot,st].sort(function(n,t){return t-n})[0]},t}();t.PageBorderLayout=r})(t=n.Presentation||(n.Presentation={}))})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var t;(function(t){var r=function(){function t(){}return t.canHorizontallyStretch=function(n){return n===1||n===3||n===4},t.canVerticallyStretch=function(n){return n===2||n===3||n===4},t.getStretchMode=function(i,r){switch(i){case 0:return n.ForguncyData.GlobalSettings.PageResponsiveMode===0?0:t.getStretchMode(n.ForguncyData.GlobalSettings.PageResponsiveMode,r);case 4:if(r===3)return 3;if(r===0)return 1;if(r===1)return 2;break;case 2:if(r===3||r===0)return 1;break;case 3:if(r===3||r===1)return 2;break;case 5:if(r===3)return 4;break;default:return 0}return 0},t.getPageResponsiveMode=function(n){switch(n){case 3:return 4;case 1:return 2;case 2:return 3;case 4:return 5;default:return 1}},t}(),i;t.StretchCommon=r;i=function(){function i(){}return i.adjustMainDiv=function(n,r,u,f){var e=n,s=u.PageSettings.Width,h=u.PageSettings.Height,o;switch(r){case 1:n.css("width","100%");n.css("min-width","100%");this.adjustMainDivHeight(n,u,f);break;case 2:n.css("height","100%");n.css("min-height","100%");this.adjustMainDivWidth(n,u,f);break;case 3:n.css("width","100%");n.css("height","100%");n.css("min-width","100%");n.css("min-height","100%");break;case 4:n.css("width","100%");n.css("height","0");n.css("min-width","100%");n.css("padding-bottom",i._calcPaddingBottomRatio(s,h)+"%");e=$(document.createElement("div"));e.css("position","absolute");e.css("left","0");e.css("top","0");e.css("right","0");e.css("bottom","0");e.css("width","");e.css("height","");n.append(e);break;case 0:default:this.adjustMainDivWidth(n,u,f);this.adjustMainDivHeight(n,u,f)}return o=u.PageSettings,t.GridRender.renderFullSizeElement(e[0],o.RowCount+1,o.ColumnCount+1,o.ColumnDefinitions),e},i.adjustMainDivWidth=function(t,i,r){var u=r===1,f=i.PageSettings.ColumnDefinitions,e=f.some(function(n){return n.Mode===2});e&&!u?(t.css("width","inherit"),n.Common.IsEmpty(t.css("min-width"))&&t.css("min-width","100%")):t.css("width","")},i.adjustMainDivHeight=function(n,t){var i=t.PageSettings.RowDefinitions,r=i.some(function(n){return n.Mode===2});r?(n.css("height","inherit"),n.css("min-height","100%")):n.css("height","")},i._calcPaddingBottomRatio=function(n,t){return n>0?100*t/n:100},i}();t.StretchLayout=i})(t=n.Presentation||(n.Presentation={}))})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var t=function(){function t(){}return t.initPageZoomInfo=function(){t.removeDisableZoomCss();n.ForguncyData.pageInfo.allowZoomScreen?$("meta[name='viewport']").replaceWith("<meta name='viewport' content='width=device-width'>"):($("meta[name='viewport']").replaceWith("<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no' />"),t.injectDisableZoomCss())},t.disablePageZoomForMobile=function(){if(n.Platform.isMobile()){var t=function(t){n.ForguncyData.pageInfo.allowZoomScreen||t.touches.length>1&&t.preventDefault()};window.addEventListener("touchstart",t,!1)}},t.injectDisableZoomCss=function(){var t,i;n.Platform.isIOSDevice()&&(t=document.createElement("style"),t.setAttribute("id","disablegestures"),document.body.appendChild(t),i=t.sheet,i.insertRule?i.insertRule("*{touch-action:manipulation;}",0):i.addRule("*","{touch-action:manipulation;}",0),document.ondblclick=function(){})},t.removeDisableZoomCss=function(){if(n.Platform.isIOSDevice()){var t=$("style#disablegestures");t.length!==0&&t.remove()}},t}();n.PageZoomHelper=t})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var t=function(){function t(){var i=this;$(document.body).on("click","["+t.AttributeName+"]",function(){var e=$(this),u=e.attr(t.AttributeName),f=i.getUserManagerOperation(u),r;if(f!==16)return r=[],r.push({$type:"Forguncy.Model.UserManagerCommand, ServerDesignerCommon",operation:f}),n.ForguncyData.commandExcutor.executeCommand(r,{runTimePageName:n.ForguncyData.pageInfo.runTimeNormalPage,commandTrigger:null,commandID:u,eventType:"click"}),!1});$(document).on("forguncyPageloaded",function(){i.loadUserProfile();i.loadUserSubscription();i.loadMFASettings()})}return t.prototype.getUserManagerOperation=function(n){if(n.indexOf("Logout:")===0)return this.getLogoutOperation(n);switch(n){case"LogIn_Button":return 0;case"ForgotPassword_Send":return 3;case"ChangeProfile_Button":return 7;case"ChangePassword_Button":return 4;case"CancelChangePassword_Button":return 5;case"ResetPassword_Button":return 6;case"401Login":return 2;case"MailSubscription_Button":return 8;case"MFA_Secret_Next_Button":return 9;case"MFA_VerifyCode_SubmitButton":return 10;case"MFA_Enable":return 11;case"MFA_Disable":return 12;case"ThirdPartBindingLogin_LoginButton":return 13;case"ThirdPartBindingLogin_RegisterButton":return 14;case"ReloadPage_Button":return 15;default:return 16}},t.prototype.getLogoutOperation=function(t){var r,f=t.split(":"),e=f[1],u=n.ForguncyData.pageInfo.pageElementManager.cells.getCell(e).cellType,i;return u?n.ForguncyData.pageDirtyCheckManager.shouldCancelByPageDirty(!1,!0,"Logout")?16:(i=u.cellTypeData.metaData,{option:1,param:(r=i===null||i===void 0?void 0:i.NavigateSettingWhenLogout)!==null&&r!==void 0?r:{NavigateWhenLogoutMode:n.NavigateWhenLogoutMode.KeepCurrentPage}}):16},t.prototype.loadUserProfile=function(){this.containBuiltinElement("ChangeProfile_Button")&&n.Common.forguncyPost("Account/GetUserProfile",null,function(i){var u,r;i&&(u=$("["+t.AttributeName+"=ChangeProfile_Picture]"),n.ForguncyData.pageInfo.pageElementManager.cells.setValueToForguncyattrCell("ChangeProfile_FullName",i.FullName),n.ForguncyData.pageInfo.pageElementManager.cells.setValueToForguncyattrCell("ChangeProfile_Email",i.Email),r=n.ForguncyData.pageInfo.pageElementManager.cells.getCell(u.attr("id")),!n.Common.IsEmpty(r)&&r.cellType instanceof n.ImageCellType&&r.cellType.setValueToElement(u,i.Picture))})},t.prototype.loadUserSubscription=function(){if(this.containBuiltinElement("MailSubscription_Button")){var i=n.Common.getPageContext(),t={};t.commandID=i.commandID;n.Common.forguncyPost("Home/GetSubscription",t,function(t){t&&n.ForguncyData.pageInfo.pageElementManager.cells.setValueToForguncyattrCell("MailSubscription_Choice",t)})}},t.prototype.loadMFASettings=function(){this.containBuiltinElement("MFA_Secret_Barcode")&&n.Common.forguncyPost("Account/GetMFABarcodeText",null,function(t){var i=n.Common.IsEmpty(t)?null:t;n.ForguncyData.pageInfo.pageElementManager.cells.setValueToForguncyattrCell("MFA_Secret_Barcode",i);n.Common.removeCookie("HasMFASecret=0")})},t.prototype.containBuiltinElement=function(i){var r=$("#pageWrapper_"+n.ForguncyData.pageInfo.pageID).find("["+t.AttributeName+" = "+i+"]");return r.length>0},t.AttributeName="forguncyattr",t}();new t})(Forguncy||(Forguncy={}))
;var __awaiter=this&&this.__awaiter||function(n,t,i,r){function u(n){return n instanceof i?n:new i(function(t){t(n)})}return new(i||(i=Promise))(function(i,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?i(n.value):u(n.value).then(o,s)}e((r=r.apply(n,t||[])).next())})},__generator=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=e[0]&2?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[e[0]&2,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i,e;return e={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e},Forguncy;(function(n){var f=function(){function n(){this._waitingQueque={};this._priorityList=[0,1]}return n.prototype.getPriority=function(n){return n==="validate"?0:1},n.prototype.push=function(n){var t=this.getPriority(n.eventType);this._waitingQueque[t]||(this._waitingQueque[t]=[]);this._waitingQueque[t].push(n)},n.prototype.insertToFirst=function(n){var t=this.getPriority(n.eventType);this._waitingQueque[t]||(this._waitingQueque[t]=[]);this._waitingQueque[t]=[n].concat(this._waitingQueque[t])},n.prototype.shift=function(){for(var i,n,t=0,r=this._priorityList;t<r.length;t++)if(i=r[t],((n=this._waitingQueque[i])===null||n===void 0?void 0:n.length)>0)return this._waitingQueque[i].shift();return null},n.prototype.getInfo=function(n,t){var r,u=this.getPriority(t),i=(r=this._waitingQueque[u])===null||r===void 0?void 0:r.filter(function(i){return i.commandID===n&&i.eventType===t});return(i===null||i===void 0?void 0:i.length)>0?i[0]:null},n.prototype.clear=function(){this._waitingQueque={}},n.prototype.isEmpty=function(){for(var r,n,t=0,i=this._priorityList;t<i.length;t++)if(r=i[t],((n=this._waitingQueque[r])===null||n===void 0?void 0:n.length)>0)return!1;return!0},n}(),i=function(){function t(){this.executingContext={}}return Object.defineProperty(t.prototype,"designerPageName",{get:function(){return n.PageManager.getDesignerPageName(this.runTimePageName,!1)},enumerable:!1,configurable:!0}),t.prototype.getCurrentRowInfoCollection=function(){return n.ForguncyData.pageInfo.currentRowInfoCollection},t.prototype.getBindingValueVersions=function(){return n.ForguncyData.pageInfo.normalCellBindingManager.bindingValueVersions},t}(),r,u,t;n.CommandExecuteInfo=i;r=function(){function r(){this.middleClick=!1;this.commandFactor=new n.CommandFactory;var t=this;t._waitingQueque=new f;$(document).on("mousedown mouseup",function(i){if(i.which===2&&i.target.tagName==="A")return i.type==="mousedown"&&(t.__swcp__||(t.__swcp__=$('<div style="position:fixed;top:0px;left:0px;width:100%;height:100%;background:#000;display:block;z-index:9999;opacity:0.01;filter:alpha(opacity:1);" />').appendTo("body")),n.DelayRefresh.setTimeout(function(){try{t.middleClick=!0;$(i.target).trigger("click","middleButton")}finally{t.middleClick=!1}},50),t.__swcp__.show(),n.DelayRefresh.setTimeout(function(){t.__swcp__.hide()},1e3)),!1});this.createFileInputElementForImportExcelToListViewCommand()}return r.prototype.init=function(){this._commandExecuteInfo=undefined;this._waitingQueque.clear();this._clickCommandsEndTime={}},r.prototype.createFileInputElementForImportExcelToListViewCommand=function(){var t=n.DomUtilities.createJqueryDomElement("input"),i;t.attr("type","file");t.attr("id","forguncy_FileInput");i=".xlsx";n.Platform.isAndroid()&&n.Platform.isWeChatOrQQBrowser()&&(i=null);t.attr("accept",i);t.css("display","none");t.appendTo("body")},r.prototype.ajustCurrentRowInfo=function(t,i,r,u){if(u!=="validate"){var f=this.getAjustedRowInfo(i,r,u).filter(function(n){return!!n});f.forEach(function(t){var i=n.ForguncyData.pageInfo.currentRowInfoCollection.getCurrentRowInfo(t.currentTable);(n.Common.IsEmpty(i)||i.listviewLocation!==t.listviewLocation||!n.Common.isQueryEqual(i.query,t.query))&&n.ForguncyData.pageInfo.currentRowInfoCollection.setCurrentRowInfo(t,!0)});f.length>0&&n.DeleteRecordCommand.prepareRowInfo(t,f[0])}},r.prototype.getAjustedRowInfo=function(t,i,r){var e,f=[],o,u;if(i instanceof n.ListviewBase&&f.push(i.getRowInfo()),r!=="click")return f;for(i instanceof n.RepeaterCellType&&(o=(e=i.listview)===null||e===void 0?void 0:e.getRowInfo(),o&&f.push(o)),u=n.PageManager.getContainerCell(t);u;)u.cellType instanceof n.RepeaterCellType&&f.push(u.cellType.getAdditionalRowInfo(t)),t=u.runTimePageName,u=n.PageManager.getContainerCell(t);return f},r.prototype.alertRepeatMessage=function(t,i){t==="click"&&(new Date).valueOf()-i.valueOf()>1e3&&alert(n.RS.Commit_ExecutingMessage)},r.prototype.isCommandExecuting=function(n,t){return this._commandExecuteInfo&&this._commandExecuteInfo.commandId===n&&this._commandExecuteInfo.eventType===t},r.prototype.excuteCommand=function(n,t){this.executeCommand(n,t)},r.prototype.executeCommand=function(t,i){var r,u,f;if(this.isCommandExecuting(i.commandID,i.eventType)){this.alertRepeatMessage(i.eventType,this._commandExecuteInfo.startTime);return}if(u=this._waitingQueque.getInfo(i.commandID,i.eventType),u){this.alertRepeatMessage(i.eventType,u.startTime);return}(n.ForguncyData.IsAutoTest||i.eventType!=="click"||n.Common.IsEmpty(i.commandID)||(f=this._clickCommandsEndTime[i.commandID],n.Common.IsEmpty(f)||!((new Date).valueOf()-f.valueOf()<300)))&&(this.ajustCurrentRowInfo(t,i.runTimePageName,i.commandTrigger,i.eventType),this._waitingQueque.push({commandID:i.commandID,commands:t,runTimePageName:i.runTimePageName,eventType:i.eventType,initParams:i.initParams,commandTrigger:i.commandTrigger,isMiddelClick:this.isMiddleClick(t,i.eventType),callbackOnCommandCompleted:i.callbackOnCommandCompleted,startTime:new Date,locationStr:i.locationString,listViewInfo:i.listViewInfo,logHelper:(r=i.logHelper)!==null&&r!==void 0?r:new n.CommandLogHelper}),this.executeCommandFromWaitingQueque())},r.prototype.getCommandLocation=function(){var i,r,u,f,e,t=this.getCommandExecuteInfo();switch(t.eventType){case"pageloaded":return n.Common.format(n.RS.StartExecutePageLoadCommand,n.PageManager.getDesignerPageName(t.runTimePageName,!1,!0));case"click":return n.Common.format(n.RS.StartExecuteCellClickCommand,(i=t.locationStr)!==null&&i!==void 0?i:t.commandId);case"dblclick":return n.Common.format(n.RS.StartExecuteCellDblClickCommand,(r=t.locationStr)!==null&&r!==void 0?r:t.commandId);case"valuechanged":return n.Common.format(n.RS.StartExecuteCellValudeChangedCommand,(u=t.locationStr)!==null&&u!==void 0?u:t.commandId);case"processprecommand":return n.Common.format(n.RS.BPM_LogText_ExecutePreCommands);case"processpostcommand":return n.Common.format(n.RS.BPM_LogText_ExecutePostCommands);case"processsavebusinessdatacommand":return n.Common.format(n.RS.BPM_LogText_SaveBussinessDataCommand);case"validate":return n.Common.format(n.RS.CommandLog_StartExecuteValidateCommand,(f=t.locationStr)!==null&&f!==void 0?f:t.commandId);case"propertyChanged":return n.Common.format(n.RS.CommandLog_PropertyChanged,(e=t.locationStr)!==null&&e!==void 0?e:t.commandId);default:return t.locationStr}},r.prototype.executeCommandFromWaitingQueque=function(){var t,r,u,i;if(!this._waitingQueque.isEmpty()&&!this._commandExecuteInfo){if(t=this._waitingQueque.shift(),this._commandExecuteInfo=this._createCommandExecuteInfo(t),n.ForguncyData.commandLogHelper=this._commandExecuteInfo.logHelper,n.ForguncyData.commandLogHelper.tryStartNewRoot(),r=this.getCommandLocation(),this._commandExecuteInfo.logHelper.log(r),u=this._commandExecuteInfo.logHelper.startChild(),this._commandExecuteInfo.validateInfo.isValidating&&(this._commandExecuteInfo.validateInfo.validateLogIndex=u),this._commandExecuteInfo.executingContext={},t.initParams){this._commandExecuteInfo.logHelper.log(n.RS.CreateCommandContextVariables);this._commandExecuteInfo.logHelper.startChild();for(i in t.initParams)n.ForguncyData.parameterManager.setValue(i,t.initParams[i],this._commandExecuteInfo.logHelper),this._commandExecuteInfo.executingContext[i]=t.initParams[i];this._commandExecuteInfo.logHelper.endChild()}this._executeCommand()}},r.prototype.insertCommandsToCurrentExecutingList=function(t,i,r,u){var f,o,s,e;if(r===void 0&&(r=null),u===void 0&&(u=!1),f=this._commandExecuteInfo,f===null||f===void 0?void 0:f.currentCommandList){if(o=f.runTimePageName,f.runTimePageName=i,n.ForguncyData.parameterManager.push(),r)for(s in r)n.ForguncyData.parameterManager.setValue(s,r[s]);e=t;u?t[t.length-1].runTimePageName=o:e=e.concat([new n.RestoreRuntimePageNameParam(o)]);f.currentCommandList=e.concat(f.currentCommandList)}},r.prototype.getCommandExecuteInfo=function(){return this._commandExecuteInfo},r.prototype.isMiddleClick=function(n,t){return t!=="click"||n.length>1?!1:this.middleClick},r.prototype._createCommandExecuteInfo=function(n){var r=new i,f,u;for(r.isFirstCommand=!0,r.commandId=n.commandID,r.currentCommandList=[],f=n.commands.length,u=0;u<f;u++)n.commands[u]&&r.currentCommandList.push(n.commands[u]);return r.commandTrigger=n.commandTrigger,r.runTimePageName=n.runTimePageName,r.haveCommitListView=!1,r.eventType=n.eventType,r.isMiddelClick=this.isMiddleClick(n.commands,n.eventType),r.callbackOnCommandCompleted=n.callbackOnCommandCompleted,r.cacheDataHelper=new t,r.startTime=n.startTime,r.logHelper=n.logHelper,r.listViewInfo=n.listViewInfo,r.validateInfo={isValidating:n.eventType==="validate"},r.continuousExecution=n.eventType==="validate",r.locationStr=n.locationStr,r},r.prototype._executeCommand=function(){var t=this,i=this._commandExecuteInfo;if(i===null||i===void 0?void 0:i.currentCommandList){if(i.suspend){setTimeout(function(){t._executeCommand()},10);return}i.continuousExecution&&n.DelayOperateHelper.haveNoActiveAjaxCall()?t.continueExecuteCommandInList():n.DelayOperateHelper.Push(t,function(){t.shouldExecuteCommandInList()&&t._executeFirstCommandInList(!0)},t._commandExecuteInfo.eventType==="validate"?1:0)}},r.prototype.shouldExecuteCommandInList=function(){var r=this,t=this===null||this===void 0?void 0:this._commandExecuteInfo,i;return(t===null||t===void 0?void 0:t.currentCommandList)?t.suspend?(this._executeCommand(),!1):t.currentCommandList.every(function(t){return n.ModuleLoader.isPluginLoaded(t.$type)})?!0:(i=t.currentCommandList.map(function(t){return n.ModuleLoader.LoadTypeModule(t.$type)}),$.when.apply($,i).then(function(){r._executeCommand()}),!1):!1},r.prototype.continueExecuteCommandInList=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(i){switch(i.label){case 0:return this.shouldExecuteCommandInList()?n.DelayOperateHelper.haveNoActiveAjaxCall()?[4,this._executeFirstCommandInList(!1)]:(this._executeCommand(),[3,2]):[3,2];case 1:return(t=i.sent(),t)?[3,2]:[3,0];case 2:return[2]}})})},r.prototype._executeFirstCommandInList=function(t){return __awaiter(this,void 0,void 0,function(){var i,e,r,o,f,l,s,h,c;return __generator(this,function(a){switch(a.label){case 0:if(i=this._commandExecuteInfo,!(i===null||i===void 0?void 0:i.currentCommandList))return[2,!0];if(!(i.isFirstCommand&&i.commandTrigger))return[3,2];i.isFirstCommand=!1;e=!0;try{e=i.commandTrigger.shouldCancelCommand(i.commandId,i.eventType)}catch(v){e=!0}return e?[4,this.stopExecuteCommandList(i)]:[3,2];case 1:return a.sent(),[2,!0];case 2:return(r=i.currentCommandList,!(r.length===0))?[3,4]:[4,this.stopExecuteCommandList(i,!0)];case 3:return a.sent(),[2,!0];case 4:return(o=r[0],f=o.$type,!(!o.Disabled&&!i.haveCommitListView))?[3,7]:(f==="Forguncy.Model.NavigateCommand, ServerDesignerCommon"||f==="Forguncy.Model.ShowPopupCommand, ServerDesignerCommon"||f==="Forguncy.Model.ClosePopupCommand, ServerDesignerCommon")?(i.haveCommitListView=!0,l=this.addCommitAllEditedTableCommand(r,f),!(l===!0))?[3,5]:(t&&this._executeCommand(),[2,!1]):[3,7];case 5:return(l===n.CommandResult.stop)?[4,this.stopExecuteCommandList(i)]:[3,7];case 6:return a.sent(),[2,!0];case 7:r.shift();s=n.CommandResult.stop;h=!1;a.label=8;case 8:return(a.trys.push([8,,12,15]),c=this._executeSingleCommand(o),!(c instanceof Promise))?[3,10]:[4,c];case 9:return s=a.sent(),[3,11];case 10:s=c;a.label=11;case 11:return[3,15];case 12:return(s===u.stop)?[4,this.stopExecuteCommandList(i)]:[3,14];case 13:h=a.sent();a.label=14;case 14:return!h&&t&&this._executeCommand(),[7];case 15:return[2,h]}})})},r.prototype._executeSingleCommand=function(t){var i,u;return t.Disabled?n.CommandResult.completed:(i=this.commandFactor.CreateCommand(t),!i.EnableProtect&&this._commandExecuteInfo.logHelper.getStackLength()>r.stackSizeLimit)?(console.error("Maximum call stack size exceeded"),n.CommandResult.stop):(i.CommandExecutingInfo=this._commandExecuteInfo,i.CommandExecutor=this,t.DisplayName&&!t.ignoreDisplay&&(this._commandExecuteInfo.logHelper.log(t.DisplayName),this._commandExecuteInfo.logHelper.startChild(),u=new n.CommandTerminateParam,u.command=i,this._commandExecuteInfo.currentCommandList=[u].concat(this._commandExecuteInfo.currentCommandList)),t.ignoreDisplay=!1,i.execute())},r.prototype.stopExecuteCommandList=function(t,i){return i===void 0&&(i=!1),__awaiter(this,void 0,void 0,function(){var s,u,e,h,c,r,o,l,f,a=this;return __generator(this,function(v){switch(v.label){case 0:if(!t||t!==this._commandExecuteInfo)return[2,!0];if(!!t.currentCommandList.every(function(t){return n.ModuleLoader.isPluginLoaded(t.$type)}))return[3,4];s=t.currentCommandList.map(function(t){return n.ModuleLoader.LoadTypeModule(t.$type)});u=0;e=s;v.label=1;case 1:return(u<e.length)?(h=e[u],[4,h]):[3,4];case 2:v.sent();v.label=3;case 3:return u++,[3,1];case 4:if(t!==this._commandExecuteInfo)return[2,!0];for(c=new n.CommandFactory,r=[];t.currentCommandList.length>0;){if(t.currentCommandList[0].$type==="Forguncy.Model.ValidateHelpCommand, ServerDesignerCommon")break;o=t.currentCommandList.shift();try{l=c.CreateCommand(o);l.EnableProtect&&r.push(o)}catch(y){}}if(r&&r.length>0)for(f=0;f<r.length;f++)this._executeSingleCommand(r[f]);return this._commandExecuteInfo.currentCommandList.length>0?[2,!1]:(this._commandExecuteInfo=undefined,t.eventType!=="click"||n.Common.IsEmpty(t.commandId)||(this._clickCommandsEndTime[t.commandId]=new Date),n.DelayRefresh.NeedDelayRun?n.DelayRefresh.setTimeout(function(){a.executeCommandFromWaitingQueque()}):this.executeCommandFromWaitingQueque(),n.ForguncyData.parameterManager.clearCommandParams(),n.ValidateHelpCommand.logValidateResult(t),t.logHelper.logDuring(),t.logHelper.endChild(),t.logHelper.consoleLog(),t.callbackOnCommandCompleted&&t.callbackOnCommandCompleted(i,t.validateInfo.validateResult),[2,!0])}})})},r.prototype.addCommitAllEditedTableCommand=function(t,i){for(var r,o,f=n.ListviewBase.getAllListviews(),e=i==="Forguncy.Model.ShowPopupCommand, ServerDesignerCommon"?1:0,s=f.length,u=0;u<s;u++)if(r=f[u],o=r.stopEditingActiveCell(!0),r.GetDataCommitMode()===0){if(!o)return e===0?n.CommandResult.stop:!1;if(r.isMasterTable()&&r.needCommit())return t.unshift({$type:"Forguncy.Model.commitEditTableCommand, ServerDesignerCommon",listView:r,failOptions:e}),!0}return!1},r.prototype.createCommand=function(n){return this.commandFactor.CreateCommand(n)},r.stackSizeLimit=1e3,r}();n.CommandExecutor=r,function(n){n[n.stop=0]="stop";n[n.completed=1]="completed"}(u=n.CommandResult||(n.CommandResult={}));t=function(){function t(){t._id++;this._cachedData=[]}return t.prototype.cacheData=function(n){var i=this._cachedData.length;return this._cachedData.push(n),{id:t._id,index:i}},t.prototype.getCachedData=function(i){return n.Common.IsEmpty(i)?null:t._id!==i.id?null:this.cacheData.length<=i.index||0>i.index?null:this._cachedData[i.index]},t._id=0,t}();n.CacheDataHelper=t})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__spreadArray=this&&this.__spreadArray||function(n,t,i){if(i||arguments.length===2)for(var r=0,f=t.length,u;r<f;r++)!u&&r in t||(u||(u=Array.prototype.slice.call(t,0,r)),u[r]=t[r]);return n.concat(u||Array.prototype.slice.call(t))},Forguncy;(function(n){var i=function(){function t(){this.CommandExecutingInfo=new n.CommandExecuteInfo;this.CommandExecutingInfo.currentCommandList=[]}return t.prototype.getPluginResource=function(t){for(var u,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];return u=n.Plugin.LocalizationResourceHelper.getLocalizationResourceByCommand(this),n.Common.formatResource(u[t],r)},t.prototype.getApplicationResource=function(t){for(var r,u=[],i=1;i<arguments.length;i++)u[i-1]=arguments[i];return(r=n.Plugin.LocalizationResourceHelper).getApplicationResource.apply(r,__spreadArray([t],u,!1))},t.prototype.stopExecuteCommandList=function(){this.CommandExecutor&&this.CommandExecutor.stopExecuteCommandList&&this.CommandExecutor.stopExecuteCommandList(this.CommandExecutingInfo)},t.prototype.addIgnoreDisplayCommand=function(t){return!t||!this.CommandExecutingInfo.currentCommandList?t:(t=n.Common.clone(t),t.ignoreDisplay=!0,this.CommandExecutingInfo.currentCommandList=[t].concat(this.CommandExecutingInfo.currentCommandList),t)},t.prototype.addToCommandList=function(t,i,r,u){var o,s,h,f,c,e;if(!n.Common.IsEmpty(t)&&!(t.length<=0)&&this.CommandExecutingInfo.currentCommandList){for(i=(o=i!==null&&i!==void 0?i:this.CommandParam.rowOffset)!==null&&o!==void 0?o:0,r=(s=r!==null&&r!==void 0?r:this.CommandParam.columnOffset)!==null&&s!==void 0?s:0,u=(h=u!==null&&u!==void 0?u:this.CommandParam.formulaListRowInfo)!==null&&h!==void 0?h:null,f=0,c=t;f<c.length;f++)e=c[f],e.rowOffset=i,e.columnOffset=r,e.formulaListRowInfo=u;this.CommandExecutingInfo.currentCommandList=t.concat(this.CommandExecutingInfo.currentCommandList)}},t.prototype.getCellLocation=function(t){return n.Helper.getCellLocation(t,this.getFormulaCalcContext())},t.getCellID=function(i,r,u){var l=[],p=r===null||r===void 0?void 0:r.runTimePageName,e,o,f,s,h,c;if(n.ForguncyData.parameterManager.NeedUpdateReference(i.Name)?(o=n.ForguncyData.parameterManager.ParamToReference(i.Name),f=n.Common.parseCellReferenceFormulaToCellLocation(o),f.length>0&&(i=f[0])):(e=n.PageManager.getContainerCell(r.runTimePageName),(e===null||e===void 0?void 0:e.cellType)instanceof n.UserControlPageCellType&&e.cellType.needUpdateReference(i.Name)&&(o=e.cellType.propertyToReference(i.Name),f=n.Common.parseCellReferenceFormulaToCellLocation(o.referStr),f.length>0&&(i=f[0],p=o.runTimePageName))),n.Common.IsEmpty(i.Name)){i=t.offsetFormulaCellLocation(i,r.rowOffset,r.columnOffset);var a=i.Row,v=i.Column,y=p;u||(s=n.Common.getLocatedListview(y,a,v),s&&(a=0,v-=s.getRangeInfo().Column,y=s.getCalcSheetName()));l.push(n.Common.getIdStr(a,v,y))}else if(h=n.ForguncyData.pageInfo.pageElementManager.cells.getCellsByName(i.Name,!1),h)for(c=0;c<h.length;c++)l.push(h[c].id);return l},t.offsetFormulaCellLocation=function(t,i,r,u){var e,s,f,o;return((t===null||t===void 0?void 0:t.Name)&&(n.ForguncyData.parameterManager.NeedUpdateReference(t.Name)?(s=n.ForguncyData.parameterManager.ParamToReference(t.Name),f=n.Common.parseCellReferenceFormulaToCellLocation(s),f.length>0&&(t=f[0])):u&&(e=n.PageManager.getContainerCell(u),(e===null||e===void 0?void 0:e.cellType)instanceof n.UserControlPageCellType&&e.cellType.needUpdateReference(t.Name)&&(s=e.cellType.propertyToReference(t.Name),f=n.Common.parseCellReferenceFormulaToCellLocation(s.referStr),f.length>0&&(t=f[0])))),n.Common.IsEmpty(t)||!n.Common.IsEmpty(t.Name)||!t.RowRelative&&!t.ColumnRelative)?t:(n.Common.IsEmpty(i)&&(i=0),n.Common.IsEmpty(r)&&(r=0),i===0&&r===0)?t:(o=n.Common.clone(t),o.RowRelative&&(o.Row+=i),o.ColumnRelative&&(o.Column+=r),o)},t.prototype.evaluateKeyword=function(t){return n.KeyWords.GetKeyWordValue(t,this.CommandExecutingInfo.runTimePageName)},t.prototype.evaluateFormula=function(t){return n.ForguncyData.pageInfo.formulaManager.evaluateFormula(t,this.getDefaultFormulaCalcInfo())},t.prototype.getFormulaCalcContext=function(){var t=this.CommandExecutingInfo.runTimePageName;return{IsInMasterPage:n.PageManager.isMasterPageName(t),PageID:t,ListviewRowInfo:this.CommandParam.formulaListRowInfo,RowOffset:this.CommandParam.rowOffset,ColumnOffset:this.CommandParam.columnOffset,IsCommand:!0}},t.prototype.getDefaultFormulaCalcInfo=function(){return{runTimePageName:this.CommandExecutingInfo.runTimePageName,nullAsException:!1,listInfo:this.CommandParam.formulaListRowInfo,rowOffset:this.CommandParam.rowOffset,columnOffset:this.CommandParam.columnOffset,isCommand:!0}},t.prototype.commandPost=function(t,i,r,u){var f=this;n.Common.forguncyPost(t,i,r,u,function(){alert(n.RS.Command_postFail_ErrorMessage);f.stopExecuteCommandList()})},t.prototype.log=function(n){this.CommandExecutingInfo.logHelper.log(n)},t.prototype.executeCustomCommandObject=function(t,i,r,u){var f;(r===void 0&&(r="click"),u===void 0&&(u=null),!t||!t.Commands||t.Commands.length<=0)||n.ForguncyData.commandExecutor.executeCommand(t.Commands,{runTimePageName:this.CommandExecutingInfo.runTimePageName,commandTrigger:null,commandID:this.CommandExecutingInfo.commandId,eventType:r,initParams:i,callbackOnCommandCompleted:u,locationString:n.Common.format(n.RS.TriggerByCommand,(f=this.CommandParam.DisplayName)!==null&&f!==void 0?f:"Command")})},t.prototype.getBindingDataSourceValue=function(t,i){var r=this;return new Promise(function(u,f){var o,e,s,h,c;if(t||u(null),t.GUID){if(o={},t.Params)for(e=0,s=t.Params;e<s.length;e++)h=s[e],o[h]=r.evaluateFormula(h);c={CommandId:t.GUID,Params:o,options:i};n.Common.forguncyPost("Home/CalcBindingDataSource",c,function(n){u(n);r.addWarningInfoIfNecessary(n)},n.Common.generateID("command"),function(){f()},function(){f("cancel")})}})},t.prototype.addWarningInfoIfNecessary=function(t){var i,r,u,e,f;n.ForguncyData.isDebugMode()&&(r=n.RS.PerformanceWarning,u=(i=t===null||t===void 0?void 0:t.length)!==null&&i!==void 0?i:0,u>2e3&&(e=this.CommandExecutor.getCommandLocation()+" "+this.CommandParam.DisplayName,f=n.Common.format(n.RS.PerformanceWarningCommandLoadTooManyDatas,e,u),console.warn("%c"+r+" %c"+f,"color:red;font-weight:600","color:black;"),n.ForguncyData.pageInfo.dataModel.debugWarningInfoDataModel.push({message:"".concat(r).concat(f)})))},t}(),t,f,r,e,u;n.CommandBase=i;t=function(){function t(){}return t.prototype.CreateCommand=function(n){var t=this._createCommandInstance(n);return t.CommandParam=n,t},t.prototype._createCommandInstance=function(i){var r,u;if(i.$type==="Forguncy.Model.ImportExcelToListViewCommand, ServerDesignerCommon"&&(n.ImportExcelToListViewCommand||(r=document.createElement("script"),r.type="text/javascript",r.src=n.ForguncyData.ForguncyRoot+"Resources/ImportExcel.js?v="+n.StaticData.JSVersion,$("head").append(r))),u=t._registedCommands[i.$type],u)return new u;throw"Not Support This Type: "+i.$type;},t.registerCommand=function(n,i){t._registedCommands[n]=i},t.getCommandTypeByCommand=function(n){for(var i in t._registedCommands)if(t._registedCommands[i]===n.constructor)return i;return null},t._registedCommands={},t}();n.CommandFactory=t;f=function(){function n(){this.$type="Forguncy.Model.CommandTerminateParam, ServerDesignerCommon"}return n}();n.CommandTerminateParam=f;r=function(t){function i(){var n=t.call(this)||this;return n.EnableProtect=!0,n}return __extends(i,t),i.prototype.execute=function(){return this.CommandExecutingInfo.logHelper.logDuring(),this.CommandExecutingInfo.logHelper.endChild(),n.CommandResult.completed},i}(i);n.CommandTerminate=r;t.registerCommand("Forguncy.Model.CommandTerminateParam, ServerDesignerCommon",r);e=function(){function n(n){this.$type="Forguncy.Model.RestoreRuntimePageNameParam, ServerDesignerCommon";this.runTimePageName=n}return n}();n.RestoreRuntimePageNameParam=e;u=function(t){function i(){var n=t.call(this)||this;return n.EnableProtect=!0,n}return __extends(i,t),i.prototype.execute=function(){return this.CommandExecutingInfo.runTimePageName=this.CommandParam.runTimePageName,n.ForguncyData.parameterManager.pop(),n.CommandResult.completed},i}(i);n.RestoreRuntimePageNameCommand=u;t.registerCommand("Forguncy.Model.RestoreRuntimePageNameParam, ServerDesignerCommon",u)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t,s=(t={},t[0]="",t[1]="Question",t[2]="Information",t[3]="Error",t[4]="Warning",t),u=function(t){function r(){return t!==null&&t.apply(this,arguments)||this}return __extends(r,t),r.prototype.execute=function(){var n=this.CommandParam;return this.ExecuteConditionCommand(n)},r.prototype.ExecuteConditionCommand=function(t){var u,e,r,i;if(!t||!t.ConditionAndCommandPairList)return n.CommandResult.completed;u=t.ConditionAndCommandPairList;e=t.FunctionNameForGenerate;try{return r=this.getNoValueBindingInfos(u),this._ifConditionParamCalculator=new f(this.getDefaultFormulaCalcInfo(),r,this.CommandExecutingInfo),r.length>0?(i=this,i.commandPost("Home/GetConditionParamResult",{bindingInfos:r===null||r===void 0?void 0:r.map(function(n){return n.GUID}),currentRowInfos:i.CommandExecutingInfo.getCurrentRowInfoCollection().list,pageName:i.CommandExecutingInfo.designerPageName},function(t){if(t===""||t===null||t===undefined||t==="null")return i.stopExecuteCommandList(),n.CommandResult.stop;var r=typeof t=="string"?JSON.parse(t):t;i._ifConditionParamCalculator.tableValues=r;i.executeCommandIfConditionIsRight(u,e)})):this.executeCommandIfConditionIsRight(u,e),n.CommandResult.completed}catch(o){o.stack.indexOf(e)?n.ErrorHelper.printError(o):alert(o)}},r.prototype.getNoValueBindingInfos=function(n){for(var i=[],t=0;t<n.length;t++)this.getNoValueBindingInfoUsedInCondition(n[t].Condition,i);return i},r.prototype.getNoValueBindingInfoUsedInCondition=function(t,i){for(var r,e,u,o=n.ConditionHelper.enumAllConditions(t),f=0;f<o.length;f++)if(r=o[f],!n.Common.IsEmpty(r.param)&&!n.Common.IsEmpty(r.param.tableData)){for(e=!1,u=i.length-1;u>=0;u--)if(n.Common.isBindingInfoEquals(r.param.tableData,i[u])){e=!0;break}e||i.push(r.param.tableData)}},r.prototype.logCondition=function(t,i){t?t.indexOf("{0}")>=0?this.log(n.Common.format(t,i)):this.log(t):this.log("IF")},r.prototype.executeCommandIfConditionIsRight=function(t,r,u){var o=this,c,f,s,h;for(u===void 0&&(u=0),c=function(u){var h,s,c,l;return t[u].ConfirmDialogSettings?(f.showConfirmBox(t[u],function(){o.logCondition(t[u].ConditionDispay,t[u].ConfirmDialogSettings.YesButtonText);o.CommandExecutingInfo.logHelper.startChild();o.addToCommandList([new i]);o.addToCommandList(t[u].CommandList)},function(){o.logCondition(t[u].ConditionDispay,t[u].ConfirmDialogSettings.NoButtonText);o.executeCommandIfConditionIsRight(t,r,u+1)}),{value:!1}):t[u].JSText?(h=f.getJSFunction(t[u].FunctionNameForJS),s=!0,h&&(s=h()),n.Common.isFuzzyEquals(s,!0)?(f.logCondition(t[u].ConditionDispay,s),f.CommandExecutingInfo.logHelper.startChild(),f.addToCommandList([new n.CommandTerminateParam]),f.addToCommandList(t[u].CommandList),{value:!0}):(f.logCondition(t[u].ConditionDispay,s),f.executeCommandIfConditionIsRight(t,r,u+1),{value:!1})):(c=n.ConditionHelper.getConditionResult(t[u].Condition,f._ifConditionParamCalculator.formulaCalcInfo,f._ifConditionParamCalculator),l=new e(f._ifConditionParamCalculator.formulaCalcInfo.rowOffset,f._ifConditionParamCalculator.formulaCalcInfo.columnOffset).getConditionLogString(t[u]),f.logCondition(l,c),c)?(f.CommandExecutingInfo.logHelper.startChild(),f.addToCommandList([new n.CommandTerminateParam]),f.addToCommandList(t[u].CommandList),"break"):void 0},f=this,s=u;s<t.length;s++){if(h=c(s),typeof h=="object")return h.value;if(h==="break")break}return!0},r.prototype.getJSFunction=function(t){var i=n.RunJavaScriptCommandFunctions;if(i)return i[t]},r.prototype.showConfirmBox=function(t,i,r){var l=this,a=document.activeElement,c,f,o;this.CommandExecutingInfo.suspend=!0;var u=t.ConfirmDialogSettings,e=function(){l.CommandExecutingInfo.suspend=!1},h="";u.ConfirmIcon!==0&&(h=n.ForguncyData.ForguncyRoot+"Resources/Images/ConfirmDialog/"+s[u.ConfirmIcon]+".png");c=this.evaluateFormula(u.FormulaText);f=n.PopupHelper.createConfirmPopupDom(n.Common.getMultiLanguageWord(u.Title),h,c,!n.ForguncyData.GlobalSettings.HidePopUpCloseButton);f.zIndex=n.ForguncyData.pageInfoStack.length;o=f.target.footerButtonGroup.items;o[0].text=n.Common.getMultiLanguageWord(u.YesButtonText);o[1].text=n.Common.getMultiLanguageWord(u.NoButtonText);f.target.on("Confirm",function(){e();i()});f.target.on("Cancel",function(){e();r()});f.target.on("Close",function(){e()})},r}(n.CommandBase),f,i,r,e,o;n.ConditionCommand=u;f=function(){function t(n,t,i){this.formulaCalcInfo=n;this.bindingInfoList=t;this.commandExecuteInfo=i}return t.prototype.calc=function(t){if(n.Common.IsEmpty(t)||n.Common.IsEmpty(t.param))return null;var i=t.param;return typeof i.result=="undefined"&&(i.result=this.getParamResult(t.param)),i.result},t.prototype.getParamResult=function(t){var u,s,e,f,o,i,r;if(typeof t.cellLocations!="undefined")return(u=t.cellLocations,u===null||u===undefined||u.length!==1)?null:n.Common.IsEmpty(u[0].Name)?(s=n.CommandBase.offsetFormulaCellLocation(u[0],this.formulaCalcInfo.rowOffset,this.formulaCalcInfo.columnOffset),n.ForguncyData.pageInfo.formulaManager.getValue(s,this.formulaCalcInfo)):n.ForguncyData.pageInfo.formulaManager.evaluateFormula("="+u[0].Name,this.formulaCalcInfo);if(typeof t.tableData!="undefined"){for(e=n.ListviewBase.getAllListviews(),i=0;i<e.length;i++)if((f=e[i],f.getDataTableName()===t.tableData.TableName&&!f.isGroupMode())&&(o=f.listviewData.getColIndexByBindingInfo(t.tableData),o!==-1))return f.getListDataModel().getValue(f.getCurrentRowIndex(),o);for(i=0;i<this.bindingInfoList.length;i++)if(n.Common.isBindingInfoEquals(this.bindingInfoList[i],t.tableData))return this.tableValues[i]}else return typeof t.contextProperty!="undefined"?t.contextProperty.ContextInfoType===1?this.commandExecuteInfo.executingContext.valueChangedReason:(r=t.contextProperty.Display,r&&r[0]==="="&&(r=r.substring(1)),this.commandExecuteInfo.executingContext.hasOwnProperty(r))?this.commandExecuteInfo.executingContext[r]:n.CustomFunction.GetParamFunction.getParamResult(r):typeof t.currentUserProperty!="undefined"?n.UserInfoHelper.getUserInfo(t.currentUserProperty):null},t.prototype.needUnparseValue2=function(t){if(typeof t.param.cellLocations!="undefined"){if(t.param.cellLocations===null||t.param.cellLocations===undefined||t.param.cellLocations.length!==1)return!0;try{var i=n.CommandBase.getCellID(t.param.cellLocations[0],this.formulaCalcInfo,!1);return!i||i.length!==1?!0:n.SetCellPropertyCommand.shouldUnparseText(i[0])}catch(r){return!1}}else return typeof t.param.tableData!="undefined"?!0:typeof t.param.currentUserProperty!="undefined"?!1:!0},t.prototype.equals=function(t,i){return n.Common.isFuzzyEquals(t,i)},t}();n.CommandFactory.registerCommand("Forguncy.Model.ConditionCommand, ServerDesignerCommon",u);i=function(){function n(){this.$type="Forguncy.Model.ConditionTerminateParam, ServerDesignerCommon"}return n}();n.ConditionTerminateParam=i;r=function(t){function i(){var n=t.call(this)||this;return n.EnableProtect=!0,n}return __extends(i,t),i.prototype.execute=function(){return this.CommandExecutingInfo.logHelper.endChild(),n.CommandResult.completed},i}(n.CommandBase);n.ConditionTerminate=r;e=function(){function t(n,t){this._rowOffset=n;this._colOffset=t}return t.prototype.getConditionLogString=function(t){if(t.Condition&&(this._rowOffset!==0||this._colOffset!==0)){var i=this.getConditionString(t.Condition);return n.Common.format(n.RS.ConditionCommand_Log_EvalueCondition,i,"{0}")}return t.ConditionDispay},t.prototype.getConditionString=function(t){return t?n.ConditionHelper.isRelationCondition(t)?this.getRelationConditionString(t):this.getIfConditionString(t):null},t.prototype.getRelationConditionString=function(t){var u=this,r=t.SubConditions.map(function(n){return u.getConditionString(n)}),f=t.RelationType===0?n.RS.Condition_RelationType_And:n.RS.Condition_RelationType_Or,i=r.join(" "+f+" ");return r.length>1&&(i="("+i+")"),i},t.prototype.getIfConditionString=function(t){var r,u,f=this.getIfConditionParamString(t===null||t===void 0?void 0:t.param),i;return n.Common.IsEmpty(f)?null:(i=(u=(r=t.value)===null||r===void 0?void 0:r.toString())!==null&&u!==void 0?u:"",i.startsWith("=")&&(i="="+n.FormulaHelper.translateFormula(i,new o(this._rowOffset,this._colOffset))),n.Common.format(t.OriginalConditionDispay,f,i))},t.prototype.getIfConditionParamString=function(t){var i,r;return t&&typeof t.cellLocations!="undefined"&&(i=t.cellLocations,(i===null||i===void 0?void 0:i.length)===1&&n.Common.IsEmpty(i[0].Name))?(r=n.CommandBase.offsetFormulaCellLocation(i[0],this._rowOffset,this._colOffset),"="+n.FormulaHelper.getReferenceString(r.Row,r.Column)):t===null||t===void 0?void 0:t.ParamDisplay},t}();o=function(n){function t(t,i){var r=n.call(this)||this;return r._rowOffset=t,r._colOffset=i,r}return __extends(t,n),t.prototype.visitCellExpression=function(n){return n.rowRelative&&(n.row+=this._rowOffset),n.columnRelative&&(n.column+=this._colOffset),n},t.prototype.visitRangeExpression=function(n){return n.rowRelative&&(n.row+=this._rowOffset),n.columnRelative&&(n.column+=this._colOffset),n},t}(n.ExpressionVisitor);n.CommandFactory.registerCommand("Forguncy.Model.ConditionTerminateParam, ServerDesignerCommon",r)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.execute=function(){return this.commitEditedTable(this.CommandParam)},i.prototype.commitEditedTable=function(t){var i,r;try{return(i=t.listView,typeof i=="undefined")?n.CommandResult.completed:(r=i.commitEditChange(),t.failOptions===0&&r==="cancel")?n.CommandResult.stop:n.CommandResult.completed}catch(u){alert(u)}},i}(n.CommandBase);n.commitEditTableCommand=t;n.CommandFactory.registerCommand("Forguncy.Model.commitEditTableCommand, ServerDesignerCommon",t)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t=function(t){function i(){var n=t!==null&&t.apply(this,arguments)||this;return n._isPdf=!1,n}return __extends(i,t),i.prototype.execute=function(){if(n.Common.IsEmpty(this.CommandParam))return n.CommandResult.completed;this.CommandExecutingInfo.suspend=!0;try{this.export(this.CommandParam)}catch(t){return alert(t),this.CommandExecutingInfo.suspend=!1,n.CommandResult.completed}},i.prototype.export=function(t){var i=this,u,r=this.getExportParam(t),f=((u=n.PageManager.getContainerCell(r.runTimePageName))===null||u===void 0?void 0:u.cellType)instanceof n.RepeaterCellType;if(r.pageName.length>31&&!f)throw r.isExportListview?n.RS.ExportListviewToExcelCommand_PageNameTooLong:n.RS.ExportPageToExcelCommand_PageNameTooLong;n.Common.forguncyPost("Home/GiveParam",r,function(t){try{i._isPdf?n.Common.openWindow(n.ForguncyData.ForguncyRoot+"Home/ExportFile?key="+t):n.Common.download(n.ForguncyData.ForguncyRoot+"Home/ExportFile?key="+t)}finally{n.DelayRefresh.setTimeout(function(){i.CommandExecutingInfo.suspend=!1},500)}},"export",function(){i.CommandExecutingInfo.suspend=!1},function(){i.CommandExecutingInfo.suspend=!1})},i.prototype.getExportParam=function(t){var i=this.getRunTimeNormalPageName(),r=n.ListviewBase.getAllListviews([i]),u=this.getListview(t,i),s=this.getExportFileName(t),h=this.getPassword(t),e=this.getRepeatInfo(t,u),f=this.isExportListview(t),o={pageName:this.getExportDesignerPageName(t,i),pageTitle:this.getExportDesignerPageTitle(t,i),runTimePageName:i,tableName:t.ListViewName,currentRowInfoList:this.CommandExecutingInfo.getCurrentRowInfoCollection().list,exportTableMode:t.ExportTableOverFlowMode,exportExcelPageNameMode:t.ExportExcelPageNameMode,otherName:s,exportExcelListviewNameMode:t.ExportExcelListviewNameMode,isOnlyExportValue:t.TargetPageName?!1:!!t.IsOnlyExportValue,dataModel:t.TargetPageName?null:n.ForguncyData.pageInfo.dataModel.normalCellDataModel.getAllExportDatas(),queryCondition:this.getQueryCondition(),sortInfoCache:this.getSortInfoCache(i),columnFilterQueries:this.getColumnFilterQueries(t.ListViewName?[u]:r),runtimeQueryConditionDatas:this.getRuntimeQueryConditionDatas(t.ListViewName?[u]:r),viewQueryConditionFormulaValues:this.getViewQueryConditionFormulaValues(t,r),isPdf:this._isPdf,repeatQureys:e.querys,repeatTableName:e.tableName,AutoFitRowHeight:t.AutoFitRowHeight,AsyncExport:t.AsyncExport,ListviewColumns:this.getListviewColumnInfos(u),listviewsTotalRowFormulaValues:f?this.getListviewTotalRowFormulaValues(r):null,isExportListview:f,deviceInfo:n.MFAHelper.GetDeviceInfo(),password:h};if(f&&o.ListviewColumns.length===0)throw n.RS.ExportListviewNoColumnError;return o},i.prototype.getListviewTotalRowFormulaValues=function(t){var i={};return t.forEach(function(t){if(n.SpreadJSView&&t instanceof n.SpreadJSView){var r=t.getListviewName();i[r]={};t.listviewData.visibleColumns.forEach(function(n){var u=n.columnInfo.TotalRowCell;u&&u.FormulaType===0&&u.StatisticFormula&&(i[r][n.columnInfo.Index]=t.getTotalRowStaticValue(u))})}}),i},i.prototype.getExportDesignerPageName=function(t,i){return t.TargetPageName?t.TargetPageName:n.PageManager.getDesignerPageName(i,!0)},i.prototype.getExportDesignerPageTitle=function(t,i){return t.TargetPageTitle?t.TargetPageTitle:n.PageManager.getDesignerPageTitle(i)},i.prototype.getRunTimeNormalPageName=function(){var t=this.CommandExecutingInfo.runTimePageName;return n.PageManager.getRunTimeNormalPageName(t)},i.prototype.getListview=function(t,i){if(n.Common.IsEmpty(t.ListViewName))return null;var r=n.ListviewBase.getListview(t.ListViewName,i);if(!r)throw n.RS.listviewNotExisted;return r},i.prototype.getQueryCondition=function(){var t={};for(var i in n.ForguncyData.pageInfo.commandQuerys)t[i]=JSON.stringify(n.ForguncyData.pageInfo.commandQuerys[i]);return t},i.prototype.getViewQueryConditionFormulaValues=function(n,t){if(n.TargetPageName)return null;var i={};return t.forEach(function(n){var t=n.GetQueryConditionFormulaValues();t&&(i[n.getListviewName()]=t)}),i},i.prototype.getSortInfoCache=function(t){for(var r,u,f={},o=n.ListviewBase.getAllListviews([t]),i=0,e=o;i<e.length;i++)(r=e[i],u=n.ForguncyData.pageInfo.getSortInfoWithBinding(r.getLocationString()),u)&&(f[r.getFullListviewName()]=u);return f},i.prototype.getColumnFilterQueries=function(t){var i={};return t.forEach(function(t){var r=n.ForguncyData.pageInfo.getFilterInfoWithBinding(t.getLocationString());r&&(i[t.getFullListviewName()]=r)}),i},i.prototype.getRuntimeQueryConditionDatas=function(t){var i={};return t.forEach(function(t){var r=n.ForguncyData.pageInfo.runtimeQueryConditionDataCache[t.getLocationString()];r&&(i[t.getFullListviewName()]=r)}),i},i.prototype.getExportFileName=function(t){var i=null,e=this.isExportListview(t)?t.ExportExcelListviewNameMode===1:t.ExportExcelPageNameMode===2,r,u,f;if(e){if(i=this.evaluateFormula(t.NewOtherName),i instanceof GC.Spread.CalcEngine.CalcError)if(this._isPdf)throw n.RS.ExprotToPDFCalFormulaError;else throw n.RS.ExprotToExcelCalFormulaError;}else n.Common.IsEmpty(t.TargetPageName)&&(r=n.PageManager.getContainerCell(this.CommandExecutingInfo.runTimePageName),r&&r.cellType instanceof n.RepeaterCellType&&(u=r.cellType,f=u.listview.getListviewName(),i=f+"-"+(u.getTabIndex(this.CommandExecutingInfo.runTimePageName)+1)));return i},i.prototype.getPassword=function(t){var i=this.evaluateFormula(t.Password);if(i instanceof GC.Spread.CalcEngine.CalcError)throw n.RS.ExportToExcel_CalFormulaErrors;if(i&&i.length>255)throw n.RS.ExportToExcel_PasswordLengthException;return i},i.prototype.getRepeatInfo=function(t,i){var r,s="",f,u,e,o;if(!n.Common.IsEmpty(t.RowsToExport)&&i)if(r=[],s=i.getDataTableName(),f=i.getListDataModel(),t.RowsToExport===0)for(u=0;u<f.getRowCount();u++)e=f.getRowQuery(u),e&&r.push(e);else{if(o=i.getSelectedRowsData(),o.length===0)throw n.RS.NoSelectedRowError;o.forEach(function(n){n.query&&r.push(n.query)})}return{tableName:s,querys:r}},i.prototype.getListviewColumnInfos=function(t){var u=this,i,r;return t?(i=n.SpreadJSView&&t instanceof n.SpreadJSView,r=t.getExportColmnMetadatas(),r.map(function(n,r){return{index:n.Index,name:n.IsExternal?n.TemplateCell.Element.Name[0]:null,width:i?t.getColumnWidth(r):n.Width,shouldAutofit:u.shouldAutofit(t,i,r),commandID:n.ColumnOptionsCommandID}}).filter(function(n){return n.width!==0})):null},i.prototype.shouldAutofit=function(n,t,i){if(!n.listviewData.getAutoFitColumnWidth())return!1;if(t){var r=n.getColumnWidth(i),u=n.getAutoFitWidth(i);return r===u}return!0},i.prototype.isExportListview=function(n){return!this._isPdf&&!!n.ListViewName},i}(n.CommandBase),i;n.ExportCommand=t;i=function(n){function t(){var t=n.call(this)||this;return t._isPdf=!0,t}return __extends(t,n),t}(t);n.ExportCommandPDF=i;n.CommandFactory.registerCommand("Forguncy.Model.ExportListViewToExcelCommand, ServerDesignerCommon",t);n.CommandFactory.registerCommand("Forguncy.Model.ExportPageToExcelCommand, ServerDesignerCommon",t);n.CommandFactory.registerCommand("Forguncy.Model.ExportPageToPdfCommand, ServerDesignerCommon",i)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.execute=function(){return this.Goto(this.CommandParam)},i.prototype.Goto=function(t){var r,e,f,o,i;try{if(n.Common.IsEmpty(t))return n.CommandResult.completed;r=t.TableName;r||(e=this.CommandExecutingInfo.getCurrentRowInfoCollection(),e.list.length>0&&(r=e.list[0].currentTable));var u=t.TargetRecord,h=n.ListviewBase.getAllListviews(),a=h.length;for(f=0;f<a;f++)if(o=h[f],o.getDataTableName()===r)return this._goToListviewRecord(o,u),n.CommandResult.completed;if((i=this.CommandExecutingInfo.getCurrentRowInfoCollection().getCurrentRowInfo(r),i===null)||i.recordID===0&&(u===0||u===2))return this.stopExecuteCommandList(),n.CommandResult.stop;var c=i.listviewLocation,v=n.ForguncyData.pageInfo.getFilterInfoWithBinding(c),y=n.ForguncyData.pageInfo.runtimeQueryConditionDataCache[c],s=i.currentTable,l=n.ForguncyData.pageInfo.normalCellBindingManager.getBindingInfos(s),p=this;return n.Common.forguncyPost("Home/GetTargetRecordData",{bindingInfos:l.pageBindingInfo,targetRecord:u,currentRowInfo:i,queryCommandInfo:n.ForguncyData.pageInfo.commandQuerys[s],sortInfo:n.ForguncyData.pageInfo.getSortInfoWithBinding(i.listviewLocation),columnFilterQueries:v,runtimeQueryConditionData:y},function(t){if(t&&t.data){var i=p.CommandExecutingInfo.getCurrentRowInfoCollection().getCurrentRowInfo(s);if(i){i.query=t.query;switch(u){case 0:i.recordID=Number(i.recordID)-1;break;case 1:i.recordID=Number(i.recordID)+1;break;case 2:i.recordID=0;break;case 3:i.recordID=Number(t.recordCount)-1}i.recordID>=Number(t.recordCount)?i.recordID=Number(t.recordCount)-1:i.recordID<0&&(i.recordID=0);n.ForguncyData.pageInfo.normalCellBindingManager.updateBindingValues(t.data,i.currentTable,l.bindingInfos);n.ForguncyData.pageInfo.currentRowInfoCollection.setCurrentRowInfo(i,!1)}}}),n.CommandResult.completed}catch(w){alert(w)}},i.prototype._goToListviewRecord=function(n,t){var r=n.getActualDataLength(),i,u;r<=0||(i=-1,t===2?i=0:t===3?i=r-1:(u=n.getCurrentRowIndex(),t===0?i=u-1:t===1&&(i=u+1)),i>=0&&i<r&&n.selectRow(i))},i}(n.CommandBase);n.GoToRecordCommand=t;n.CommandFactory.registerCommand("Forguncy.Model.GoToRecordCommand, ServerDesignerCommon",t)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.execute=function(){try{return i.gotoPage(this.CommandParam,this.CommandExecutingInfo.runTimePageName),n.CommandResult.completed}catch(t){alert(t)}},i.gotoPage=function(t,i){var s=this;if(this.isParamsValid(t)){var f=t.TargetPageIndex,e=t.Limit,r=n.ListviewBase.getListview(t.ListviewName,i),u=r.getLocationString(),o=n.ForguncyData.pageingInfoList.GetInfo(u);r.showLoadingIndicator();n.ForguncyData.pageingInfoList.GetRowCount(u,function(i){var c,h;f=s.ensureIndexByTargetPageKind(f,e,t.targetPageKind,i);c=n.ForguncyData.pageingInfoList.SetPageingInfo(u,f,e);c||(h=n.ForguncyData.pageingInfoList.GetInfo(u),(h.getCurrentPageIndex()!==o.getCurrentPageIndex()||h.getPageCount()!==o.getPageCount())&&r.fillData(undefined,undefined,undefined,undefined,undefined,undefined,!1));r.hiddenLoadingIndicator()})}},i.ensureIndexByTargetPageKind=function(n,t,i,r){switch(i){case 0:n=1;break;case 1:n--;break;case 2:n++;break;case 3:n=Math.ceil(r/t)}return n=Math.min(n,Math.ceil(r/t)),Math.max(n,1)},i.isParamsValid=function(t){return n.Common.IsEmpty(t)?!1:isNaN(t.TargetPageIndex)?!1:isNaN(t.Limit)?!1:!0},i}(n.CommandBase);n.GoToPageCommand=t;n.CommandFactory.registerCommand("Forguncy.Model.GoToPageCommand, ServerDesignerCommon",t)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var r=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.navigateToPage=function(t,r,u,f,e){var v,s,o,l,a,c,h,y;return this.CommandExecutingInfo.isMiddelClick?(this.stopExecuteCommandList(),n.CommandResult.stop):(s=t.PageName,t.DeleteCachedQuery&&n.ForguncyData.pageInfo.pageElementManager.cleanQuaryCookie(s),o={historyIndex:history.length-1,ignoreCurrentRowInfoInStoredContext:t.IgnoreTargetPageCachedCurrentRowInfo},this.commandID&&(o.commandID=this.commandID),(t.LoadBindingDataOption===1||t.LoadBindingDataOption===2)&&(o.loadBindingDataOption=t.LoadBindingDataOption),t.DeleteCachedQuery&&(o.DeleteCachedQuery=!0),l=null,((v=t===null||t===void 0?void 0:t.PassValues)===null||v===void 0?void 0:v.length)>0&&(l=t.PassValues),a=this.getPassValues(l,r,u,f),a&&(o.passValues=a,this.logPassValues(a)),o.closePopupCallbackContext=t.ClosePopupCallbackContext,i.addCurrentInfosToPageContext(o,[s],this.CommandExecutingInfo.getCurrentRowInfoCollection().list),this.addCrossPageQueryToPageContext(o,s),i.addSortInfoToPageContext(o,[s]),i.addColumnFilterQueriesToPageContext(o,[s]),i.addRuntimeQueryConditionDataToPageContext(o,[s]),c=null,h="",o.currentRowInfoList===undefined&&o.querys===undefined&&o.sortInfoCache===undefined&&o.columnFilterQueryCache===undefined&&o.runtimeQueryConditionDataCache===undefined&&o.passValues===undefined&&o.loadBindingDataOption===undefined&&o.commandID===undefined?h=this.generateUrlWhenQueryIsNull(s):(c=n.Common.JsonUrlSwitch(JSON.stringify(o)),h=this.generateUrlWhenQueryIsNotNull(s,c)),t.IsOpenInNewTab)?this.navigateToUrl(h,!0,c):(e||(n.SessionStorageManager.pageContext=c),window.history.replaceState?(y=n.ForguncyData.pageInfo.pageName,this.navigateByLoadMetadata(y,s,o,h,l)):(window.open(h,"_self"),this.stopExecuteCommandList()),n.CommandResult.stop)},i.prototype.navigateToUrl=function(t,i,r){var u=n.SessionStorageManager.pageContext;return n.SessionStorageManager.pageContext=r,i?(n.Common.openWindow(t),n.SessionStorageManager.pageContext=u,n.CommandResult.completed):(window.open(t,"_self"),this.stopExecuteCommandList(),n.CommandResult.stop)},i.prototype.logPassValues=function(t){var i=this,r=function(t){return t.Name?t.Name:n.FormulaHelper.getReferenceString(t.Row,t.Column)};this.CommandExecutingInfo.logHelper.log(n.RS.Log_NavigateCommand_PassValues);this.CommandExecutingInfo.logHelper.startChild();t.forEach(function(n){var t=JSON.stringify(n.Source)+" -> "+r(n.TargetCell);i.CommandExecutingInfo.logHelper.log(t)});this.CommandExecutingInfo.logHelper.endChild()},i.prototype.generateUrlWhenQueryIsNull=function(t){t===void 0&&(t="");var i="";return i=n.ForguncyData.ForguncyRoot+t,n.ForguncyData.forceMobileChild&&(i=i+"?mobileChild=true"),i},i.prototype.shouldReserveUrlQuery=function(){return n.ForguncyData.GlobalSettings.ReserveUrlQuery||n.SessionStorageManager.isInIframe},i.prototype.generateUrlWhenQueryIsNotNull=function(t,i){var r="";return this.shouldReserveUrlQuery()?(r=n.ForguncyData.ForguncyRoot+t+"?pageContext="+encodeURIComponent(i),n.ForguncyData.forceMobileChild&&(r=r+"&mobileChild=true")):(r=n.ForguncyData.ForguncyRoot+t,n.ForguncyData.forceMobileChild&&(r=r+"?mobileChild=true")),r},i.prototype.getPassValues=function(n,t,i,r){var f,u,e,o,s;if(n){for(f=[],u=0,e=n;u<e.length;u++)o=e[u],o.Source&&(s=this.convertPassValueItem(o,t,i,r),f.push(s));return f}},i.prototype.convertPassValueItem=function(t,i,r,u){var e,f;t.Source===n.KeyWords.Null?e=null:n.KeyWords.IsKeyWord(t.Source)?e=n.KeyWords.GetKeyWordValue(t.Source):(f=this.getDefaultFormulaCalcInfo(),f.listInfo=u,f.rowOffset=i,f.columnOffset=r,e=n.ForguncyData.pageInfo.formulaManager.evaluateFormula(t.Source,f));var o=t.TargetCell?n.CommandBase.offsetFormulaCellLocation(t.TargetCell,i,r,this.CommandExecutingInfo.runTimePageName):{Name:t.CellName},s={Row:o.Row,Column:o.Column,Name:o.Name},h=this.getTargetRunTimePageName(s,t),c={Source:e,TargetCell:s,TargetRunTimePageName:h};return h===n.ForguncyData.pageInfo.runTimeNormalPage&&delete c.TargetRunTimePageName,c},i.prototype.getTargetRunTimePageName=function(t,i){return n.Common.IsEmpty(i.TargetRunTimePageName)?n.ForguncyData.pageInfo.runTimeNormalPage:i.TargetRunTimePageName},i.addCurrentInfosToPageContext=function(t,i,r){r||(r=n.ForguncyData.pageInfo.currentRowInfoCollection.list);r.forEach(function(r){(n.Common.isProcessView(r.currentTable)||i.some(function(t){return n.Common.isPageContainsTableBinding(t,r.currentTable)}))&&(t.currentRowInfoList||(t.currentRowInfoList=[]),t.currentRowInfoList.some(function(n){return n.currentTable===r.currentTable})||t.currentRowInfoList.push(r))})},i.prototype.addCrossPageQueryToPageContext=function(n,t){i.addCommandQuerysToPageContext(n,[t]);this.addCommandQuerysFromCommand(n)},i.addCommandQuerysToPageContext=function(t,i){var r,u;if(!t.DeleteCachedQuery){r=function(r){i.some(function(t){return n.Common.isPageContainsTableBinding(t,r)})&&(t.querys||(t.querys={}),t.querys[r]=n.ForguncyData.pageInfo.commandQuerys[r])};for(u in n.ForguncyData.pageInfo.commandQuerys)r(u)}},i.prototype.addCommandQuerysFromCommand=function(t){var i,u,r,f;if(!(this.CommandExecutingInfo.currentCommandList.length<=0))for(i=0,u=this.CommandExecutingInfo.currentCommandList;i<u.length;i++)(r=u[i],r.Disabled||r.$type!=="Forguncy.Model.QueryCommand, ServerDesignerCommon")||(t.querys||(t.querys={}),f=r,t.querys[f.TargetTableName]=n.QueryCommand.getQueryData(f,this.CommandExecutingInfo.runTimePageName))},i.addSortInfoToPageContext=function(t,i){var r,u;if(!t.DeleteCachedQuery){r=function(r){var u=n.ListviewBase.getListviewByLocationString(r);if(!u)return"continue";i.some(function(t){return n.Common.isPageContainsTableBinding(t,u.getDataTableName())})&&(t.sortInfoCache||(t.sortInfoCache={}),t.sortInfoCache[r]=n.ForguncyData.pageInfo.sortInfoCache[r])};for(u in n.ForguncyData.pageInfo.sortInfoCache)r(u)}},i.addColumnFilterQueriesToPageContext=function(t,i){var r,u;if(!t.DeleteCachedQuery&&n.ForguncyData.pageInfo.columnFilterQueryCache){r=function(r){var u=n.ListviewBase.getListviewByLocationString(r);if(!u)return"continue";i.some(function(t){return n.Common.isPageContainsTableBinding(t,u.getDataTableName())})&&(t.columnFilterQueryCache||(t.columnFilterQueryCache={}),t.columnFilterQueryCache[r]=n.ForguncyData.pageInfo.columnFilterQueryCache[r])};for(u in n.ForguncyData.pageInfo.columnFilterQueryCache)r(u)}},i.addRuntimeQueryConditionDataToPageContext=function(t,i){var r,u;if(!t.DeleteCachedQuery&&n.ForguncyData.pageInfo.runtimeQueryConditionDataCache){r=function(r){var u=n.ListviewBase.getListviewByLocationString(r);if(!u)return"continue";i.some(function(t){return n.Common.isPageContainsTableBinding(t,u.getDataTableName())})&&(t.runtimeQueryConditionDataCache||(t.runtimeQueryConditionDataCache={}),t.runtimeQueryConditionDataCache[r]=n.ForguncyData.pageInfo.runtimeQueryConditionDataCache[r])};for(u in n.ForguncyData.pageInfo.runtimeQueryConditionDataCache)r(u)}},i.prototype.navigateByLoadMetadata=function(){throw"Need implement";},i}(n.CommandBase),t,i;n.NavigateCommandBase=r;t=function(t){function r(){return t!==null&&t.apply(this,arguments)||this}return __extends(r,t),r.prototype.execute=function(){return this.navigate(this.CommandParam)},r.prototype.navigate=function(t){var r,u;try{if(n.Common.IsEmpty(t))return n.CommandResult.completed;if(r=t.NavigateType,r===i.back)return this.navigateToBack();if(r===i.normal||r===null||r===undefined)return u=this.getNavigateUrl(t),u?this.navigateToUrl(u,t.IsOpenInNewTab,null):t.PageName?this.shouldCancelByPageDirty(t)?n.CommandResult.stop:this.navigateToPage(t,this.CommandParam.rowOffset,this.CommandParam.columnOffset,this.CommandParam.formulaListRowInfo,!1):n.CommandResult.completed}catch(f){alert(f)}},r.prototype.shouldCancelByPageDirty=function(t){return t.IsOpenInNewTab?!1:n.ForguncyData.pageDirtyCheckManager.shouldCancelByPageDirty(!1,!0,null,this.CommandExecutingInfo.logHelper)},r.prototype.getNavigateUrl=function(t){var u=t.ValidUrl,r;if(t.ValueFormula){var i=this.evaluateFormula(t.ValueFormula),f=!1,e={};e.PageName=i;n.Common.forguncyPostSync("Home/PageNameExisted",e,function(n){f=n});f?t.PageName=i:(t.PageName=null,n.Common.IsEmpty(i)||(r=i+"",u=r.toLowerCase().startsWith("servercommand")?n.ForguncyData.ForguncyRoot+i:r.indexOf("://")<0?"http://"+i:i))}return u},r.prototype.navigateToBack=function(){return n.Common.back(),this.stopExecuteCommandList(),n.CommandResult.stop},r.prototype.navigateByLoadMetadata=function(t,i,r,u){var o,f,e,s;n.ForguncyData.pageInfoStack.length>0&&(t=n.ForguncyData.pageInfoStack[0].pageName);n.ForguncyData.historyIndex=history.length-1;o={pageName:t,pageContext:JSON.stringify(r)};f={};for(e in r)f[e]=r[e];f.historyIndex=history.length;s={pageName:i,pageContext:JSON.stringify(f)};history.replaceState(o,t);u||(u=n.ForguncyData.ForguncyRoot+i);history.pushState(s,i,u);this.stopExecuteCommandList();n.PageBuilder.loadPage(i,f)},r}(r);n.NavigateCommand=t;i=function(){function n(){}return n.back="back",n.normal="normal",n}();n.CommandFactory.registerCommand("Forguncy.Model.NavigateCommand, ServerDesignerCommon",t)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.execute=function(){return this.queryCommand(this.CommandExecutingInfo.eventType==="pageloaded",this.CommandParam)},i.prototype.queryCommand=function(t,r){var e,o,u,f;if(n.ForguncyData.pageInfo.commandQuerys[r.TargetTableName]&&t)return n.CommandResult.completed;if(e=n.ListviewBase.getAllListviews(),e.length===0)return n.ForguncyData.pageInfo.commandQuerys[r.TargetTableName]=i.getQueryData(r,this.CommandExecutingInfo.runTimePageName),n.CommandResult.completed;for(o=[],u=0;u<e.length;u++)if(f=e[u],f.getDataTableName()===r.TargetTableName){if(!f.tryCommitValueBeforeQueryOrSort(!0))return n.CommandResult.stop;o.push(f)}for(n.ForguncyData.pageInfo.commandQuerys[r.TargetTableName]=i.getQueryData(r,this.CommandExecutingInfo.runTimePageName),u=0;u<o.length;u++)f=o[u],f.resetToFirstPage(),f.fillData();return $(window).trigger("ForguncyRowCountChanged"),n.CommandResult.completed},i.getQueryData=function(n,t){return{id:n.ID,paramList:this.getCommandQarams(n.Params,t,n)}},i.getCommandQarams=function(t,i,r){var e={},u,f;if(t)for(u=0;u<t.length;u++)f=t[u],e[f]=n.ForguncyData.pageInfo.formulaManager.evaluateFormula(f,{runTimePageName:i,nullAsException:!0,listInfo:r.formulaListRowInfo,rowOffset:r.rowOffset,columnOffset:r.columnOffset,isCommand:!0});return e},i}(n.CommandBase);n.QueryCommand=t;n.CommandFactory.registerCommand("Forguncy.Model.QueryCommand, ServerDesignerCommon",t)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.execute=function(){var u=this.CommandParam,r=n.ListviewBase.getListview(u.ListViewName,this.CommandExecutingInfo.runTimePageName),t,i;return r?(t=r.getLocationString(),i=n.ForguncyData.pageInfo.sortInfoCache,i[t]&&i[t].sortCommandID&&this.CommandExecutingInfo.eventType==="pageloaded")?n.CommandResult.completed:r.tryCommitValueBeforeQueryOrSort(!0)?(i[t]||(i[t]={}),i[t].sortCommandID=u.ID,r.fillData(u.ID),n.CommandResult.completed):n.CommandResult.stop:n.CommandResult.completed},i}(n.CommandBase);n.SortCommand=t;n.CommandFactory.registerCommand("Forguncy.Model.SortCommand, ServerDesignerCommon",t)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.execute=function(){return this.sendMailCommand(this.CommandParam)},i.prototype.sendMailCommand=function(t){var r,u,f,e={},i,o;if(t.Params)for(i=0;i<t.Params.length;i++)o=t.Params[i],e[o]=(u=(r=this.evaluateFormula(t.Params[i]))===null||r===void 0?void 0:r.toString())!==null&&u!==void 0?u:null;return n.Common.forguncyPost("Home/SendMailForCommand",{ID:t.ID,Params:e,CurrentRowInfoListStr:this.CommandExecutingInfo.getCurrentRowInfoCollection().list,ConstValue:(f=t.ConstValue)!==null&&f!==void 0?f:null,Keywords:t.Keywords},function(n){n&&alert(n)},t.ID,function(n){n&&alert(n)}),n.CommandResult.completed},i.sendMail=function(t,r,u,f,e,o){var s={From:t,To:r,Content:f,Title:u};i.sendMailInternal(s,null,n.ForguncyData.pageInfo.currentRowInfoCollection,e,o)},i.sendMailMessage=function(t,r,u){i.sendMailInternal(t,null,n.ForguncyData.pageInfo.currentRowInfoCollection,r,u)},i.sendMailInternal=function(t,i,r,u,f){n.Common.forguncyPost("Home/SendMail",{id:t.ID,from:t.From,to:t.To,title:t.Title,cc:t.CC,bcc:t.BCC,skipCalc:t.SkipCalc,enhanced_to:t.EnhancedTo,enhanced_cc:t.EnhancedCC,enhanced_bcc:t.EnhancedBCC,attachments:t.Attachments,content:t.Content,sendAsPlainText:t.SendAsPlainText,tableName:i,priority:t.Priority,currentRowInfoListStr:r.list},function(n){n?f&&f(n):u&&u()})},i}(n.CommandBase);n.SendMailCommand=t;n.CommandFactory.registerCommand("Forguncy.Model.SendMailCommand, ServerDesignerCommon",t)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.execute=function(){return this.runJavascriptCommand(this.CommandParam)},i.prototype.runJavascriptCommand=function(t){var f=n.Common.IsEmpty(t)?null:t.FunctionNameForGenerate,i,r,u;return n.Common.IsEmpty(f)?n.CommandResult.completed:(i=null,r=n.RunJavaScriptCommandFunctions,r&&(i=r[f]),u=!1,i&&(u=i()),u===!1?n.CommandResult.stop:n.CommandResult.completed)},i}(n.CommandBase);n.RunJavaScriptCommand=t;n.CommandFactory.registerCommand("Forguncy.Model.RunJavaScriptCommand, ServerDesignerCommon",t)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.execute=function(){var t=this;return(n.Platform.isMobile()||n.Platform.isIOSDevice())&&this.CommandExecutingInfo.eventType==="valuechanged"?(this.CommandExecutingInfo.suspend=!0,n.DelayRefresh.setTimeout(function(){t.showMessageCommand(t.CommandParam);t.CommandExecutingInfo.suspend=!1},100)):this.showMessageCommand(this.CommandParam),n.CommandResult.completed},i.prototype.showMessageCommand=function(n){try{var t=this.getMessage(n);alert(t)}catch(i){alert(i)}},i.prototype.getMessage=function(t){if(n.Common.IsEmpty(t))return"";var i=this.evaluateFormula(t.MessageFormula);return n.Common.IsEmpty(i)?"":i},i}(n.CommandBase);n.ShowMessageCommand=t;n.CommandFactory.registerCommand("Forguncy.Model.ShowMessageCommand, ServerDesignerCommon",t)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.execute=function(){return this.SubscribeCommand(this.CommandParam)},i.prototype.SubscribeCommand=function(t){var i,r;try{return i=new n.NavigateCommand,i.commandID=t.ID,r={},r.PageName=n.BuiltInPageManager.builtInPages[n.BuiltInPageType.MailSubscriptPage],i.CommandParam=r,i.execute(),n.CommandResult.stop}catch(u){alert(u)}return n.CommandResult.completed},i}(n.CommandBase);n.SubscribeCommand=t;n.CommandFactory.registerCommand("Forguncy.Model.SubscribeCommand, ServerDesignerCommon",t)})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var c=function(){function r(){}return r.prototype.shouldValidate=function(n){return t.shouldValidate(n)},r.prototype.checkCanUpdate=function(n){t.checkCanUpdate(n)},r.prototype.buildRequestData=function(i,r,u){var e=i.CommandParam,f={},s,o;return f.updateType=n.UpdateType.add,s=t.getMasterTableData(i,u),o=t.getDetailTableData(e),f.editedValues=s,o&&(f.detailTableValues=o),f.tableName=e.TableName,f.bindingInfos=n.ForguncyData.pageInfo.normalCellBindingManager.getBindingInfos(e.TableName).pageBindingInfo,f},r.prototype.checkRequestDataValid=function(t,r){if(n.Common.IsEmpty(t.editedValues)||n.Common.isObjEmpty(t.editedValues)){alert(n.Common.format(n.RS.noFieldErrorInfo,r.TableName));throw n.CommandResult.stop;}i.checkMasterDetailValues(r.TableName,t.editedValues,t.detailTableValues,r)},r.prototype.prepareBeforePostServer=function(n){t.preparePostServer(n)},r.prototype.completeAfterPostServer=function(n,i,r){t.postProcessing(n,i,r,r.detailTableValues)},r}(),u,f,e,o,s,h,i,t,r;n.AddRecordCommandExecutor=c;u=function(){function r(){}return r.prototype.shouldValidate=function(n){return t.shouldValidate(n)},r.prototype.checkCanUpdate=function(n){t.checkCanUpdate(n)},r.prototype.buildRequestData=function(r,u,f){var e=r.CommandParam,o={},l,s,h,c;return o.updateType=n.UpdateType.edit,l=t.getMasterTableData(r,f),s=t.getDetailTableData(e),o.editedValues=l,s&&(o.detailTableValues=s),o.bindingInfos=n.ForguncyData.pageInfo.normalCellBindingManager.getBindingInfos(e.TableName).pageBindingInfo,o.tableName=e.TableName,h=r.CommandExecutingInfo.getCurrentRowInfoCollection().getCurrentRowInfo(e.TableName),h&&(o.query=h.query),o.rowVersion=r.CommandExecutingInfo.getBindingValueVersions()[e.TableName],o.rowsToUpdate=e.RowsToUpdate,e.RowsToUpdate===1?o.rowsToUpdateCondition=n.ConditionHelper.getComputedSqlConditionFormula(e.RowsToUpdateCondition,r.CommandExecutingInfo.runTimePageName,e.NullFormulaValueQueryPolicy,e.rowOffset,e.columnOffset,e.formulaListRowInfo,!0):e.RowsToUpdate===2&&(o.rowsToUpdateListViewQuery=i.getRowsToUpdateListViewQuery(e,r.CommandExecutingInfo.runTimePageName),c=i.getUpdateSpecialRecordsRowVersion(e,r.CommandExecutingInfo.runTimePageName),c.length>0&&(o.rowsToUpdateListViewRowVersion=c)),o},r.prototype.checkRequestDataValid=function(t,r){if((n.Common.IsEmpty(t.editedValues)||n.Common.isObjEmpty(t.editedValues))&&(n.Common.IsEmpty(t.detailTableValues)||t.detailTableValues.length===0))throw n.CommandResult.completed;if(!t.tableName||!t.query&&!t.rowsToUpdateCondition&&!t.rowsToUpdateListViewQuery)throw n.CommandResult.completed;i.checkMasterDetailValues(r.TableName,t.editedValues,t.detailTableValues,r)},r.prototype.prepareBeforePostServer=function(n){t.preparePostServer(n)},r.prototype.completeAfterPostServer=function(n,i,r){t.postProcessing(n,i,r,r.detailTableValues)},r}();n.EditRecordCommandExecutor=u;f=function(){function r(){}return r.prototype.shouldValidate=function(n){return t.shouldValidate(n)},r.prototype.checkCanUpdate=function(n){t.checkCanUpdate(n)},r.prototype.buildRequestData=function(r,u,f){var e=r.CommandParam,l=t.getMasterTableData(r,f),c=t.getDetailTableData(e),o={},s,h;return o.updateType=n.UpdateType.AddOrEdit,o.editedValues=l,c&&(o.detailTableValues=c),o.tableName=e.TableName,o.bindingInfos=n.ForguncyData.pageInfo.normalCellBindingManager.getBindingInfos(e.TableName).pageBindingInfo,s=r.CommandExecutingInfo.getCurrentRowInfoCollection().getCurrentRowInfo(e.TableName),s&&(o.query=s.query),o.rowVersion=r.CommandExecutingInfo.getBindingValueVersions()[e.TableName],o.rowsToUpdate=e.RowsToUpdate,e.RowsToUpdate===1?o.rowsToUpdateCondition=n.ConditionHelper.getComputedSqlConditionFormula(e.RowsToUpdateCondition,r.CommandExecutingInfo.runTimePageName,e.NullFormulaValueQueryPolicy,e.rowOffset,e.columnOffset,e.formulaListRowInfo,!0):e.RowsToUpdate===2&&(o.rowsToUpdateListViewQuery=i.getRowsToUpdateListViewQuery(e,r.CommandExecutingInfo.runTimePageName),h=i.getUpdateSpecialRecordsRowVersion(e,r.CommandExecutingInfo.runTimePageName),h.length>0&&(o.rowsToUpdateListViewRowVersion=h)),o},r.prototype.checkRequestDataValid=function(t,r){if((n.Common.IsEmpty(t.editedValues)||n.Common.isObjEmpty(t.editedValues))&&(n.Common.IsEmpty(t.detailTableValues)||t.detailTableValues.length===0))throw n.CommandResult.completed;if(!t.tableName||!t.query&&!t.rowsToUpdateCondition&&!t.rowsToUpdateListViewQuery)throw n.CommandResult.completed;i.checkMasterDetailValues(r.TableName,t.editedValues,t.detailTableValues,r)},r.prototype.prepareBeforePostServer=function(n){t.preparePostServer(n)},r.prototype.completeAfterPostServer=function(n,i,r){t.postProcessing(n,i,r,r.detailTableValues)},r}();n.AddOrEditRecordCommandExecutor=f;e=function(){function r(){}return r.prototype.shouldValidate=function(){return!1},r.prototype.checkCanUpdate=function(t){var i=t.CommandParam;if(i.ActualShowConfirm&&!confirm(n.Common.getMultiLanguageWord(i.ConfirmText)))throw n.CommandResult.stop;if(!i.TableName)throw n.CommandResult.stop;},r.prototype.buildRequestData=function(t){var u={},r,f;return u.updateType=n.UpdateType.DELETE,r=t.CommandParam,u.rowsToUpdate=r.RowsToUpdate,r.RowsToUpdate===1?u.rowsToUpdateCondition=n.ConditionHelper.getComputedSqlConditionFormula(r.RowsToUpdateCondition,t.CommandExecutingInfo.runTimePageName,r.NullFormulaValueQueryPolicy,r.rowOffset,r.columnOffset,r.formulaListRowInfo,!0):r.RowsToUpdate===2&&(u.rowsToUpdateListViewQuery=i.getRowsToUpdateListViewQuery(r,t.CommandExecutingInfo.runTimePageName)),f=t.CommandExecutingInfo.getCurrentRowInfoCollection().getCurrentRowInfo(r.TableName),f&&(u.query=f.query),u.tableName=r.TableName,u},r.prototype.checkRequestDataValid=function(t){if(!t.query&&!t.rowsToUpdateCondition&&!t.rowsToUpdateListViewQuery)throw n.CommandResult.completed;},r.prototype.prepareBeforePostServer=function(n){t.preparePostServer(n)},r.prototype.completeAfterPostServer=function(i,r,u){var f,e;t.postProcessing(i,r,u,null);f=r.CommandParam;i.Success&&f.RowsToUpdate===2&&(e=n.ListviewBase.getListview(f.RowsToUpdateListViewName,r.CommandExecutingInfo.runTimePageName),e&&e.clearSelectionOutOfCurrentRow())},r}();n.DeleteRecordCommandExecutor=e;o=function(){function t(){}return t.prototype.shouldValidate=function(){return!1},t.prototype.checkCanUpdate=function(n){r.checkCanUpdate(n)},t.prototype.buildRequestData=function(t,i){var f=t.CommandParam,u={},h,o,e,s,c;if(u.updateType=n.UpdateType.add,h=r.getMasterTableData(f,i),o=r.getDetailTableData(f),u.editedValues=h,u.editedValues)for(e=0,s=u.editedValues;e<s.length;e++)c=s[e],c.isEditedAutoID=!0;return o&&(u.detailTableValues=o),u.tableName=f.currentTable,u.bindingInfos=f.columnBindingInfos,f.viewName&&(u.listViewName=f.viewName,u.masterQuery=f.masterQuery),u},t.prototype.checkRequestDataValid=function(t,r){if(n.Common.IsEmpty(t.editedValues)||n.Common.isObjEmpty(t.editedValues)){alert(n.Common.format(n.RS.noFieldErrorInfo,r.currentTable));throw n.CommandResult.stop;}i.checkMasterDetailValues(r.currentTable,t.editedValues,t.detailTableValues,r)},t.prototype.prepareBeforePostServer=function(){},t.prototype.completeAfterPostServer=function(n,t,i,u){r.postProcessing(n,t,i,u,i.detailTableValues)},t}();n.AddRecordListviewExecutor=o;s=function(){function t(){}return t.prototype.shouldValidate=function(){return!1},t.prototype.checkCanUpdate=function(n){r.checkCanUpdate(n)},t.prototype.buildRequestData=function(t,i){var f=t.CommandParam,u={},o,e;return u.updateType=n.UpdateType.edit,o=r.getMasterTableData(f,i),e=r.getDetailTableData(f),u.editedValues=o,e&&(u.detailTableValues=e),u.tableName=f.currentTable,u.query=f.querys[0],u.rowVersion=f.rowVersion,u.bindingInfos=f.columnBindingInfos,u.rowsToUpdate=f.RowsToUpdate,u},t.prototype.checkRequestDataValid=function(t,r){if((n.Common.IsEmpty(t.editedValues)||n.Common.isObjEmpty(t.editedValues))&&(n.Common.IsEmpty(t.detailTableValues)||t.detailTableValues.length>0))throw n.CommandResult.completed;if(!t.tableName||!t.query)throw n.CommandResult.stop;i.checkMasterDetailValues(r.currentTable,t.editedValues,t.detailTableValues,r)},t.prototype.prepareBeforePostServer=function(){},t.prototype.completeAfterPostServer=function(t,i,u,f){var s,o,e;for(r.postProcessing(t,i,u,f,u.detailTableValues),s=i.CommandParam,o=n.ListviewBase.getDetailListviews(f.getDataTableName()),e=0;e<o.length;e++)o[e].hasCommitingRow()&&n.Common.isQueryEqual(s.querys[0],o[e].getMasterQuery())&&o[e].fillData()},t}();n.EditRecordListviewExecutor=s;h=function(){function t(){}return t.prototype.shouldValidate=function(){return!1},t.prototype.checkCanUpdate=function(t){r.checkCanUpdate(t);var i=t.CommandParam;if(i.ActualShowConfirm&&!confirm(n.Common.getMultiLanguageWord(i.ConfirmText)))throw n.CommandResult.stop;},t.prototype.buildRequestData=function(t){var i={},r;return i.updateType=n.UpdateType.DELETE,r=t.CommandParam,r.querys.length>1?(i.rowsToUpdateListViewQuery=r.querys,i.rowsToUpdate=2):i.query=r.querys[0],i.tableName=r.currentTable,i},t.prototype.checkRequestDataValid=function(t){if(t.rowsToUpdate===2){if(!t.rowsToUpdateListViewQuery||t.rowsToUpdateListViewQuery.length<=0)throw n.CommandResult.completed;}else if(!t.query)throw n.CommandResult.completed;},t.prototype.prepareBeforePostServer=function(){},t.prototype.completeAfterPostServer=function(n,t,i,u){r.postProcessing(n,t,i,u,null)},t}();n.DeleteRecordListviewExecutor=h;i=function(){function t(){}return t.canUpdate=function(t){return!n.Common.IsEmpty(t)&&!n.Common.isBuiltInDataBaseView(t)},t.checkCanUpdate=function(i){if(!t.canUpdate(i)){alert(n.RS.UpdateViewFail_Error);throw n.CommandResult.stop;}},t.checkMasterDetailValues=function(t,i,r,u){var f=n.UpdateDataTableCommand.checkCalcErrorValue(t,i,r,u);if(!n.Common.IsEmpty(f)){alert(f);throw n.CommandResult.stop;}},t.getDetailTableData=function(n,t){var i,r,u;if(n.length===0)return null;for(i=[],r=0;r<n.length;r++)u=n[r].buildDetailListviewValues(!0,t),u&&i.push(u);return i.length===0?null:i},t.getRowsToUpdateListViewQuery=function(t,i){var u,r,f;return t.RowsToUpdate!==2?null:(u=n.ListviewBase.getListview(t.RowsToUpdateListViewName,i),!u)?null:(r=[],f=u.getSelectedRowsData(),f.forEach(function(t){n.Common.IsEmpty(t.query)||r.push(t.query)}),r.length===0?null:r)},t.getUpdateSpecialRecordsRowVersion=function(t,i){var r=[],u,f;return t.RowsToUpdate!==2?r:(u=n.ListviewBase.getListview(t.RowsToUpdateListViewName,i),!u)?r:(f=u.getSelectedRowsData(),f.forEach(function(t){n.Common.IsEmpty(t.query)||r.push(t.rowVersion)}),r)},t.postProcessing=function(t,i,r,u,f){i.removeCommitingRowForDetailListview(u);var e=i.CommandParam;t.Success&&e.ReloadAfterSucceed&&(n.ForguncyData.getRelatedTableWithForeignKey(r.tableName).forEach(function(t){return n.NormalCellBindingManager.reloadData(t,!0)}),n.ForguncyData.GlobalSettings.ViewInfoList.map(function(n){return n.ViewName}).forEach(function(t){return n.NormalCellBindingManager.reloadData(t,!0,f)}));$(window).trigger("ForguncyRowCountChanged")},t}();n.UpdateTableHelper=i;t=function(){function t(){}return t.shouldValidate=function(n){var t=n===null||n===void 0?void 0:n.CommandParam;return(t===null||t===void 0?void 0:t.CheckDataValidation)&&i.canUpdate(t===null||t===void 0?void 0:t.TableName)},t.checkCanUpdate=function(t){if(n.Common.IsEmpty(t)||n.Common.IsEmpty(t.CommandParam))throw n.CommandResult.stop;var r=t.CommandParam;if(i.checkCanUpdate(r.TableName),r.ActualShowConfirm&&!confirm(n.Common.getMultiLanguageWord(r.ConfirmText)))throw n.CommandResult.stop;},t.getMasterTableData=function(t,i){var f=[],r=t.CommandParam,u,e,o;if(r.RowsToUpdate===0&&(f=n.ForguncyData.pageInfo.normalCellBindingManager.getEditedBindingValues(r.TableName)),!n.Common.IsEmpty(r.UpdateBindingValues))for(u=0;u<r.UpdateBindingValues.length;u++)e=r.UpdateBindingValues[u],o=t.evaluateFormula(e.Value),f.push({pageName:i,bindingInfo:e.BindingInfo.GUID,value:o===undefined?null:o});return f},t.getDetailTableData=function(t){var r=n.ListviewBase.getAllListviews().filter(function(n){return n.getMasterDataTableName()===t.TableName});return i.getDetailTableData(r,t.UpdateType)},t.preparePostServer=function(t){var u=n.ForguncyData.getRelatedTableWithForeignKey(t.TableName),i=n.ListviewBase.getListviewsRelatedWithTable(t.TableName),r;if(u.forEach(function(t){i=i.concat(n.ListviewBase.getListviewsRelatedWithTable(t))}),t.ReloadAfterSucceed)for(r=0;r<i.length;r++)i[r].showLoadingIndicator()},t.postProcessing=function(r,u,f,e){var o=u.CommandParam,w=n.ForguncyData.getRelatedTableWithForeignKey(o.TableName),h,a,c,y,p,v,l,s;r.AutoIDConflictErrorInfo&&(h=r.AutoIDConflictErrorInfo,h.NewID?(a=h.BindingInfo,n.ForguncyData.pageInfo.autoIDManager.updateAutoIDCache(a.TableName,a.ColumnName,h.NewID),n.ForguncyData.pageInfo.normalCellBindingManager.setValueToBindingCell(a,h.NewID),r.Message=n.RS.AutoGeneratedID_Conflict_Error):r.Message=n.Common.format(n.RS.AutoGeneratedID_Generate_Error,h.BindingInfo.ColumnName));try{if(r.NothingDid)return;if(r.Success){if(o.ReloadAfterSucceed){for(r.JustInsertedRowInfo&&o.RowsToUpdate===0&&(c=u.CommandExecutingInfo.getCurrentRowInfoCollection().getCurrentRowInfo(o.TableName),c?c.query=r.JustInsertedRowInfo.query:c=r.JustInsertedRowInfo,n.ForguncyData.pageInfo.currentRowInfoCollection.setCurrentRowInfo(c,!1)),(r.RowData||r.UpdatedRowResults instanceof Array)&&(y=n.ForguncyData.pageInfo.normalCellBindingManager.getBindingInfos(o.TableName),r.RowData?n.ForguncyData.pageInfo.normalCellBindingManager.updateBindingValues(r.RowData,o.TableName,y.bindingInfos):(p=u.CommandExecutingInfo.getCurrentRowInfoCollection().getCurrentRowInfo(o.TableName),p&&r.UpdatedRowResults.forEach(function(t){t.JustInsertedRowInfo&&n.Common.isQueryEqual(t.JustInsertedRowInfo.query,p.query)&&n.ForguncyData.pageInfo.normalCellBindingManager.updateBindingValues(t.RowData,o.TableName,y.bindingInfos)}))),v=n.ListviewBase.getListviewsRelatedWithTable(o.TableName),s=0;s<v.length;s++)t.RemoveSelectionOfDeletedRows(o,f,v[s]),v[s].fillData();t.clearCacheWhenTableDataChanged(o.TableName)}}else{n.Common.IsEmpty(r.Message)||alert(r.Message);throw n.CommandResult.stop;}}finally{if(o.ReloadAfterSucceed)for(l=n.ListviewBase.getListviewsRelatedWithTable(o.TableName),w.forEach(function(t){l=l.concat(n.ListviewBase.getListviewsRelatedWithTable(t))}),s=0;s<l.length;s++)l[s].hiddenLoadingIndicator();i.postProcessing(r,u,f,e)}},t.clearCacheWhenTableDataChanged=function(t){var r,i;for(n.NormalCellBindingManager.updateTableDataCacheForCombo(t,!0),n.clearGetTableDataByConditionCache(),n.NormalCellBindingManager.reloadItemsCellType(t,!1,!0),n.CustomFunction.ODataFunction.clearCache(t),r=n.ListviewBase.getAllListviews().filter(function(n){return n.getMasterDataTableName()===t}),i=0;i<r.length;i++)n.CustomFunction.ODataFunction.clearCache(r[i].getDataTableName())},t.RemoveSelectionOfDeletedRows=function(t,i,r){if(t.UpdateType===n.UpdateType.DELETE){var u=null;switch(t.RowsToUpdate){case 0:u=i.query;break;case 2:break;default:return}r.clearSelectionCache(u)}},t}();n.UpdateTableByCommandHelper=t;r=function(){function t(){}return t.checkCanUpdate=function(t){if(n.Common.IsEmpty(t)||n.Common.IsEmpty(t.CommandParam))throw n.CommandResult.stop;i.checkCanUpdate(t.CommandParam.currentTable)},t.getMasterTableData=function(t,i){return n.Common.IsEmpty(t)||n.Common.IsEmpty(i)?[]:i.buildEditedRowValue(t.rowIndexes[0],!1,!1,2)},t.getDetailTableData=function(t){var r=n.ListviewBase.getAllListviews().filter(function(n){return n.getMasterDataTableName()===t.currentTable&&n.GetDataCommitMode()===0});return i.getDetailTableData(r,t.UpdateType)},t.postProcessing=function(t,r,u,f,e){var s=r.CommandParam,o;t.AutoIDConflictErrorInfo&&(o=t.AutoIDConflictErrorInfo,o.NewID?(n.ForguncyData.pageInfo.normalCellBindingManager.setValueToBindingCell(o.BindingInfo,o.NewID),t.Message=n.Common.format(n.RS.AutoGeneratedID_Conflict_Listview_Error,o.BindingInfo.ColumnName)):t.Message=n.Common.format(n.RS.AutoGeneratedID_Generate_Error,o.BindingInfo.ColumnName));s.rowIndexes.forEach(function(n){return f.handleAfterUpdateDataChange(n,s.UpdateType,t)});f.refreshOtherListViewsBindingToSameTable();i.postProcessing(t,r,u,e,[f.getListviewName()])},t}();n.UpdateTableByListviewHelper=r})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var i=function(i){function r(){return i!==null&&i.apply(this,arguments)||this}return __extends(r,i),r.prototype.execute=function(){return this.UpdateDataTableCommand(this.CommandParam,this.CommandExecutingInfo.designerPageName)},r.prototype.UpdateDataTableCommand=function(t,i,u,f){var w=this,o,p,h,a,e,y;if(u===void 0&&(u=null),f===void 0&&(f=null),t===undefined)return n.CommandResult.stop;o=r.enumAllUpdateDataTableCommand(this);p=this.validate(o,u);switch(p){case 2:return n.CommandResult.completed;case 1:return this.CommandExecutingInfo.logHelper.log(n.RS.DataValidationNotPassed),n.CommandResult.stop}var l=[],s=[],c=[];for(e=0;e<o.length;e++)try{h=o[e].getUpdateDataTableExecutor(u);h.checkCanUpdate(o[e]);a=h.buildRequestData(o[e],u,i);h.checkRequestDataValid(a,o[e].CommandParam);l.push(o[e]);s.push(h);c.push(a)}catch(v){if(v===n.CommandResult.stop)return this.stopExecuteCommandList(),n.CommandResult.stop;if(v===n.CommandResult.completed)continue;else return alert(v),this.stopExecuteCommandList(),n.CommandResult.stop}if(c.length===0)return n.CommandResult.completed;for(e=0;e<s.length;e++)s[e].prepareBeforePostServer(l[e].CommandParam);return y={},y.requestDataList=c,this.commandPost("Home/UpdateMultiDataTable",y,function(t){var r,i;if(t.length===1&&!t[0].Success)for(i=0;i<s.length-1;i++)t.push({Success:!1,ConcurrentError:!1,Message:""});for(r=!1,i=0;i<s.length;i++)try{s[i].completeAfterPostServer(t[i],l[i],c[i],u)}catch(e){if(e===n.CommandResult.stop){r=!0;continue}}r&&w.stopExecuteCommandList();f&&f()}),n.CommandResult.completed},r.prototype.getUpdateDataTableExecutor=function(i){i===void 0&&(i=null);var r=this.CommandParam;return i===null?r.UpdateType===t.add?new n.AddRecordCommandExecutor:r.UpdateType===t.edit?new n.EditRecordCommandExecutor:r.UpdateType===t.AddOrEdit?new n.AddOrEditRecordCommandExecutor:new n.DeleteRecordCommandExecutor:r.UpdateType===t.add?new n.AddRecordListviewExecutor:r.UpdateType===t.edit?new n.EditRecordListviewExecutor:new n.DeleteRecordListviewExecutor},r.checkCalcErrorValue=function(t,i,u,f){var a,v,y,p,w,tt,h,b,it,k,d,g,o,nt,c,l,e,s;if(i)if(Array.isArray(i)){for(tt=function(i){var s=i.value,u,r,h,e,o,c;if(s instanceof GC.Spread.CalcEngine.CalcError){if(u=i.bindingInfo,r=(a=n.ForguncyData.pageInfo.pageElementManager.cells.getAllCells().find(function(n){var t;return((t=n===null||n===void 0?void 0:n.bindingInfo)===null||t===void 0?void 0:t.GUID)===u}))===null||a===void 0?void 0:a.bindingInfo,!r&&f&&(r=(y=(v=f.UpdateBindingValues)===null||v===void 0?void 0:v.find(function(n){var t;return((t=n===null||n===void 0?void 0:n.BindingInfo)===null||t===void 0?void 0:t.GUID)===u}))===null||y===void 0?void 0:y.BindingInfo),!r)for(h=n.ListviewBase.getAllListviews(),e=0,o=h;e<o.length;e++)if(c=o[e],r=(p=c.listviewData)===null||p===void 0?void 0:p.columnBindingInfos.find(function(n){return(n===null||n===void 0?void 0:n.GUID)===u}),r)break;return{value:n.Common.format(n.RS.InvalidValueErrorMessage,s.toString(),(w=r===null||r===void 0?void 0:r.ColumnName)!==null&&w!==void 0?w:"Column",t)}}},h=0,b=i;h<b.length;h++)if(it=b[h],k=tt(it),typeof k=="object")return k.value}else for(d in i)if(g=i[d],g instanceof GC.Spread.CalcEngine.CalcError)return n.Common.format(n.RS.InvalidValueErrorMessage,g.toString(),d,t);if(u)for(o=0;o<u.length;o++){if(nt=u[o].TableName,c=u[o].AddValues,c)for(e=0;e<c.length;e++)if(s=r.checkCalcErrorValue(nt,c[e].values,null,f),!n.Common.IsEmpty(s))return s;if(l=u[o].EditValues,l)for(e=0;e<l.length;e++)if(s=r.checkCalcErrorValue(nt,l[e].values,null,f),!n.Common.IsEmpty(s))return s}},r.prototype.removeCommitingRowForDetailListview=function(t){var r,u,f,e,i;if(t)for(r=0;r<t.length;r++)if(u=n.ListviewBase.getListviewByCalcSheetName(t[r].calcSheetName),u){if(f=t[r].EditValues,f)for(i=0;i<f.length;i++)u.removeFromCommitingRow(f[i].rowIndex);if(e=t[r].AddValues,e)for(i=0;i<e.length;i++)u.removeFromCommitingRow(e[i].rowIndex)}},r.enumAllUpdateDataTableCommand=function(t){var f=[],i,u;if(n.Common.IsEmpty(t)||n.Common.IsEmpty(t.CommandParam))return f;for(f.push(t),i=t.CommandParam.NextUpdateDataTableCommand;!n.Common.IsEmpty(i);)u=new r,u.CommandExecutingInfo=t.CommandExecutingInfo,u.CommandExecutor=t.CommandExecutor,u.CommandParam=i,i.rowOffset=t.CommandParam.rowOffset,i.columnOffset=t.CommandParam.columnOffset,i.formulaListRowInfo=t.CommandParam.formulaListRowInfo,f.push(u),i=i.NextUpdateDataTableCommand;return f},r.prototype.validate=function(t,i){for(var r,h,c,u,l,e={},o=!1,f=0,s=t;f<s.length;f++)r=s[f],h=r.getUpdateDataTableExecutor(i),h.shouldValidate(r)&&(o=!0,c=r.CommandParam.TableName,e[c]=!0);if(!o)return 0;u=[];for(l in e)u=u.concat(n.ListviewBase.getDetailListviews(l));return n.ValidateHelpCommand.validateInCommand(this,null,u,!1)},r}(n.CommandBase),r,u,t;n.UpdateDataTableCommand=i;r=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.execute=function(){var r,u,i=this.getOperatedListview(),t=this.CommandParam,f,e;if(t.TableName=i.getDataTableName(),f=((r=t.querys)===null||r===void 0?void 0:r.length)===1?t.querys[0]:null,e=((u=t.rowIndexes)===null||u===void 0?void 0:u.length)===1?t.rowIndexes[0]:null,f)if(i&&i.GetDataCommitMode()!==0){if(i)return t.ActualShowConfirm&&!confirm(n.Common.getMultiLanguageWord(t.ConfirmText))||!t.currentTable?n.CommandResult.stop:(i.deletedRowQuerys.push(f),i.deleteRow(e,!1))}else return this.UpdateDataTableCommand(t,null);else if(i)return t.ActualShowConfirm&&!confirm(n.Common.getMultiLanguageWord(t.ConfirmText))?n.CommandResult.stop:i.deleteRow(e,!0)},i.prototype.getOperatedListview=function(){var i=this.CommandExecutingInfo,u=i.runTimePageName,r=i.commandTrigger,t;return r instanceof n.ListviewBase?r:(t=n.PageManager.getContainerCell(u),t&&t.cellType instanceof n.RepeaterCellType)?t.cellType.listview:null},i.prepareRowInfo=function(n,t){n&&n.forEach(function(n){if(n.$type==="Forguncy.Model.DeleteRecordCommand, ServerDesignerCommon"){var r=n;r.currentTable=t.currentTable;r.querys=[t.query]}else n.$type==="Forguncy.Model.ConditionCommand, ServerDesignerCommon"&&n.ConditionAndCommandPairList.forEach(function(n){return i.prepareRowInfo(n.CommandList,t)})})},i}(i);n.DeleteRecordCommand=r;u=function(){function n(){}return n}();n.UpdateValueItem=u;t=function(){function n(){}return n.edit="edit",n.add="add",n.DELETE="delete",n.AddOrEdit="addOrEdit",n}();n.UpdateType=t;n.CommandFactory.registerCommand("Forguncy.Model.UpdateDataTableCommand, ServerDesignerCommon",i);n.CommandFactory.registerCommand("Forguncy.Model.DeleteRecordCommand, ServerDesignerCommon",r)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var i=function(i){function r(){return i!==null&&i.apply(this,arguments)||this}return __extends(r,i),r.prototype.execute=function(){var t;try{if(!this._isPopupPage())return this.CommandParam.HistoryBack?n.Common.back():alert(n.RS.ClosePopupCommand_NotPopup),n.CommandResult.stop;if(t=n.ForguncyData.pageDirtyCheckManager.shouldCancelByPageDirty(!0,!0,null,this.CommandExecutingInfo.logHelper,!1),t)return n.CommandResult.stop;if(n.ForguncyData.isMobileCoverPage())if(this.CommandParam.HistoryBack)r._closePopupCommandParamCache!==undefined&&(this.CommandParam=r._closePopupCommandParamCache,r._closePopupCommandParamCache=undefined);else return r._closePopupCommandParamCache=this.CommandParam,n.Common.back(),this.stopExecuteCommandList(),n.CommandResult.stop;var u=this._getNavigateCommandParam(),i=this.getPassValueOffset(),f=this.navigateToPage(u,i.Row,i.Column,null,!0);return r._closePopupCommandContexts.splice(r._closePopupCommandContexts.length-1,1),f}catch(e){alert(e)}},r.prototype._isPopupPage=function(){return n.ForguncyData.pageInfoStack.length>0},r.prototype.getParentPagePassValueInfo=function(){return r._closePopupCommandContexts[r._closePopupCommandContexts.length-1]},r.prototype.getPassValueOffset=function(){var t={Row:0,Column:0},i=this.getParentPagePassValueInfo();return n.Common.IsEmpty(i)||(t.Row=i.rowOffset,t.Column=i.columnOffset),t},r.prototype._getNavigateCommandParam=function(){var h=this,u,f,e,t={},o=this.getPassValueItems(),i,s,r;return o.length>0&&(t.PassValues=o),i=this.getParentPagePassValueInfo(),((f=(u=i.closePopupCallbackCommand)===null||u===void 0?void 0:u.Commands)===null||f===void 0?void 0:f.length)>0&&(s=this.CommandParam.ClosePopupResult,t.ClosePopupCallbackContext={ClosePopupCallbackCommand:i.closePopupCallbackCommand,ClosePopupResult:s,ClosePopupReturnValues:((e=this.CommandParam.ClosePopupReturnValues)!==null&&e!==void 0?e:[]).map(function(n){return{Name:n.Name,Value:h.evaluateFormula(n.Value)}}),runTimePageName:i.runTimePageName}),r=n.ForguncyData.pageInfoStack,r.length>0&&(t.PageName=r[r.length-1].pageName),t},r.prototype.getPassValueItems=function(){var r,u,f,i,e,t,o;if(!this.CommandParam.PassValueBack)return[];if(r=this.getParentPagePassValueInfo(),u=n.Common.IsEmpty(r)?null:r.items,!u)return[];for(f=[],i=0,e=u;i<e.length;i++)(t=e[i],t&&t.CellName&&!t.TargetCell&&(t.TargetCell={Name:t.CellName}),o=this.convertPassvalueItem(t),o)&&f.push(o);return f},r.prototype.convertPassvalueItem=function(t){if(!t||!t.Source||t.Source.length===0||t.Source[0]!=="="||!t.TargetCell)return null;var i={};if(t.TargetCell.Row>=0&&t.TargetCell.Column>=0)i.Source="="+n.Common.getA1ReferenceString(t.TargetCell.Row,t.TargetCell.Column,t.TargetCell.RowRelative,t.TargetCell.ColumnRelative);else if(t.TargetCell.Name)i.Source="="+t.TargetCell.Name;else return null;return(i.TargetCell=this.translateSourceToTarget(t.Source),!i.TargetCell)?null:(i.TargetRunTimePageName=t.SourceRunTimePageName,i)},r.prototype.translateSourceToTarget=function(t){var r,i;return n.Common.IsEmpty(t)?null:(r=n.FormulaHelper.parse(t),r.type===GC.Spread.CalcEngine.ExpressionType.name)?{Row:-1,Column:-1,Name:r.value}:r.type===GC.Spread.CalcEngine.ExpressionType.reference&&(i=r,n.FormulaHelper.isCellExpression(i))?{Row:i.row,Column:i.column,RowRelative:i.rowRelative,ColumnRelative:i.columnRelative}:null},r.prototype.navigateByLoadMetadata=function(t,i,r){this.stopExecuteCommandList();var u=this.CommandParam;n.PageBuilder.closePopup(r,u.ReloadData,u.PassQueryCondition)},r.addPopupContext=function(n){r._closePopupCommandContexts.push(n)},r.ClosePopup=function(i){var f,o=n.ForguncyData.pageInfo.pageElementManager.cells.getAllCells(),r=o.find(function(i){return i.commandExecuteKind===0&&i.commands&&n.Common.enumAllCommandsMetaData(i.commands).find(function(n){return n.$type==="Forguncy.Model.ClosePopupCommand, ServerDesignerCommon"&&!n.Disabled&&n.ClosePopupResult===t.Cancel})}),u=[],e;r?(u=n.Common.clone(r.commands),n.Common.enumAllCommandsMetaData(u).forEach(function(n){n.$type==="Forguncy.Model.ClosePopupCommand, ServerDesignerCommon"&&(n.HistoryBack=!0)})):(e={$type:"Forguncy.Model.ClosePopupCommand, ServerDesignerCommon",PassValueBack:!1,ClosePopupResult:t.Cancel,DisplayName:n.RS.CommandName_ClosePopupCommand,HistoryBack:i},u=[e]);n.ForguncyData.commandExecutor.executeCommand(u,{runTimePageName:(f=r===null||r===void 0?void 0:r.runTimePageName)!==null&&f!==void 0?f:n.ForguncyData.pageInfo.runTimeNormalPage,commandTrigger:null,commandID:n.RS.PopupCloseButton,eventType:"click"})},r._closePopupCommandContexts=[],r._closePopupCommandParamCache=undefined,r}(n.NavigateCommandBase),t;n.ClosePopupCommand=i,function(n){n[n.Ok=0]="Ok";n[n.Cancel=1]="Cancel"}(t=n.ClosePopupResult||(n.ClosePopupResult={}));n.CommandFactory.registerCommand("Forguncy.Model.ClosePopupCommand, ServerDesignerCommon",i)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__assign=this&&this.__assign||function(){return __assign=Object.assign||function(n){for(var t,r,i=1,u=arguments.length;i<u;i++){t=arguments[i];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},__assign.apply(this,arguments)},Forguncy;(function(n){var t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.execute=function(){var t,i;try{if(t=this.CommandParam,i=JSON.stringify(t),t.ValueFormula){var r=this.evaluateFormula(t.ValueFormula),f={PageName:r},u=!1;if(n.Common.forguncyPostSync("Home/PageNameExisted",f,function(n){u=n}),u)t.PageName=r;else return n.CommandResult.completed}return t.PageName?(t.PopupDisplayMode===4&&n.Platform.isMobile()&&!t.hasPushState&&(history.state||history.replaceState({pageName:n.ForguncyData.pageInfo.pageName,pageContext:null},n.ForguncyData.pageInfo.pageName),history.pushState({isPopup:!0,commandParam:i,params:JSON.stringify(__assign({},n.ForguncyData.parameterManager.getCurrent())),parentPages:n.ForguncyData.getParentPages()},t.PageName)),this.navigateToPage(t,this.CommandParam.rowOffset,this.CommandParam.columnOffset,this.CommandParam.formulaListRowInfo,!0)):n.CommandResult.completed}catch(e){alert(e)}},i.prototype.navigateByLoadMetadata=function(t,i,r,u,f){var e=null,o,h,s,p,k,c,d,l,v,y,a,w,b,g;if(f&&f.length>0)for(e=n.Common.clone(f),o=0;o<e.length;o++)h=this.CommandExecutingInfo.runTimePageName,n.ForguncyData.parameterManager.NeedUpdateReference(e[o].Source)?e[o].Source=n.ForguncyData.parameterManager.ParamToReference(e[o].Source):(s=n.PageManager.getContainerCell(h),(s===null||s===void 0?void 0:s.cellType)instanceof n.UserControlPageCellType&&s.cellType.needUpdateReference(e[o].Source)&&(p=s.cellType.propertyToReference(e[o].Source),e[o].Source=p.referStr,h=p.runTimePageName)),h!==n.ForguncyData.pageInfo.runTimeNormalPage&&(e[o].SourceRunTimePageName=h),e[o].TargetCell=n.CommandBase.offsetFormulaCellLocation(e[o].TargetCell,0,0,this.CommandExecutingInfo.runTimePageName);k={items:e,rowOffset:this.CommandParam.rowOffset,columnOffset:this.CommandParam.columnOffset,closePopupCallbackCommand:this.CommandParam.ClosePopupCallbackCommand,runTimePageName:this.CommandExecutingInfo.runTimePageName};n.ClosePopupCommand.addPopupContext(k);l=this.CommandParam.Placement;l&&(v=n.CommandBase.getCellID(l,this.getDefaultFormulaCalcInfo(),!0),v&&v.length>0&&(y=n.ForguncyData.pageInfo.pageElementManager.cells.getCell(v[0]),y&&y.cellType&&(d=y.cellType.getContainer())));this.CommandParam.PopupDisplayMode===1&&!c&&l&&(a=this.CommandExecutingInfo.listViewInfo,a&&(w=n.ListviewBase.getListview(a.listViewName,a.pageName),b=this.updateAnchorWhenPlacementInListView(l,w,a.rowIndex),b&&(c=this.createTempAnchor(b,w.getContainerDiv()[0]))));c=this.updateAnchor(d,c);this.stopExecuteCommandList();g={isShowAsPopup:!0,popupDisplayMode:this.CommandParam.PopupDisplayMode,anchor:c,drawerDirection:this.CommandParam.DrawerDirection,dialogLocation:this.CommandParam.DialogLocation,showDrawerHeader:this.CommandParam.ShowDrawerHeader,closeWhenClickGrayArea:this.CommandParam.CloseWhenClickGrayArea};n.PageBuilder.loadPage(i,r,g)},i.prototype.updateAnchor=function(t,i){if(!i){if(!t){var r=this.CommandExecutingInfo.commandTrigger;r instanceof n.CellTypeBase&&(t=r.getContainer())}t&&(i=new n.UI.Anchor(t))}return i},i.prototype.updateAnchorWhenPlacementInListView=function(t,i,r){var o,f,e;if(i&&(o=i.getcolHeaderCellIDDic(),f=n.CommandBase.getCellID(__assign(__assign({},t),{Row:t.Row-1}),this.getDefaultFormulaCalcInfo(),!0),f.length&&(e=o[f[0]],e))){var s={Column:e.Column,Row:r},u=i.getCellRect(s.Row,s.Column);return{x:u.x,y:u.y,width:u.width,height:u.height}}},i.prototype.createTempAnchor=function(t,i){var r=document.createElement("div");return r.style.position="absolute",r.classList.add(n.UI.AutoLocateModifier.ListviewPopupTempAnchor),r.style.width=t.width+"px",r.style.height=t.height+"px",r.style.left=t.x+"px",r.style.top=t.y+"px",i.appendChild(r),new n.UI.Anchor($(r))},i}(n.NavigateCommandBase);n.ShowPopupCommand=t;n.CommandFactory.registerCommand("Forguncy.Model.ShowPopupCommand, ServerDesignerCommon",t)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.execute=function(){for(var t,u,r,o=this.CommandParam,f=0;f<o.PropertyItemsList.length;f++)if(t=o.PropertyItemsList[f],t){var e=n.FormulaHelper.getCellIds(t.TargetCells,this.getDefaultFormulaCalcInfo()),i=t.PropertyType===4?t.Value:this.evaluateFormula(t.Value),s=i;for(t.PropertyType===undefined&&(t.PropertyType=0),u=0;u<e.length;u++){r=e[u];switch(t.PropertyType){case 2:this.setBackColor(i,r);break;case 3:this.setForeColor(i,r);break;case 0:this.setIsEnabled(i,r);break;case 1:this.setIsVisible(i,r);break;case 4:s=this.setValue(i,r);break;case 5:this.setReadOnly(i,r)}}this.logSetProperty(t,s,e)}return n.CommandResult.completed},i.prototype.logSetProperty=function(t,i,r){var u="";r&&r.length>0&&(u=r.map(function(t){return n.FormulaHelper.getReferenceStringByID(t)}).join(","));t.PropertyTypeDisplay&&(u+="."+t.PropertyTypeDisplay);this.log(u+" = "+i)},i.shouldUnparseText=function(t){var i,f,r,u;return n.PageManager.isNormalCellID(t)?(i=n.ForguncyData.pageInfo.pageElementManager.cells.getCell(t),!i)?!1:(f=!i.cellType||i.cellType.allowFormatValue(),i.formatString!=="@"&&f?!0:!1):(r=n.Common.parseIDStr(t),u=n.ListviewBase.getListviewByCalcSheetName(r.suffix),u)?!u.isTextFormat(r.col):!0},i.prototype.setValue=function(t,r){var u,f;return t===i.AUTO_GENERATED_ID_VALUE?(u=n.ForguncyData.pageInfo.pageElementManager.cells.getCell(r),u&&(f=u.bindingInfo,f&&!f.RelationBinding&&(t=this.getAutoGeneratedID(u)))):t=n.ConditionHelper.calcValue(t,this.getDefaultFormulaCalcInfo(),i.shouldUnparseText(r)),n.ForguncyData.pageInfo.dataModel.normalCellDataModel.setValue(r,{newValue:t},5),t},i.prototype.getAutoGeneratedID=function(t){var i,r;return t?(i=t.bindingInfo,!i||i.RelationBinding)?null:(r=null,n.ForguncyData.pageInfo.autoIDManager.getAutoGeneratedID(i.TableName,i.ColumnName,!1,function(n){r=n}),r):null},i.prototype.setIsEnabled=function(n,t){n&&(n+"").toLowerCase()==="false"&&(n=!1);var i=this.getCell(t);i&&(n?i.enable():i.disable())},i.prototype.setIsVisible=function(n,t){var i=this.getCell(t);i&&i.setVisible(n)},i.prototype.setReadOnly=function(n,t){var i=this.getCell(t);i&&i.setReadOnly(n)},i.prototype.setBackColor=function(n,t){var i=this.getCell(t);i&&i.setBackColor(n)},i.prototype.setForeColor=function(n,t){var i=this.getCell(t);i&&i.setForeColor(n)},i.prototype.getCell=function(t){var i=n.ForguncyData.pageInfo.pageElementManager.cells.getCell(t);return i?i:null},i.AUTO_GENERATED_ID_VALUE="%AutoGeneratedID%",i}(n.CommandBase);n.SetCellPropertyCommand=t;n.CommandFactory.registerCommand("Forguncy.Model.SetCellPropertyCommand, ServerDesignerCommon",t)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.execute=function(){for(var u,e,r,t,c,o,i,s=this.CommandParam,f=0,h=s.PropertyItemsList;f<h.length;f++)if(r=h[f],t=r,t&&t.LayoutType===1&&(i=t.FormulaDefinition,!this.validateValue(i)))return n.CommandResult.completed;for(u=0,e=s.PropertyItemsList;u<e.length;u++)if(r=e[u],t=r,t){c=t.LayoutType;switch(c){case 0:o=this.evaluateFormula(t.Value);this.setRowVisibility(o,t.Location);this.setColumnVisibility(o,t.Location);break;case 1:i=t.FormulaDefinition;this.setRowHeight(i,t.Location);this.setColumnWidth(i,t.Location)}}return n.CommandResult.completed},i.prototype.setRowVisibility=function(t,i){var u=this,r=n.FormulaHelper.getRangeLocations(i,this.CommandExecutingInfo.runTimePageName);r===null||r===void 0?void 0:r.forEach(function(i){var r;if(i&&!(i.Row<0)){var f=n.ForguncyData.pageInfo.pageLayouts[i.PageID],e=i.Row,o=i.EndRow;for(r=e;r<=o;r++)f.changeRowVisibility(r,t);u.updateLayout(f)}})},i.prototype.setColumnVisibility=function(t,i){var u=this,r=n.FormulaHelper.getRangeLocations(i,this.CommandExecutingInfo.runTimePageName);r===null||r===void 0?void 0:r.forEach(function(i){var r;if(i&&!(i.Column<0)){var f=n.ForguncyData.pageInfo.pageLayouts[i.PageID],e=i.Column,o=i.EndColumn;for(r=e;r<=o;r++)f.changeColumnVisibility(r,t);u.updateLayout(f)}})},i.prototype.setRowHeight=function(t,i){var r=this,u=n.FormulaHelper.getRangeLocations(i,this.CommandExecutingInfo.runTimePageName);u===null||u===void 0?void 0:u.forEach(function(i){var f,e;if(i&&!(i.Row<0)){var u=n.ForguncyData.pageInfo.pageLayouts[i.PageID],o=i.Row,s=i.EndRow;for(f=o;f<=s;f++)(e=u.rowDefinitions[f],e!==undefined)&&u.changeRowHeight(f,r.getNewDefinition(e,t));u.preProcessDefinitions();r.updateWidthHeightAndOverflow(u);r.updateLayout(u)}})},i.prototype.setColumnWidth=function(t,i){var r=this,u=n.FormulaHelper.getRangeLocations(i,this.CommandExecutingInfo.runTimePageName);u===null||u===void 0?void 0:u.forEach(function(i){var f,e;if(i&&!(i.Column<0)){var u=n.ForguncyData.pageInfo.pageLayouts[i.PageID],o=i.Column,s=i.EndColumn;for(f=o;f<=s;f++)(e=u.columnDefinitions[f],e!==undefined)&&u.changeColumnWidth(f,r.getNewDefinition(e,t));u.preProcessDefinitions();r.updateWidthHeightAndOverflow(u);r.updateLayout(u)}})},i.prototype.getNewDefinition=function(n,t){var u=t.Mode,i=n,r;switch(u){case 0:return r=this.evaluateFormula(t.FixedLength),i.Mode=0,i.DesignLengthInPixel=Number(r.toString()),i;case 1:return i.Mode=1,i;case 2:return i.Mode=2,i.MinLength=this.convertLength(t.MinLength),i.MaxLength=this.convertLength(t.MaxLength),i;default:return i}},i.prototype.isNumber=function(n){return n!==null&&n!==""&&!isNaN(Number(n.toString()))},i.prototype.validateValue=function(t){var f=t.Mode,u,i,r;switch(f){case 0:if(u=this.evaluateFormula(t.FixedLength),!this.isNumber(u)||u<0||u>9999999)return alert(n.RS.RowHeightColumnWidth_InvalidNumber),!1;break;case 2:if((i=this.convertLength(t.MinLength).Value,r=this.convertLength(t.MaxLength).Value,!this.isNumber(i)||i<0||i>9999999)||!this.isNumber(r)||r<0||r>9999999)return alert(n.RS.RowHeightColumnWidth_InvalidNumber),!1;if(t.MaxLength.Unit===1&&r<i)return alert(n.RS.RowHeightColumnWidth_MinLargerThanMax),!1}return!0},i.prototype.convertLength=function(n){var t=this.evaluateFormula(n.Value);return{Value:t!==null?Number(t.toString()):null,Unit:n.Unit}},i.prototype.updateWidthHeightAndOverflow=function(n){this.updateColumnStyle(n);this.adjustMainDivWidthHeight(n);this.updatePlaceHolderOverflow(n);this.updateMasterPageHeight(n);this.updateCellOverflow(n)},i.prototype.updateLayout=function(t){var r,i=(r=n.ForguncyData.pageInfo)===null||r===void 0?void 0:r.dialogUI,u=(i===null||i===void 0?void 0:i.target.visibility)===!1;u?t.lazyLocateElements(function(){i.centerWhenOpen=i.target.centerWhenOpen}):t.lazyLocateElements()},i.prototype.updateColumnStyle=function(t){var i=n.PageBuilder.getColumnsStyle(t.pageStretchInfo,t.metadata),r=t.parentElement[0].parentElement;r.style.gridTemplateColumns=i.join(" ")},i.prototype.adjustMainDivWidthHeight=function(t){var r=t.pageStretchInfo.StretchMode,i=t.parentElement;switch(r){case 1:n.Presentation.StretchLayout.adjustMainDivHeight(i,t.metadata,t.pageContentType);break;case 2:n.Presentation.StretchLayout.adjustMainDivWidth(i,t.metadata,t.pageContentType);break;default:n.Presentation.StretchLayout.adjustMainDivWidth(i,t.metadata,t.pageContentType);n.Presentation.StretchLayout.adjustMainDivHeight(i,t.metadata,t.pageContentType)}},i.prototype.updatePlaceHolderOverflow=function(t){var r=t.parentElement.find("#placeHolderDiv"),i,u;r.length!==0&&(i=t.getPlaceHolderMetaData(),i!==undefined&&i!==null)&&(u=t.possibleStretch(i.MasterPage.PlaceHolders[0].Layout),n.Presentation.PlaceHolderElementPresenter.updatePlaceHolderOverflow(r,i,u))},i.prototype.updateMasterPageHeight=function(t){var i=t.getPlaceHolderMetaData();if(i!==undefined&&i!==null){var u=i.PageSettings.Height,r=i.MasterPage.PlaceHolders[0],f=u-r.Height,o=n.MetadataHelper.rowDefinitionsContainsAutoOrRange(i),e=function(n){var u=r.Layout.Row+r.Layout.RowSpan-1,f=i.MasterPage.PageSettings.RowDefinitions[u];f.DesignLengthInPixel+=n;t.rowDefinitions[u].DesignLengthInPixel+=n;i.MasterPage.PageSettings.Height+=n};o?r&&r.Height<u&&i.MasterPage.PageSettings.hasLengthenHeight&&(e(-f),i.MasterPage.PageSettings.hasLengthenHeight=!1):r&&r.Height<u&&!i.MasterPage.PageSettings.hasLengthenHeight&&(e(f),i.MasterPage.PageSettings.hasLengthenHeight=!0)}},i.prototype.updateCellOverflow=function(n){var i=this,t=n.metadata;t!==undefined&&t!==null&&(t.Cells.forEach(function(t){return t.CellType||t.$type||!t.CanAdjustOverflowRegardlessOfLengthMode||(n.possibleAutoFitInColumns(t.Layout)||n.possibleStretchInColumns(t.Layout)?i.updateCellOverflowState(t,!1):i.updateCellOverflowState(t,!0)),t}),this.updateOverflowCellBackgrounds(n),this.updateBackGroundColor(t))},i.prototype.updateBackGroundColor=function(t){var i=this;t.Cells.forEach(function(t){if(n.OverflowHelper.needAdjustDom(t)){var r=n.Common.getIdStr(t.Layout.Row,t.Layout.Column,i.CommandExecutingInfo.runTimePageName);$("#"+r+"_div").css("background","")}});n.ForguncyData.pageInfo.pageElementManager.cells.getAllCells([this.CommandExecutingInfo.runTimePageName]).forEach(function(n){n.cellType.setBackColor(n.actualStyleInfo.styleInfo.Background)})},i.prototype.updateOverflowCellBackgrounds=function(t){var r=this,i=t.metadata;i!==undefined&&i!==null&&(i.OverflowCellBackgrounds=i.Cells.map(function(i){var o=n.Common.getIdStr(i.Layout.Row,i.Layout.Column,r.CommandExecutingInfo.runTimePageName),u=$("#"+o+"_backgrounddiv"),f,e,s;return n.OverflowHelper.needAdjustDom(i)?(f=n.Common.clone(i.Layout),f.rightOverflowOffset=0,e={Layout:f},s=t.createElementHandler(e,2,!1),u.length==0&&$("#"+o+"_outerdiv").before(s),e):(u.length>0&&u.remove(),null)}).filter(function(n){return n!==null}))},i.prototype.updateCellOverflowState=function(n,t){n.IsLeftOverflow=t;n.IsRightOverflow=t;n.Layout.IsLeftOverflow=t;n.Layout.IsRightOverflow=t},i}(n.CommandBase);n.SetRowColumnLayoutCommand=t;n.CommandFactory.registerCommand("Forguncy.Model.SetRowColumnLayoutCommand, ServerDesignerCommon",t)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.execute=function(){return this.CommandExecutingInfo.eventType==="pageloaded"?this.DelayPrint(function(){return n.PageBuilder.pageCover.css("display")==="none"}):this.PrintImmediatly(),n.CommandResult.completed},i.prototype.DelayPrint=function(n){var t=this;setTimeout(function(){n()?t.PrintImmediatly():t.DelayPrint(n)},50)},i.prototype.PrintImmediatly=function(){var t,r,u;n.DelayRefresh.RunNow();i.IsPrinting=!0;try{return this.Print()}finally{if(i.IsPrinting=!1,t=n.ListviewBase.getAllListviews(),t)for(r=0;r<t.length;r++)n.SpreadJSView&&t[r]instanceof n.SpreadJSView&&(u=t[r],u.refresh())}},i.prototype.Print=function(){var h=[],c=[],r=n.ListviewBase.getAllListviews(),u,o,i,e,t,f;if(r)for(t=0;t<r.length;t++)u={ShowHorizontal:!1,ShowVertical:!1},o=!1,n.SpreadJSView&&r[t]instanceof n.SpreadJSView&&(i=r[t],o=i.hideSelection(),o||i.hideSelection(!0),i.showHorizontalScrollBar()&&(i.showHorizontalScrollBar(!1),u.ShowHorizontal=!0),i.showVerticalScrollBar()&&(i.showVerticalScrollBar(!1),u.ShowVertical=!0),i.refresh()),c.push(o),h.push(u),r[t].hiddenLoadingIndicator(!0);for(e=n.ForguncyData.pageInfo.pageElementManager.cells.getAllCells(),t=0;t<e.length;t++)f=e[t].cellType,f&&f.enterPrintMode();var l=this.CommandParam,s=this.CommandExecutingInfo.commandTrigger,a=!1;if(l.HiddenPrintElement===!0&&s&&(s.setVisible(!1),a=!0),window.print(),r)for(t=0;t<r.length;t++)if(n.SpreadJSView&&r[t]instanceof n.SpreadJSView){var u=h[t],v=c[t],i=r[t];u.ShowHorizontal&&i.showHorizontalScrollBar(!0);u.ShowVertical&&i.showVerticalScrollBar(!0);v||i.hideSelection(!1);i.refresh()}for(t=0;t<e.length;t++)f=e[t].cellType,f&&f.quitPrintMode();return l.HiddenPrintElement===!0&&s&&a&&s.setVisible(!0),n.CommandResult.completed},i}(n.CommandBase),i;n.PrintCommand=t;i=function(){function n(){}return n}();n.CommandFactory.registerCommand("Forguncy.Model.PrintCommand, ServerDesignerCommon",t)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.execute=function(){var t=this,i=this.CommandParam.operation,r=i;if(r.option===1)return t.Logout(r.param);switch(i){case 0:return t.logIn();case 3:return t.ForgotPassword();case 7:return t.ChangeUserProfile();case 4:return t.ChangePassword();case 5:return t.CancelChangePassword();case 6:return t.ResetPassword();case 2:return n.ForguncyData.SecurityProviderValidateType===2||n.ForguncyData.AuthenticationType===1?t.WindowsChangeUser():t.Logout();case 8:return t.SubscribeMeByMail();case 9:return t.goToMFAVerifyPage();case 10:return t.VerifyMFACode();case 11:return t.changeMFAStatus(!0);case 12:return t.changeMFAStatus(!1);case 13:return t.thirdPartBindingLogin(1);case 14:return t.thirdPartBindingLogin(0);case 15:return t.reloadPage();default:return n.CommandResult.completed}},i.prototype.reloadPage=function(){return window.location.reload(),n.CommandResult.completed},i.prototype.SubscribeMeByMail=function(){if(n.ValidationMananger.validateAllCells()!==0)return n.CommandResult.stop;var i=n.Common.getPageContext(),t={};return t.commandID=i.commandID,t.setting=n.ForguncyData.pageInfo.pageElementManager.cells.getValueOfForguncyattrCell("MailSubscription_Choice"),n.Common.forguncyPost("Home/AddSubscription",t,function(t){n.Common.IsEmpty(t)||n.Common.back()}),n.CommandResult.completed},i.prototype._forceCommitValue=function(t){var i=n.ForguncyData.pageInfo.pageElementManager.cells.getForguncyattrCell(t);i&&i.cellType&&i.cellType.commitValue()},i.prototype.thirdPartBindingLogin=function(t){var i=n.ForguncyData.pageInfo.pageElementManager.cells,r=i.getValueOfForguncyattrCell("ThirdPartBindingLogin_UserName"),u=i.getValueOfForguncyattrCell("ThirdPartBindingLogin_Password"),e=i.getValueOfForguncyattrCell("ThirdPartBindingLogin_Password_Confirm"),f=this.checkThirdPartBindingLoginPageCells(r,u,e,t);return n.Common.IsEmpty(f)?(n.Security.SecurityManager.requestRSAPublicKey(function(i){n.Security.Encrypter.encrypt(u,i.Value,function(u){n.Common.forguncyPost("Account/ThirdPartBindingLogin",{mode:t,userName:r,password:u,keyId:i.Id},function(t){if(t&&t.Result){var i=n.Helper.SpecialPath.getBaseUrl();location.search&&(i+=location.search);window.open(i,"_self")}else alert(t.Message)})})}),n.CommandResult.completed):(alert(f),n.CommandResult.stop)},i.prototype.checkThirdPartBindingLoginPageCells=function(t,i,r,u){if(n.Common.IsEmpty(t))return n.RS.ThirdPartBindingLogin_Error_UserNameEmpty;if(n.Common.IsEmpty(i))return n.RS.ThirdPartBindingLogin_Error_PasswordEmpty;if(u===0){if(i.length<6||i.length>18)return n.RS.ThirdPartBindingLogin_Error_PasswordLengthInvalid;if(r!==i)return n.RS.ThirdPartBindingLogin_Error_PasswordConfirmNotSame}return null},i.prototype.logIn=function(){var t=this;if(n.ValidationMananger.validateAllCells()!==0)return n.CommandResult.stop;n.Platform.isMobile()&&(this._forceCommitValue("LogIn_Username"),this._forceCommitValue("LogIn_Password"));var r=n.ForguncyData.pageInfo.pageElementManager.cells.getValueOfForguncyattrCell("LogIn_Username"),u=n.ForguncyData.pageInfo.pageElementManager.cells.getValueOfForguncyattrCell("LogIn_Password"),i=$("[forguncyattr=LogIn_RememberMe]")[0],f=i&&i.checked;return this.loginByRSA(r,u,f,function(i){if(i&&i.Result)if(i.Properties&&i.Properties["to-page"]){var r=n.BuiltInPageManager.builtInPages[i.Properties["to-page"]];r==n.BuiltInPageManager.builtInPages[n.BuiltInPageType.ChangePassword]&&alert(n.RS.NeedChangeOriginPassword);t.goToReturnURL(r)}else t.goToReturnURL()},function(t){var i=JSON.parse(t.responseText);n.Common.IsEmpty(i.Message)?alert(n.RS.UserNameOrPasswordIsIncorrect):alert(i.Message)}),n.CommandResult.completed},i.prototype.goToReturnURL=function(t){if(n.Common.IsEmpty(t)){var i=n.Common.GetUrlQuery("ReturnUrl");t=i?i:n.ForguncyData.pageInfo.ReturnUrl}n.PageStatistics.instance.leaveAllPages();location.href=t?location.origin+n.ForguncyData.ForguncyRoot+t+this.removeURLParameter(location.search,"ReturnUrl",t):location.origin+n.ForguncyData.ForguncyRoot},i.prototype.removeURLParameter=function(n,t,i){var f=n.split("?"),e,r,u,o;if(f.length>=2){for(e=encodeURIComponent(t)+"=",r=f[1].split("&"),u=r.length;u--;u>0)r[u].lastIndexOf(e,0)!==-1&&(o=r[u].substring(e.length),o===i&&r.splice(u,1));return f[0]+(r.length>0?"?"+r.join("&"):"")}return n},i.prototype.Logout=function(t,i,r){var u=this;if(n.PageStatistics.instance.leaveAllPages(),n.ForguncyData.pageDirtyCheckManager.removeDirtyStatus(),r||n.ForguncyData.AuthenticationType!==4||n.ForguncyData.SecurityProviderValidateType!==3)return n.Common.forguncyPost("Account/Logout",null,function(){if(i&&i(),t&&t.NavigateWhenLogoutMode!==n.NavigateWhenLogoutMode.KeepCurrentPage)t.NavigateWhenLogoutMode===n.NavigateWhenLogoutMode.GoToHomePage?location.href=location.origin+n.ForguncyData.ForguncyRoot:t.NavigateWhenLogoutMode===n.NavigateWhenLogoutMode.GoToURL?location.href=t.Url:t.NavigateWhenLogoutMode===n.NavigateWhenLogoutMode.GoToSpecificPage&&(location.href=location.origin+n.ForguncyData.ForguncyRoot+t.PageName);else{var r=n.ForguncyData.pageInfo.ReturnUrl;r||(r=n.Common.GetUrlQuery("ReturnUrl"));r?u.goToReturnURL(r):location.reload()}}),n.CommandResult.completed;location.href=n.ForguncyData.ForguncyRoot+"38969272-D69D-4812-B2B0-643EE98215D8"},i.prototype.WindowsChangeUser=function(){var t=n.ForguncyData.pageInfo.noPermissionPage?n.ForguncyData.pageInfo.noPermissionPage:n.ForguncyData.pageInfo.ReturnUrl;if(t)return n.Common.forguncyPost("Home/LoginByOtherWindowsUser",{pageName:t},function(){location.pathname=n.ForguncyData.ForguncyRoot+n.ForguncyData.pageInfo.ReturnUrl}),n.CommandResult.completed},i.prototype.ForgotPassword=function(){if(n.ValidationMananger.validateAllCells()!==0)return n.CommandResult.stop;var t=n.ForguncyData.pageInfo.pageElementManager.cells.getValueOfForguncyattrCell("ForgotPassword_UserOrEmail");return n.Common.forguncyPost("Account/ForgotPassword",{userNameOrEmail:t},function(t){t&&t.Result?n.PageBuilder.loadPage(n.BuiltInPageManager.builtInPages[n.BuiltInPageType.ResetPasswordMailSended]):t.Message?alert(t.Message):alert(n.RS.Failed)}),n.CommandResult.completed},i.prototype.ChangeUserProfile=function(){if(n.ValidationMananger.validateAllCells()!==0)return n.CommandResult.stop;var t=n.ForguncyData.pageInfo.pageElementManager.cells.getValueOfForguncyattrCell("ChangeProfile_Picture"),i=n.ForguncyData.pageInfo.pageElementManager.cells.getValueOfForguncyattrCell("ChangeProfile_FullName"),r=n.ForguncyData.pageInfo.pageElementManager.cells.getValueOfForguncyattrCell("ChangeProfile_Email");return n.Common.forguncyPost("Account/ChangeUserProfile",{email:r,fullName:i,image:t},function(t){t&&t.Result?(alert(n.RS.Success),n.ForguncyData.UserProfileAvatorVersion=Math.floor(Math.random()*1e8).toString(),n.Common.back()):t.Message?alert(t.Message):alert(n.RS.Failed)}),n.CommandResult.completed},i.prototype.ChangePassword=function(){var u=this;if(n.ValidationMananger.validateAllCells()!==0)return n.CommandResult.stop;var f=$("[forguncyattr=ChangePassword_ConfirmPassword]"),e=$("[forguncyattr=ChangePassword_NewPassword]"),i=n.ForguncyData.pageInfo.pageElementManager.cells.getValueOfForguncyattrCell("ChangePassword_OldPassword"),t=n.ForguncyData.pageInfo.pageElementManager.cells.getValueOfForguncyattrCell("ChangePassword_NewPassword"),r=n.ForguncyData.pageInfo.pageElementManager.cells.getValueOfForguncyattrCell("ChangePassword_ConfirmPassword");if(t!==r){n.ValidationTooltipHelper.showTooltip(f[0],n.RS.PasswordIsNotSame);return}if(t==i){n.ValidationTooltipHelper.showTooltip(e[0],n.RS.PasswordNotChange);return}return this.changePasswordByRSA(t,i,r,function(t){t&&t.Result?(alert(n.RS.Success),t.Properties&&t.Properties["and-login"]?u.goToReturnURL():n.Common.back()):t.Message?alert(t.Message):alert(n.RS.Failed)}),n.CommandResult.completed},i.prototype.CancelChangePassword=function(){return n.Common.forguncyPost("Account/CancelChangePassword",null,function(t){t&&t.Properties&&t.Properties["to-page"]?n.PageBuilder.loadPage(n.BuiltInPageManager.builtInPages[t.Properties["to-page"]]):window.history.back()}),n.CommandResult.completed},i.prototype.ResetPassword=function(){var t;if(n.ValidationMananger.validateAllCells()!==0)return n.CommandResult.stop;var u=$("[forguncyattr=ResetPassword_ConfirmPassword]"),i=n.ForguncyData.pageInfo.pageElementManager.cells.getValueOfForguncyattrCell("ResetPassword_NewPassword"),r=n.ForguncyData.pageInfo.pageElementManager.cells.getValueOfForguncyattrCell("ResetPassword_ConfirmPassword");if(i!==r){n.ValidationTooltipHelper.showTooltip(u[0],n.RS.PasswordIsNotSame);return}if(t=n.Common.GetUrlQuery("token"),!t){alert(n.RS.TokenIsInvalid);return}return this.resetPasswordByRSA(t,i,r,function(t){t&&t.Result?(alert(n.RS.ResetPasswordSuccess),n.PageBuilder.loadPage(n.BuiltInPageManager.builtInPages[n.BuiltInPageType.Login])):t.Message?alert(t.Message):alert(n.RS.Failed)}),n.CommandResult.completed},i.prototype.loginByRSA=function(t,i,r,u,f){n.Security.SecurityManager.requestRSAPublicKey(function(e){n.Security.Encrypter.encrypt(i.toString(),e.Value,function(i){n.Common.forguncyPost("Account/Login",{userName:t,password:i,rememberMe:!!r,keyId:e.Id,deviceInfo:n.MFAHelper.GetDeviceInfo()},function(t,i,r){n.ForguncyData.pageDirtyCheckManager.removeDirtyStatus();u===null||u===void 0?void 0:u(t,i,r)},null,f)})})},i.prototype.resetPasswordByRSA=function(t,i,r,u){n.Security.SecurityManager.requestRSAPublicKey(function(f){var e="",o="",s=n.Security.Encrypter.encrypt(i.toString(),f.Value,function(n){e=n}),h=n.Security.Encrypter.encrypt(r.toString(),f.Value,function(n){o=n});$.when(s,h).done(function(){n.Common.forguncyPost("Account/ResetPassword",{token:t,newPassword:e,confirmPassword:o,keyId:f.Id},u)})})},i.prototype.changePasswordByRSA=function(t,i,r,u){var f="",e="",o="";n.Security.SecurityManager.requestRSAPublicKey(function(s){var h=n.Security.Encrypter.encrypt(t.toString(),s.Value,function(n){return f=n}),c=n.Security.Encrypter.encrypt(i.toString(),s.Value,function(n){return e=n}),l=n.Security.Encrypter.encrypt(r.toString(),s.Value,function(n){return o=n});$.when(h,c,l).done(function(){n.Common.forguncyPost("Account/ChangePassword",{newPassword:f,oldPassword:e,confirmPassword:o,keyId:s.Id},u)})})},i.prototype.goToMFAVerifyPage=function(){return this.goToReturnURL(n.BuiltInPageManager.builtInPages[n.BuiltInPageType.MFA_VerifyCodePage]),n.Common.setCookie("HasMFASecret=1"),n.CommandResult.completed},i.prototype.VerifyMFACode=function(){var i=this;if(n.ValidationMananger.validateAllCells()!==0)return n.CommandResult.stop;var r=n.ForguncyData.pageInfo.pageElementManager.cells.getValueOfForguncyattrCell("MFA_VerifyCode_Inputbox"),t=!!n.ForguncyData.pageInfo.pageElementManager.cells.getValueOfForguncyattrCell("MFA_VerifyCode_TrustDevice"),u=t?n.MFAHelper.GetDeviceInfo():null;n.Common.forguncyPost("Account/VerifyMFACode",{code:r,trustDevice:t,deviceInfo:u},function(t){var r,u;t.Result?(n.Common.removeCookie("HasMFASecret=0"),localStorage.setItem(n.MFAHelper.mfaDeviceLocalStorageKey,(r=t.Properties.key)!==null&&r!==void 0?r:n.MFAHelper.mfaDeviceLocalStorageKey),u=n.BuiltInPageManager.builtInPages[t.Properties["to-page"]],u==n.BuiltInPageManager.builtInPages[n.BuiltInPageType.ChangePassword]&&alert(n.RS.NeedChangeOriginPassword),i.goToReturnURL(u)):alert(t.Message)})},i.prototype.changeMFAStatus=function(t){var i=t?n.RS.ChangeCurrentUserMFA_Enable_Confirm:n.RS.ChangeCurrentUserMFA_Disable_Confirm;return confirm(i)!==!0?n.CommandResult.completed:n.ForguncyData.pageDirtyCheckManager.shouldCancelByPageDirty(!1,!0,"changeMFAStatus")?n.CommandResult.completed:(n.Common.forguncyPost("Account/ChangeCurrentUserMFAEnabled",{isEnabled:t},function(i){i.Result||alert(t?n.RS.ChangeCurrentUserMFA_Enable_Fail:n.RS.ChangeCurrentUserMFA_Disable_Fail);location.reload()}),n.CommandResult.completed)},i}(n.CommandBase);n.UserManagerCommand=t;n.CommandFactory.registerCommand("Forguncy.Model.UserManagerCommand, ServerDesignerCommon",t)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.execute=function(){var t=this.CommandParam,i=this.getLoopCategory(t.LoopInfo);switch(i){case 2:this.LoopByCountOrArray(t);break;case 0:this.LoopByListview(t);break;case 1:this.LoopByCell(t)}return n.CommandResult.completed},i.prototype.getLoopCategory=function(n){return n.$type.indexOf("CountLoopInfo")!==-1?2:n.$type.indexOf("ListviewKindLoopInfo")!==-1?0:n.$type.indexOf("CellLoopInfo")!==-1?1:3},i.prototype.LoopByCountOrArray=function(t){var r=this.getLoopCountOrArray(t.LoopInfo),u=t.LoopInfo.LoopIndexParamName,f,i;if(r instanceof Array)for(f=this.evaluateFormula(t.LoopInfo.LoopItemParamName),i=r.length-1;i>=0;i--)this.addToCommandList(t.CommandList),n.Common.IsEmpty(f)||this.addToCommandList([{$type:"Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",ParameterName:f+"",ParameterValue:r[i]}]),n.Common.IsEmpty(u)||this.addToCommandList([{$type:"Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",ParameterName:u,ParameterValue:i+1+""}]);else for(i=0;i<r;i++)this.addToCommandList(t.CommandList),n.Common.IsEmpty(u)||this.addToCommandList([{$type:"Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",ParameterName:u,ParameterValue:r-i+""}])},i.prototype.getLoopCountOrArray=function(n){var i=this.evaluateFormula(n.LoopCount),r,t;return i instanceof Array?i:(r=typeof i,r!=="string"&&r!=="number")?0:(t=Number(i),!isFinite(t)||isNaN(t)||t<=0)?0:Number(t.toFixed(0))},i.prototype.LoopByListview=function(t){var e=t.LoopInfo.ListviewName,o=t.LoopInfo.ListViewLoopMode,f=n.ListviewBase.getListview(e,this.CommandExecutingInfo.runTimePageName),u,i,r;(o===1&&n.Common.IsEmpty(t.LoopInfo.LastLoopIndex)&&(t.LoopInfo.SelectedRowsCache=f.getSelectedRowsIndexes().sort(function(n,t){return n-t})),u=this._getListViewLoopCount(t),u<=0)||(i=this.getLoopIndex(t),i>=u)||(this.reAddCurrentCommand(i),r=null,r=this.CommandParam.formulaListRowInfo?n.Common.clone(this.CommandParam.formulaListRowInfo):{},r[f.getCalcSheetName()]=this._getCurrentLoopRowIndex(t,i),this.addToCommandList(t.CommandList,null,null,r))},i.prototype.getLoopIndex=function(t){return n.Common.IsEmpty(t.LoopInfo.LastLoopIndex)?0:t.LoopInfo.LastLoopIndex+1},i.prototype.reAddCurrentCommand=function(n){var t=this.addIgnoreDisplayCommand(this.CommandParam);t.LoopInfo.LastLoopIndex=n},i.prototype.LoopByCell=function(n){var i,r,u,f,t,e,o;n.LoopInfo.OffsetList&&((t=this.getLoopIndex(n),t>=n.LoopInfo.OffsetList.length)||(this.reAddCurrentCommand(t),e=((i=n.LoopInfo.OffsetList[t].Row)!==null&&i!==void 0?i:0)+((r=n.rowOffset)!==null&&r!==void 0?r:0),o=((u=n.LoopInfo.OffsetList[t].Column)!==null&&u!==void 0?u:0)+((f=n.columnOffset)!==null&&f!==void 0?f:0),this.addToCommandList(n.CommandList,e,o)))},i.prototype._getListViewLoopCount=function(t){if(t.LoopInfo.ListViewLoopMode===0){var i=n.ForguncyData.pageInfo.dataModel.getListDataByListviewName(t.LoopInfo.ListviewName,this.CommandExecutingInfo.runTimePageName);return i?i.getRowCount():0}return t.LoopInfo.SelectedRowsCache.length},i.prototype._getCurrentLoopRowIndex=function(n,t){return n.LoopInfo.ListViewLoopMode===0?t:n.LoopInfo.SelectedRowsCache[t]},i}(n.CommandBase);n.LoopCommand=t;n.CommandFactory.registerCommand("Forguncy.Model.LoopCommand, ServerDesignerCommon",t)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.execute=function(){var t=this.CommandExecutingInfo.currentCommandList,r=t.findIndex(function(t){return t instanceof n.CommandTerminateParam&&t.command instanceof n.LoopCommand}),u,i;if(r>-1){for(u=[],i=0;i<r;i++)t[i].$type==="Forguncy.Model.CommandTerminateParam, ServerDesignerCommon"&&u.push(t[i]);t.splice(0,r);t.unshift.apply(t,u)}return n.CommandResult.completed},i}(n.CommandBase);n.EndLoopCommand=t;n.CommandFactory.registerCommand("Forguncy.Model.EndLoopCommand, ServerDesignerCommon",t)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__awaiter=this&&this.__awaiter||function(n,t,i,r){function u(n){return n instanceof i?n:new i(function(t){t(n)})}return new(i||(i=Promise))(function(i,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?i(n.value):u(n.value).then(o,s)}e((r=r.apply(n,t||[])).next())})},__generator=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=e[0]&2?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[e[0]&2,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i,e;return e={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e},Forguncy;(function(n){var t=function(t){function r(){return t!==null&&t.apply(this,arguments)||this}return __extends(r,t),r.prototype.execute=function(){return __awaiter(this,void 0,void 0,function(){var i,t=this;return __generator(this,function(){if(i=this.initProperties(),!i)return[2,n.CommandResult.completed];if(this._param.UpdateListviewCommandRunTimeMethodSetting)return n.SpreadJSView&&this._listview instanceof n.SpreadJSView&&this._listview.isWaitForRefresh?[2,new Promise(function(i){var r=setInterval(function(){t._listview.isWaitForRefresh||(clearInterval(r),n.RuntimeMethedExecuteHelper.execute(new n.ListView(t._listview,!1),t._param.UpdateListviewCommandRunTimeMethodSetting,t),i(n.CommandResult.completed))},50)})]:(n.RuntimeMethedExecuteHelper.execute(new n.ListView(this._listview,!1),this._param.UpdateListviewCommandRunTimeMethodSetting,this),[2,n.CommandResult.completed]);switch(this._param.UpdateType){case 0:return[2,this.edit()];case 1:return[2,this.add()];case 4:return[2,this.insert(!1)];case 5:return[2,this.insert(!0)];case 2:return[2,this.delete()];case 3:return[2,r.updateListview(this._listview,this,!1,function(n){t.updateListviewCallBack(t._listview,n)},function(){t.stopExecuteCommandList()})];default:return[2,n.CommandResult.completed]}return[2]})})},r.prototype.initProperties=function(){return(this._param=this.CommandParam,!this._param)?!1:(this._listview=n.ListviewBase.getListview(this._param.ListviewName,this.CommandExecutingInfo.runTimePageName),!this._listview)?!1:(this._dataModel=this._listview.getListDataModel(),!this._dataModel)?!1:!0},r.prototype.edit=function(){var s=this._listview.stopEditingActiveCell(!0),t,i,e,r,o;if(!s)return n.CommandResult.stop;if(!this._param.UpdateValues)return n.CommandResult.completed;var f=this.getUpdateRowIndexList(this._param.UpdateRowType),h=this.getDefaultFormulaCalcInfo(),u=this._param.UpdateValues;for(t=0;t<u.length;t++)if(i=n.Common.getColumnIndex(u[t].Column,this._listview),i!==-1)for(e=n.ConditionHelper.calcValue(u[t].Value,h,!this._listview.isTextFormat(i)),r=f.length-1;r>=0;r--)o=f[r],this._dataModel.setValue(o,i,e,5);return n.CommandResult.completed},r.prototype.add=function(){var i=this._listview.stopEditingActiveCell(!0),t;return i?(t=this.getNewRowData(),this._listview.addNewRow(t),n.CommandResult.completed):n.CommandResult.stop},r.prototype.getNewRowData=function(){var e=this.getDefaultFormulaCalcInfo(),f=[],i=this._param.UpdateValues,t,r,u;if(i)for(t=0;t<i.length;t++)(r=n.Common.getColumnIndex(i[t].Column,this._listview),r!==-1)&&(u=n.ConditionHelper.calcValue(i[t].Value,e,!this._listview.isTextFormat(r)),u!==null)&&(f[r]=u);return f},r.prototype.insert=function(t){var e=this._listview.stopEditingActiveCell(!0),i,r,f,u;return e?(i=this.getUpdateRowIndexList(3),!i||i.length<=0)?n.CommandResult.completed:(i.sort(function(n,t){return n-t}),r=this._param.InsertInRear?i.slice(-1)[0]+1:i[0],(Number.isNaN(r)||n.Common.IsEmpty(r))&&(r=0),f=i.length,u=this.getNewRowData(),t?this._listview.duplicateRow(r,i,u,!1):(r=Math.min(r,this._listview.getListDataCount()),this._listview.insertRow(r,f,u,!0,!1)),n.CommandResult.completed):n.CommandResult.stop},r.prototype.delete=function(){var r=this._listview.stopEditingActiveCell(!0),i,t;if(!r)return n.CommandResult.stop;for(i=this.getUpdateRowIndexList(this._param.UpdateRowType),t=i.length-1;t>=0;t--)this._listview.deleteRowByJavascriptAPI(i[t]);return this._param.UpdateRowType===0&&this._listview.clearSelectionOutOfCurrentRow(),n.CommandResult.completed},r.prototype.getUpdateRowIndexList=function(n){switch(n){case 1:return this.getRowsByCondition();case 0:return this.getSelectedRows();case 2:return this.getAllRows();case 3:return this.getCurrentRow();default:return[]}},r.prototype.getSelectedRows=function(){return this._listview.getSelectedRowsIndexes()},r.prototype.getRowsByCondition=function(){var t;if(!this._param.SpecifiedRowCondition)return[];var f=this._dataModel.getRowCount(),e=this.getDefaultFormulaCalcInfo(),r=new i(this._listview,this._dataModel,this.CommandExecutingInfo.cacheDataHelper),o=n.ConditionHelper.handlingConditionValue(this._param.SpecifiedRowCondition,e,r),u=[];for(t=0;t<f;t++)r.rowIndex=t,n.ConditionHelper.executeConditionResult(o,r)&&u.push(t);return u},r.prototype.getAllRows=function(){for(var i=this._dataModel.getRowCount(),t=[],n=0;n<i;n++)t.push(n);return t},r.prototype.getCurrentRow=function(){if(this.CommandParam.formulaListRowInfo){var t=this.CommandParam.formulaListRowInfo[this._listview.getCalcSheetName()];if(!n.Common.IsEmpty(t))return[t]}return[this._listview.getCurrentRowIndex()]},r.updateListview=function(t,i,u,f,e){var s,o,c,h,l;if(!r.isListviewAllowUpdate(t))return n.CommandResult.stop;if(s=r.getEditedValues(t),!s)return f(null),n.CommandResult.completed;t.showLoadingIndicator();o=[];u||(c=n.ForguncyData.pageInfo.pageElementManager.getRepeaterCellOfListview(t),c.forEach(function(n){return o=o.concat(n.getAllRunTimePageNames())}));h=[];t.GetDataValidationTime()===1&&h.push(t);l=n.ValidateHelpCommand.validateInCommand(i,o,h,u);switch(l){case 1:return t.hiddenLoadingIndicator(),i.CommandExecutingInfo.logHelper.log(n.RS.DataValidationNotPassed),n.CommandResult.stop;case 0:break;default:return n.CommandResult.completed}return t.updateMultiRows(s,f,function(){alert(n.RS.Commit_FailMessage);t.hiddenLoadingIndicator();e()}),n.CommandResult.completed},r.isListviewAllowUpdate=function(t){var i=t.stopEditingActiveCell(!0);return i?t.isGroupMode()?(alert(n.RS.UpdateListviewCommand_Listview_Group),!1):!t.isMasterTable()&&!t.getMasterQuery()?(alert(n.RS.UpdateListviewCommand_Listview_DetailListview),!1):t.bindingTableCanEdit()?!0:(alert(n.RS.UpdateListViewFail_BindingTableCantEditError),!1):!1},r.getEditedValues=function(t){var i=t.buildDetailListviewValues(!1),r;return i?(r=n.UpdateDataTableCommand.checkCalcErrorValue(null,null,[i]),!n.Common.IsEmpty(r))?(alert(r),null):i:null},r.prototype.updateListviewCallBack=function(t,i){if(!t.hasDestroyed()&&i){var r=i;if(r.Message){t.hiddenLoadingIndicator();this.stopExecuteCommandList();alert(r.Message);return}n.NormalCellBindingManager.reloadData(t.getDataTableName(),!0);n.ForguncyData.getRelatedTableWithForeignKey(t.getDataTableName()).forEach(function(t){n.NormalCellBindingManager.reloadData(t,!0)});n.ForguncyData.GlobalSettings.ViewInfoList.map(function(n){return n.ViewName}).forEach(function(t){return n.NormalCellBindingManager.reloadData(t,!0)})}},r}(n.CommandBase),i;n.UpdateListviewCommand=t;i=function(){function t(i,r,u){this._listview=i;this._dataModel=r;this._columnIndexCache=u.getCachedData(t._cacheDataKey);n.Common.IsEmpty(this._columnIndexCache)&&(this._columnIndexCache={},t._cacheDataKey=u.cacheData(this._columnIndexCache))}return t.prototype.calc=function(n){var t=this.getColumnIndex(n);return t===-1?null:this.getValue(t)},t.prototype.getValue=function(n){return n===-1?null:this._dataModel.getValue(this.rowIndex,n)},t.prototype.getColumnIndex=function(t){if(n.Common.IsEmpty(t)||n.Common.IsEmpty(t.Column))return-1;if(typeof t.columnIndex=="undefined"){var r=this._listview.getFullListviewName()+"@"+t.Column,i=this._columnIndexCache[r];n.Common.IsEmpty(i)&&(i=n.Common.getColumnIndex(t.Column,this._listview));this._columnIndexCache[r]=i;t.columnIndex=i}return t.columnIndex},t.prototype.needUnparseValue2=function(n){var t=this.getColumnIndex(n);return t===-1?!1:!this._listview.isTextFormat(t)},t.prototype.equals=function(t,i){return n.Common.isFuzzyEquals(t,i)},t}();n.CommandFactory.registerCommand("Forguncy.Model.UpdateListviewCommand, ServerDesignerCommon",t)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.execute=function(){return this.Export(this.CommandParam)},i.prototype.Export=function(t){this.CommandExecutingInfo.suspend=!0;try{if(n.Common.IsEmpty(t))return n.CommandResult.completed;var i=n.ModuleLoader.getCdnUrl("DownloadFile/Download?fileName="+encodeURIComponent(t.FileName)+"&fileGuid="+t.FileGuid+"&fileExtension="+t.FileExtension),r=n.ForguncyData.ForguncyRoot+i;n.Common.download(r)}catch(u){alert(u)}finally{this.CommandExecutingInfo.suspend=!1}return n.CommandResult.completed},i}(n.CommandBase);n.DownloadFileCommand=t;n.CommandFactory.registerCommand("Forguncy.Model.DownloadFileCommand, ServerDesignerCommon",t)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.execute=function(){return this.runWorkflowCommand(this.CommandParam)},i.prototype.runWorkflowCommand=function(t){var i=this.evaluateFormula(t.TableName),r=t.ActionGUID,u=this.evaluateFormula(t.AssignTo),f=this.evaluateFormula(t.WorkflowComments),e=this.evaluateFormula(t.NextState),o=this.evaluateFormula(t.ActionName),s=this.CommandExecutingInfo.getBindingValueVersions()[i],h=this.CommandExecutingInfo.getCurrentRowInfoCollection().getCurrentRowInfo(i),c=this;return n.Common.forguncyPostSync("WorkflowApi/ExecuteFlowAction",{actionGuid:r,currentInfo:h,comments:f,assignTo:u,newState:e,actionName:o,rowVersion:s},function(r){if(!r||!r.Success)return r.ErrorMessage?alert(r.ErrorMessage):alert(n.RS.ProcessBarCell_ChangeStateFailed),c.stopExecuteCommandList(),n.CommandResult.stop;t.ReloadAfterSucceed&&(n.NormalCellBindingManager.reloadData(i,!0),n.ForguncyData.GlobalSettings.ViewInfoList.filter(function(n){return n.ViewType===2&&n.RelatedWorkflowTableName===i}).map(function(n){return n.ViewName}).forEach(function(t){return n.NormalCellBindingManager.reloadData(t,!0)}))}),n.CommandResult.completed},i}(n.CommandBase);n.WorkflowCommand=t;n.CommandFactory.registerCommand("WorkflowCommand.WorkflowCommand, WorkflowCommand",t)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__awaiter=this&&this.__awaiter||function(n,t,i,r){function u(n){return n instanceof i?n:new i(function(t){t(n)})}return new(i||(i=Promise))(function(i,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?i(n.value):u(n.value).then(o,s)}e((r=r.apply(n,t||[])).next())})},__generator=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=e[0]&2?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[e[0]&2,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i,e;return e={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e},Forguncy;(function(n){var r=function(i){function r(){return i!==null&&i.apply(this,arguments)||this}return __extends(r,i),r.prototype.execute=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.shareCommand(this.CommandParam)];case 1:return[2,n.sent()]}})})},r.prototype.shareCommand=function(i){return __awaiter(this,void 0,void 0,function(){var s,r,w,b,k,v,e,h,a,f,c,u,o,y,p,l;return __generator(this,function(d){switch(d.label){case 0:return(s=i.ShareCommandContainerRefer.ShareCommandContainerID,n.ForguncyData.GlobalSettings.ShareCommands||(n.ForguncyData.GlobalSettings.ShareCommands={}),r=n.ForguncyData.GlobalSettings.ShareCommands[s],!(r===undefined))?[3,3]:(w=n.ForguncyData.ForguncyRoot+"Home/GetShareCommand?commandId="+s+"&v="+n.StaticData.ShareCommandVersion,[4,fetch(w)]);case 1:return b=d.sent(),[4,b.text()];case 2:k=d.sent();n.ForguncyData.GlobalSettings.ShareCommands[s]=JSON.parse(k);r=n.ForguncyData.GlobalSettings.ShareCommands[s];d.label=3;case 3:if(r===null||r===void 0?void 0:r.Commands){if(v={},e={},h={},r.Params)for(f=0;f<r.Params.length;f++)a=r.Params[f],e[a.Name]=null,v[a.ID]=a.Name;if(i.Params)for(f=0;f<i.Params.length;f++)c=i.Params[f],u=v[c.ParamReferObject.ParamID],u&&(e[u]=this.evaluateFormula(c.Value),h[u]={original:c.Value,"new":n.ForguncyData.parameterManager.ParamToReference(c.Value)},o=h[u].new,(o===null||o===void 0?void 0:o.startsWith("="))?(o=o.substring(1),this.log(n.Common.format(n.RS.ServerCommandLog_CreateParam,u,o+"("+e[u]+")"))):this.log(n.Common.format(n.RS.ServerCommandLog_CreateParam,u,e[u])));n.ForguncyData.parameterManager.push();for(y in e)n.ForguncyData.parameterManager.setValue(y,e[y],null);for(p in h)n.ForguncyData.parameterManager.SetParamToReference(p,h[p].original);l=new t;l.ResultErrorCodeTo=i.ResultErrorCodeTo;l.ResultMessageTo=i.ResultMessageTo;i.ReturnPropertiesTo!==null&&i.ReturnPropertiesTo!==undefined&&(l.ReturnPropertiesTo=i.ReturnPropertiesTo.map(function(n){var t,i=((t=r.Returns)!==null&&t!==void 0?t:[]).filter(function(t){return t.ID===n.ReturnPropertyReferObject.ParamID});if(i&&i.length===1)return{ResultTo:n.ResultTo,Name:i[0].Name}}).filter(function(n){return n}));this.addToCommandList([].concat(r.Commands,l))}return[2,n.CommandResult.completed]}})})},r}(n.CommandBase),t,i;n.ShareCommand=r;n.CommandFactory.registerCommand("Forguncy.Model.ShareCommand, ServerDesignerCommon",r);t=function(){function n(){this.$type="Forguncy.Model.CommandMethodTerminate, ServerDesignerCommon"}return n}();n.CommandMethodTerminateParam=t;i=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.execute=function(){return n.ForguncyData.parameterManager.pop(),n.CommandResult.completed},i}(n.CommandBase);n.CommandMethodTerminate=i;n.CommandFactory.registerCommand("Forguncy.Model.CommandMethodTerminate, ServerDesignerCommon",i)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__spreadArray=this&&this.__spreadArray||function(n,t,i){if(i||arguments.length===2)for(var r=0,f=t.length,u;r<f;r++)!u&&r in t||(u||(u=Array.prototype.slice.call(t,0,r)),u[r]=t[r]);return n.concat(u||Array.prototype.slice.call(t))},Forguncy;(function(n){var i={Left:'<?xml version="1.0" encoding="UTF-8"?><svg viewBox="0 0 10 10" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="arrowleft" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><polygon id="Path-5-Copy-2" fill="currentColor" transform="translate(5.000000, 5.000000) scale(-1, 1) rotate(90.000000) translate(-5.000000, -5.000000) " points="0 8 10 8 5 2"><\/polygon><\/g><\/svg>',Right:'<?xml version="1.0" encoding="UTF-8"?><svg viewBox="0 0 10 10" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="arrowright" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><polygon id="Path-5-Copy-2" fill="currentColor" transform="translate(5.000000, 5.000000) rotate(90.000000) translate(-5.000000, -5.000000) " points="0 8 10 8 5 2"><\/polygon><\/g><\/svg>',Up:'<?xml version="1.0" encoding="UTF-8"?><svg viewBox="0 0 10 10" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="arrowup" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><polygon id="Path-5-Copy-2" fill="currentColor" points="0 8 10 8 5 2"><\/polygon><\/g><\/svg>',Down:'<?xml version="1.0" encoding="UTF-8"?><svg viewBox="0 0 10 10" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="arrowdown" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><polygon id="Path-5-Copy-3" fill="currentColor" transform="translate(5.000000, 5.000000) scale(1, -1) translate(-5.000000, -5.000000) " points="0 8 10 8 5 2"><\/polygon><\/g><\/svg>'},u=function(t){function r(){var i=t.call(this)||this;return i.id="fgc-columnoptions-dialog",i.defaultUI=f,i.availableTextBlock=new n.UI.TextBlock(n.RS.ColumnOptionsCommand_AvailableColumns).identify("fgc-columnoptions-availabletext"),i.selectedTextBlock=new n.UI.TextBlock(n.RS.ColumnOptionsCommand_SelectedColumns).identify("fgc-columnoptions-selectedtext"),i.availableListBox=new n.UI.ListBox(!0).identify("fgc-columnoptions-availablebox"),i.selectedListBox=(new n.UI.ListBox).identify("fgc-columnoptions-selectedbox"),i.addOrRemoveButtonGroup=new n.UI.ButtonGroup(1),i.moveDownOrUpButtonGroup=new n.UI.ButtonGroup(1),i.resetButton=new n.UI.Button(n.RS.ColumnOptionsCommand_ResetSetting).identify("fgc-columnoptions-button-reset"),i.outerFlex=new n.UI.FlexLayout(0).identify("fgc-columnoptions-outerflex"),i.innerFlex1=new n.UI.FlexLayout(1).identify("fgc-columnoptions-availableflex"),i.innerFlex2=new n.UI.FlexLayout(1).identify("fgc-columnoptions-selectedflex"),i.initializeListBoxs(),i.initializeButtons(),i.title=n.RS.ColumnOptionsCommand_Title,i.initializeFlexLayout(),i}return __extends(r,t),r.prototype.initializeFlexLayout=function(){this.outerFlex.add(this.innerFlex1);this.outerFlex.add(this.addOrRemoveButtonGroup);this.outerFlex.add(this.innerFlex2);this.outerFlex.add(this.moveDownOrUpButtonGroup);this.innerFlex1.add(this.availableTextBlock);this.innerFlex1.add(this.availableListBox);this.innerFlex2.add(this.selectedTextBlock);this.innerFlex2.add(this.selectedListBox);this.footerButtonGroup.add(this.resetButton)},r.prototype.initializeListBoxs=function(){this.availableListBox.compareFn=function(n,t){return n.value.Order-t.value.Order}},r.prototype.initializeButtons=function(){var t=this;this.addOrRemoveButtonGroup.add(new n.UI.Button("",i.Right,n.RS.ColumnOptionsCommand_AddColumn).on("Clicked",function(){t.moveToRight()}).identify("fgc-columnoptions-button-add"));this.availableListBox.on("ActiveItemsChanged",function(){t.moveToRight()});this.addOrRemoveButtonGroup.add(new n.UI.Button("",i.Left,n.RS.ColumnOptionsCommand_RemoveColumn).on("Clicked",function(){t.moveToLeft()}).identify("fgc-columnoptions-button-remove"));this.selectedListBox.on("ActiveItemsChanged",function(){t.moveToLeft()});this.availableListBox.on("SelectionsChanged",function(){t.addOrRemoveButtonGroup.items[0].enabled=t.availableListBox.selections.length>0});this.selectedListBox.on("SelectionsChanged",function(){var n=t.selectedListBox.selections.length>0;t.addOrRemoveButtonGroup.items[1].enabled=n;t.moveDownOrUpButtonGroup.items.forEach(function(t){return t.enabled=n})});this.moveDownOrUpButtonGroup.add(new n.UI.Button("",i.Up,n.RS.ColumnOptionsCommand_MoveColumnUp).on("Clicked",function(){t.selectedListBox.moveUpSelect();t.selectedListBox.moveSelectionToViewport()}).identify("fgc-columnoptions-button-up"));this.moveDownOrUpButtonGroup.add(new n.UI.Button("",i.Down,n.RS.ColumnOptionsCommand_MoveColumnDown).on("Clicked",function(){t.selectedListBox.moveDownSelect();t.selectedListBox.moveSelectionToViewport()}).identify("fgc-columnoptions-button-down"))},r.prototype.moveToRight=function(){var n,t,i;(n=this.selectedListBox).add.apply(n,this.availableListBox.selections);(t=this.selectedListBox).select.apply(t,this.availableListBox.selections);this.selectedListBox.moveSelectionToViewport();(i=this.availableListBox).remove.apply(i,this.availableListBox.selections);this.selectedListBox.focus()},r.prototype.moveToLeft=function(){var n,t,i;(n=this.availableListBox).add.apply(n,this.selectedListBox.selections);(t=this.availableListBox).select.apply(t,this.selectedListBox.selections);this.availableListBox.moveSelectionToViewport();(i=this.selectedListBox).remove.apply(i,this.selectedListBox.selections);this.availableListBox.focus()},r}(n.UI.Dialog),f=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),Object.defineProperty(t.prototype,"content",{get:function(){return new e(this.target)},enumerable:!1,configurable:!0}),t}(n.UI.DialogUI),e=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.createChildren=function(){this.addChild(this.target.outerFlex.createUI())},t}(n.UI.DialogContentUI),r=function(i){function r(){var n=i!==null&&i.apply(this,arguments)||this;return n.control=new u,n.externalColumns=[],n}return __extends(r,i),r.prototype.execute=function(){return(this.param=this.CommandParam,this.listview=n.ListviewBase.getListview(this.param.ListviewName,this.CommandExecutingInfo.runTimePageName),!this.listview.tryCommitEdit())?n.CommandResult.stop:(this.createControl(),this.resetListviewMetadata(),this.resetListBoxItems(),this.control.footerButtonGroup.items[0].enabled=!1,this.control.show(),n.CommandResult.stop)},r.prototype.resetListviewMetadata=function(){var i=this;this.metadata=n.Common.clone(this.listview.listviewData.metadata);this.externalColumns=this.param.Columns.map(function(n,r){return t.generate(i.metadata,n,i.param.ID,r+1e6)})},r.prototype.createControl=function(){this.bindControlEvents();n.ForguncyData.pageInfo.appendExtralPopup(this.control);n.PageBuilder.pagesContainer.append(this.control.createUI().container)},r.prototype.bindControlEvents=function(){var n=this;this.control.on("Confirm",function(){n.resetListView()});this.control.resetButton.on("Clicked",function(){n.resetListviewMetadata();n.resetListBoxItems(!0)});this.control.selectedListBox.on("ItemsChanged",function(){n.control.footerButtonGroup.items[0].enabled=!0})},r.prototype.resetListBoxItems=function(n){var i,r,t;n===void 0&&(n=!1);t=this.generateListBoxItems(n);this.control.selectedListBox.clear();(i=this.control.selectedListBox).add.apply(i,t.filter(function(n){return n.value.Width>0||n.value.IsHiddenByUIResizeColumn}));this.control.availableListBox.clear();(r=this.control.availableListBox).add.apply(r,t.filter(function(n){return n.value.IsHiddenByColumnOptions&&!n.value.IsHiddenByLayout&&!n.value.IsHiddenByJavaScriptAPI}))},r.prototype.generateListBoxItems=function(i){var e=this,r,u,f;return i===void 0&&(i=!1),r=[],u=this.metadata.Columns,i&&(u=this.metadata.OriginalColumns),f=t.distinct(this.metadata,u,this.externalColumns),r.push.apply(r,f.map(function(t){return{value:t,displayText:n.Common.getMultiLanguageWord(e.getColumnName(t))}})),r},r.prototype.resetListView=function(){var u=this.control.availableListBox.items.map(function(n){return n.value}),r,i,f,e;u.forEach(function(n){n.Width=0;n.IsHiddenByColumnOptions=!0;n.IsHiddenByUIResizeColumn=!1});r=this.control.selectedListBox.items.map(function(n){return n.value});r.forEach(function(n){n.Width<=0&&!n.IsHiddenByUIResizeColumn&&(n.Width=n.OriginalWidth,n.IsHiddenByColumnOptions=!1)});i=this.metadata;t.mix(i,__spreadArray(__spreadArray([],u,!0),r,!0));this.clearContext(i);i.CacheListviewStatus?n.ListviewStatusCacheHelper.autoSaveMetadataCacheDataAsync(this.listview,{columns:n.ListviewStatusCacheHelper.getCacheDataFromListviewMatadata(i)}):n.ListviewMetadataHelper.save(i,this.listview.getLocationString());f=this.listview.listviewData;e=new n.ListviewData(i,this.CommandExecutingInfo.runTimePageName,this.CommandExecutingInfo.designerPageName,f.uniqueIndex);this.listview.resetListviewData(e)},r.prototype.clearContext=function(n){n.Columns.forEach(function(n){var i,r,u,f,e,t=(r=(i=n===null||n===void 0?void 0:n.TemplateCell)===null||i===void 0?void 0:i.Element)===null||r===void 0?void 0:r.CellType;(t===null||t===void 0?void 0:t.haveLoadItems)===!0&&(t.haveLoadItems=!1);(t===null||t===void 0?void 0:t.hasInitItemsInfo)===!0&&(t.hasInitItemsInfo=!1);((e=(f=(u=n===null||n===void 0?void 0:n.TemplateCell)===null||u===void 0?void 0:u.Element)===null||f===void 0?void 0:f.ConditionalFormattingMetadata)===null||e===void 0?void 0:e.handledRules)&&(n.TemplateCell.Element.ConditionalFormattingMetadata.handledRules=undefined)})},r.prototype.getColumnName=function(t){var u,f,e,o,s,h,i="",c=(f=(u=t.TemplateCell)===null||u===void 0?void 0:u.Element)===null||f===void 0?void 0:f.Name,r;return n.ForguncyData.GlobalSettings.MultipleLanguageSettings.EnableMultipleLanguage&&(r=(e=t.HeaderCell)===null||e===void 0?void 0:e.length,r&&r>0&&(i=(o=t.HeaderCell[r-1].Element)===null||o===void 0?void 0:o.Value),n.Common.IsEmpty(i)&&(i=(h=(s=t.TemplateCell)===null||s===void 0?void 0:s.Element)===null||h===void 0?void 0:h.Value)),n.Common.IsEmpty(i)&&(i=c&&!n.Common.IsEmpty(c[0])?c[0]:n.RS.ColumnOptionsCommand_UnamedColumn),i},r}(n.CommandBase),t;n.ColumnOptionsCommand=r;t=function(){function t(){}return t.distinct=function(t,i,r){var u=n.Common.clone(i),e=this.getPreserveColumnCount(t),f;return u=u.slice(e),f=u.map(function(n){var t=n.TemplateCell&&n.TemplateCell.Element&&n.TemplateCell.Element.Name;if(t)return t[0]}),r.forEach(function(n){var t=n.TemplateCell&&n.TemplateCell.Element&&n.TemplateCell.Element.Name;t&&f.indexOf(t[0])<0&&u.push(n)}),u},t.mix=function(n,i){var u,f=this.getPreserveColumnCount(n),r;n.Columns=__spreadArray(__spreadArray([],n.Columns.slice(0,f),!0),n.Columns.filter(function(n){return n.IsHiddenByLayout||n.IsHiddenByJavaScriptAPI}),!0);(u=n.Columns).push.apply(u,i.filter(function(n){return!(n.Width<=0&&n.IsExternal)||n.Width<=0&&n.IsHiddenByUIResizeColumn}));r=__spreadArray([],n.Columns,!0).sort(function(n,t){return n.Index-t.Index});r.forEach(function(i,u){i.IsExternal&&(t.recalcColumnIndex(i,u,r),t.recalcColumnHeaderRowColumnInfo(i,n))});t.recalcHeaderCellsColumnSpan(n);t.recalcColumnCount(n)},t.recalcColumnIndex=function(n,t,i){n.Index=t===0?0:i[t-1].Index+i[t-1].ColumnCount},t.recalcHeaderCellsColumnSpan=function(n){n.Columns.forEach(function(i,r){i.IsExternal||t.recalcSingleHeaderCellColumnSpan(i,r,n.Columns)})},t.recalcSingleHeaderCellColumnSpan=function(n,t,i){n.HeaderCell&&n.HeaderCell.forEach(function(n,r){var e,o,s,h,c,y,u,l,a,f,v;if(n.ColumnSpan=1,n.Element&&n.ColumnSpanIgnoreHidden>1){for(c=0,y=Math.min(i.length,t+n.ColumnSpanIgnoreHidden),u=t+1;u<y;u++){if(i[u].IsExternal)break;if(l=(o=(e=i[u])===null||e===void 0?void 0:e.HeaderCell)===null||o===void 0?void 0:o[r],l&&!l.Element){for(a=!1,f=0;f<r;f++)if(v=(h=(s=i[u])===null||s===void 0?void 0:s.HeaderCell)===null||h===void 0?void 0:h[f],v&&f+v.RowSpan>r){a=!0;break}if(a)break;i[u].Width>0&&(c+=1)}else break}n.ColumnSpan+=c}n.ColumnSpan=Math.min(n.ColumnSpan,n.ColumnSpanIgnoreHidden)})},t.recalcColumnHeaderRowColumnInfo=function(n,t){n.HeaderCell&&n.HeaderCell.forEach(function(i,r){i.Element.Column=n.Index+t.CellRange.Column;i.Element.Row=t.CellRange.Row+r})},t.recalcColumnCount=function(n){var i=n.Columns.length,t;i>0?(t=__spreadArray([],n.Columns,!0).sort(function(n,t){return t.Index-n.Index})[0],n.ColumnCount=t.Index+t.ColumnCount):n.ColumnCount=0},t.generate=function(i,r,u,f){f===void 0&&(f=0);var e=i.ColumnOptionCommandsColumns.find(function(n){return n.TemplateCell.Element.Name&&n.TemplateCell.Element.Name[0]===r.Name?!0:!1});return e||(e={AllowSort:r.AllowSort,AllowAutoMerge:!1,BindingColumnDataType:r.BindingColumnDataType,FilterBindingInfo:r.BindingInfo,FilterColumnDataType:r.BindingColumnDataType,ColumnCount:1,DependenceColumnsIndex:null,Index:1e5,HeaderCell:[{ColumnSpan:1,ColumnSpanIgnoreHidden:1,RowSpan:i.ColumnHeaderHeights.length,Row:0,Element:{Value:n.Common.getMultiLanguageWord(r.Name),Row:-1,Column:-1}}],TemplateCell:{Element:{BindingInfo:r.BindingInfo,Name:[n.Common.getMultiLanguageWord(r.Name)],EditableCellType:r.EditableCellType,ReadonlyCellType:r.ReadonlyCellType,DataValidation:r.DataValidation,ServerPropertiesId:r.ServerPropertiesId}}}),e.HeaderCell[0].Element.StyleInfo=r.HeaderCellStyleMetadata,e.TemplateCell.Element.StyleInfo=r.TemplateCellStyleMetadata,e.OriginalWidth=r.Width||0,e.ColumnOptionsCommandID=u,t.initDefaultValueForColumnMetadata(e,f),e},t.initDefaultValueForColumnMetadata=function(n,t){n.HeaderCell[0].Element.StyleInfo||(n.HeaderCell[0].Element.StyleInfo=this.DefaultHeaderStyleInfo);n.HeaderCell[0].Element.IgnoreExport=!0;n.TemplateCell.Element.StyleInfo||(n.TemplateCell.Element.StyleInfo=this.DefaultTemplateStyleInfo);n.Width=0;n.IsHiddenByLayout=!1;n.IsHiddenByColumnOptions=!0;n.IsHiddenByJavaScriptAPI=!1;n.Order=t;n.IsExternal=!0},t.getPreserveColumnCount=function(n){var t=0;return n.IsRowHeaderVisible&&(t+=1),n.IsRowHeaderCheckBoxVisible&&(t+=1),t},Object.defineProperty(t,"DefaultHeaderStyleInfo",{get:function(){return{FontFamily:n.LocaleFonts.default,FontSize:n.StaticValues.DefaultFontSizeInPx,FontStyle:"Normal",FontWeight:"Normal",HorizontalAlignment:n.CellHorizontalAlignment.Center,Strikethrough:!1,TextIndent:0,Underline:!1,VerticalAlignment:n.CellVerticalAlignment.Center,WordWrap:!1}},enumerable:!1,configurable:!0}),Object.defineProperty(t,"DefaultTemplateStyleInfo",{get:function(){return{FontFamily:n.LocaleFonts.default,FontSize:n.StaticValues.DefaultFontSizeInPx,FontStyle:"Normal",FontWeight:"Normal",HorizontalAlignment:n.CellHorizontalAlignment.Left,Strikethrough:!1,TextIndent:0,Underline:!1,VerticalAlignment:n.CellVerticalAlignment.Center,WordWrap:!1}},enumerable:!1,configurable:!0}),t}();n.ColumnOptionsListviewMetadataHelper=t;n.CommandFactory.registerCommand("Forguncy.Model.ColumnOptionsCommand, ServerDesignerCommon",r)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.execute=function(){return this.runCallStoredProcedureCommand(this.CommandParam)},i.prototype.runCallStoredProcedureCommand=function(t){for(var i,u,h=t.ID,c=t.Parmeters,e=[],o={},r=0,s=c;r<s.length;r++)i=s[r],u={Name:i.Name,Value:this.evaluateFormula(i.Value),Direction:i.Direction,DataType:i.DataType},e.push(u),o[u.Name]=i.ReturnCell;var f=this,l=t.ReturningValue;return n.Common.forguncyPostSync("Home/CallStoredProcedure",{ID:h,parList:e},function(i){var r,s,e,h,u;if(!n.Common.IsEmpty(i))if(r=i,r.Success===!0){if(s=r.ReturnValue,s)for(e=0,h=s;e<h.length;e++)u=h[e],u.Direction===3||u.Direction===2?f.SetValue(u.Value,o[u.Name]):u.Direction===6&&f.SetValue(u.Value,l);t.ReturnsName&&r.ReturnResult&&(n.ForguncyData.parameterManager.setValue(t.ReturnsName,r.ReturnResult),n.ForguncyData.parameterManager.SetParamToReference(t.ReturnsName,r.ReturnResult));t.ReloadAfterSucceed&&n.NormalCellBindingManager.reloadData(null,!0)}else return alert(r.ReturnValue),console.error(n.RS.CallStoredProcedureCommand_ExecuteFailed+"\r\n"+r.ReturnValue),f.stopExecuteCommandList(),n.CommandResult.stop}),n.CommandResult.completed},i.prototype.SetValue=function(t,i){n.FormulaHelper.setValueToCellLocation(t,i,5,this.getDefaultFormulaCalcInfo())},i}(n.CommandBase);n.CallStoredProcedureCommand=t;n.CommandFactory.registerCommand("Forguncy.Model.CallStoredProcedureCommand, ServerDesignerCommon",t)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.execute=function(){return this.CallUserControlPageCommand(this.CommandParam),n.CommandResult.completed},i.prototype.CallUserControlPageCommand=function(t){var f={},i,r,u,e,o;if(t.CommandParamValue)for(i=0,r=t.CommandParamValue;i<r.length;i++)u=r[i],f[u.Name]=this.evaluateFormula(u.Value);e=n.PageManager.getContainerCell(this.CommandExecutingInfo.runTimePageName);o=e.cellType;o.addCommandsToCurrentExecuteList(t.CommandName,f)},i}(n.CommandBase);n.CallUserControlPageCommand=t;n.CommandFactory.registerCommand("Forguncy.Model.CallUserControlPageCommand, ServerDesignerCommon",t)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.execute=function(){return this.CallUserControlPageMethod(this.CommandParam),n.CommandResult.completed},i.prototype.CallUserControlPageMethod=function(t){var s,f,h,l,r,e,c,i,a,u;if(n.ForguncyData.parameterManager.push(),t.MethodParamValues)for(f=0,h=t.MethodParamValues;f<h.length;f++)i=h[f],l=this.evaluateFormula(i.Value),n.ForguncyData.parameterManager.setValue(i.Name,l,null);if(r={},t.MethodReturnProperties)for(e=0,c=t.MethodReturnProperties;e<c.length;e++)i=c[e],r[i.Name]=i.ResultTo;var v=n.PageManager.getContainerCell(this.CommandExecutingInfo.runTimePageName),y=v.cellType,o=y.getMethodDefinition(t.MethodName);((s=o===null||o===void 0?void 0:o.Commands)===null||s===void 0?void 0:s.length)&&(a=o.Commands,u=new n.CommandMethodTerminateParam,u.ResultErrorCodeTo=t.ResultErrorCodeTo,u.ResultMessageTo=t.ResultMessageTo,r&&(u.ReturnPropertiesTo=Object.keys(r).map(function(n){return{Name:n,ResultTo:r[n]}})),this.addToCommandList(a.concat(u)))},i}(n.CommandBase);n.CallUserControlPageMethod=t;n.CommandFactory.registerCommand("Forguncy.Model.CallUserControlPageMethod, ServerDesignerCommon",t)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.execute=function(){return this.SetUserControlPagePropertyValue(this.CommandParam),n.CommandResult.completed},i.prototype.SetUserControlPagePropertyValue=function(t){var r=this,i=n.PageManager.getContainerCell(this.CommandExecutingInfo.runTimePageName),u,f;i.cellType instanceof n.UserControlPageCellType&&(u=i.cellType,t.UserControlProperties.forEach(function(n){u.SetSinglePropertyValue(n.PropertyName,r.evaluateFormula(n.PropertyValue),!0)}),i.cellType.SetPropertiesRefer(t.UserControlProperties,this.CommandExecutingInfo.runTimePageName,!0));f=t.UserControlProperties.map(function(n){return"{".concat(n.PropertyName," = ").concat(r.evaluateFormula(n.PropertyValue),"}")}).join(", ");this.log(f)},i}(n.CommandBase);n.SetUserControlPagePropertyValueCommand=t;n.CommandFactory.registerCommand("Forguncy.Model.SetUserControlPagePropertyValueCommand, ServerDesignerCommon",t)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__awaiter=this&&this.__awaiter||function(n,t,i,r){function u(n){return n instanceof i?n:new i(function(t){t(n)})}return new(i||(i=Promise))(function(i,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?i(n.value):u(n.value).then(o,s)}e((r=r.apply(n,t||[])).next())})},__generator=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=e[0]&2?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[e[0]&2,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i,e;return e={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e},Forguncy;(function(n){var t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.execute=function(){return this.sendRequestToServer(this.CommandParam)},i.prototype.sendRequestToServer=function(t){var i;return __awaiter(this,void 0,void 0,function(){var l,r,e,u,h,o,s,f,c,a=this;return __generator(this,function(){if(t.CheckDataValidation){l=n.ValidateHelpCommand.validateInCommand(this,null,n.ListviewBase.getAllListviews(),!1);switch(l){case 2:return[2,n.CommandResult.completed];case 1:return this.log(n.RS.DataValidationNotPassedServerCommand),this.stopExecuteCommandList(),[2,n.CommandResult.stop]}}try{if(r=null,t.OnlySendChangeParams=(i=t.OnlySendChangeParams)!==null&&i!==void 0?i:[],t.Parameters&&t.Parameters.length>0)for(r={},e=0;e<t.Parameters.length;e++)u=t.Parameters[e],u.$type.indexOf("ObjectParam")>=0?(r[u.ParamName]=this.evaluateFormula(u.Value),r[u.ParamName]instanceof Date&&(r[u.ParamName]=n.Convertor.fromDateToOADate(r[u.ParamName]))):r[u.ParamName]=this.getListviewData(u,t.OnlySendChangeParams.indexOf(u.ParamName)>=0);if(h=function(i,r,u){var f=u.getResponseHeader("fgc_redirect"),e=u.getResponseHeader("fgc_redirect_name");e&&(e=decodeURI(e));f&&(f.toLowerCase().startsWith("http://")||f.toLowerCase().startsWith("https://")?n.Common.download(f,e):n.Common.download(n.ForguncyData.ForguncyRoot+f,e));a.setResult(t,i);t.RefreshAfterFinish&&n.Page.reloadBindingData()},o=function(n,i){var r={ErrCode:n.status===0?-1:n.status,Message:i};a.setResult(t,r)},t.RequestAsync)s="ServerCommand/"+t.ServerCommandName,s=encodeURI(n.ForguncyData.ForguncyRoot+s),f=new XMLHttpRequest,f.open("POST",s,!0),f.setRequestHeader("connectionId",n.HubManager.GetconnectionId()),f.onload=function(){if(this.status>=200&&this.status<400){var n=this.getResponseHeader("content-type"),t=this.response;n&&n.toLowerCase().indexOf("application/json")>=0&&(t=JSON.parse(this.response));h(t,null,f)}else o(f,this.response)},f.onerror=function(){o(f,this.response)},n.Common.IsEmpty(r)||(r=n.Common.adjustDate(r),typeof r=="object"&&(f.setRequestHeader("Content-Type","application/json"),r=JSON.stringify(r))),f.send(r);else return c="ServerCommand/"+t.ServerCommandName,[2,new Promise(function(t){n.Common.forguncyPost(c,r,function(i,r,u){h(i,r,u);t(n.CommandResult.completed)},c,function(i,r){o(i,r);t(n.CommandResult.completed)},null,{connectionId:n.HubManager.GetconnectionId()})})];return[2,n.CommandResult.completed]}catch(v){alert(v)}return[2]})})},i.prototype.setResult=function(t,i){var f,r,u;if(t.ResultMessageTo&&this.setValue(i.Message,t.ResultMessageTo),t.ResultErrorCodeTo&&this.setValue(i.ErrCode,t.ResultErrorCodeTo),t.ReturnPropertiesTo)for(f=0;f<t.ReturnPropertiesTo.length;f++)r=t.ReturnPropertiesTo[f],(r===null||r===void 0?void 0:r.ResultTo)&&this.setValue(i[r.ResultPropertyName],r.ResultTo);i.Log&&(u=this.CommandExecutingInfo.logHelper,t.RequestAsync&&(u=new n.CommandLogHelper,u.tryStartNewRoot()),u.logGroupedText(i.Log),t.RequestAsync&&u.consoleLog());i.ErrCode===0||n.Common.IsEmpty(i.Message)||t.ResultMessageTo||t.ResultErrorCodeTo||alert(i.Message)},i.prototype.setValue=function(t,i){n.FormulaHelper.setValueToCellLocation(t,i,5,this.getDefaultFormulaCalcInfo())},i.prototype.getListviewData=function(t,i){var rt=this,v,y,o,k,a,f,c,l,d,g,w,s,e,h,r,u,b,it,p;if(i){if(e={AddRows:[],EditRows:[],DeleteRows:[]},v=n.ListviewBase.getAllListviews().filter(function(n){return n.getListviewName()===t.ListviewName}),v.length===0)throw n.Common.format(n.RS.CannotFindListview,t.ListviewName);if(y=v.find(function(n){return n.runTimePageName===rt.CommandExecutingInfo.runTimePageName})||v[0],o=y.buildDetailListviewValues(!1,null,1),!o)return e;for(r=0;r<o.AddValues.length;r++){if(u={},k=o.AddValues[r],t.Columns)for(f=0;f<t.Columns.length;f++)c=t.Columns[f].ArrayItemName,l=k.values[t.Columns[f].Column],u[c]=l;e.AddRows.push(u)}for(r=0;r<o.EditValues.length;r++){if(u={},a=o.EditValues[r],t.Columns)for(f=0;f<t.Columns.length;f++)c=t.Columns[f].ArrayItemName,l=a.values[t.Columns[f].Column],l!==undefined?u[c]=l:(d=y.getColIndexOfNamedColumn(t.Columns[f].Column,!1),g=y.getListDataModel().getValue(a.rowIndex,d),u[c]=g);for(s in a.query)u[s]=a.query[s];e.EditRows.push(u)}for(r=0;r<o.DeletedValues.length;r++){u={};w=o.DeletedValues[r];for(s in w.query)u[s]=w.query[s];e.DeleteRows.push(u)}return e}if(e=[],h=n.Page.getListView(t.ListviewName),h===null)throw n.Common.format(n.RS.CannotFindListview,t.ListviewName);if(t.Scope===1){var nt=h.getSelectedRowsData(),ut=h.getMergedColumnInfos(),tt=this.mergedColumnInfos(t,ut);for(r=0;r<nt.length;r++){u={};for(b in tt)it=tt[b],u[b]=nt[r].Values[it];e.push(u)}}else for(p=0;p<h.getRowCount();p++)this.addRowData(e,t,p,h);return e},i.prototype.mergedColumnInfos=function(n,t){for(var f,e,i,u={},r=0;r<n.Columns.length;r++)for(f=n.Columns[r].ArrayItemName,e=n.Columns[r].Column,i=0;i<t.length;i++)t[i].ColumnName===e&&(u[f]=i);return u},i.prototype.addRowData=function(n,t,i,r){var f={},u,e;if(t.Columns)for(u=0;u<t.Columns.length;u++)e=t.Columns[u].ArrayItemName,f[e]=r.getValue(i,t.Columns[u].Column);n.push(f)},i.prototype.getMessage=function(t){if(n.Common.IsEmpty(t))return"";var i=this.evaluateFormula(t.MessageFormula);return n.Common.IsEmpty(i)?"":i},i}(n.CommandBase);n.RequestServerCommand=t;n.CommandFactory.registerCommand("Forguncy.Model.RequestServerCommand, ServerDesignerCommon",t)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t=function(t){function r(){return t!==null&&t.apply(this,arguments)||this}return __extends(r,t),r.prototype.execute=function(){try{return this.exportActiveReportToPdf(this.CommandParam)}catch(t){return alert(t),this.CommandExecutingInfo.suspend=!1,n.CommandResult.completed}},r.prototype.exportActiveReportToPdf=function(t){var r=this,u;if(this.preHandlePassParameterItems(t),u=this.evaluateFormula(t.CustomName),u instanceof GC.Spread.CalcEngine.CalcError)throw n.RS.ExprotActiveReportsCalFormulaError;return n.Common.forguncyPost("ARExport/SetExportParam",{ExportReportType:t.ExportReportType,ReportFiles:t.ExportReportNameList,ReportParameters:t.PassParameters,FileName:u,IsPageBreakBefores:t.IsPageBreakBefores,ReportGaps:t.ReportGaps,ReportJsonDataResources:t.JsonDataSources,ExportReportSettings:t.ExportSettings},function(u){try{t.ExportReportType===i.Pdf?n.Common.openWindow(n.ForguncyData.ForguncyRoot+"ARExport/ExportReport"+"?CacheGuid=".concat(u,"&exportType=").concat(t.ExportReportType)):n.Common.download(n.ForguncyData.ForguncyRoot+"ARExport/ExportReport"+"?CacheGuid=".concat(u,"&exportType=").concat(t.ExportReportType))}finally{n.DelayRefresh.setTimeout(function(){r.CommandExecutingInfo.suspend=!1},500)}},"export",function(){r.CommandExecutingInfo.suspend=!1},function(){r.CommandExecutingInfo.suspend=!1}),n.CommandResult.completed},r.prototype.preHandlePassParameterItems=function(t){var u=this,i,r;(i=t.PassParameters)===null||i===void 0?void 0:i.forEach(function(t){var i=u.evaluateFormula(t.SourceValue);if(i instanceof GC.Spread.CalcEngine.CalcError)throw n.RS.ActiveReportsParameterValueCalFormulaError;t.ActualSourceValue=i;t.ActualTargetParameter=t.TargetParameter});(r=t.JsonDataSources)===null||r===void 0?void 0:r.forEach(function(t){var i=u.evaluateFormula(t.SourceValue);if(i instanceof GC.Spread.CalcEngine.CalcError)throw n.RS.ActiveReportsParameterValueCalFormulaError;if(typeof i=="string"){if(i!=="")try{JSON.parse(i)}catch(r){throw n.Common.format(n.RS.ActiveReportsJsonDataSourceIsNotAJSONString,i);}}else try{i=JSON.stringify(i)}catch(f){throw n.Common.format(n.RS.ActiveReportsJsonDataSourceIsNotAJSONString,i);}t.ActualSourceValue=i})},r}(n.CommandBase),i;n.ExportActiveReportCommand=t,function(n){n[n.Pdf=0]="Pdf";n[n.Word=1]="Word";n[n.Excel=2]="Excel";n[n.Csv=3]="Csv"}(i=n.ExportReportType||(n.ExportReportType={}));n.CommandFactory.registerCommand("Forguncy.Model.ExportActiveReportCommand, ServerDesignerCommon",t)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.execute=function(){var t=this;return new Promise(function(i){n.LoadModule("f4d61031-b4c0-435b-af6e-991d81290afd").then(function(){i(t.openActiveReportToPdf(t.CommandParam))}).fail(function(t){alert(t);i(n.CommandResult.completed)})})},i.prototype.openActiveReportToPdf=function(t){var f,u,r,i,e,o,s;return this.preHandlePassParameterItems(t),this.saveSessions(t),u="".concat(n.ForguncyData.ForguncyRoot,"ReportsService/preview/").concat(t.SessionGuid,"/").concat(t.OpenReportName,".rdlx"),(t.PassParameters||t.JsonDataSources||t.OpenReportTitle)&&(i=this.evaluateFormula(t.OpenReportTitle),r=i instanceof GC.Spread.CalcEngine.CalcError||n.Common.IsEmpty(i)?"":typeof i=="string"?i.trim():i instanceof Date?i.toJSON():i.toString(),n.Common.forguncyPostSync("ARExport/SetOpenParam",{ReportParameters:t.PassParameters,ReportName:t.OpenReportName,ReportJsonDataResources:t.JsonDataSources,PageTitle:r},function(n){u+="?CacheGuid=".concat(n)})),e=n.ForguncyData.pageInfo.pageID,((f=window===null||window===void 0?void 0:window.TabManager)===null||f===void 0?void 0:f.TabContainer.getCurrentInstance(window,e))?(o=t.OpenReportName,r&&r.length>0&&(o=r),s=new TabManager.Tab(!1,"",window.location.origin+u,o,0),TabManager.TabContainer.addTab(s,e)):n.Common.openWindow(u),n.CommandResult.completed},i.prototype.preHandlePassParameterItems=function(t){var u=this,i,r;(i=t.PassParameters)===null||i===void 0?void 0:i.forEach(function(t){var i=u.evaluateFormula(t.SourceValue);if(i instanceof GC.Spread.CalcEngine.CalcError)throw n.RS.ActiveReportsParameterValueCalFormulaError;t.ActualSourceValue=i;t.ActualTargetParameter=t.TargetParameter});(r=t.JsonDataSources)===null||r===void 0?void 0:r.forEach(function(t){var i=u.evaluateFormula(t.SourceValue);if(i instanceof GC.Spread.CalcEngine.CalcError)throw n.RS.ActiveReportsParameterValueCalFormulaError;if(typeof i=="string"){if(i!=="")try{JSON.parse(i)}catch(r){throw n.Common.format(n.RS.ActiveReportsJsonDataSourceIsNotAJSONString,i);}}else try{i=JSON.stringify(i)}catch(f){throw n.Common.format(n.RS.ActiveReportsJsonDataSourceIsNotAJSONString,i);}t.ActualSourceValue=i})},i.prototype.saveSessions=function(n){this.saveToSessionStorage(n.SessionGuid,JSON.stringify(n))},i.prototype.saveToSessionStorage=function(n,t){t?sessionStorage.setItem(n,t):sessionStorage.removeItem(n)},i}(n.CommandBase),i,r;n.OpenActiveReportCommand=t,function(n){n[n.None=0]="None";n[n.Left=1]="Left";n[n.Right=2]="Right"}(i=n.SideBarPosition||(n.SideBarPosition={})),function(n){n[n.Top=0]="Top";n[n.Default=1]="Default"}(r=n.ParametersPanelPosition||(n.ParametersPanelPosition={}));n.CommandFactory.registerCommand("Forguncy.Model.OpenActiveReportCommand, ServerDesignerCommon",t)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.execute=function(){var t=this;return new Promise(function(i){try{n.LoadModule("f4d61031-b4c0-435b-af6e-991d81290afd").then(function(){i(t.openActiveReportWebDesigner(t.CommandParam))})}catch(r){alert(r);i(n.CommandResult.completed)}})},i.prototype.openActiveReportWebDesigner=function(t){var i,r="".concat(n.ForguncyData.ForguncyRoot,"ReportsService/edit/").concat(t.OpenReportName,".rdlx"),u=n.ForguncyData.pageInfo.pageID,f,e;return((i=window===null||window===void 0?void 0:window.TabManager)===null||i===void 0?void 0:i.TabContainer.getCurrentInstance(window,u))?(f=t.OpenReportName,e=new TabManager.Tab(!1,"",window.location.origin+r,f,0),TabManager.TabContainer.addTab(e,u)):n.Common.openWindow(r),n.CommandResult.completed},i}(n.CommandBase);n.OpenActiveReportWebDesignerCommand=t;n.CommandFactory.registerCommand("Forguncy.Model.OpenActiveReportWebDesignerCommand, ServerDesignerCommon",t)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__awaiter=this&&this.__awaiter||function(n,t,i,r){function u(n){return n instanceof i?n:new i(function(t){t(n)})}return new(i||(i=Promise))(function(i,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?i(n.value):u(n.value).then(o,s)}e((r=r.apply(n,t||[])).next())})},__generator=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=e[0]&2?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[e[0]&2,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i,e;return e={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e},Forguncy;(function(n){var i=function(i){function r(){return i!==null&&i.apply(this,arguments)||this}return __extends(r,i),r.prototype.execute=function(){var i;return __awaiter(this,void 0,void 0,function(){var u,r,f,e,o=this;return __generator(this,function(s){switch(s.label){case 0:return(u=this.CommandParam,r=n.FormulaHelper.getCellIds(u.TargetPageElement,this.getDefaultFormulaCalcInfo()),f=null,(r===null||r===void 0?void 0:r.length)===1?f=r[0]:(r===null||r===void 0?void 0:r.length)>0&&(f=r.find(function(n){return n.endsWith(o.CommandExecutingInfo.runTimePageName)})),e=(i=n.ForguncyData.pageInfo.pageElementManager.cells.getCell(f))===null||i===void 0?void 0:i.cellType,!e)?[3,2]:(n.DelayRefresh.RunNow(),[4,t.execute(e,u,this)]);case 1:return s.sent(),[3,3];case 2:this.log("Can't find target ".concat(u.TargetPageElement));s.label=3;case 3:return[2,n.CommandResult.completed]}})})},r}(n.CommandBase),t;n.OperateCellTypeCommand=i;t=function(){function t(){}return t.execute=function(t,i,r){return __awaiter(this,void 0,void 0,function(){var u,f,l,a,e,s,h,o,c,v,y,p=this;return __generator(this,function(w){switch(w.label){case 0:if(u=t[i.MethodName],!u)return[3,6];if(f=[],i.ParameterValues)for(l in i.ParameterValues)f.push(r.evaluateFormula(i.ParameterValues[l]));if(a=f.map(function(t){if(n.Common.IsEmpty(t))return"null";try{return JSON.stringify(t)}catch(i){return t}}).join(","),t instanceof n.UserControlPageCellType){if(u!==n.UserControlPageCellType.prototype.SetUserControlPage&&!t.GetUserControlPageName())return r.log(n.RS.UserControlIsUnset),[2];if(u===n.UserControlPageCellType.prototype.CallUserControlPageMethod){if(e=f[0],e&&e.MethodName&&!t.getMethodDefinition(e.MethodName))return r.log(n.Common.format(n.RS.UserControlCannotFindUserControlMethod,t.GetUserControlPageName(),e.MethodName)),[2]}else s=t.getMethodLogText(u,f),s&&s.trim().length>0?r.log(s):r.log("".concat(i.MethodName,"()"))}else r.log("".concat(i.MethodName,"(").concat(a,")"));w.label=1;case 1:return(w.trys.push([1,4,,5]),h=u.apply(t,f),t instanceof n.UserControlPageCellType&&u===n.UserControlPageCellType.prototype.SetPropertyValue&&t.SetPropertiesRefer(f[0],r.CommandExecutingInfo.runTimePageName),o=h,!(h instanceof Promise))?[3,3]:[4,h];case 2:o=w.sent();w.label=3;case 3:if(o&&i.RetrunParamNames)for(c in i.RetrunParamNames)this.setValue(o[c],i.RetrunParamNames[c],r);return t instanceof n.UserControlPageCellType&&u===n.UserControlPageCellType.prototype.GetPropertyValue&&(v=f[0],v.$values.forEach(function(n){p.setValue(o[n.PropertyName],n.PropertyValueTo,r)})),[3,5];case 4:return y=w.sent(),r.CommandExecutingInfo.logHelper.startChild(),r.CommandExecutingInfo.logHelper.log("Fail to operate cell type.\r\nException:"),r.CommandExecutingInfo.logHelper.log(y),r.CommandExecutingInfo.logHelper.endChild(),[3,5];case 5:return[3,7];case 6:r.log("Can't find method ".concat(i.MethodName));w.label=7;case 7:return[2]}})})},t.setValue=function(t,i,r){n.FormulaHelper.setValueToCellLocation(t,i,5,r.getDefaultFormulaCalcInfo())},t}();n.RuntimeMethedExecuteHelper=t;n.CommandFactory.registerCommand("Forguncy.Model.OperateCellTypeCommand, ServerDesignerCommon",i)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__awaiter=this&&this.__awaiter||function(n,t,i,r){function u(n){return n instanceof i?n:new i(function(t){t(n)})}return new(i||(i=Promise))(function(i,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?i(n.value):u(n.value).then(o,s)}e((r=r.apply(n,t||[])).next())})},__generator=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=e[0]&2?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[e[0]&2,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i,e;return e={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e},Forguncy;(function(n){var t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.execute=function(){return __awaiter(this,void 0,void 0,function(){var i,t;return __generator(this,function(r){switch(r.label){case 0:return(i=this.CommandParam,t=n.ListviewBase.getListview(i.ListviewName,this.CommandExecutingInfo.runTimePageName),!t)?[2,n.CommandResult.completed]:t.tryCommitValueBeforeQueryOrSort(!0)?[4,n.ModuleLoader.loadReactSuite()]:[2,n.CommandResult.stop];case 1:return r.sent(),this.createControl(i,t),this.control.show(),[2,n.CommandResult.stop]}})})},i.prototype.createControl=function(t,i){var r=this.evaluateFormula(t.QueryDialogTitle);t.Columns.forEach(function(t){return t.DisplayName=n.Common.getMultiLanguageWord(t.Name)});this.control=new u(t.Columns,i,t.DefaultViewId,r,t.ID);n.ForguncyData.pageInfo.appendExtralPopup(this.control);n.PageBuilder.pagesContainer.append(this.control.createUI().container)},i}(n.CommandBase);n.RuntimeQueryCommand=t;var i=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),Object.defineProperty(t.prototype,"content",{get:function(){return new r(this.target)},enumerable:!1,configurable:!0}),t}(n.UI.DialogUI),r=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.renderComponent=function(){return __awaiter(this,void 0,void 0,function(){var i,t=this;return __generator(this,function(r){switch(r.label){case 0:return[4,n.ReactSuite.Component.render(this.container[0],n.ReactSuite.ComponentNames.QueryCommandPanel,{conditions:this.target.conditions,columns:this.target.columns,defaultViewId:this.target.defaultViewId,resources:n.RS,onConditionsCommit:function(n){t.target.commit(n);t.target.dispose()},fetchOptionalValues:function(n,i){t.target.fetchOptionalValues(n,i)}})];case 1:return i=r.sent(),this.target.component=i,[2]}})})},i.prototype.createChildren=function(){this.renderComponent()},i}(n.UI.DialogContentUI),u=function(t){function r(r,u,f,e,o){var s=t.call(this)||this,c,h;return s.id="fgc-runtime-query-dialog",s.defaultUI=i,s.clearAllButton=new n.UI.Button(n.RS.RuntimeQueryCommand_ClearAll).identify("fgc-query-dialog-clear-all-button"),s.columns=r,s.defaultViewId=f,s.listview=u,s.title=e,s.commandId=o,c=s.listview.getLocationString(),h=n.ForguncyData.pageInfo.runtimeQueryConditionDataCache[c],h&&h.commandId===o&&(s.conditions=h.conditions),s.footerButtonGroup.add(s.clearAllButton),s.bindControlEvents(),s}return __extends(r,t),r.prototype.bindControlEvents=function(){var n=this;this.on("Confirm",function(t,i){var r=n.component.ref;if(!r.validate()){i&&(i.cancel=!0);return}n.commit(r.getCommitConditions())});this.clearAllButton.on("Clicked",function(){var t=n.component.ref;t.clearAll()})},r.prototype.commit=function(t){var i={commandId:this.commandId,conditions:t},r=this.listview.getLocationString();n.ForguncyData.pageInfo.runtimeQueryConditionDataCache[r]=i;this.listview.fillData()},r.prototype.fetchOptionalValues=function(t,i){var r=this.listview.getLocationString(),u={currentRowInfo:this.listview.getRowInfo(),queryCommandInfo:n.ForguncyData.pageInfo.commandQuerys[this.listview.getDataTableName()],sortCommandID:null,orderByInfo:n.ForguncyData.pageInfo.getSortInfoWithBinding(r),columnFilterQueries:n.ForguncyData.pageInfo.columnFilterQueryCache[r],pageName:n.PageManager.getDesignerPageName(this.listview.runTimePageName,!1),columnName:t,commandId:this.commandId};n.Common.forguncyPost("Home/GetRuntimeQueryColumnOptionalValues",u,function(n){if(n){if(n.errorMessage){alert(n.errorMessage);return}if(i){if(n.rows){i(n.rows);return}i([])}}},this.listview.getCalcSheetName()+" GetRuntimeQueryColumnOptionalValues")},r}(n.UI.Dialog);n.CommandFactory.registerCommand("ServerDesignerCommon.Command.RuntimeQueryCommand, ServerDesignerCommon",t)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.execute=function(){return this.setParameterCommand(this.CommandParam)},i.prototype.setParameterCommand=function(t){var r,u,i,f;if(t.IsTableValue){if(u={},t.Params)for(i=0;i<t.Params.length;i++)f=t.Params[i],u[f]=this.evaluateFormula(t.Params[i]);return n.HomeController.CalcParamValue({CommandId:t.ID,Params:u},function(i){var r=i.Success?i.Param:GC.Spread.CalcEngine.Errors.Value;!i.Success&&i.ErrorMessage&&alert(i.ErrorMessage);n.ForguncyData.parameterManager.setValue(t.ParameterName,r)},function(){n.ForguncyData.parameterManager.setValue(t.ParameterName,GC.Spread.CalcEngine.Errors.Value)}),n.CommandResult.completed}return r=this.evaluateKeyword(t.ParameterValue),r=this.evaluateFormula(r),n.ForguncyData.parameterManager.setValue(t.ParameterName,r),(t.ParameterValue+"").startsWith("=")&&n.ForguncyData.parameterManager.SetParamToReference(t.ParameterName,t.ParameterValue),n.CommandResult.completed},i}(n.CommandBase);n.SetParameterCommand=t;n.CommandFactory.registerCommand("Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",t)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.execute=function(){return this.returnCommand(this.CommandParam)},i.prototype.returnCommand=function(t){for(var u,h,f,e,s,i=this.CommandExecutingInfo.currentCommandList,o=i.length-1,r=0;r<i.length;r++){if(i[r].$type==="Forguncy.Model.CommandMethodTerminate, ServerDesignerCommon"){e=i[r];o=r;break}if(i[r].$type==="Forguncy.Model.ValidateHelpCommand, ServerDesignerCommon"){s=i[r];o=r-1;break}}for(u=o;u>=0;u--)h=this.CommandExecutor.createCommand(i[u]),h.EnableProtect||i.splice(u,1);if(f=this.getReturnResult(t),this.logResult(f),e)this.endCommand(e,f);else if(this.CommandExecutingInfo.eventType==="validate"||s)this.endValidate(f);else return n.CommandResult.stop},i.prototype.logResult=function(t){var i=this.CommandExecutingInfo.logHelper;i.log(n.Common.format(n.RS.CommandLog_ReturnCommand_ReturnCode,t.ErrorCode));n.Common.IsEmpty(t.Message)||i.log(n.Common.format(n.RS.CommandLog_ReturnCommand_ReturnMessage,t.Message))},i.prototype.getReturnResult=function(n){var i=this,t=[];return n.CustomReturns&&(t=n.CustomReturns.map(function(n){return{property:n.ReturnPropertyName,value:i.evaluateFormula(n.Value)}})),{ErrorCode:this.evaluateFormula(n.ErrorCode),Message:this.evaluateFormula(n.Message),CustomReturns:t}},i.prototype.endCommand=function(t,i){var u,f,r;if(t.runTimePageName&&(this.CommandExecutingInfo.runTimePageName=t.runTimePageName),(new n.CommandMethodTerminate).execute(),this.setValueToCell(t.ResultErrorCodeTo,i.ErrorCode),this.setValueToCell(t.ResultMessageTo,i.Message),t.ReturnPropertiesTo)for(u=0;u<t.ReturnPropertiesTo.length;u++)for(f=t.ReturnPropertiesTo[u],r=0;r<i.CustomReturns.length;r++)if(i.CustomReturns[r].property===f.Name){this.setValueToCell(f.ResultTo,i.CustomReturns[r].value);break}!i.ErrorCode||Number(i.ErrorCode)===0||n.Common.IsEmpty(i.Message)||t.ResultErrorCodeTo||t.ResultMessageTo||alert(i.Message)},i.prototype.endValidate=function(n){var t=(n===null||n===void 0?void 0:n.ErrorCode)&&Number(n.ErrorCode)!==0;this.CommandExecutingInfo.validateInfo.validateResult={status:t?1:0,message:t?n===null||n===void 0?void 0:n.Message:null}},i.prototype.setValueToCell=function(t,i){n.FormulaHelper.setValueToCellLocation(i,t,5,this.getDefaultFormulaCalcInfo())},i}(n.CommandBase);n.ReturnCommand=t;n.CommandFactory.registerCommand("Forguncy.Model.ReturnCommand, ServerDesignerCommon",t)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.execute=function(){return n.ForguncyData.pageDirtyCheckManager.removeDirtyStatus(),n.CommandResult.completed},i}(n.CommandBase);n.IgnorePageDirtyCommand=t;n.CommandFactory.registerCommand("Forguncy.Model.IgnorePageDirtyCommand, ServerDesignerCommon",t)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.execute=function(){return n.CommandResult.stop},i}(n.CommandBase);n.StopCommand=t;n.CommandFactory.registerCommand("Forguncy.Model.StopCommand, ServerDesignerCommon",t)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.execute=function(){return this.SubscribeNotificationCommand(this.CommandParam)},i.prototype.SubscribeNotificationCommand=function(t){try{return n.HubManager.SubscribeNotification(t.Name,t,this.CommandExecutingInfo.runTimePageName),n.CommandResult.completed}catch(i){alert(i)}return n.CommandResult.completed},i}(n.CommandBase);n.SubscribeNotificationCommand=t;n.CommandFactory.registerCommand("Forguncy.Model.SubscribeNotificationCommand, ServerDesignerCommon",t)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.execute=function(){return this.UnSubscribeNotificationCommand(this.CommandParam)},i.prototype.UnSubscribeNotificationCommand=function(t){try{return n.HubManager.UnSubscribeNotification(t.NotificationName),n.CommandResult.completed}catch(i){alert(i)}return n.CommandResult.completed},i}(n.CommandBase);n.UnSubscribeNotificationCommand=t;n.CommandFactory.registerCommand("Forguncy.Model.UnSubscribeNotificationCommand, ServerDesignerCommon",t)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__spreadArray=this&&this.__spreadArray||function(n,t,i){if(i||arguments.length===2)for(var r=0,f=t.length,u;r<f;r++)!u&&r in t||(u||(u=Array.prototype.slice.call(t,0,r)),u[r]=t[r]);return n.concat(u||Array.prototype.slice.call(t))},Forguncy;(function(n){var r=function(r){function u(){var n=r.call(this)||this;return n.EnableProtect=!0,n}return __extends(u,r),u.prototype.execute=function(){var t=this.CommandParam,i=!1;return t.previousValidateInfo?i=this.handlePreviousValidate(t):this.startValidate(t),i||(i=this.prepareNextValidate(t)),i&&this.endValidate(),n.CommandResult.completed},u.prototype.handlePreviousValidate=function(r){var f=r.previousValidateInfo,s;u.logValidateResult(this.CommandExecutingInfo);this.CommandExecutingInfo.logHelper.logDuring();this.CommandExecutingInfo.logHelper.endChild();n.ForguncyData.parameterManager.pop();this.CommandExecutingInfo.runTimePageName=r.runTimePageName;var h=this.CommandExecutingInfo.validateInfo.validateResult,e=n.CommandValidator.getValidateResult(h,n.Common.getMultiLanguageWord(f.dataValidation.ErrorMessage)),o=!1;e.status!==0&&(o=this.CommandExecutingInfo.validateInfo.validateStatus===0,this.CommandExecutingInfo.validateInfo.validateStatus=1);s=f.calcSheetName?new t(null):new i(null);return s.onPreviousValidateEnd(f,e,o)},u.prototype.startValidate=function(t){this.CommandExecutingInfo.validateInfo={isValidating:!0,validateStatus:t.hasFail?1:0};var i=n.RS.CommandLog_DataValidation;this.CommandExecutingInfo.logHelper.log(i);this.CommandExecutingInfo.logHelper.startChild();this.CommandExecutingInfo.continuousExecution=!0},u.prototype.prepareNextValidate=function(r){var f,h=r.cellCache.length===0?new t(r.listviewCache):new i(r.cellCache),u=h.getNextValidateInfo(),s,e,o;if(u){this.CommandExecutingInfo.logHelper.log(n.Common.format(n.RS.CommandLog_StartExecuteValidateCommand,u.locationStr));s=this.CommandExecutingInfo.logHelper.startChild();this.CommandExecutingInfo.validateInfo.validateLogIndex=s;this.CommandExecutingInfo.runTimePageName=u.runTimePageName;r.previousValidateInfo=u;this.addToCommandList(__spreadArray(__spreadArray([],u.dataValidation.ValidateCommand,!0),[r],!1),0,0,this.getFormulaListRowInfo(u));e=(f={},f[n.RS.DataValidation_Command_Param_NewValue]=u.value,f);n.ForguncyData.parameterManager.push();for(o in e)n.ForguncyData.parameterManager.setValue(o,e[o]);return!1}return!0},u.prototype.getFormulaListRowInfo=function(n){var t={};return n.calcSheetName&&(t[n.calcSheetName]=n.rowIndex),t},u.prototype.endValidate=function(){this.CommandExecutingInfo.validateInfo.isValidating=!1;this.CommandExecutingInfo.logHelper.endChild();this.CommandExecutingInfo.continuousExecution=!1},u.logValidateResult=function(t){var i,r;t.validateInfo.isValidating&&!n.Common.IsEmpty(t.validateInfo.validateLogIndex)&&(r=n.RS.CommandLog_ValidateCommand_ValidateResult+(((i=t.validateInfo.validateResult)===null||i===void 0?void 0:i.status)!==1?n.RS.CommandLog_ValidateCommand_ValidateResult_Success:n.RS.CommandLog_ValidateCommand_ValidateResult_Fail),t.logHelper.logAdditionalText(t.validateInfo.validateLogIndex,r))},u.validateInCommand=function(t,i,r,f){var o=t.CommandExecutingInfo.validateInfo,a,s,h,e,c,l,v;return o.isValidating?0:n.Common.IsEmpty(o.validateStatus)?(s=[],h=0,(!i||i.length>0)&&(h=n.ValidationMananger.validateAllCells(!0,i,s)),(h&2)!=0)?(u.insertCommand(null,t),2):(e=[],c=0,(r===null||r===void 0?void 0:r.length)>0&&(c=n.ListviewBase.validateListviewsData(r,f?null:e),c===1&&(e=[])),l=h===1||c===1,s.length>0||e.length>0)?(v={$type:"Forguncy.Model.ValidateHelpCommand, ServerDesignerCommon",runTimePageName:t.CommandExecutingInfo.runTimePageName,cellCache:s,listviewCache:e,hasFail:l},u.insertCommand(v,t),2):l?1:0:(a=o.validateStatus,delete o.validateStatus,a)},u.insertCommand=function(n,t){t.addIgnoreDisplayCommand(t.CommandParam);n&&t.addToCommandList([n])},u}(n.CommandBase),t,i;n.ValidateHelpCommand=r;t=function(){function t(n){this._cache=n}return t.prototype.getNextValidateInfo=function(){for(var t,e,u,i,o,r=0,f=this._cache;r<f.length;r++){t=f[r];for(e in t.columnCache)if(u=t.columnCache[e],i=u.values.shift(),i)return o=Number(e),{calcSheetName:t.calcSheetName,rowIndex:i.rowIndex,colIndex:o,dataValidation:this.getDataValidationInfo(t.calcSheetName,i.rowIndex,o),value:i.value,runTimePageName:t.runTimePageName,locationStr:n.Common.format(u.locationStr,i.rowIndex),id:n.Common.getIdStr(i.rowIndex,u.mergedColIndex,t.calcSheetName)}}return null},t.prototype.getDataValidationInfo=function(t,i,r){var u=n.ListviewBase.getListviewByCalcSheetName(t),o=u.getVisibleColumnIndexInListViewByDataIndex(r),f=u.listviewData.visibleColumns[o].columnInfo.TemplateCell.Element.DataValidation,s=f.ValidateCommand,e={};return e[t]=i,s.forEach(function(n){return n.formulaListRowInfo=e}),f},t.prototype.onPreviousValidateEnd=function(t,i,r){if(i.status===1){var u=t,f=n.ListviewBase.getListviewByCalcSheetName(u.calcSheetName),e=f.getVisibleColumnIndexInListViewByDataIndex(u.colIndex);return r&&f.scrollToView(),f.editAndValidateCellWithDelayRefresh(u.rowIndex,e,{message:i.message}),!0}return!1},t}();i=function(){function t(n){this._ids=n}return t.prototype.getNextValidateInfo=function(){var i=this._ids.shift(),t;return i?(t=this.getCellType(i),{id:i,locationStr:n.FormulaHelper.getCellLogLocationString(t.ID,t.Name,t.runTimePageName),dataValidation:t.CellElement.DataValidation,value:t.getValue(!1),runTimePageName:t.runTimePageName}):null},t.prototype.onPreviousValidateEnd=function(t,i,r){var f=this,u;return i.status===1&&(u=this.getCellType(t.id),n.DelayRefresh.NeedDelayRun?n.DelayRefresh.setTimeout(function(){f.validateCell(u,r,i)},100):this.validateCell(u,r,i)),!1},t.prototype.validateCell=function(t,i,r){if(!t.hasDestroyed){t.onValidateError(r,!0);i&&n.ValidationMananger.showAndFocusCell(t)}},t.prototype.getCellType=function(t){return n.ForguncyData.pageInfo.pageElementManager.cells.getCell(t).cellType},t}();n.CommandFactory.registerCommand("Forguncy.Model.ValidateHelpCommand, ServerDesignerCommon",r)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__awaiter=this&&this.__awaiter||function(n,t,i,r){function u(n){return n instanceof i?n:new i(function(t){t(n)})}return new(i||(i=Promise))(function(i,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?i(n.value):u(n.value).then(o,s)}e((r=r.apply(n,t||[])).next())})},__generator=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=e[0]&2?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[e[0]&2,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i,e;return e={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e},Forguncy;(function(n){var t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.execute=function(){return this.switchLanguageCommand(this.CommandParam),n.CommandResult.completed},i.prototype.switchLanguageCommand=function(t){return __awaiter(this,void 0,void 0,function(){var r,i,u;return __generator(this,function(){return n.ForguncyData.GlobalSettings.MultipleLanguageSettings.EnableMultipleLanguage?(r=localStorage.getItem(n.Resource.ActiveLanguageKey),i=this.evaluateFormula(t.Language),r===i)?[2]:(u=n.ForguncyData.GlobalSettings.MultipleLanguageSettings.Languages.find(function(n){return n.Name==i}),u?n.MultipleLanguageStatusCacheHelper.setMultipleLanguageCacheDataAsync(i,function(){location.reload()}):alert(n.Common.format(n.RS.MultipleLanguage_SwitchLanguage_NotExistLanguage,i)),[2]):(alert(n.RS.MultipleLanguage_SwitchMultipleLanguage_ErrorMessage),[2])})})},i}(n.CommandBase);n.SwitchLanguageCommand=t;n.CommandFactory.registerCommand("Forguncy.Model.SwitchLanguageCommand, ServerDesignerCommon",t)})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var i=function(){function i(){}return i.showTooltip=function(r,u,f){f===void 0&&(f=null);n.DelayOperateHelper.Push(null,function(){var n=i.getToolTipElement($(r)),e=n.attr("data-original-title");e!==u&&(e!==undefined&&i.tooltip(n,t.destroy),n.attr("title",u));f==null&&i.updateTooltipPlacementLocation(n);i.tooltip(n,t.show,{placement:f!==null&&f!==void 0?f:n.attr("data-placement")})},2)},i.destroyTooltip=function(r){n.DelayOperateHelper.Push(null,function(){var n=i.getToolTipElement(r);i.tooltip(n,t.destroy)},2)},i.getToolTipElement=function(n){return $(n).closest("[data-trigger]")},i.tooltip=function(r,u,f){return r.each(function(){var e=$(this),r=e.data(i.DataKey);(!r||u!==t.show)&&(r||u!==t.destroy)&&(r||(r=new n.Tooltip(this,f),e.data(i.DataKey,r)),typeof u=="string"&&r[u]())})},i.setTooltipAttr=function(n,t){t===void 0&&(t=!1);n.addClass("red-tooltip");n.attr("data-trigger","manual");n.attr("data-placement","bottom");t||n.addClass("fgc-tooltip-normalcell")},i.updateTooltipPlacementLocation=function(n){var t,i=((t=n.offset())===null||t===void 0?void 0:t.top)>60?"top":"bottom";n.attr("data-placement",i)},i.DataKey="bs.tooltip",i}(),t;n.ValidationTooltipHelper=i;t=function(){function n(){}return n.show="show",n.destroy="destroy",n}()})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var t=GC.Spread.Sheets.ConditionalFormatting,i=function(){function i(){}return i.prototype.ConvertConditionRuleToSpreadJS=function(n,t,i,r,u){return u===void 0&&(u=0),this.ConvertConditionRuleToSpreadJSByRanges(n,t,[new GC.Spread.Sheets.Range(u,i,r,1)])},i.prototype.ConvertConditionRuleToSpreadJSByRanges=function(n,t,r){if(!t)return null;this._colStyleInfo=n;var u=null;switch(t.RuleType){case 1:u=this.GenerateCellValueRule(t);break;case 2:u=this.GenerateSpecificTextRule(t);break;case 3:u=this.GenerateDateOccurringRule(t);break;case 4:u=this.GenerateDuplicateRule(t);break;case 5:u=this.GenerateUniqueRule(t);break;case 6:u=i.GenerateTwoColorScaleRule(t);break;case 7:u=i.GenerateThreeColorScaleRule(t);break;case 8:u=this.GenerateTop10Rule(t);break;case 9:u=this.GenerateAverageRule(t);break;case 10:u=this.GenerateFormulaRule(t);break;case 11:u=i.GenerateIconSetRule(t);break;case 12:u=i.GenerateDataBarRule(t)}return u.stopIfTrue(!!t.StopIfTrue),u.ranges(r),u},i.prototype.ConvertResourceStringToFormula=function(t){if(n.ForguncyData.GlobalSettings.MultipleLanguageSettings.EnableMultipleLanguage&&n.Common.isMultiLanguageKeyWord(t)){var i=n.Common.getMultiLanguageWord(t);t='="'+i.replace(/"/g,'""')+'"'}return t},i.prototype.GenerateCellValueRule=function(n){var r=n.Params,u=i.ConvertComparisonOperator(r.Operator),f=this.GenerateStyle(n.StyleInfo);return(r.Operator==3||r.Operator==4)&&r.Value1&&(r.Value1=this.ConvertResourceStringToFormula(r.Value1)),new t.NormalConditionRule(t.RuleType.cellValueRule,[],f,u,r.Value1,r.Value2)},i.prototype.GenerateSpecificTextRule=function(i){var r=i.Params,u=this.GenerateStyle(i.StyleInfo);return r.Value&&(r.Value=n.Common.getMultiLanguageWord(r.Value)),new t.NormalConditionRule(t.RuleType.specificTextRule,[],u,r.Operator,null,null,r.Value)},i.prototype.GenerateDateOccurringRule=function(n){var i=n.Params,r=i.Operator,u=this.GenerateStyle(n.StyleInfo);return new t.NormalConditionRule(t.RuleType.dateOccurringRule,[],u,null,null,null,null,null,r)},i.prototype.GenerateDuplicateRule=function(n){var i=this.GenerateStyle(n.StyleInfo);return new t.NormalConditionRule(t.RuleType.duplicateRule,[],i)},i.prototype.GenerateUniqueRule=function(n){var i=this.GenerateStyle(n.StyleInfo);return new t.NormalConditionRule(t.RuleType.uniqueRule,[],i)},i.GenerateTwoColorScaleRule=function(r){var u=r.Params,f=i.ConvertScaleValueType(u.MinimumType),e=i.ConvertScaleValueType(u.MaximumType);return new t.ScaleRule(t.RuleType.twoScaleRule,f,u.MinimumValue,n.ColorHelper.Convert(u.MinimumColor),null,null,null,e,u.MaximumValue,n.ColorHelper.Convert(u.MaximumColor),[])},i.GenerateThreeColorScaleRule=function(r){var u=r.Params,f=i.ConvertScaleValueType(u.MinimumType),e=i.ConvertScaleValueType(u.MidpointType),o=i.ConvertScaleValueType(u.MaximumType);return new t.ScaleRule(t.RuleType.threeScaleRule,f,u.MinimumValue,n.ColorHelper.Convert(u.MinimumColor),e,u.MidpointValue,n.ColorHelper.Convert(u.MidpointColor),o,u.MaximumValue,n.ColorHelper.Convert(u.MaximumColor),[])},i.GenerateIconSetRule=function(n){var f=n.Params,h=i.ConvertIconSetType(f.IconSetType),e=new t.IconSetRule(h,[]),s,o,r,u;if(e.showIconOnly(f.ShowIconOnly),e.reverseIconOrder(f.ReverseIconOrder),s=e.iconCriteria(),o=s.length,o>=2&&o<=4)for(r=0;r<o;r++)u=f.IconCriteria.$values,s[r]=new t.IconCriterion(u[r].IsGreaterThanOrEqualTo===undefined?!1:u[r].IsGreaterThanOrEqualTo,i.ConvertIconValueType(u[r].IconValueType),u[r].Value===undefined?0:u[r].Value);return e},i.GenerateDataBarRule=function(r){var u=r.Params,e=i.ConvertScaleValueType(u.MaximumType),o=i.ConvertScaleValueType(u.MinimumType),f=new t.DataBarRule(o,u.MinimumValue,e,u.MaximumValue,n.ColorHelper.Convert(u.Color),[]);return f.gradient(u.Gradient),f.axisColor(n.ColorHelper.Convert(u.AxisColor)),f.axisPosition(i.ConvertDataBarAxisPosition(u.AxisPosition)),f.borderColor(n.ColorHelper.Convert(u.BorderColor)),f.negativeBorderColor(n.ColorHelper.Convert(u.NegativeBorderColor)),f.negativeFillColor(n.ColorHelper.Convert(u.NegativeFillColor)),f.showBarOnly(u.ShowBarOnly),f.showBorder(u.ShowBorder),f.useNegativeBorderColor(u.UseNegativeBorderColor),f.useNegativeFillColor(u.UseNegativeFillColor),f.dataBarDirection(i.ConvertDataBarDirection(u.DataBarDirection)),f},i.prototype.GenerateTop10Rule=function(n){var i=n.Params,r=this.GenerateStyle(n.StyleInfo);return new t.NormalConditionRule(t.RuleType.top10Rule,[],r,null,null,null,null,null,i.Operator,i.Rank)},i.prototype.GenerateAverageRule=function(n){var r=n.Params,u=this.GenerateStyle(n.StyleInfo);return new t.NormalConditionRule(t.RuleType.averageRule,[],u,null,null,null,null,null,i.ConvertAverageRuleType(r.Operator))},i.ConvertAverageRuleType=function(n){switch(n){case 0:return t.AverageConditionType.above;case 4:return t.AverageConditionType.above1StdDev;case 6:return t.AverageConditionType.above2StdDev;case 8:return t.AverageConditionType.above3StdDev;case 1:return t.AverageConditionType.below;case 5:return t.AverageConditionType.below1StdDev;case 7:return t.AverageConditionType.below2StdDev;case 9:return t.AverageConditionType.below3StdDev;case 2:return t.AverageConditionType.equalOrAbove;case 3:return t.AverageConditionType.equalOrBelow}},i.prototype.GenerateFormulaRule=function(n){var i=n.Params,r=this.GenerateStyle(n.StyleInfo);return new t.NormalConditionRule(t.RuleType.formulaRule,[],r,null,null,null,null,i.Formula)},i.ConvertScaleValueType=function(n){switch(n){case 8:return t.ScaleValueType.automax;case 6:return t.ScaleValueType.automin;case 7:return t.ScaleValueType.formula;case 3:return t.ScaleValueType.highestValue;case 2:return t.ScaleValueType.lowestValue;case 1:return t.ScaleValueType.number;case 4:return t.ScaleValueType.percent;case 5:return t.ScaleValueType.percentile}},i.ConvertIconValueType=function(n){switch(n){case 7:return t.IconValueType.formula;case 1:return t.IconValueType.number;case 4:return t.IconValueType.percent;case 5:return t.IconValueType.percentile}},i.ConvertIconSetType=function(n){switch(n){case 15:return t.IconSetType.fiveArrowsColored;case 16:return t.IconSetType.fiveArrowsGray;case 19:return t.IconSetType.fiveBoxes;case 18:return t.IconSetType.fiveQuarters;case 17:return t.IconSetType.fiveRatings;case 10:return t.IconSetType.fourArrowsColored;case 11:return t.IconSetType.fourArrowsGray;case 13:return t.IconSetType.fourRatings;case 12:return t.IconSetType.fourRedToBlack;case 14:return t.IconSetType.fourTrafficLights;case 0:return t.IconSetType.threeArrowsColored;case 1:return t.IconSetType.threeArrowsGray;case 4:return t.IconSetType.threeFlags;case 7:return t.IconSetType.threeSigns;case 3:return t.IconSetType.threeStars;case 8:return t.IconSetType.threeSymbolsCircled;case 9:return t.IconSetType.threeSymbolsUncircled;case 6:return t.IconSetType.threeTrafficLightsRimmed;case 5:return t.IconSetType.threeTrafficLightsUnrimmed;case 2:return t.IconSetType.threeTriangles}},i.ConvertDataBarAxisPosition=function(n){switch(n){case 0:return t.DataBarAxisPosition.automatic;case 1:return t.DataBarAxisPosition.cellMidPoint;case 2:return t.DataBarAxisPosition.none}},i.ConvertDataBarDirection=function(n){switch(n){case 0:return t.BarDirection.leftToRight;case 1:return t.BarDirection.rightToLeft}},i.ConvertComparisonOperator=function(n){switch(n){case 1:return t.ComparisonOperators.between;case 2:return t.ComparisonOperators.notBetween;case 3:return t.ComparisonOperators.equalsTo;case 4:return t.ComparisonOperators.notEqualsTo;case 5:return t.ComparisonOperators.greaterThan;case 6:return t.ComparisonOperators.lessThan;case 7:return t.ComparisonOperators.greaterThanOrEqualsTo;case 8:return t.ComparisonOperators.lessThanOrEqualsTo}},i.prototype.GenerateStyle=function(t){var i,u,r;return n.Common.IsEmpty(t)?null:(i=n.Common.clone(t),this._colStyleInfo&&(u=this._colStyleInfo,i.FontStyle===n.StaticValues.Font_Normal&&(i.FontStyle=u.FontStyle),i.FontWeight===n.StaticValues.Font_Normal&&(i.FontWeight=u.FontWeight),n.Common.IsEmpty(i.Underline)&&(i.Underline=u.Underline),n.Common.IsEmpty(i.Strikethrough)&&(i.Strikethrough=u.Strikethrough)),r=n.ListViewHelper.SpreadJSStyleHelper.generateStyleObject(i),delete r.wordWrap,delete r.hAlign,delete r.vAlign,delete r.textIndent,n.Common.IsEmpty(t.Underline)&&n.Common.IsEmpty(t.Strikethrough)&&delete r.textDecoration,r)},i}();n.ConditionFormatRuleHelper=i})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var v=function(){function n(){}return n}(),t,i,r,u,f,e,o,s,h,c,l,a;n.ConditionalFormattingMetadata=v;t=function(){function n(){}return n}();n.ConditionRuleModel=t;i=function(){function n(){}return n}();n.CellValueRuleParam=i;r=function(){function n(){}return n}();n.SpecificTextRuleParam=r;u=function(){function n(){}return n}();n.DateOccurringRuleParam=u;f=function(){function n(){}return n}();n.TwoColorScaleRuleParam=f;e=function(){function n(){}return n}();n.ThreeColorScaleRuleParam=e;o=function(){function n(){}return n}();n.IconSetRuleParam=o;s=function(){function n(){}return n}();n.DataBarRuleParam=s;h=function(){function n(){}return n}();n.IconCriterion=h;c=function(){function n(){}return n}();n.Top10RuleParam=c;l=function(){function n(){}return n}();n.AverageRuleParam=l;a=function(){function n(){}return n}();n.FormulaRuleParam=a})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var t=function(){function t(n){this._runTimePageName=n;this._dependences=[];this._dependenceListviews=[]}return t.prototype.getDependences=function(){return this._dependences},Object.defineProperty(t.prototype,"dependenceListviews",{get:function(){return this._dependenceListviews},enumerable:!1,configurable:!0}),t.prototype.HandleFormulaInConditionFormat=function(n){var t=n.Params;switch(n.RuleType){case 1:this.HandleCellValueRuleParam(t);break;case 2:this.HandleSpecificTextRuleParam(t);break;case 6:this.HandleTwoColorScaleRuleParam(t);break;case 7:this.HandleThreeColorScaleRuleParam(t);break;case 10:this.HandleFormulaRuleParam(t);break;case 11:this.HandleIconSetRuleParam(t);break;case 12:this.HandleDataBarRuleParam(t)}},t.prototype.HandleCellValueRuleParam=function(n){this.HandleFormula(n,"Value1");this.HandleFormula(n,"Value2")},t.prototype.HandleSpecificTextRuleParam=function(n){this.HandleFormula(n,"Value")},t.prototype.HandleTwoColorScaleRuleParam=function(n){this.HandleFormula(n,"MaximumValue");this.HandleFormula(n,"MinimumValue")},t.prototype.HandleThreeColorScaleRuleParam=function(n){this.HandleFormula(n,"MaximumValue");this.HandleFormula(n,"MinimumValue");this.HandleFormula(n,"MidpointValue")},t.prototype.HandleIconSetRuleParam=function(n){for(var i=n.IconCriteria.$values,t=0;t<i.length;t++)this.HandleFormula(i[t],"Value")},t.prototype.HandleDataBarRuleParam=function(n){this.HandleFormula(n,"MaximumValue");this.HandleFormula(n,"MinimumValue")},t.prototype.HandleFormulaRuleParam=function(n){this.HandleFormula(n,"Formula")},t.prototype.HandleFormula=function(t,i){var e=t[i],r,u;if(typeof e=="string"&&(r=e,r=r.trim(),r.length>0&&r[0]==="="))try{var o=n.FormulaHelper.parse(r),f=this,s=this.adjustFormula(o,function(n){return f.adjustCellExpression(n)},function(n){return f.adjustRangeExpression(n)},function(n){return f.adjustNameExpression(n)});s!==o?(u=n.FormulaHelper.unparse(s),u="="+u,t[i]=u,this._dependences.push(u)):this._dependences.push(r)}catch(h){}},t.prototype.adjustCellExpression=function(t){var i=n.Common.getLocatedListview(this._runTimePageName,t.row,t.column),r,f,u;return i&&n.SpreadJSView&&i instanceof n.SpreadJSView?(f=i.getConditionFormatCalcSourceName(),r=n.ForguncyData.pageInfo.formulaManager.getCalcSource(f),u=i.getContentRangeInfo(),t.row=t.row-u.Row,t.column=t.column-u.Column,this._dependenceListviews.indexOf(i.getCalcSheetName())===-1&&this._dependenceListviews.push(i.getCalcSheetName())):r=n.ForguncyData.pageInfo.formulaManager.getCalcSource(this._runTimePageName),n.FormulaHelper.createCellExpression(r,null,t.row,t.column,t.rowRelative,t.columnRelative)},t.prototype.adjustRangeExpression=function(t){var i=n.Common.getLocatedListview(this._runTimePageName,t.row,t.column),u,r;return i?(u=n.ForguncyData.pageInfo.formulaManager.getCalcSource(i.getCalcSheetName()),r=i.getContentRangeInfo(),t.row=t.row-r.Row,t.column=t.column-r.Column,t.endRow=t.endRow-r.Row,t.endColumn=t.endColumn-r.Column,this._dependenceListviews.indexOf(i.getCalcSheetName())===-1&&this._dependenceListviews.push(i.getCalcSheetName())):u=n.ForguncyData.pageInfo.formulaManager.getCalcSource(this._runTimePageName),n.FormulaHelper.createRangeExpression(u,null,t.row,t.column,t.endRow,t.endColumn,t.rowRelative,t.columnRelative,t.endRowRelative,t.endColumnRelative)},t.prototype.adjustNameExpression=function(n){return n},t.prototype.adjustFormula=function(t,i,r,u){var e,f,o,a;if(!t)return t;if(e=this,f=GC.Spread.CalcEngine.ExpressionType,t.type===f.operator){var s=t,v=s.value,y=s.value2,p=e.adjustFormula(v,i,r,u),w=e.adjustFormula(y,i,r,u);if(v!==p||y!==w)return n.FormulaHelper.createOperatorExpression(s.operatorType,p,w)}else if(t.type===f.function){var h=t,b=[],c=void 0,l=!1;for(o=0;o<h.arguments.length;o++)c=h.arguments[o],a=e.adjustFormula(c,i,r,u),l=l||c!==a,b.push(a);if(l)return n.FormulaHelper.createFunctionExpression(h,b)}else{if(t.type===f.reference)return n.FormulaHelper.isCellExpression(t)?i(t):r(t);if(t.type===f.parentheses){var g=t,k=g.value,d=e.adjustFormula(k,i,r,u);if(k!==d)return n.FormulaHelper.createParenthesesExpression(d)}else if(t.type===f.name)return u(t)}return t},t}();n.ConditionFormatFormulaHelper=t})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){function ui(t,i,r,u,f,e){n.Common.IsEmpty(u)&&typeof t=="object"&&(n.Common.IsEmpty(r)||typeof r=="function")&&(n.Common.IsEmpty(i)||typeof i=="function")?n.SendMailCommand.sendMailMessage(t,i,r):n.Common.IsEmpty(e)===!1?n.SendMailCommand.sendMail(t,i,r,u,f,e):typeof u=="string"?n.SendMailCommand.sendMail(t,i,r,u,f,e):n.SendMailCommand.sendMail("",t,i,r,u,f)}function fi(t){try{return n.Convertor.fromOADateToDate(t)}catch(i){n.ErrorHelper.printJavascriptAIPError("OADate","ConvertOADateToDate",i)}}function ei(t){try{return n.Convertor.fromDateToOADate(t)}catch(i){n.ErrorHelper.printJavascriptAIPError("OADate","ConvertDateToOADate",i)}}function oi(t){return n.ColorHelper.Convert(t)}var i="rowIndex",o="fn",d="getCell",at="getListView",vt="getCellArray",w="getValue",c="setValue",e="bind",l="unbind",yt="selectRow",st="addNewRow",pt="executeCommand",wt="getVariableValue",bt="setVariableValue",kt="getAllVariableValues",r="Page",a="CommandHelper",f="Cell",u="ListView",t=function(n){return n=String(n),n.toLowerCase()},s=function(t,i,r,u){return typeof t!="function"?(n.ErrorHelper.printJavascriptAIPError(i,r,n.Common.format(n.RS.InvalidFunctionParam,u)),!1):!0},dt=function(){function n(){}return n.Loaded="loaded",n.PageDefaultDataLoaded="pagedefaultdataloaded",n.PopupClosed="popupclosed",n}(),g,nt,ht,v,ct,b,k,y,tt,it,rt,ut,p,ft,h,et,gt,ni,ti,ii,ri,ot,lt;n.PageEvents=dt;g=function(){function i(){this._supportedForguncyEvents=["loaded","pagedefaultdataloaded","popupclosed"];this._elements=new v}return i.prototype._getRunTimePageNames=function(t){return t?null:[n.ForguncyData.pageInfo.runTimeNormalPage,n.ForguncyData.pageInfo.runTimeMasterPage]},i.prototype.getCell=function(t,i,r){var u,f,e;return(i===void 0&&(i=!0),r===void 0&&(r=!0),f=(u=n.ForguncyData.commandExecutor.getCommandExecuteInfo())===null||u===void 0?void 0:u.runTimePageName,f&&(e=this._elements.getCell(t,[f],!1),e))?e:this._elements.getCell(t,this._getRunTimePageNames(i),r)},i.prototype.getCellByLocation=function(n,t){return t===void 0&&(t=!0),this._elements.getCellByLocation(n,t)},i.prototype.getCellArray=function(n,t){return t===void 0&&(t=!0),this._elements.getCellArray(n,this._getRunTimePageNames(t))},i.prototype.getContainerCells=function(n){return n===void 0&&(n=!0),this._elements.getContainerCells(this._getRunTimePageNames(n))},i.prototype.getSubPageInfoByPageID=function(t){var i,r;return this._getRunTimePageNames(!1).indexOf(t)>=0?null:(i=n.PageManager.getContainerCell(t),!i||!i.cellType)?null:(r=this._elements._getCellByPageCell([i])[0],!r)?null:r.getSubPageByPageID(t)},i.prototype.getListView=function(t,i){var r,u,f;return(i===void 0&&(i=!0),u=(r=n.ForguncyData.commandExecutor.getCommandExecuteInfo())===null||r===void 0?void 0:r.runTimePageName,u&&(f=this._elements.getListView(t,[u],!0),f))?f:this._elements.getListView(t,this._getRunTimePageNames(i))},i.prototype.getListViews=function(n){return n===void 0&&(n=!0),this._elements.getListViews(this._getRunTimePageNames(n))},i.prototype.recalc=function(){n.FormulaManager.isReady()&&(n.CustomFunction.ODataFunction.clearCache(null,!1),n.ForguncyData.pageInfo.formulaManager.recalc(!0))},i.prototype.suspendCalc=function(){n.FormulaManager.isReady()&&n.ForguncyData.pageInfo.formulaManager.suspend()},i.prototype.resumeCalc=function(){n.FormulaManager.isReady()&&n.ForguncyData.pageInfo.formulaManager.resume(!0)},i.prototype.reloadBindingData=function(t){n.NormalCellBindingManager.reloadData(t,!0)},i.prototype.getUserName=function(){return n.ForguncyData.userInfo.UserName},i.prototype.getUserInfo=function(){return n.ForguncyData.userInfo},i.prototype.getPageName=function(){return n.ForguncyData.pageInfo.pageName},i.prototype.getPageTitle=function(){return n.ForguncyData.pageInfo.pageTitle},i.prototype.getMasterPageName=function(){return n.ForguncyData.pageInfo.masterPageName},i.prototype.setCurrentRow=function(t){n.ForguncyData.pageInfo&&n.ForguncyData.pageInfo.currentRowInfoCollection&&n.ForguncyData.pageInfo.currentRowInfoCollection.setCurrentRowInfoByAPI(t)},i.prototype._init=function(){this._elements.destroy();this._elements=new v;delete this._valueChangedEventHandler},i.prototype._pushCurrentState=function(){i._stateStack.push(this._elements);this._elements=new v},i.prototype._popupState=function(){i._stateStack.length!==0&&(this._init(),this._elements=i._stateStack.pop())},i.prototype._clearState=function(){i._stateStack.forEach(function(n){return n.destroy()});i._stateStack=[]},i.prototype.ready=function(n){this.bind("loaded",null,n)},i.prototype.bind=function(u,f,h,c){var v=t(u),l,a;this._checkEventType(v,u,e)&&(arguments.length===2?(h=f,f=undefined):arguments.length===3&&typeof f=="function"&&(c=h,h=f,f=undefined),s(h,r,e,o))&&(l=n.Common.IsEmpty(c)||typeof c!="string"?n.ForguncyData.pageInfo?n.ForguncyData.pageInfo.pageName:null:c,a={eventType:v,data:f,fn:h},l?(i._userEvents[l]||(i._userEvents[l]=[]),i._userEvents[l].push(a)):(this._tempReadyEvents||(this._tempReadyEvents=[]),this._tempReadyEvents.push(a)))},i.prototype.unbind=function(u,f,h){var w=t(u),v,y,c,a,p;if(this._checkEventType(w,u,l)&&(v=arguments.length===1||n.Common.IsEmpty(f),v!==!1||s(f,r,e,o))&&(y=n.Common.IsEmpty(h)||typeof h!="string"?n.ForguncyData.pageInfo.pageName:h,c=y?i._userEvents[y]:this._tempReadyEvents,c))for(a=c.length-1;a>=0;a--)p=c[a],p.eventType===w&&(v||p.fn===f)&&c.splice(a,1)},i.prototype.unbindAll=function(t){var r=n.Common.IsEmpty(t)||typeof t!="string"?n.ForguncyData.pageInfo.pageName:t;r?i._userEvents[r]=[]:this._tempReadyEvents=[]},i.prototype._setTempReadyEvents=function(){var r=n.ForguncyData.pageInfo.pageName,t;r&&(this._tempReadyEvents&&this._tempReadyEvents.length>0&&(t=i._userEvents[r],t=t&&t.length>0?this._tempReadyEvents.concat(t):this._tempReadyEvents,i._userEvents[r]=t),this._tempReadyEvents=null)},i.prototype._trigger=function(t){var r=this;this._setTempReadyEvents();t=t.toLowerCase();t!=="loaded"||this._valueChangedEventHandler||(this._valueChangedEventHandler=function(n,t){r._onCellValueChanged(t)},n.ForguncyData.pageInfo.dataModel.normalCellDataModel.bind("valuechanged",this._valueChangedEventHandler));this._triggerUserEvents(i._userEvents[n.ForguncyData.pageInfo.pageName],t);this._triggerUserEvents(i._userEvents["*"],t)},i.prototype._triggerUserEvents=function(t,i){var f,e,u,r;if(t)for(f=t.map(function(n){return n}),e=f.length,u=0;u<e;u++)r=f[u],r.eventType===i&&r.fn({data:r.data===undefined?null:r.data},{pageName:n.ForguncyData.pageInfo.pageName})},i.prototype._checkEventType=function(t,i,u){return this._supportedForguncyEvents.indexOf(t)===-1?(n.ErrorHelper.printJavascriptAIPError(r,u,n.Common.format(n.RS.NotSupportEventForPage,i,r)),!1):!0},i.prototype._onCellValueChanged=function(n){var t=this._elements.getExistingCellById(n.id);t!==null&&t.trigger("valuechanged",{oldValue:n.oldValue,newValue:n.newValue})},Object.defineProperty(i.prototype,"AutoDisconnectTimeout",{get:function(){return n.ForguncyData.AutoDisconnectTimeout},set:function(t){n.ForguncyData.AutoDisconnectTimeout=t},enumerable:!1,configurable:!0}),i._userEvents={},i._stateStack=[],i}();n.ForguncyPage=g;nt=function(){function i(){}return i.prototype.executeCellCommand=function(i,r){var f=t(i),u=n.ForguncyData.pageInfo.pageElementManager.cells.getCellByName(f,!0,null);if(u===null){n.ErrorHelper.printJavascriptAIPError(a,d,n.Common.format(n.RS.CannotFindCell,i));return}if(!u.commands){n.ErrorHelper.printJavascriptAIPError(a,pt,n.Common.format(n.RS.CannotFindCommandInCell,i));return}n.ForguncyData.commandExecutor.executeCommand(u.commands,{runTimePageName:u.runTimePageName,commandTrigger:u.cellType,commandID:u.id,eventType:"Api",callbackOnCommandCompleted:r?function(){return r()}:undefined})},i.prototype.getVariableValue=function(t){var i=n.ForguncyData.parameterManager.getCurrent();return i||n.ErrorHelper.printJavascriptAIPError(a,wt,n.RS.CannotUseCommandParameterInCurrentContext),n.ForguncyData.parameterManager.getValue(t)},i.prototype.setVariableValue=function(t,i){var r=n.ForguncyData.parameterManager.getCurrent();return r||n.ErrorHelper.printJavascriptAIPError(a,bt,n.RS.CannotUseCommandParameterInCurrentContext),n.ForguncyData.parameterManager.setValue(t,i)},i.prototype.getAllVariableValues=function(){var t=n.ForguncyData.parameterManager.getCurrent();return t||n.ErrorHelper.printJavascriptAIPError(a,kt,n.RS.CannotUseCommandParameterInCurrentContext),t},i}();n.ForguncyCommandHelper=nt;ht=function(){function t(){}return t.setCurrentRowByProcessTask=function(t){n.ForguncyData.pageInfo&&n.ForguncyData.pageInfo.currentRowInfoCollection&&n.ForguncyData.pageInfo.currentRowInfoCollection.setCurrentRowInfoByProessTaskId(t)},t}();n.ForguncyInternalPage=ht;v=function(){function i(){this._listViews=null;this._cells=null}return i.prototype.getExistingCellById=function(n){var i,t;if(this._cells){for(i=this._cells.length,t=0;t<i;t++)if(this._cells[t]._getCellId()===n)return this._cells[t]}else this._cells=[];return null},i.prototype._createCell=function(t){var i;return t.runTimePageName&&n.Page.getSubPageInfoByPageID(t.runTimePageName),i=t.cellType instanceof n.ContentContainerCellType?new tt(t):t.cellType instanceof n.UserControlPageCellType?new it(t):t.cellType instanceof n.TabControlCellType?new rt(t):t.cellType instanceof n.RepeaterCellType?new ut(t):new b(t),this._cells===null&&(this._cells=[]),this._cells.push(i),i},i.prototype.getCell=function(i,u,f){var s,e,o;return(f===void 0&&(f=!0),s=t(i),e=n.ForguncyData.pageInfo.pageElementManager.cells.getCellByName(s,!0,u),e===null)?(f&&n.ErrorHelper.printJavascriptAIPError(r,d,n.Common.format(n.RS.CannotFindCell,i)),null):(o=this.getExistingCellById(e.id),o!==null)?o:this._createCell(e)},i.prototype.getCellByLocation=function(t,i,u){var e=this,o,f;return(i===void 0&&(i=!0),!t)?null:(o=u!==null&&u!==void 0?u:[this._getRunTimePageName(t)],f=[],o.forEach(function(){var h=e._getRunTimePageName(t),u,o,s;if(!n.Common.IsEmpty(h)){if(u=n.Common.getIdStr(t.Row,t.Column,h),o=e.getExistingCellById(u),o!==null){f.push(o);return}if(s=n.ForguncyData.pageInfo.pageElementManager.cells.getCell(u),s===null){i&&n.ErrorHelper.printJavascriptAIPError(r,d,n.Common.format(n.RS.CannotFindCellById,u));return}f.push(e._createCell(s))}}),f.length>0?f[0]:null)},i.prototype._getRunTimePageName=function(t){if(t.PageID)return t.PageID;var i="";return t.PageName&&(i=n.PageManager.getRunTimePageName(t.PageName)),n.Common.IsEmpty(i)?n.ForguncyData.pageInfo.runTimeNormalPage:i},i.prototype.getCellArray=function(i,u){var e=t(i),f=n.ForguncyData.pageInfo.pageElementManager.cells.getCellsByName(e,!0,u);return!f||f.length===0?(n.ErrorHelper.printJavascriptAIPError(r,vt,n.Common.format(n.RS.CannotFindCell,i)),null):this._getCellByPageCell(f)},i.prototype._getCellByPageCell=function(n){var t=this,i=this;return n.map(function(n){var r=t.getExistingCellById(n.id);return r!==null?r:i._createCell(n)})},i.prototype.getContainerCells=function(t){var i=n.ForguncyData.pageInfo.pageElementManager.cells.getAllContainerCells(t);return this._getCellByPageCell(i)},i.prototype.getListView=function(i,u,f){for(var o,h=t(i),c=this.getListViews(u),e=0,s=c;e<s.length;e++)if(o=s[e],o.getName().toLowerCase()===h)return o;return f||n.ErrorHelper.printJavascriptAIPError(r,at,n.Common.format(n.RS.CannotFindListview_Log,i)),null},i.prototype.getListViews=function(t){var i=this,r=n.ListviewBase.getAllListviews(t);return r.map(function(n){return i._getListviewAPIObject(n)})},i.prototype._getListviewAPIObject=function(n){var t=this._getExistingListview(n.getCalcSheetName());return t?t:this._createListview(n)},i.prototype._getExistingListview=function(n){var i,t;if(this._listViews)for(i=this._listViews.length,t=0;t<i;t++)if(this._listViews[t]._getUniqueID()===n)return this._listViews[t];return null},i.prototype._createListview=function(n){this._listViews===null&&(this._listViews=[]);var t=new et(n);return this._listViews.push(t),t},i.prototype.destroy=function(n){this._listViews&&(this._listViews.filter(function(t){return!n||n.indexOf(t.getRunTimePageName())>=0}).forEach(function(n){return n.unbindAll()}),this._listViews=n?this._listViews.filter(function(t){return n.indexOf(t.getRunTimePageName())===-1}):null);this._cells&&(this._cells.filter(function(t){return!n||n.indexOf(t._getPageID())>=0}).forEach(function(n){return n.unbindAll()}),this._cells=n?this._cells.filter(function(t){return n.indexOf(t._getPageID())===-1}):null)},i}();n.APIPageElements=v;ct=function(){function n(){}return n.ValueChanged="valuechanged",n.Click="click",n.MouseEnter="mouseenter",n.MouseLeave="mouseleave",n.SelectionChanged="selectionchanged",n.PivottableClick="pivottableclick",n}();n.CellEvents=ct;b=function(i){function r(n){var t=i.call(this)||this;return t._pageCell=n,t}return __extends(r,i),r.prototype._getPageID=function(){return this._pageCell.runTimePageName},r.prototype._getCellId=function(){return this._pageCell.id},r.prototype.getValue=function(){return n.ForguncyData.pageInfo.dataModel.normalCellDataModel.getValue(this._pageCell.id)},r.prototype.setValue=function(t){if(!this._pageCell.cellType.allowSetValueByUser){n.ErrorHelper.printJavascriptAIPError(f,c,n.Common.format(n.RS.NotSupportSetValue,this.getCellName()));return}var i=this.getValue();(t===undefined&&(t=null),n.Common.equals(i,t))||n.ForguncyData.pageInfo.dataModel.normalCellDataModel.setValue(this._pageCell.id,{newValue:t},7)},r.prototype.getCellName=function(){return this._pageCell.name&&this._pageCell.name.length>0?this._pageCell.name[0]:n.Common.getA1ReferenceString(this._pageCell.row,this._pageCell.column,!0,!0)},r.prototype.setText=function(n){n===undefined&&(n=null);var t=this._pageCell.cellType.getValueFromListviewText(n);this.setValue(t)},r.prototype.setVisible=function(n){this._pageCell.setVisible(n)},r.prototype.hide=function(){this.setVisible(!1)},r.prototype.show=function(){this.setVisible(!0)},r.prototype.setBackColor=function(n){this._pageCell.setBackColor(n)},r.prototype.setForeColor=function(n){this._pageCell.setForeColor(n)},r.prototype.disable=function(){this._pageCell.disable()},r.prototype.enable=function(){this._pageCell.enable()},r.prototype.setReadOnly=function(n){this._pageCell.setReadOnly(n)},r.prototype.hasFocus=function(){var n=this._pageCell.cellType;return n?n.hasFocus():!1},r.prototype.setFocus=function(){var n=this._pageCell.cellType;n&&n.setFocus()},r.prototype.getControl=function(){return this._pageCell.cellType.getControl()},r.prototype.bind=function(r,u,h){if(arguments.length===2&&(h=u,u=undefined),s(h,f,e,o)){var c=t(r);c==="valuechanged"||this._pageCell.cellType.supportedEvents.indexOf(c)>=0?(i.prototype.bind.call(this,c,u,h),c!=="valuechanged"&&this._pageCell.cellType.bind(c,u,h)):n.ErrorHelper.printJavascriptAIPError(f,e,n.Common.format(n.RS.NotSupportEventForCellOrListview,r,f,this.getCellName()))}},r.prototype.unbind=function(r,u){var h=arguments.length===1,e;(h!==!1||s(u,f,l,o))&&(e=t(r),e==="valuechanged"||this._pageCell.cellType.supportedEvents.indexOf(e)>=0?(i.prototype.unbind.call(this,e,u),e!=="valuechanged"&&this._pageCell.cellType.unbind(e,u)):n.ErrorHelper.printJavascriptAIPError(f,l,n.Common.format(n.RS.NotSupportEventForCellOrListview,r,f,this.getCellName())))},r.prototype.unbindAll=function(){for(var n,r=this._events.length,t=0;t<r;t++)n=this._events[t],this._pageCell.cellType.supportedEvents.indexOf(n.eventType)>=0&&this._pageCell.cellType.unbind(n.eventType,n.fn);i.prototype.unbindAll.call(this)},r.prototype.getCellType=function(){return this._pageCell.cellType},r}(n.EventClassBase);n.Cell=b;k=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t}(b);n.ContainerCellBase=k;y=function(n){function t(t){var r=n.call(this,t)||this,i;return r._subPages=[],i=r,i._cellType=t.cellType,i._cellType.bind("pageingInfoChanged",function(n,t){i._updateSubPage(t.tabIndex)}),i._cellType.subPageInfos.forEach(function(n,t){return i._updateSubPage(t)}),r}return __extends(t,n),t.prototype._updateSubPage=function(n){n===void 0&&(n=0);this._subPages[n]||(this._subPages[n]=new p(null,null));var t=this._subPages[n],i=this._cellType.subPageInfos[n],r=i?i.runTimeNormalPageName:null,u=i?i.runTimeMasterPageName:null;(r!==t.runTimeNormalPageName||u!==t.runTimeMasterPageName)&&(t.destroy(),t.runTimeNormalPageName=r,t.runTimeMasterPageName=u)},t.prototype._getSubPage=function(n){return n===void 0&&(n=0),this._subPages[n]||(this._subPages[n]=new p(null,null)),this._subPages[n]},t.prototype.getSubPageByPageID=function(n){var t=this._subPages.filter(function(t){return t.runTimeMasterPageName===n||t.runTimeNormalPageName===n});return t.length>0?t[0]:null},t}(k);n.SubPageContainerCellBase=y;tt=function(n){function t(t){return n.call(this,t)||this}return __extends(t,n),t.prototype.getContentPage=function(){return this._getSubPage(0)},t}(y);n.ContentContainerCell=tt;it=function(n){function t(t){return n.call(this,t)||this}return __extends(t,n),t.prototype.getContentPage=function(){return this._getSubPage(0)},t}(y);n.UserControlPageCell=it;rt=function(n){function t(t){return n.call(this,t)||this}return __extends(t,n),t.prototype.getTabPage=function(n){return this._getSubPage(n)},t.prototype.showTab=function(n){this._cellType&&this._cellType.showTab(n)},t.prototype.getActiveTabIndex=function(){return this._cellType?this._cellType.getActiveTabIndex():-1},t.prototype.getTabCount=function(){return this._cellType?this._cellType.getTabCount():0},t}(y);n.TabControlCell=rt;ut=function(t){function i(n){var r=t.call(this,n)||this,i;return r._subPages=[],i=r,i._cellType=n.cellType,i._cellType.bind("subpagechanged",function(){i.removeSubPage()}),r}return __extends(i,t),i.prototype.removeSubPage=function(){var t=this;this._subPages.filter(function(n){return!t._cellType.containRunTimePage(n.runTimeNormalPageName)}).forEach(function(n){n.destroy();n.runTimeNormalPageName=null});this._subPages=this._subPages.filter(function(t){return!n.Common.IsEmpty(t.runTimeNormalPageName)})},i.prototype.getSubPageByPageID=function(n){var t=this._subPages.filter(function(t){return t.runTimeNormalPageName===n}),i;return t&&t.length>0?t[0]:this._cellType.containRunTimePage(n)?(i=new ft(n),this._subPages.push(i),i):null},i}(k);n.RepeaterCell=ut;p=function(){function t(n,t){this.runTimeNormalPageName=n;this.runTimeMasterPageName=t}return t.prototype._getRunTimePageNames=function(){return[this.runTimeNormalPageName,this.runTimeMasterPageName].filter(function(t){return!n.Common.IsEmpty(t)})},t.prototype.getCell=function(t){return n.Page._elements.getCell(t,this._getRunTimePageNames())},t.prototype.getCellByLocation=function(t,i){return i===void 0&&(i=!0),n.Page._elements.getCellByLocation(t,i,this._getRunTimePageNames())},t.prototype.getCellArray=function(t){return n.Page._elements.getCellArray(t,this._getRunTimePageNames())},t.prototype.getContainerCells=function(){return n.Page._elements.getContainerCells(this._getRunTimePageNames())},t.prototype.getListView=function(t){return n.Page._elements.getListView(t,this._getRunTimePageNames())},t.prototype.getListViews=function(){return n.Page._elements.getListViews(this._getRunTimePageNames())},t.prototype.getPageName=function(){return n.Common.IsEmpty(this.runTimeNormalPageName)?null:n.PageManager.getDesignerPageName(this.runTimeNormalPageName,!1)},t.prototype.getPageTitle=function(){return n.Common.IsEmpty(this.runTimeNormalPageName)?null:n.PageManager.getDesignerPageTitle(this.runTimeNormalPageName)},t.prototype.getMasterPageName=function(){return n.Common.IsEmpty(this.runTimeMasterPageName)?null:n.PageManager.getDesignerPageName(this.runTimeMasterPageName,!1)},t.prototype.destroy=function(){n.Page._elements.destroy(this._getRunTimePageNames())},t}();n.SubPage=p;ft=function(n){function t(t){return n.call(this,t,null)||this}return __extends(t,n),t.prototype.getPageName=function(){return null},t.prototype.getPageTitle=function(){return null},t}(p);n.TemplatePage=ft;h=function(){function n(){}return n.Reloaded="reloaded",n.SelectionChanged="selectionchanged",n.SelectedRowsChanged="selectedrowschanged",n.ValueChanged="valuechanged",n.PageingInfoChanged="pageingInfoChanged",n}();n.ListViewEvents=h;et=function(a){function v(n,t){var i,r,u;if(t===void 0&&(t=!0),i=a.call(this)||this,i._grid=n,t){r=i;for(u in h)(function(n){r._grid.bind(n,function(t,i){r._triggerListviewEvent(n,i)})})(h[u])}return i}return __extends(v,a),v.prototype._triggerListviewEvent=function(n,t){try{this.trigger(n,t)}catch(i){}},v.prototype.getRunTimePageName=function(){return this._grid.runTimePageName},v.prototype._getUniqueID=function(){return this._grid.getCalcSheetName()},v.prototype._getLocationStr=function(){return this._grid.getLocationString()},v.prototype.getName=function(){return this._grid.getListviewName()},v.prototype.getDataTableName=function(){return this._grid.getDataTableName()},v.prototype.getControl=function(){return this._grid.getControl()},v.prototype.getRowCount=function(){return this._grid.getListDataCount()},v.prototype.getSelectedRowIndex=function(){return this._grid.getCurrentRowIndex()},v.prototype.getSelectedRowIndexs=function(){return this._grid.getSelectedRowsIndexes()},v.prototype.getSelectedRowsData=function(){return this._grid.getSelectedRowsDataByAPI()},v.prototype.clearSelectedRowByQuery=function(t){return n.DelayRefresh.RunNow(),this._grid.clearSelectedRowByQuery(t)},v.prototype.selectRowsByValue=function(t,i){var r=this._getValidColumnIndexParam(i,"selectRowsByValue");if(r!==-1)return n.DelayRefresh.RunNow(),this._grid.selectRowsByValue(t,r)},v.prototype.getQuery=function(n){return this._grid.getListDataModel().getRowQuery(n)},v.prototype.getMergedColumnInfos=function(){return this._grid.getMergedColumnInfos()},v.prototype.getDesignerRangeInfo=function(){return this._grid.getRangeInfo()},v.prototype.getText=function(t,r){if(t=this._getValidRowIndexParam(t,w,i),t===-1)return"";var u=this._getValidColumnIndexParam(r,w);return u===-1?"":(n.DelayRefresh.RunNow(),this._grid.getText(t,u))},v.prototype.getValue=function(n,t){if(n=this._getValidRowIndexParam(n,w,i),n===-1)return null;var r=this._getValidColumnIndexParam(t,w);return r===-1?null:this._grid.getListDataModel().getValue(n,r)},v.prototype._getValidColumnIndexParam=function(i,r,f){var h=this,c,e,o,s;if(f===void 0&&(f=!1),c=function(i){var f,r,u,e;return n.Common.IsEmpty(i)?{colIndex:-1,isName:!0}:typeof i=="string"&&(f=t(i),r=h._grid.getColIndexOfNamedColumn(f,!1),r!==-1)?{colIndex:r,isName:!0}:(u=Number(i),!Number.isInteger(u))?{colIndex:-1,isName:!0}:(e=h._grid.getDataColIndexByMergedColIndex(u),{colIndex:e,isName:!1})},e=c(i,r),e.colIndex===-1)if(o=n.Common.IsEmpty(i)?"":i.toString(),s=e.isName?n.Common.format(n.RS.CannotFindColumn,o,this.getName()):n.Common.format(n.RS.CannotFindColumnIndex,o,this.getName()),f)throw s;else n.ErrorHelper.printJavascriptAIPError(u,r,s);return e.colIndex},v.prototype.setValue=function(n,t,r){if(n=this._getValidRowIndexParam(n,c,i),n!==-1){var u=this._getValidColumnIndexParam(t,c);u!==-1&&(r=this._ajustValue(r),this._grid.getListDataModel().setValue(n,u,r,7))}},v.prototype.setText=function(n,t,r){if(n=this._getValidRowIndexParam(n,c,i),n!==-1){var u=this._getValidColumnIndexParam(t,c);u!==-1&&this._grid.setCellText(n,u,r)}},v.prototype.addNewRow=function(n,t){if(t===void 0&&(t=!1),n){var i=n instanceof Array?this._getRowDataFromColumnIndexData(n):this._getRowDataFromColumnNameData(n);!i||i.length<=0||(t?this._grid.addNewRowWithText(i):this._grid.addNewRow(i))}},v.prototype.insertRow=function(n,t,i){if((i===void 0&&(i=!1),!(n<0)&&!(n>=this.getRowCount()))&&t){var r=t instanceof Array?this._getRowDataFromColumnIndexData(t):this._getRowDataFromColumnNameData(t);!r||r.length<=0||(i?this._grid.insertRowWithText(n,r):this._grid.insertRow(n,1,r,!1,!1))}},v.prototype.importData=function(t,i,r,u,f,e){var o=this;t||(t=[]);var s=t.map(function(n){return n instanceof Array?o._getRowDataFromColumnIndexData(n):o._getRowDataFromColumnNameData(n)}),h=u===null||u===void 0?void 0:u.map(function(n){return o._getValidColumnIndexParam(n,"importData")}),c=f===null||f===void 0?void 0:f.map(function(n){return o._getValidColumnIndexParam(n,"importData")}),l=new n.ListviewDataImportHelper(this._grid);i?l.importDataWithText(s,r,h,c,!1,e):l.importData(s,r,h,c,e)},v.prototype._getRowDataFromColumnNameData=function(n){var r=[],t,i;for(t in n){if(i=this._getValidColumnIndexParam(t,st),i<0)return null;r[i]=this._ajustValue(n[t])}return r},v.prototype._getRowDataFromColumnIndexData=function(n){for(var i,r=[],t=0;t<n.length;t++){if(i=this._getValidColumnIndexParam(t,st),i<0)return null;n[t]!==undefined&&(r[i]=this._ajustValue(n[t]))}return r},v.prototype._ajustValue=function(n){return n===undefined?null:n},v.prototype.deleteRow=function(n){(n=this._getValidRowIndexParam(n,"deleteRow",i),n!==-1)&&this._grid.deleteRowByJavascriptAPI(n)},v.prototype.selectRow=function(n){n=this._getValidRowIndexParam(n,yt,i);n!==-1&&this._grid.selectRow(n)},v.prototype.addSelectedRow=function(t){t=this._getValidRowIndexParam(t,"addSelectedRow",i);t!==-1&&(n.DelayRefresh.RunNow(),this._grid.addSelectedRow(t))},v.prototype.clearSelectedRow=function(t){t=this._getValidRowIndexParam(t,"clearSelectedRow",i);t!==-1&&(n.DelayRefresh.RunNow(),this._grid.clearSelectedRow(t))},v.prototype.selectAllRows=function(){n.DelayRefresh.RunNow();this._grid.selectAllRows()},v.prototype.clearAllSelectedRows=function(t){n.DelayRefresh.RunNow();this._grid.clearAllSelectedRows(t)},v.prototype.isSelectedRow=function(t){return t=this._getValidRowIndexParam(t,"isSelectedRow",i),t!==-1?(n.DelayRefresh.RunNow(),this._grid.isSelectedRow(t)):!1},v.prototype._getValidRowIndexParam=function(t,i,r,f){var o,s,e;return(f===void 0&&(f=!1),o=this.getRowCount(),f&&this._grid.getNewRowIndex()>=0&&o++,s=function(t,i){if(n.Common.IsEmpty(t))return{rowIndex:-1,error:n.Common.format(n.RS.InvalidNumberParam,i)};var r=Number(t);return isNaN(r)?{rowIndex:-1,error:n.Common.format(n.RS.InvalidNumberParam,i)}:r<0||r>=o?{rowIndex:-1,error:n.Common.format(n.RS.IndexOutOfRange,i)}:{rowIndex:r}},e=s(t,r),e.error)?(n.ErrorHelper.printJavascriptAIPError(u,i,e.error),-1):e.rowIndex},v.prototype.reload=function(){this._grid.fillData(null,!0)},v.prototype.clearAllColumnFilters=function(){n.ColumnFilterHelper&&(n.ColumnFilterHelper.clearColumnFilterCache(this._grid),this._grid.listviewData.metadata.CacheColumnFilterAndSort&&n.ListviewStatusCacheHelper.autoSaveMetadataCacheDataAsync(this._grid,{columnFilter:[]}))},v.prototype.bind=function(i,f,h){var c=t(i);if(arguments.length===2&&(h=f,f=undefined),s(h,r,e,o)){if(this._isSupportedEvent(c)){a.prototype.bind.call(this,c,f,h);return}n.ErrorHelper.printJavascriptAIPError(u,e,n.Common.format(n.RS.NotSupportEventForCellOrListview,i,u,this.getName()))}},v.prototype._isSupportedEvent=function(n){for(var t in h)if((h[t]+"").toLowerCase()===n)return!0;return!1},v.prototype.unbind=function(i,r){var h=arguments.length===1,e;if(h!==!1||s(r,f,l,o)){if(e=t(i),this._isSupportedEvent(e)){a.prototype.unbind.call(this,e,r);return}n.ErrorHelper.printJavascriptAIPError(u,l,n.Common.format(n.RS.NotSupportEventForCellOrListview,i,u,this.getName()))}},v.prototype.getPaginationInfo=function(){return this._grid.getPagingInfo()},v.prototype.usePaginationDisplay=function(n,t){(t===void 0&&(t=1),n<=0||t<0)||this._paginationDisplayListview(4,t,n)},v.prototype.goToFirstPage=function(){this._paginationDisplayListview(0,1)},v.prototype.goToPreviousPage=function(){var t=n.ForguncyData.pageingInfoList.GetPageIndex(this._grid.getLocationString());this._paginationDisplayListview(1,t)},v.prototype.goToNextPage=function(){var t=n.ForguncyData.pageingInfoList.GetPageIndex(this._grid.getLocationString());this._paginationDisplayListview(2,t)},v.prototype.goToLastPage=function(){this._paginationDisplayListview(3,1)},v.prototype.goToSpecifiedPage=function(n){n<0||this._paginationDisplayListview(4,n)},v.prototype._paginationDisplayListview=function(t,i,r){if(r===void 0&&(r=0),r===0&&(r=n.ForguncyData.pageingInfoList.GetLimit(this._grid.getLocationString())),!(r<=0)){var u={$type:"Forguncy.Model.GoToPageCommand, ServerDesignerCommon",targetPageKind:t,ListviewName:this.getName(),Limit:r,TargetPageIndex:i};n.GoToPageCommand.gotoPage(u,this._grid.runTimePageName)}},v.prototype.showLoadingIndicator=function(){this._grid.showLoadingIndicator()},v.prototype.hiddenLoadingIndicator=function(){this._grid.hiddenLoadingIndicator()},v.prototype.commitEditChange=function(){return this._grid.commitEditChange()},v.prototype.getRowValue=function(n){return this._grid.getRowValue(n)},v.prototype.getDataCommitMode=function(){return this._grid.GetDataCommitMode()},v.prototype.getDataValidationTime=function(){return this._grid.GetDataValidationTime()},v.prototype.isRowHeaderVisible=function(){return n.SpreadJSView&&this._grid instanceof n.SpreadJSView?this._grid.isRowHeaderVisible():!1},v.prototype.isRowHeaderCheckBoxVisible=function(){return n.SpreadJSView&&this._grid instanceof n.SpreadJSView?this._grid.isRowHeaderCheckBoxVisible():!1},v.prototype.setSelection=function(t,i){n.SpreadJSView&&this._grid instanceof n.SpreadJSView&&this._grid.setSelectionWithEvent(t,i,1,1)},v.prototype.hideColumns=function(n){return this.showOrHideColumns(n,!0)},v.prototype.showColumns=function(n){return this.showOrHideColumns(n,!1)},v.prototype.showOrHideColumns=function(t,i){var f=this,r,u;!t||t.length<=0||(r=i?"hideColumns":"showColumns",u=t.map(function(n){return f._getValidColumnIndexParam(n,r,!0)}),new n.ListviewColumnManager(this._grid).showOrHideColumns(u,i))},v.prototype.isDataSourceListview=function(){return this._grid instanceof n.DataSourceListview},v.prototype.isSpreadJSView=function(){return typeof n.SpreadJSView!="undefined"&&this._grid instanceof n.SpreadJSView},v.prototype.saveStatusCacheData=function(t,i,r,u,f){var e=this;return t===void 0&&(t=null),i===void 0&&(i=!0),r===void 0&&(r=!1),u===void 0&&(u=!1),f===void 0&&(f=!1),new Promise(function(o,s){var c,l,a,w=undefined,b,h,v,y,p;i&&e.isSpreadJSView()&&(b=e._grid.getClonedListviewMetadataAfterAdjustColumnWidth(),w=n.ListviewStatusCacheHelper.getCacheDataFromListviewMatadata(b));h=e._grid.getLocationString();v=undefined;r&&(v=(c=n.ForguncyData.pageInfo.columnFilterQueryCache[h])!==null&&c!==void 0?c:[]);y=undefined;u&&(y=(l=n.ForguncyData.pageInfo.sortInfoCache[h])!==null&&l!==void 0?l:{});p=undefined;f&&(p=(a=n.ForguncyData.pageInfo.runtimeQueryConditionDataCache[h])!==null&&a!==void 0?a:{});n.ListviewStatusCacheHelper.setMetadataCacheDataAsync(e._grid,{columns:w,columnFilter:v,sort:y,runtimeQueryConditions:p},t,function(n){n.Success?o():s(n.ErrorMessage)})})},v.prototype.loadStatusCacheData=function(t){var i=this;return t===void 0&&(t=null),new Promise(function(r,u){var f=i._grid.listviewData.metadata,e=i._grid.designerPageName,o=i._grid.getListviewName();n.ListviewStatusCacheHelper.getMetadataCacheDataAsync(e,o,t,function(t){var s,o,v,h,y,p;if(t.Success){if(s=t.StatusCacheData,s){o={};s.Settings?o=JSON.parse(s.Settings):s.Columns&&(o.columns=JSON.parse(s.Columns));var c=i._grid.listviewData,l=!1,a=o.columns;a&&i.isSpreadJSView()&&(n.ListviewStatusCacheHelper.syncListviewColumnsMetadataFromCache(f,a),v=i._grid.listviewData,c=new n.ListviewData(f,i._grid.runTimePageName,e,v.uniqueIndex),l=!0);h=i._grid.getLocationString();o.columnFilter&&(y=n.ListviewStatusCacheHelper.filterListviewColumnFilterFromCache(c,o.columnFilter),n.ForguncyData.pageInfo.columnFilterQueryCache[h]=y);o.sort&&(i.isSpreadJSView()?(p=n.ListviewStatusCacheHelper.filterListviewColumnSortFromCache(c,o.sort),n.ForguncyData.pageInfo.sortInfoCache[h]=p):n.ForguncyData.pageInfo.sortInfoCache[h]=o.sort);o.runtimeQueryConditions&&(n.ForguncyData.pageInfo.runtimeQueryConditionDataCache[h]=o.runtimeQueryConditions);l?i._grid.resetListviewData(c):i._grid.fillData()}r()}else u(t.ErrorMessage)})})},v.prototype.getColumnsStatusMetadata=function(){var t=this._grid.getClonedListviewMetadataAfterAdjustColumnWidth();return{DesignerPageName:this._grid.designerPageName,Target:"Listview",Location:this._grid.getListviewName(),PropertyName:"Columns",PropertyValue:JSON.stringify(n.ListviewStatusCacheHelper.getCacheDataFromListviewMatadata(t)),Version:"1"}},v.prototype.loadColumnsStatusMetadata=function(t){var i,u,f;if(t&&(i=JSON.parse(t),i)){var r=this._grid.listviewData.metadata,e=this._grid.designerPageName,o=this._grid.getListviewName();n.ListviewStatusCacheHelper.syncListviewColumnsMetadataFromCache(r,i);u=this._grid.listviewData;f=new n.ListviewData(r,this._grid.runTimePageName,e,u.uniqueIndex);this._grid.resetListviewData(f)}},v.prototype.Reload=function(t,i,r){var u,f;if(t===void 0&&(t=!1),i===void 0&&(i=!1),r===void 0&&(r=!1),u=undefined,this.isTrue(t)&&!this.isDataSourceListview()){if(!this._grid.tryCommitValueBeforeQueryOrSort(!0))return;n.ColumnFilterHelper.clearColumnFilterCache(this._grid);u=[]}if(f=undefined,this.isTrue(i)){if(!this._grid.tryCommitValueBeforeQueryOrSort(!0))return;n.ForguncyData.pageInfo.sortInfoCache[this._grid.getLocationString()]=undefined;f={}}if(this.isTrue(r)){if(!this._grid.tryCommitValueBeforeQueryOrSort(!0))return;n.ForguncyData.pageInfo.runtimeQueryConditionDataCache[this._grid.getLocationString()]=undefined}this._grid.listviewData.metadata.CacheColumnFilterAndSort&&n.ListviewStatusCacheHelper.autoSaveMetadataCacheDataAsync(this._grid,{columnFilter:u,sort:f});this.reload()},v.prototype.UpdateEditingSetting=function(t,i,r,u){var e,f,o;t===void 0&&(t=!1);i===void 0&&(i=!0);r===void 0&&(r=!1);u===void 0&&(u=!1);e=this._grid.listviewData;f=n.Common.clone(this._grid.listviewData.metadata);f.CanEdit=t&&!f.IsGroupMode;f.CanAddRow=i&&t&&!f.IsGroupMode;f.CanDelete=r;f.forceDisableDeleteMenuItem=!u;o=new n.ListviewData(f,e.runTimePageName,e.designerPageName,e.uniqueIndex);this._grid.resetListviewData(o)},v.prototype.isTrue=function(t){return!n.Common.IsEmpty(t)&&t!==0&&t!==!1&&(t+"").toLowerCase()!=="false"},v.prototype.GetCurrentRowIndex=function(){return{RowIndex:this.getSelectedRowIndex()}},v.prototype.GetCurrentColumnIndex=function(){return this.isDataSourceListview()?{ColumnIndex:-1}:{ColumnIndex:this._grid.getMergedColIndexByDataColIndex(this._grid.getCurrentColIndex())}},v.prototype.GetSelectedRows=function(){var t,n=this.getSelectedRowIndexs();return{SelectedRows:n!==null&&n!==void 0?n:[],SelectedRowCount:(t=n===null||n===void 0?void 0:n.length)!==null&&t!==void 0?t:0}},v.prototype.ClearAllSelectedRows=function(n){this.clearAllSelectedRows(n)},v.prototype.SelectAllRows=function(){this.selectAllRows()},v.prototype.AddRowSelection=function(n){this.addSelectedRow(n)},v.prototype.RemoveRowSelection=function(n){this.clearSelectedRow(n)},v.prototype.HideColumn=function(t){if(!this.isDataSourceListview())try{this.hideColumns(typeof t=="string"?t.split(",").map(function(n){return n.trim()}):[t])}catch(i){n.ErrorHelper.printJavascriptAIPError(u,"HideColumn",i)}},v.prototype.ShowColumn=function(t){if(!this.isDataSourceListview())try{this.showColumns(typeof t=="string"?t.split(",").map(function(n){return n.trim()}):[t])}catch(i){n.ErrorHelper.printJavascriptAIPError(u,"ShowColumn",i)}},v.prototype.SelectCell=function(t,r){var f,e,o;if(!this.isDataSourceListview()&&(f="SelectCell",t=this._getValidRowIndexParam(t,f,i,!0),t!==-1)&&(e=this._getValidColumnIndexParam(r,f),e!==-1)){if(o=this._grid.getVisibleColumnIndexInListViewByDataIndex(e),o===-1){n.ErrorHelper.printJavascriptAIPError(u,f,n.RS.CannotSelectCellInColumn);return}n.DelayRefresh.RunNow();this._grid.selectCell(t,o)}},v.prototype.GetValue=function(n,t){return{Value:this.getValue(n,t)}},v.prototype.GetText=function(n,t){return{Text:this.getText(n,t)}},v.prototype.SetValue=function(n,t,i){this.setValue(n,t,i)},v.prototype.SetText=function(n,t,i){this.setText(n,t,i)},v.prototype.SaveStatusCacheData=function(n,t,i,r,u){t===void 0&&(t=!0);i===void 0&&(i=!1);r===void 0&&(r=!1);u===void 0&&(u=!1);this.saveStatusCacheData(n,t,i,r,u)},v.prototype.LoadStatusCacheData=function(n){this.loadStatusCacheData(n)},v}(n.EventClassBase);n.ListView=et,function(n){n[n.CurrentPagination=0]="CurrentPagination";n[n.AllPagination=1]="AllPagination"}(gt=n.SelectionRowMode||(n.SelectionRowMode={})),function(n){n[n.Add=0]="Add";n[n.Merge=1]="Merge";n[n.Replace=2]="Replace";n[n.MergeIgnoreEdit=3]="MergeIgnoreEdit";n[n.ReplaceIgnoreEdit=4]="ReplaceIgnoreEdit"}(ni=n.ImportMode||(n.ImportMode={})),function(n){n[n.ExistEmptyKeys=0]="ExistEmptyKeys";n[n.ExistSameKeys=1]="ExistSameKeys";n[n.ValidateError=2]="ValidateError"}(ti=n.ImportError||(n.ImportError={})),function(n){n[n.RowHeader=0]="RowHeader";n[n.SelectedColumn=1]="SelectedColumn";n[n.DataColumn=2]="DataColumn"}(ii=n.ListviewColumnType||(n.ListviewColumnType={})),function(n){n[n.Other=0]="Other";n[n.Number=1]="Number";n[n.Bool=2]="Bool";n[n.Date=3]="Date";n[n.Time=4]="Time";n[n.String=5]="String";n[n.Image=6]="Image";n[n.Attachment=7]="Attachment";n[n.User=8]="User"}(ri=n.ColumnDataType||(n.ColumnDataType={}));n.Page=new g;n.CommandHelper=new nt;ot=function(){function t(){}return t.prototype.getBaseUrl=function(){return n.ForguncyData.ForguncyRoot},t.prototype.getBuiltInImageFolderPath=function(){return n.ForguncyData.ForguncyRoot+"Resources/Images/CellTypeBuiltInImage/"},t.prototype.getImageEditorUploadImageFolderPath=function(){return n.StaticData.IsDesignerPreview?n.StaticData.DesignerPreviewData.DesignerHttpServerRoot+"/localImageCellType/":n.ForguncyData.ForguncyRoot+"GeneratedResources/Images/GenerateImages/ImageCellType/"},t.prototype.getUploadFileFolderPathInDesigner=function(){return n.ForguncyData.ForguncyRoot+"GeneratedResources/Images/UserCustomCellTypeFiles/"},t.prototype.getUploadImageFolderPathInServer=function(){return n.StaticData.IsDesignerPreview?n.StaticData.DesignerPreviewData.DesignerHttpServerRoot+"/upload/":n.ForguncyData.ForguncyRoot+"Upload/"},t.prototype.getUserFileFolderPath=function(){return n.ForguncyData.ForguncyRoot+"GeneratedResources/UserFile/"},t.prototype.getPluginRootPath=function(t){return n.ModuleLoader.getPluginRoot(t)},t.prototype.getFileDownloadUrl=function(t,i){i===void 0&&(i=!0);var u=t.indexOf(".")===-1?"":t.split(".").pop().toLowerCase(),r="?file="+(i?encodeURIComponent(t):t);return(u==="pdf"&&(r+="&openPdfDirectly=true"),n.StaticData.IsDesignerPreview)?n.StaticData.DesignerPreviewData.DesignerHttpServerRoot+"/file/download"+r:n.Helper.SpecialPath.getBaseUrl()+n.ModuleLoader.getCdnUrl("FileDownloadUpload/Download"+r)},t}();n.SpecialPath=ot;lt=function(){function t(){}return t.post=function(t,i,r,u){u===void 0&&(u=!0);u?n.Common.forguncyPost(t,i,r):n.Common.forguncyPostSync(t,i,r)},t.getCellLocation=function(t,i){var r=n.FormulaHelper.getCellIdInfos(t,n.FormulaHelper.getFormulaCalcInfo(i));return r.length>=1?{Row:r[0].row,Column:r[0].col,PageID:r[0].suffix,PageName:n.PageManager.getDesignerPageName(r[0].suffix,!1),PageTitle:n.PageManager.getDesignerPageTitle(r[0].suffix)}:null},t.preSetEchartOption=function(){},t.preProcessImageSrc=function(t){return n.ModuleLoader.getCdnUrl(t,n.ForguncyData.ForguncyRoot)},t.addDebugWarning=function(t){n.ForguncyData.pageInfo.dataModel.debugWarningInfoDataModel.push({message:t})},t.SpecialPath=new ot,t}();n.Helper=lt;n.SendMail=ui;n.ConvertOADateToDate=fi;n.ConvertDateToOADate=ei;n.ConvertToCssColor=oi})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){function b(n,t,u,f){var o={};o[r]=t;i(e,n,o,u,f)}function k(t,i,r,u){u===void 0&&(u=!0);n.Common.operateODataPost(y,{ODataString:t},i,r,u)}function d(i,r,u,f){f===void 0&&(f=!0);var s="Home/GetTableDataForPlugins",c=n.Common.IsEmpty(i.QueryPolicy)?!0:i.QueryPolicy.Distinct,l=n.Common.getRunTimePageNameFromFormulaCalcContext(r),h=n.NullFormulaValueQueryPolicy.AllDatas;n.Common.IsEmpty(i.QueryPolicy)||i.QueryPolicy.QueryNullPolicy===n.QueryNullPolicy.QueryZeroItemsWhenValueIsNull&&(h=n.NullFormulaValueQueryPolicy.EmptyDatas);var o={tableName:i.TableName,columns:i.Columns,queryCondition:n.ConditionHelper.getComputedSqlConditionFormula(i.QueryCondition,l,h,r.RowOffset,r.ColumnOffset,r.ListviewRowInfo),sortCondition:i.SortCondition,distinct:c},e=JSON.stringify(o),a=n.Common.IsEmpty(i.QueryPolicy)?!1:i.QueryPolicy.IgnoreCache;a||t[e]===undefined?f?n.Common.forguncyPost(s,o,function(n){t[e]=n;u&&u(n)}):n.Common.forguncyPostSync(s,o,function(n){t[e]=n;u&&u(n)}):u&&u(t[e])}function g(n,t,u,f){var e={};e[r]=t;i(a,n,e,u,f)}function nt(n,t,r,u){var f={};f[c]=t;i(v,n,f,r,u)}function tt(n,t,u,f,e){var o={};o[r]=t;o[h]=u;i(l,n,o,f,e)}function it(n,t,r){var f={};f.updateData=n;i(u,null,f,t,r)}function rt(t,i){n.Common.forguncyPost(p,{tableName:t},function(n){i&&i(n)})}function i(t,i,r,h,c){var y,l,a,v;if(t===u){for(y in r.updateData)if(i=String(y),l=s(i,r),l){c&&c(l);return}}else if(i=String(i),l=s(i,r),l){c&&c(l);return}a={};a[f]=i;for(v in r)a[v]=r[v];n.Common.forguncyPost(t,a,function(n){var f=n,s,l;if(f.Success){if(t!==e){if(t===u)for(s in r.updateData)o(s,!0);else o(i,!0);$(window).trigger("ForguncyRowCountChanged")}h&&(f.TableRowData?(l=f.TableRowData,h(l)):h())}else c&&c(f.ErrorMessage)},undefined,function(n){var t;c&&c((t=n===null||n===void 0?void 0:n.responseText)!==null&&t!==void 0?t:"")})}function o(t,i){n.NormalCellBindingManager.reloadData(t,i);n.ForguncyData.getRelatedTableWithForeignKey(t).forEach(function(t){n.NormalCellBindingManager.reloadData(t,i)})}function s(t,i){if(t==="")return n.Common.format(n.RS.WebApi_ErrorInfo_NonemptyStringParam,f);for(var r in i)if(typeof i[r]!="object")return n.Common.format(n.RS.ErrorInfo_ParamInvalid,r)}function ut(){t={}}var f="tableName",r="primaryKey",h="updateValue",c="newValue",e="Home/GetTableDataApi",l="Home/UpdateTableDataApi",a="Home/DeleteTableDataApi",v="Home/AddTableDataApi",u="Home/ModifyTablesDataApi",y="Home/GetTableDataODataApi",p="Home/ForceSyncExternalBuiltInTableDataApi",w,t;(function(n){n[n.QueryAllItemsWhenValueIsNull=0]="QueryAllItemsWhenValueIsNull";n[n.QueryZeroItemsWhenValueIsNull=1]="QueryZeroItemsWhenValueIsNull"})(w=n.QueryNullPolicy||(n.QueryNullPolicy={}));n.getTableData=b;n.getTableDataByOData=k;n.getTableDataByCondition=d;n.deleteTableData=g;n.addTableData=nt;n.updateTableData=tt;n.modifyTablesData=it;n.forceSyncTableData=rt;t={};n.clearGetTableDataByConditionCache=ut})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){function r(t,i,r,u,f){var e=new n.UserManagerCommand,o=u!==null&&u!==void 0?u:function(){location.reload()};e.loginByRSA(t,i,r,o,f)}function u(t){var i=new n.UserManagerCommand;i.Logout(t?{NavigateWhenLogoutMode:n.NavigateWhenLogoutMode.GoToHomePage}:null)}function f(r,u,f,e,o,s){if(n.ForguncyData.AuthenticationType===1){if(o=u,s=f,u=undefined,f=undefined,e=undefined,!t(o,"function")||!t(s,"function")||!t(r,"string")){alert(n.RS.AddUserApiParamError);return}i("AddUser",{userName:r},o,s)}else{if(!t(u,"string")||!t(f,"string")||!t(e,"string")||!t(o,"function")||!t(s,"function")||!t(r,"string")){alert(n.RS.AddUserApiParamError);return}n.Security.SecurityManager.requestRSAPublicKey(function(t){n.Security.Encrypter.encrypt(u,t.Value,function(n){i("AddUser",{userName:r,password:n,displayName:f,email:e,keyId:t.Id},o,s)})})}}function t(n,t){return typeof n===t?!0:!1}function e(n,t,r){i("DeleteUser",{userName:n},t,r)}function o(n,t,r,u){i("AddUserToRole",{userName:n,roleName:t},r,u)}function s(n,t,r,u){i("DeleteUserFromRole",{userName:n,roleName:t},r,u)}function i(t,i,r,u){n.Common.forguncyPost("Account/"+t,i,function(n){n.Result?r&&r():u&&u(n.Message)})}n.logIn=r;n.logOut=u;n.addUser=f;n.deleteUser=e;n.addUserToRole=o;n.deleteUserFromRole=s})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var t;(function(t){t.CellHorizontalAlignment=n.CellHorizontalAlignment;t.CellVerticalAlignment=n.CellVerticalAlignment;t.CellTypeBase=n.CellTypeBase;t.CellTypeBaseWithSimplebar=n.CellTypeBaseWithSimplebar;t.CellTypeHelper=n.CellTypeHelper;t.CommandBase=n.CommandBase;t.CommandFactory=n.CommandFactory})(t=n.Plugin||(n.Plugin={}))})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var t;(function(t){var i,r;$(document).ready(function(){if(location.hostname==="localhost"){var n=null;$(document).on("keydown",function(t){var f,u;if(!n&&t.key==="m"&&t.ctrlKey===!0){for(f=$("[innerid],[fgcname],[chartname]"),n=$(document.createElement("div")),n.addClass("fgc-cell-tip__cover"),u=0;u<f.length;u++){var i=$(f[u]),e=i.attr("innerid"),r=$(document.createElement("div"));r.addClass("fgc-cell-tip__label");r.css("left",i.offset().left);r.css("top",i.offset().top);i.attr("fgcname")?e=i.attr("fgcname"):i.attr("chartname")&&(e=i.attr("chartname"));r.text(e);n.append(r)}return $(document.body).append(n),!1}});$(document).on("keyup",function(){n&&(n.remove(),n=null)})}});i=function(){function t(){}return t.getListviewControl=function(t){for(var r=n.ListviewBase.getAllListviews(),i=0;i<r.length;i++)if(r[i].getListviewName()===t)return r[i]},t.getSpreadJSNewRowIndex=function(i){var r=t.getListviewControl(i);return n.SpreadJSView&&r&&r instanceof n.SpreadJSView?r.getNewRowIndex():-1},t.IsListviewAllowEdit=function(n){var i=t.getListviewControl(n);return i?i.allowEdit():!1},t.getTextIndent=function(t,i,r){var u=this.getActualStyle(t,i,r);return u&&!n.Common.IsEmpty(u.textIndent)?u.textIndent:0},t.getBackcolor=function(t,i,r){var u=this.getActualStyle(t,i,r);return u&&!n.Common.IsEmpty(u.backColor)?u.backColor:""},t.getForecolor=function(t,i,r){var u=this.getActualStyle(t,i,r);return u&&!n.Common.IsEmpty(u.foreColor)?u.foreColor:""},t.getActualStyle=function(n,i,r){var u=t.getListviewControl(n);return u?u.getActualStyle(i,r):null},t.getRowHeaderIcon=function(n,i){var r=t.getListviewControl(n);return r?r.getRowState(i):0},t.getRowHeaderText=function(i,r){var u=t.getListviewControl(i);return u?n.SpreadJSRowHeaderCellType.getRowHeaderText(r,u.getCalcSheetName()):""},t.getImageTooltip=function(i,r,u){var f=t.getListviewControl(i),e;return n.SpreadJSView&&f instanceof n.SpreadJSView&&(e=f.getSheet().getCellType(-1,u),n.SpreadJSViewImageCellType&&e instanceof n.SpreadJSViewImageCellType)?e.getTooltipContent(f.getCalcSheetName(),r):null},t.isSimplebar=function(i){var r=t.getListviewControl(i);return n.SpreadJSView&&r instanceof n.SpreadJSView?r.getSpread().options.scrollbarAppearance===GC.Spread.Sheets.ScrollbarAppearance.mobile:!1},t}();t.Listview=i;r=function(){function t(){}return t.login=function(t,i,r){var u=new n.UserManagerCommand;u.loginByRSA(t,i,r,function(){location.reload()})},t}();t.UserManager=r})(t=n.AutoTest||(n.AutoTest={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t;(function(t){var r=function(t){function i(){var i=t.call(this)||this;return n.Platform.isMobile()&&(i.closeButton.text="",i.closeButton.svg='<?xml version="1.0" encoding="UTF-8"?><svg width="8px" height="12px" viewBox="0 0 8 12" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="Designer-Icon" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><path d="M4.54726758,2.31385803 C4.53447812,2.2990491 4.51692479,2.2944275 4.50336287,2.28056285 C4.50018695,2.27688545 4.49937153,2.27131968 4.49619562,2.26764229 C4.18242368,1.90894768 3.67706884,1.91078789 3.36647295,2.27320806 L-1.76856402,8.4247363 C-2.0791175,8.78805311 -2.0767548,9.3723113 -1.76375725,9.73189857 C-1.60809479,9.9103015 -1.40449282,10 -1.2017077,10 C-0.996518206,10 -0.790556287,9.90846273 -0.634850421,9.72638255 L3.94454148,4.22563179 L8.63967301,9.68567826 C8.79533547,9.86408119 8.99816401,9.95377969 9.20172256,9.95377969 C9.40768448,9.95377969 9.61287397,9.86224242 9.76857984,9.68016224 C10.0791333,9.31774097 10.0767282,8.73253813 9.76377304,8.37295085 L4.54726758,2.31385803 Z" fill="#6B6B6B" transform="translate(4.000000, 6.000000) scale(1, -1) rotate(-90.000000) translate(-4.000000, -6.000000) "><\/path><\/g><\/svg>',i.footerButtonGroup.items[1].visibility=!1),i}return __extends(i,t),i.prototype.appendExtraPopup=function(){n.ForguncyData.pageInfo.appendExtralPopup(this);this.extraDialogCount=n.ForguncyData.pageInfo.extraDialogCount;n.PageBuilder.pagesContainer.append(this.createUI().container)},i.prototype.canClose=function(){return this.extraDialogCount===n.ForguncyData.pageInfo.extraDialogCount},i}(n.UI.Dialog),i;t.BPMDialog=r;i=function(){function i(){}return i.getUserDisplayName=function(i,r){var u,f,e;return n.Common.IsEmpty(i)?"":(u=t.UserSelectorDialog.NAME_SPLIT_SEGMENT_LENGTH,f=i.length>u*2?"".concat(i.substring(0,u)).concat(t.UserSelectorDialog.NAME_DELIMITER).concat(i.substring(i.length-u)):i,n.Common.IsEmpty(r)||i===r)?f:(e=n.ForguncyData.GlobalSettings.ProcessUserInfoDisplayMode===1,e)?r:"".concat(r,"(").concat(f,")")},i.combineDisplayNameAndEmail=function(t,i){return n.Common.IsEmpty(i)?t:t+"("+i+")"},i}();t.BPMCommon=i})(t=n.BPM||(n.BPM={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__spreadArray=this&&this.__spreadArray||function(n,t,i){if(i||arguments.length===2)for(var r=0,f=t.length,u;r<f;r++)!u&&r in t||(u||(u=Array.prototype.slice.call(t,0,r)),u[r]=t[r]);return n.concat(u||Array.prototype.slice.call(t))},Forguncy;(function(n){var t;(function(t){var i,r;t.UserSelectorDialogTabTypeInLocalStorage="UserSelectorDialogTabType",function(n){n.User="user";n.Org="org"}(i=t.UserSelectorDialogTabType||(t.UserSelectorDialogTabType={}));r=function(r){function f(t){var u=t.isMultiSelect,h=u===void 0?!1:u,f=t.selectableUserInfos,c=f===void 0?[]:f,o=t.selectedUserNames,l=o===void 0?[]:o,s=t.organizationNodeInfos,a=s===void 0?{}:s,i=r.call(this)||this;return i.selectionlayout_titleText=n.RS.UserSelectorDialog_Selection_Title,i.defaultUI=e,i.tableDataSourceConvert={userTab_userTable:function(n){var t=n.UserName,i=n.FullName,r=n.Email;return{key:t,UserName:t,FullName:i,Email:r}},orgTab_treeTable:function(n){var t=n.UserName,i=n.FullName,r=n.Email;return{key:t,UserName:t,FullName:i,Email:r}}},i.identify("fgc-bpm-user-selector-dialog"),i.title=n.RS.TaskActionDialog_AssigneesRow_SelectorDialogTitle,i.isMultiSelect=h,i.userInfos=c,i.organizationNodeInfos=a,i.initUI(new Set(l)),i.initUIEvents(),i}return __extends(f,r),Object.defineProperty(f.prototype,"isSingleMode",{get:function(){return!this.isMultiSelect},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"dialogResult",{get:function(){var n=this;return{selectedUserInfos:this.userInfos.filter(function(t){return n.selectionlayout_selection.has(t.UserName)})}},enumerable:!1,configurable:!0}),f.prototype.initUI=function(r){var o,s,e=this,f,h;this.userTab_searchInput=new n.UI.TextBox("",n.RS.UserSelectorDialog_SearchInput,'<?xml version="1.0" encoding="UTF-8"?><svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><path d="M7.02867366,1 C10.3582182,1 13.0573473,3.69912914 13.0573473,7.02867366 C13.0573473,8.32221061 12.6499561,9.52059624 11.9564796,10.5025245 C12.2176302,10.756983 12.4911409,11.0222645 12.7639532,11.2870677 C13.561905,12.0616577 13.3738436,11.8726065 13.8302386,12.319114 C14.1025732,12.5854965 14.3137633,12.7931835 14.457975,12.936475 C14.5392585,13.0172345 14.5998567,13.0780473 14.6432237,13.1224281 C14.7579395,13.2398368 14.99661,13.4841298 15,13.9048783 C15,14.2043686 14.8986259,14.4515177 14.6958778,14.6463257 C14.3917557,14.9385378 14.2287409,14.9505997 13.9609586,14.9505997 C13.7495485,14.9505997 13.5366685,14.8863852 13.3524424,14.7555389 C13.3264966,14.7371013 13.3007004,14.717086 13.2735264,14.6943146 C13.2512208,14.6756067 13.2258365,14.6532711 13.1936972,14.6239864 C13.1474012,14.5818653 13.0842012,14.5227758 13.0004248,14.4433642 C12.8536746,14.3042212 12.6404486,14.099311 12.3666605,13.8343802 C11.908517,13.3910446 12.0963115,13.5794538 11.2995422,12.8005309 C11.0173144,12.5246218 10.7344739,12.2478231 10.4633881,11.9823445 C9.4897578,12.6603669 8.30557561,13.0573473 7.02867366,13.0573473 C3.69912914,13.0573473 1,10.3582182 1,7.02867366 C1,3.69912914 3.69912914,1 7.02867366,1 Z M7.02867366,3.00955789 C4.80897731,3.00955789 3.00955789,4.80897731 3.00955789,7.02867366 C3.00955789,9.24837001 4.80897731,11.0477894 7.02867366,11.0477894 C9.24837001,11.0477894 11.0477894,9.24837001 11.0477894,7.02867366 C11.0477894,4.80897731 9.24837001,3.00955789 7.02867366,3.00955789 Z" fill="currentColor" fill-rule="nonzero"><\/path><\/g><\/svg>').addClass("fgc-bpm-userselectordialog-search").addAttrs({AutomationId:"userSelectorDialog_searchInput"});this.userTab_searchInput.autocomplete="new-password";f=n.ForguncyData.GlobalSettings.ProcessUserInfoDisplayMode===1;this.userTab_userTable=new n.UI.Table({isMultiSelect:this.isMultiSelect,columns:[{key:"UserName",label:n.RS.ForguncyUserAvator_UserName,width:f?"0":"100%"},{key:"FullName",label:n.RS.ForguncyUserAvator_FullName,width:"100%"},{key:"Email",label:n.RS.ForguncyUserAvator_Email,width:"100%"},],dataSource:this.userInfos.map(function(n){return e.tableDataSourceConvert.userTab_userTable(n)}),selectedKeys:Array.from(r)});this.orgTab_searchInput=new n.UI.TextBox("",n.RS.UserSelectorDialog_SearchInput,'<?xml version="1.0" encoding="UTF-8"?><svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><path d="M7.02867366,1 C10.3582182,1 13.0573473,3.69912914 13.0573473,7.02867366 C13.0573473,8.32221061 12.6499561,9.52059624 11.9564796,10.5025245 C12.2176302,10.756983 12.4911409,11.0222645 12.7639532,11.2870677 C13.561905,12.0616577 13.3738436,11.8726065 13.8302386,12.319114 C14.1025732,12.5854965 14.3137633,12.7931835 14.457975,12.936475 C14.5392585,13.0172345 14.5998567,13.0780473 14.6432237,13.1224281 C14.7579395,13.2398368 14.99661,13.4841298 15,13.9048783 C15,14.2043686 14.8986259,14.4515177 14.6958778,14.6463257 C14.3917557,14.9385378 14.2287409,14.9505997 13.9609586,14.9505997 C13.7495485,14.9505997 13.5366685,14.8863852 13.3524424,14.7555389 C13.3264966,14.7371013 13.3007004,14.717086 13.2735264,14.6943146 C13.2512208,14.6756067 13.2258365,14.6532711 13.1936972,14.6239864 C13.1474012,14.5818653 13.0842012,14.5227758 13.0004248,14.4433642 C12.8536746,14.3042212 12.6404486,14.099311 12.3666605,13.8343802 C11.908517,13.3910446 12.0963115,13.5794538 11.2995422,12.8005309 C11.0173144,12.5246218 10.7344739,12.2478231 10.4633881,11.9823445 C9.4897578,12.6603669 8.30557561,13.0573473 7.02867366,13.0573473 C3.69912914,13.0573473 1,10.3582182 1,7.02867366 C1,3.69912914 3.69912914,1 7.02867366,1 Z M7.02867366,3.00955789 C4.80897731,3.00955789 3.00955789,4.80897731 3.00955789,7.02867366 C3.00955789,9.24837001 4.80897731,11.0477894 7.02867366,11.0477894 C9.24837001,11.0477894 11.0477894,9.24837001 11.0477894,7.02867366 C11.0477894,4.80897731 9.24837001,3.00955789 7.02867366,3.00955789 Z" fill="currentColor" fill-rule="nonzero"><\/path><\/g><\/svg>').addClass("fgc-bpm-userselectordialog-search").addAttrs({AutomationId:"userSelectorDialog_searchInput"});this.orgTab_searchInput.autocomplete="new-password";this.orgTab_treeTable=new u({isMultiSelect:this.isMultiSelect,columns:[{key:"UserName",label:f?n.RS.ForguncyUserAvator_FullName:n.RS.ForguncyUserAvator_UserName,width:"100%",align:"left"},],dataSource:this.userInfos.map(function(n){return e.tableDataSourceConvert.orgTab_treeTable(n)}),selectedKeys:Array.from(r)});this.orgTab_userTable=new n.UI.Table({isMultiSelect:this.isMultiSelect,columns:[{key:"UserName",label:n.RS.ForguncyUserAvator_UserName,width:f?"0":"100%"},{key:"FullName",label:n.RS.ForguncyUserAvator_FullName,width:"100%"},{key:"Email",label:n.RS.ForguncyUserAvator_Email,width:"100%"},],dataSource:this.userInfos.map(function(n){return e.tableDataSourceConvert.userTab_userTable(n)}),selectedKeys:Array.from(r)});this.orgTab_treeView=(new n.UI.TreeView).addClass("fgc-bpm-userselectordialog-treeview");this.initOrgTab_treeView();this.orgTab_treeLayout=new n.UI.FlexLayout(0).add(this.orgTab_treeView.addCss({flex:1,"margin-right":"5px","max-height":"380px"}),this.orgTab_treeTable.addCss({flex:"1 1 5px","margin-left":"5px"}));this.tabInfos=[{tabType:i.User,selectButton:new n.UI.Button(n.RS.DelegationListDialog_Tab_User),tabPanel:new n.UI.FlexLayout(1).add(this.userTab_searchInput,this.userTab_userTable),isActive:!1},{tabType:i.Org,selectButton:new n.UI.Button(n.RS.DelegationListDialog_Tab_Org),tabPanel:new n.UI.FlexLayout(1).add(this.orgTab_searchInput,this.orgTab_treeLayout,this.orgTab_userTable),isActive:!1},];this.tabInfos.forEach(function(n){n.selectButton.classNames="".concat("FUI-button"," ").concat("fgc-bpm-userselectordialog-tabs-item")});this.selectionlayout_title=(new n.UI.TextBlock).addClass("fgc-bpm-userselectordialog-selection-title");this.selectionlayout_selection=new t.UserSelectionArea(this.userInfos,this.isMultiSelect,r);this.outerlayout=new n.UI.FlexLayout(1).add((o=new n.UI.FlexLayout(0).addClass("fgc-bpm-userselectordialog-tabs")).add.apply(o,this.tabInfos.map(function(n){return n.selectButton})),(s=new n.UI.FlexLayout(1).addCss({padding:"15px"})).add.apply(s,__spreadArray(__spreadArray([],this.tabInfos.map(function(n){return n.tabPanel}),!1),[this.selectionlayout_title,this.selectionlayout_selection],!1)));h=localStorage.getItem(t.UserSelectorDialogTabTypeInLocalStorage);this.selectTabPanel(h);this.updateOrgPanel();this.updateSelectionlayoutTitle();this.isSingleMode&&(this.selectionlayout_title.hide(),this.selectionlayout_selection.hide())},f.prototype.initUIEvents=function(){var n=this;this.tabInfos.forEach(function(t){t.selectButton.on("Clicked",function(){n.selectTabPanel(t.tabType)})});this.userTab_searchInput.on("Confirm",function(){n.userTab_userTable.filter(n.userTab_searchInput.text)});this.userTab_searchInput.on("SuffixClicked",function(){n.userTab_userTable.filter(n.userTab_searchInput.text)});this.orgTab_searchInput.on("Confirm",function(){n.updateOrgPanel()});this.orgTab_searchInput.on("SuffixClicked",function(){n.updateOrgPanel()});this.userTab_userTable.on("SelectedItem",function(t,i){n.addSelectedUserName(i)});this.userTab_userTable.on("SelectedAllItems",function(t,i){n.addSelectedAllUserNames(i)});this.userTab_userTable.on("UnselectedItem",function(t,i){n.deleteSelectedUserName(i)});this.userTab_userTable.on("UnselectedAllItems",function(t,i){n.deleteSelectedAllUserNames(i)});this.orgTab_treeTable.on("SelectedItem",function(t,i){n.addSelectedUserName(i)});this.orgTab_treeTable.on("SelectedAllItems",function(){var t=n.orgTab_treeTable.dataSource.map(function(n){return n.key});n.addSelectedAllUserNames(t)});this.orgTab_treeTable.on("UnselectedItem",function(t,i){n.deleteSelectedUserName(i)});this.orgTab_treeTable.on("UnselectedAllItems",function(){var t=n.orgTab_treeTable.dataSource.map(function(n){return n.key});n.deleteSelectedAllUserNames(t)});this.orgTab_userTable.on("SelectedItem",function(t,i){n.addSelectedUserName(i)});this.orgTab_userTable.on("SelectedAllItems",function(t,i){n.addSelectedAllUserNames(i)});this.orgTab_userTable.on("UnselectedItem",function(t,i){n.deleteSelectedUserName(i)});this.orgTab_userTable.on("UnselectedAllItems",function(t,i){n.deleteSelectedAllUserNames(i)});this.selectionlayout_selection.on("ActivelyRemove",function(t,i){n.deleteSelectedUserName(i)})},f.prototype.updateOrgPanel=function(){n.Common.IsEmpty(this.orgTab_searchInput.text)?(this.orgTab_userTable.hide(),this.orgTab_treeLayout.show()):(this.orgTab_userTable.show(),this.orgTab_treeLayout.hide(),this.orgTab_userTable.filter(this.orgTab_searchInput.text))},f.prototype.updateSelectionlayoutTitle=function(){this.selectionlayout_title.text=n.Common.format(this.selectionlayout_titleText,this.selectionlayout_selection.size)},f.prototype.selectTabPanel=function(n){var e=Object.keys(i).find(function(t){return i[t]===n}),r,f,u;(e||(n=i.User),r=this.tabInfos.find(function(n){return n.isActive}),(r===null||r===void 0?void 0:r.tabType)!==n)&&(f=r?[r]:this.tabInfos,f.forEach(function(n){n.isActive=!1;n.selectButton.addAttrs({active:"false"});n.tabPanel.hide()}),u=this.tabInfos.find(function(t){return t.tabType===n}),u.isActive=!0,u.selectButton.addAttrs({active:"true"}),u.tabPanel.show(),localStorage.setItem(t.UserSelectorDialogTabTypeInLocalStorage,n))},f.prototype.initOrgTab_treeView=function(){var u=this,i=this.organizationNodeInfos,t,e,o;if(i&&Object.keys(i).length>0){t={};e=Array.from(new Set(this.userInfos.reduce(function(n,t){return n.push.apply(n,t.OrganizationBelongsTo||[]),n},[])));e.forEach(function(n){for(var r=i[n],f=function(){var n=r.id,e=r.name,f=r.pId;t[n]=u.createNode(e,function(){return u.userInfos.filter(function(t){var i;return((i=t.OrganizationBelongsTo)===null||i===void 0?void 0:i.indexOf(n))>=0})});r=f?i[f]:null};r&&!t[r.id];)f()});for(o in t){var s=i[o],r=t[s.id],f=t[s.pId];f?(f.children.push(r),r.parent=f):(this.orgTab_treeView.add(r),r.isExpand=!0)}}this.orgTab_treeView.add(this.createNode(n.RS.UserSelectorDialog_TreeView_NotOrganizedUser,function(){return u.userInfos.filter(function(n){return!n.OrganizationBelongsTo||n.OrganizationBelongsTo.length===0})}));this.orgTab_treeView.refreshNodes();this.initOrgTab_treeViewDefaultSelectionOrgNode()},f.prototype.createNode=function(t,i){var u=this,f=new n.UI.IconText("".concat(t),'<?xml version="1.0" encoding="UTF-8"?><svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><path d="M13,10 L13,8 L8.01354599,8 L8.00630188,10 L9,10 C9.55228475,10 10,10.4477153 10,11 L10,14 C10,14.5522847 9.55228475,15 9,15 L6,15 C5.44771525,15 5,14.5522847 5,14 L5,11 C5,10.4477153 5.44771525,10 6,10 L7,10 L6.99866772,8 L2,8 L2.00585413,10 L3,10 C3.55228475,10 4,10.4477153 4,11 L4,14 C4,14.5522847 3.55228475,15 3,15 L1,15 C0.44771525,15 6.76353751e-17,14.5522847 0,14 L0,11 C-6.76353751e-17,10.4477153 0.44771525,10 1,10 L1,7 L6.99866772,7 L6.998,5 L6,5 C5.44771525,5 5,4.55228475 5,4 L5,1 C5,0.44771525 5.44771525,1.01453063e-16 6,0 L9,0 C9.55228475,-1.01453063e-16 10,0.44771525 10,1 L10,4 C10,4.55228475 9.55228475,5 9,5 L8.013,5 L8.01354599,7 L14,7 L14,10 C14.5522847,10 15,10.4477153 15,11 L15,14 C15,14.5522847 14.5522847,15 14,15 L12,15 C11.4477153,15 11,14.5522847 11,14 L11,11 C11,10.4477153 11.4477153,10 12,10 L13,10 Z M9,11 L6,11 L6,14 L9,14 L9,11 Z M3,11 L1,11 L1,14 L3,14 L3,11 Z M14,11 L12,11 L12,14 L14,14 L14,11 Z M9,1 L6,1 L6,4 L9,4 L9,1 Z" id="形状结合备份-4" fill="#6B6B6B"><\/path><\/g><\/svg>'),r=new n.UI.TreeViewNode(null,f);r.on("ItemContainerClicked",function(){u.orgTab_treeView.singleSelect(r);r.isExpand=!0;u.orgTab_treeTable.dataSource=i().map(function(n){return u.tableDataSourceConvert.orgTab_treeTable(n)});u.orgTab_treeTable.refresh()});return r.checkBox.visibility=!1,r},f.prototype.initOrgTab_treeViewDefaultSelectionOrgNode=function(){var n=this.orgTab_treeView.nodes[0];n.dispatch("ItemContainerClicked")},f.prototype.addSelectedAllUserNames=function(n){this.userTab_userTable.selectAll(n);this.orgTab_treeTable.selectAll(n);this.orgTab_userTable.selectAll(n);this.selectionlayout_selection.adds(n);this.updateSelectionlayoutTitle()},f.prototype.addSelectedUserName=function(n){this.userTab_userTable.select(n);this.orgTab_treeTable.select(n);this.orgTab_userTable.select(n);this.selectionlayout_selection.adds([n]);this.updateSelectionlayoutTitle()},f.prototype.deleteSelectedAllUserNames=function(n){var t=this;n.forEach(function(n){t.selectionlayout_selection.remove(n)});this.userTab_userTable.unselectAll(n);this.orgTab_treeTable.unselectAll(n);this.orgTab_userTable.unselectAll(n);this.updateSelectionlayoutTitle()},f.prototype.deleteSelectedUserName=function(n){this.selectionlayout_selection.remove(n);this.userTab_userTable.unselect(n);this.orgTab_treeTable.unselect(n);this.orgTab_userTable.unselect(n);this.updateSelectionlayoutTitle()},f.NAME_SPLIT_SEGMENT_LENGTH=10,f.NAME_DELIMITER="...",f}(t.BPMDialog);t.UserSelectorDialog=r;var u=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.defaultUI=f,t}return __extends(t,n),t}(n.UI.Table),f=function(n){function i(){return n!==null&&n.apply(this,arguments)||this}return __extends(i,n),i.prototype.setChildrenRowData=function(n,i){var r=this;this.target.columns.forEach(function(u){var f=u.key,e,o;switch(f){case"UserName":e=n.find('[data-key="'.concat(f,'"]'));o=t.BPMCommon.getUserDisplayName(i.UserName,i.FullName);e.text("".concat(o));e.attr("title",t.BPMCommon.combineDisplayNameAndEmail(o,i.Email));break;default:r.setChildrenCellData(n,i,f)}})},i}(n.UI.TableUI),e=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),Object.defineProperty(t.prototype,"content",{get:function(){return new o(this.target)},enumerable:!1,configurable:!0}),t}(n.UI.DialogUI),o=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.createChildren=function(){this.addChild(this.target.outerlayout.createUI())},t}(n.UI.DialogContentUI)})(t=n.BPM||(n.BPM={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t;(function(t){var e=function(r){function f(t){var u=t.isMultiSelect,s=u===void 0?!1:u,f=t.selectableUserInfos,h=f===void 0?[]:f,e=t.selectedUserNames,c=e===void 0?[]:e,i=r.call(this)||this;return i.selectionlayoutTitleText=n.RS.TaskActionDialog_AssigneesRow_SelectorDialogTitle_Mobile,i.defaultUI=o,i.identify("fgc-bpm-user-selector-dialog-mobile"),i.title=n.RS.TaskActionDialog_AssigneesRow_SelectorDialogTitle,i.isMultiSelect=s,i.userInfos=h,i._selectedUserNames=new Set(c),i.initUI(),i.initUIEvents(),i}return __extends(f,r),Object.defineProperty(f.prototype,"isSingleMode",{get:function(){return!this.isMultiSelect},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"dialogResult",{get:function(){var n=this;return{selectedUserInfos:this.userInfos.filter(function(t){return n._selectedUserNames.has(t.UserName)})}},enumerable:!1,configurable:!0}),f.prototype.initUI=function(){this.searchInput=new n.UI.TextBox("",n.RS.UserSelectorDialog_SearchInput,'<?xml version="1.0" encoding="UTF-8"?><svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><path d="M7.02867366,1 C10.3582182,1 13.0573473,3.69912914 13.0573473,7.02867366 C13.0573473,8.32221061 12.6499561,9.52059624 11.9564796,10.5025245 C12.2176302,10.756983 12.4911409,11.0222645 12.7639532,11.2870677 C13.561905,12.0616577 13.3738436,11.8726065 13.8302386,12.319114 C14.1025732,12.5854965 14.3137633,12.7931835 14.457975,12.936475 C14.5392585,13.0172345 14.5998567,13.0780473 14.6432237,13.1224281 C14.7579395,13.2398368 14.99661,13.4841298 15,13.9048783 C15,14.2043686 14.8986259,14.4515177 14.6958778,14.6463257 C14.3917557,14.9385378 14.2287409,14.9505997 13.9609586,14.9505997 C13.7495485,14.9505997 13.5366685,14.8863852 13.3524424,14.7555389 C13.3264966,14.7371013 13.3007004,14.717086 13.2735264,14.6943146 C13.2512208,14.6756067 13.2258365,14.6532711 13.1936972,14.6239864 C13.1474012,14.5818653 13.0842012,14.5227758 13.0004248,14.4433642 C12.8536746,14.3042212 12.6404486,14.099311 12.3666605,13.8343802 C11.908517,13.3910446 12.0963115,13.5794538 11.2995422,12.8005309 C11.0173144,12.5246218 10.7344739,12.2478231 10.4633881,11.9823445 C9.4897578,12.6603669 8.30557561,13.0573473 7.02867366,13.0573473 C3.69912914,13.0573473 1,10.3582182 1,7.02867366 C1,3.69912914 3.69912914,1 7.02867366,1 Z M7.02867366,3.00955789 C4.80897731,3.00955789 3.00955789,4.80897731 3.00955789,7.02867366 C3.00955789,9.24837001 4.80897731,11.0477894 7.02867366,11.0477894 C9.24837001,11.0477894 11.0477894,9.24837001 11.0477894,7.02867366 C11.0477894,4.80897731 9.24837001,3.00955789 7.02867366,3.00955789 Z" fill="currentColor" fill-rule="nonzero"><\/path><\/g><\/svg>').addClass("fgc-bpm-userselectordialog-search").addAttrs({AutomationId:"userSelectorDialog_searchInput"});this.searchInput.autocomplete="new-password";this.table=new i({isNeedCheckCol:!0,isMultiSelect:this.isMultiSelect,isNeedHeader:!1,columns:[{key:"info",label:"",width:"100%",type:"Custom"},{key:"info-username",type:"Custom"},{key:"info-email",type:"Custom"},],dataSource:this.userInfos.map(function(n){var i=n.UserName,r=n.FullName,u=n.Email;return{key:i,UserName:i,FullName:r,Email:u,"info-username":"".concat(t.BPMCommon.getUserDisplayName(i,r)),"info-email":u}}),selectedKeys:Array.from(this._selectedUserNames)});this.isSingleMode?(this.addClass("fgc-bpm-userselectordialog-singlemode"),this.outerlayout=new n.UI.FlexLayout(1).add(this.searchInput,this.table)):(this.selectionlayoutTitle=new n.UI.TextBlock,this.updateSelectionlayoutTitle(),this.selectionlayoutIcon=new n.UI.IconText("","",'<?xml version="1.0" encoding="UTF-8"?><svg viewBox="0 0 8 12" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="Designer-Icon" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><path d="M4.54726758,2.31385803 C4.53447812,2.2990491 4.51692479,2.2944275 4.50336287,2.28056285 C4.50018695,2.27688545 4.49937153,2.27131968 4.49619562,2.26764229 C4.18242368,1.90894768 3.67706884,1.91078789 3.36647295,2.27320806 L-1.76856402,8.4247363 C-2.0791175,8.78805311 -2.0767548,9.3723113 -1.76375725,9.73189857 C-1.60809479,9.9103015 -1.40449282,10 -1.2017077,10 C-0.996518206,10 -0.790556287,9.90846273 -0.634850421,9.72638255 L3.94454148,4.22563179 L8.63967301,9.68567826 C8.79533547,9.86408119 8.99816401,9.95377969 9.20172256,9.95377969 C9.40768448,9.95377969 9.61287397,9.86224242 9.76857984,9.68016224 C10.0791333,9.31774097 10.0767282,8.73253813 9.76377304,8.37295085 L4.54726758,2.31385803 Z" fill="#6B6B6B" transform="translate(4.000000, 6.000000) scale(1, -1) rotate(-270.000000) translate(-4.000000, -6.000000) "><\/path><\/g><\/svg>'),this.outerlayout=new n.UI.FlexLayout(1).add(this.searchInput,this.table,(new n.UI.FlexLayout).addClass("fgc-bpm-userselectordialog-selection-title").add(this.selectionlayoutTitle,this.selectionlayoutIcon)))},f.prototype.initUIEvents=function(){var n=this;this.searchInput.on("Confirm",function(){n.table.filter(n.searchInput.text)});this.searchInput.on("SuffixClicked",function(){n.table.filter(n.searchInput.text)});this.table.on("SelectedAllItems",function(t,i){i.forEach(function(t){n._selectedUserNames.add(t)});n.updateSelectionlayoutTitle()});this.table.on("SelectedItem",function(t,i){n.isMultiSelect||n._selectedUserNames.clear();n._selectedUserNames.add(i);n.updateSelectionlayoutTitle()});this.table.on("UnselectedAllItems",function(){n._selectedUserNames.clear();n.updateSelectionlayoutTitle()});this.table.on("UnselectedItem",function(t,i){n._selectedUserNames.delete(i);n.updateSelectionlayoutTitle()});if(this.isMultiSelect){this.selectionlayoutTitle.on("ContainerClicked",function(){n.openSelectedDialog()});this.selectionlayoutIcon.on("SuffixClicked",function(){n.openSelectedDialog()})}},f.prototype.openSelectedDialog=function(){var i=this,r=new u({isNeedHeader:!1,columns:[{key:"info",label:"",width:"100%",type:"Custom"},{key:"info-username",type:"Custom"},{key:"info-email",type:"Custom"},{key:"delete",label:"",width:"30px",type:"Custom"},],dataSource:this.dialogResult.selectedUserInfos.map(function(n){var i=n.UserName,r=n.FullName,u=n.Email;return{key:i,UserName:i,FullName:r,Email:u,"info-username":t.BPMCommon.getUserDisplayName(i,r),"info-email":u}}),selectedKeys:Array.from(this._selectedUserNames)}),f=this.openDrawDialog(r.createUI().container);r.on("UnselectedAllItems",function(t,r){r.forEach(function(n){i._selectedUserNames.delete(n);i.table.unselect(n)});f.title=n.Common.format(n.RS.UserSelectorDialog_Selection_Title,i._selectedUserNames.size);i.updateSelectionlayoutTitle()});r.on("UnselectedItem",function(t,r){i._selectedUserNames.delete(r);i.table.unselect(r);f.title=n.Common.format(n.RS.UserSelectorDialog_Selection_Title,i._selectedUserNames.size);i.updateSelectionlayoutTitle()})},f.prototype.updateSelectionlayoutTitle=function(){this.isMultiSelect&&(this.selectionlayoutTitle.text=n.Common.format(this.selectionlayoutTitleText,this._selectedUserNames.size))},f.prototype.openDrawDialog=function(t){var i=new n.PopupDialog;return i.title=n.Common.format(n.RS.UserSelectorDialog_Selection_Title,this._selectedUserNames.size),i.body=t,i.closeButton.text="",i.closeButton.svg='<?xml version="1.0" encoding="UTF-8"?><svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="CaretDownOutlined" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><path d="M8.45605632,4.23539352 C8.44539843,4.22428682 8.43077066,4.22082062 8.41946906,4.21042214 C8.41682246,4.20766409 8.41614294,4.20348976 8.41349635,4.20073172 C8.15201974,3.93171076 7.7308907,3.93309092 7.47206079,4.20490604 L1.19286332,10.8185522 C0.934068751,11.0910398 0.936037664,11.5292335 1.19686896,11.7989239 C1.32658767,11.9327261 1.49625598,12 1.66524359,12 C1.83623483,12 2.00786976,11.931347 2.13762465,11.7947869 L7.95378456,5.66922384 L13.8663942,11.7642587 C13.9961129,11.8980609 14.1651367,11.9653348 14.3347688,11.9653348 C14.5064037,11.9653348 14.677395,11.8966818 14.8071499,11.7601217 C15.0659444,11.4883057 15.0639402,11.0494036 14.8031442,10.7797131 L8.45605632,4.23539352 Z" fill="#6B6B6B" fill-rule="nonzero" transform="translate(8.000000, 8.000000) scale(1, -1) translate(-8.000000, -8.000000) "><\/path><\/g><\/svg>',i.identify("fgc-bpm-user-selection-list-dialog-mobile"),i.showHeader=!0,i.moveable=!1,i.closeWhenClickGrayArea=!0,i.centerWhenOpen=!1,i.displayMode=3,i.popupType="drawer",i.drawerDirection=0,i.disposeDelayDuration=300,n.ForguncyData.pageInfo.appendExtralPopup(i),n.PageBuilder.pagesContainer.append(i.createUI(n.DrawerUI).container),i.show(),i},f}(t.BPMDialog),i,r,u,f;t.UserSelectorDialogMobile=e;i=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.defaultUI=r,t}return __extends(t,n),t}(n.UI.Table);t.TableList=i;r=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.getDataColumnCustomTemplate=function(n){var t=n.key;switch(t){case"info":return'<td data-key="info">\n                    <div data-key="info-username"><\/div>\n                    <div data-key="info-email"><\/div>\n                <\/td>';default:return""}},t}(n.UI.TableUI);t.TableListUI=r;u=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.defaultUI=f,t}return __extends(t,n),t}(n.UI.Table);t.TableDeleteList=u;f=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.getLayoutColgroupCustomTemplate=function(n){switch(n.key){case"info":case"delete":return t.prototype.getLayoutColgroupCustomTemplate.call(this,n);default:return""}},i.prototype.getDataColumnCustomTemplate=function(n){switch(n.key){case"info":return'<td data-key="info">\n                    <div data-key="info-username"><\/div>\n                    <div data-key="info-email"><\/div>\n                <\/td>';case"delete":return'<th data-key="delete">'.concat('<?xml version="1.0" encoding="UTF-8"?><svg width="20px" height="20px" viewBox="0 0 20 20" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="Designer-Icon" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><path d="M10,0 C15.5228475,0 20,4.4771525 20,10 C20,15.5228475 15.5228475,20 10,20 C4.4771525,20 0,15.5228475 0,10 C0,4.4771525 4.4771525,0 10,0 Z M10,1.25 C5.16750844,1.25 1.25,5.16750844 1.25,10 C1.25,14.8324916 5.16750844,18.75 10,18.75 C14.8324916,18.75 18.75,14.8324916 18.75,10 C18.75,5.16750844 14.8324916,1.25 10,1.25 Z M14.2381662,5 C14.4415965,5 14.6330125,5.07937935 14.7771299,5.22349937 C15.0742863,5.52066107 15.0742863,6.00421741 14.7771299,6.30139028 L14.7771299,6.30139028 L11.0780671,10.0002512 L14.7765158,13.6987325 C14.9206332,13.8428637 15,14.0342607 15,14.2377059 C15,14.4411511 14.9206221,14.6325704 14.7765158,14.7767128 C14.6333251,14.9206095 14.4420655,15 14.2381662,15 C14.0345571,15 13.8431747,14.9206876 13.6992248,14.7766793 L13.6992248,14.7766793 L10.0003182,11.0779635 L6.3013782,14.7767016 C6.15818752,14.9205983 5.96669343,15 5.76240329,15 C5.55886126,15 5.36746767,14.9206765 5.22348421,14.7766681 C5.07938909,14.6325481 5,14.4411511 5,14.2377059 C5,14.0342607 5.07938909,13.8428302 5.22350654,13.6987214 L5.22350654,13.6987214 L8.92240191,10.0000726 L5.22349538,6.30140145 C5.07938909,6.15727026 5,5.96586208 5,5.76243924 C5,5.55901641 5.07937793,5.36760822 5.22349538,5.2234882 C5.36762399,5.07936818 5.55901759,5 5.76243679,5 C5.96585599,5 6.15726075,5.07937935 6.30136703,5.2234882 L6.30136703,5.2234882 L10.0001842,8.92234916 L13.6992583,5.22349937 C13.8433422,5.07937935 14.0347358,5 14.2381662,5 Z" fill="#00ADEE"><\/path><\/g><\/svg>',"<\/th>");default:return""}},i.prototype.createContainerEvents=function(){var t=this;this.container.on("click","table tbody tr",function(i){var u=i.currentTarget,f=$(u).find("div[data-key=info-username]").text(),r=n.PopupHelper.createConfirmPopupDom(n.RS.UserSelectorDialog_DeleteList_Title,"",n.Common.format(n.RS.UserSelectorDialog_DeleteListTip_Text,f),!n.ForguncyData.GlobalSettings.HidePopUpCloseButton);r.zIndex=n.ForguncyData.pageInfoStack.length;r.container.find(".".concat("FUI-imagetext-text")).css({"white-space":"normal","word-break":"break-all"});r.target.on("Confirm",function(){var n=i.currentTarget,r=$(n).attr("data-key");$(n).remove();t.target.dispatch("UnselectedItem",r)})})},i}(n.UI.TableUI);t.TableDeleteListUI=f;var o=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),Object.defineProperty(t.prototype,"header",{get:function(){return new h(this.target)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"content",{get:function(){return new s(this.target)},enumerable:!1,configurable:!0}),t}(n.UI.DialogUI),s=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.createChildren=function(){this.addChild(this.target.outerlayout.createUI())},t}(n.UI.DialogContentUI),h=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.createChildren=function(){n.prototype.createChildren.call(this);this.container.empty();this.addChild(this.target.closeButton.createUI());this.container.append(this.titleContainer)},t}(n.UI.DialogHeaderUI)})(t=n.BPM||(n.BPM={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__spreadArray=this&&this.__spreadArray||function(n,t,i){if(i||arguments.length===2)for(var r=0,f=t.length,u;r<f;r++)!u&&r in t||(u||(u=Array.prototype.slice.call(t,0,r)),u[r]=t[r]);return n.concat(u||Array.prototype.slice.call(t))},Forguncy;(function(n){var t;(function(t){var r=function(t){function r(r,u,f){var e=t.call(this)||this;return e.selectedKeys=new Set,e.defaultUI=i,e.containerHeight=0,e.loadUserStep=25,e.loadUserTick=0,e.loadScrollDistance=10,e.addClass("fgc-bpm-userselectordialog-selection-area"),e.userInfos=__spreadArray([],r,!0),e.isMultiSelect=u,e.selectedKeys=new Set(f),e.canLoadUserInfos=Array.from(f).map(function(n){return e.userInfos.find(function(t){return t.UserName===n})}),e.principalLayout=new n.UI.FlexLayout(0,{wrap:!0}),e}return __extends(r,t),Object.defineProperty(r.prototype,"size",{get:function(){return this.selectedKeys.size},enumerable:!1,configurable:!0}),r.prototype.has=function(n){return this.selectedKeys.has(n)},r.prototype.adds=function(n){var r,t=this,i=[];this.isMultiSelect||this.clear();n.forEach(function(n){t.has(n)||(t.selectedKeys.add(n),i.push(t.userInfos.find(function(t){return t.UserName===n})))});(r=this.canLoadUserInfos).push.apply(r,i);this.dispatch("AddItems",i)},r.prototype.remove=function(n){this.selectedKeys.has(n)&&(this.selectedKeys.delete(n),this.canLoadUserInfos.splice(this.canLoadUserInfos.findIndex(function(t){return t.UserName===n}),1),this.dispatch("PassiveRemove",n))},r.prototype.clear=function(){this.selectedKeys.clear();this.canLoadUserInfos=[];this.dispatch("Clear")},r}(n.UI.UserControl),i;t.UserSelectionArea=r;i=function(i){function r(){return i!==null&&i.apply(this,arguments)||this}return __extends(r,i),r.prototype.createContainer=function(){this.container=this.target.principalLayout.createUI().container},r.prototype.createChildren=function(){this.initData();this.loadMoreContent()},r.prototype.initData=function(){this.target.loadUserStep=25;this.target.loadUserTick=0;this.target.loadUserTimer=0;this.container.empty()},r.prototype.createContainerEvents=function(){var t=this;this.container.on("click","div[data-key] svg",function(n){var i=$(n.currentTarget).parent().attr("data-key");t.target.selectedKeys.has(i)&&(t.target.selectedKeys.delete(i),t.target.canLoadUserInfos.splice(t.target.canLoadUserInfos.findIndex(function(n){return n.UserName===i}),1),t.target.dispatch("ActivelyRemove",i))});this.target.on("AddItems",function(n,i){var r=t.target.loadUserStep*(1+t.target.loadUserTick),u;t.container.children().length>=r||(u=i.slice(0,r-t.container.children().length),u.length!==0)&&(t.handleAddItem(u),t.container.children().length==r&&t.target.loadUserTick++,t.target.containerHeight=Math.ceil(t.container.height()))});this.target.on("ActivelyRemove",function(n,i){t.handleItemRemove(i)});this.target.on("PassiveRemove",function(n,i){t.handleItemRemove(i)});this.target.on("Clear",function(){t.container.empty();t.initData()});this.container.on("scroll",function(i){t.target.loadUserTimer>0&&clearTimeout(t.target.loadUserTimer);t.target.loadUserTimer=setTimeout(function(){n.Common.isShouldLoadMoreContent(i,t.target.containerHeight,t.target.loadScrollDistance)&&t.loadMoreContent()},50)})},r.prototype.loadMoreContent=function(){var t=this.container.children().length,i=this.target.loadUserStep*(1+this.target.loadUserTick),n=this.target.canLoadUserInfos.slice(t,i);n.length!==0&&(this.handleAddItem(n),this.target.loadUserTick++)},r.prototype.handleAddItem=function(n){var t=document.createDocumentFragment();this.getChildrenTemplates(n).forEach(function(n){var i=$(n);t.appendChild(i[0])});this.container.append(t);this.target.containerHeight=Math.ceil(this.container.height())},r.prototype.getChildrenTemplates=function(n){return n.map(function(n){return'\n                <div data-key="'.concat(n.UserName,'">\n                    ').concat(t.BPMCommon.getUserDisplayName(n.UserName,n.FullName),"<\/span>").concat('<svg viewBox="64 64 896 896" focusable="false" fill="currentColor"><path d="M563.8 512l262.5-312.9c4.4-5.2.7-13.1-6.1-13.1h-79.8c-4.7 0-9.2 2.1-12.3 5.7L511.6 449.8 295.1 191.7c-3-3.6-7.5-5.7-12.3-5.7H203c-6.8 0-10.5 7.9-6.1 13.1L459.4 512 196.9 824.9A7.95 7.95 0 00203 838h79.8c4.7 0 9.2-2.1 12.3-5.7l216.5-258.1 216.5 258.1c3 3.6 7.5 5.7 12.3 5.7h79.8c6.8 0 10.5-7.9 6.1-13.1L563.8 512z" /><\/svg>',"\n                <\/div>\n            ")})},r.prototype.handleItemRemove=function(n){this.container.find("div[data-key='".concat(n,"']")).remove()},r}(n.UI.ControlUIBase)})(t=n.BPM||(n.BPM={}))})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var t;(function(t){var u=function(){function t(){}return t.prototype.invokeAsync=function(){var t=this.routeUrl(),f;if(!t||t==="")throw new Error("Route url is undefined");var e=!t.startsWith("/"),u="".concat(this.domainUrl()).concat(e?"/":"").concat(t),o=this.invokeType();switch(o){case i.Get:return f=r.jointGetUrl(u,this),n.Common.forguncyGETAsync(f);case i.Post:return n.Common.forguncyPOSTAsync(u,this);default:throw new Error("Invoke type is undefined");}},t}(),r,i;t.BaseApi=u;r=function(){function n(){}return n.jointGetUrl=function(n,t){var r=[],i,u;for(i in t)Object.prototype.hasOwnProperty.call(t,i)&&(u=t[i],u)&&r.push("".concat(i,"=").concat(u));return r.push("v=".concat((new Date).getTime())),"".concat(n,"?").concat(r.join("&"))},n}(),function(n){n[n.Get=0]="Get";n[n.Post=1]="Post"}(i=t.InvokeType||(t.InvokeType={}))})(t=n.BPM||(n.BPM={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t;(function(n){var t="BpmService",i=function(n){function i(){return n!==null&&n.apply(this,arguments)||this}return __extends(i,n),i.prototype.domainUrl=function(){return t},i}(n.BaseApi);n.BaseEngineApi=i})(t=n.BPM||(n.BPM={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t;(function(n){var t="bpm/runtime",i=function(n){function i(){return n!==null&&n.apply(this,arguments)||this}return __extends(i,n),i.prototype.domainUrl=function(){return t},i}(n.BaseApi);n.BaseServerApi=i})(t=n.BPM||(n.BPM={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t;(function(n){var s=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.routeUrl=function(){return"delegation-configuration/query/list"},i.prototype.invokeType=function(){return n.InvokeType.Get},i}(n.BaseEngineApi),t,i,r,u,f,e,o,h;n.ListConfigurationApi=s;t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.routeUrl=function(){return"delegation-configuration/update-status"},i.prototype.invokeType=function(){return n.InvokeType.Post},i}(n.BaseEngineApi);n.UpdateConfigStatusApi=t;i=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.routeUrl=function(){return"delegation-configuration/delete"},i.prototype.invokeType=function(){return n.InvokeType.Post},i}(n.BaseEngineApi);n.DeleteConfigStatusApi=i;r=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.routeUrl=function(){return"delegation-configuration/create"},i.prototype.invokeType=function(){return n.InvokeType.Post},i}(n.BaseEngineApi);n.CreateConfigurationApi=r;u=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.routeUrl=function(){return"delegation-configuration/update"},i.prototype.invokeType=function(){return n.InvokeType.Post},i}(n.BaseEngineApi);n.UpdateConfigurationApi=u;f=function(){function n(){}return n}();n.DelegationProcessDetailEntity=f;e=function(){function n(){}return n}();n.DelegationToDetailEntity=e;o=function(){function n(){}return n}();n.DelegationConfigurationEntity=o,function(n){n[n.Select=0]="Select";n[n.All=1]="All"}(h=n.DelegationProcessType||(n.DelegationProcessType={}))})(t=n.BPM||(n.BPM={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t;(function(n){var t=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t}(n.BaseEngineApi),i,r,u,f,e,o,s,h,c,l;n.TaskActionApi=t;i=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.routeUrl=function(){return"task/commit"},i.prototype.invokeType=function(){return n.InvokeType.Post},i}(t);n.CommitTaskApi=i;r=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.routeUrl=function(){return"task/terminate"},i.prototype.invokeType=function(){return n.InvokeType.Post},i}(t);n.TerminateTaskApi=r;u=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.routeUrl=function(){return"task/rollback"},i.prototype.invokeType=function(){return n.InvokeType.Post},i}(t);n.RollbackTaskApi=u;f=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.routeUrl=function(){return"task/get-back"},i.prototype.invokeType=function(){return n.InvokeType.Post},i}(t);n.GetBackTaskApi=f;e=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.routeUrl=function(){return"task/dispatch"},t}(i);n.DispatchTaskApi=e;o=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.routeUrl=function(){return"task/delegate"},i.prototype.invokeType=function(){return n.InvokeType.Post},i}(t);n.DelegateTaskApi=o;s=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.routeUrl=function(){return"task/cancel-delegate"},i.prototype.invokeType=function(){return n.InvokeType.Post},i}(t);n.CancelDelegateTaskApi=s;h=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.routeUrl=function(){return"task/add-on-sign"},i.prototype.invokeType=function(){return n.InvokeType.Post},i}(t);n.AddOnSignTaskApi=h;c=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.routeUrl=function(){return"task/carbon-copy"},i.prototype.invokeType=function(){return n.InvokeType.Post},i}(t);n.CarbonCopyTaskApi=c;l=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.routeUrl=function(){return"task/read-carbon-copy"},i.prototype.invokeType=function(){return n.InvokeType.Post},i}(t);n.ReadCarbonCopyTaskApi=l})(t=n.BPM||(n.BPM={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t;(function(n){var t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.routeUrl=function(){return"process-instance/start"},i.prototype.invokeType=function(){return n.InvokeType.Post},i}(n.BaseEngineApi);n.StartProcessInstanceApi=t})(t=n.BPM||(n.BPM={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t;(function(n){var r=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.routeUrl=function(){return"process-definition/query/get-resource-name"},i.prototype.invokeType=function(){return n.InvokeType.Get},i}(n.BaseEngineApi),t,i;n.GetProcessDefinitionResourceNameApi=r;t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.routeUrl=function(){return"process-definition/query/list-by-deployment"},i.prototype.invokeType=function(){return n.InvokeType.Get},i}(n.BaseEngineApi);n.ListByDeploymentApi=t;i=function(){function n(){}return n}();n.DefinitionByDeploymentDto=i})(t=n.BPM||(n.BPM={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t;(function(n){var u=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.routeUrl=function(){return"task/query/detail"},i.prototype.invokeType=function(){return n.InvokeType.Get},i}(n.BaseEngineApi),t,i,r;n.TaskDetailApi=u;t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.routeUrl=function(){return"task/query/notification-number"},i.prototype.invokeType=function(){return n.InvokeType.Get},i}(n.BaseEngineApi);n.ProcessNotificationNumApi=t;i=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.routeUrl=function(){return"task/query/data-permission"},i.prototype.invokeType=function(){return n.InvokeType.Get},i}(n.BaseEngineApi);n.DataPermissionApi=i;r=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.routeUrl=function(){return"task/query/business-key-info"},i.prototype.invokeType=function(){return n.InvokeType.Get},i}(n.BaseEngineApi);n.BusinessKeyInfoApi=r})(t=n.BPM||(n.BPM={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t;(function(n){var i=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.routeUrl=function(){return"delegation-configuration/get-can-be-delegated-infos"},i.prototype.invokeType=function(){return n.InvokeType.Get},i}(n.BaseServerApi),t;n.GetCanBeDelegatedInfosApi=i;t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.routeUrl=function(){return"delegation-configuration/get-userinfos"},i.prototype.invokeType=function(){return n.InvokeType.Post},i}(n.BaseServerApi);n.GetUserInfosApi=t})(t=n.BPM||(n.BPM={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t;(function(n){var o=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.routeUrl=function(){return"task-action/commit"},i.prototype.invokeType=function(){return n.InvokeType.Get},i}(n.BaseServerApi),t,i,r,u,f,e,s;n.GetMoveInfoWithUsersApi=o;t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.routeUrl=function(){return"task-action/dispath"},i.prototype.invokeType=function(){return n.InvokeType.Get},i}(n.BaseServerApi);n.GetDispatchMoveInfoWithUsersApi=t;i=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.routeUrl=function(){return"task-action/delegate"},i.prototype.invokeType=function(){return n.InvokeType.Get},i}(n.BaseServerApi);n.GetDelegateUsersApi=i;r=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.routeUrl=function(){return"task-action/add-on-sign"},i.prototype.invokeType=function(){return n.InvokeType.Get},i}(n.BaseServerApi);n.GetAddOnSignUsersApi=r;u=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.routeUrl=function(){return"task-action/carbon-copy"},i.prototype.invokeType=function(){return n.InvokeType.Get},i}(n.BaseServerApi);n.GetCarbonCopyUsersApi=u;f=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.routeUrl=function(){return"task-action/signature-pad/get-saved"},i.prototype.invokeType=function(){return n.InvokeType.Get},i}(n.BaseServerApi);n.GetSavedSignaturePadApi=f;e=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.routeUrl=function(){return"task-action/signature-pad/update"},i.prototype.invokeType=function(){return n.InvokeType.Post},i}(n.BaseServerApi);n.UpdateSignaturePadApi=e,function(n){n[n.UserTask=0]="UserTask";n[n.CarbonCopyTask=1]="CarbonCopyTask"}(s=n.TrackTaskType||(n.TrackTaskType={}))})(t=n.BPM||(n.BPM={}))})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var t;(function(n){var t,i;(function(n){n[n.SelectByUser=1]="SelectByUser";n[n.All=2]="All"})(t=n.AssigneeTarget||(n.AssigneeTarget={})),function(n){n[n.Fixed=1]="Fixed";n[n.TableField=2]="TableField"}(i=n.HybridValueType||(n.HybridValueType={}))})(t=n.BPM||(n.BPM={}))})(Forguncy||(Forguncy={}))
;var __awaiter=this&&this.__awaiter||function(n,t,i,r){function u(n){return n instanceof i?n:new i(function(t){t(n)})}return new(i||(i=Promise))(function(i,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?i(n.value):u(n.value).then(o,s)}e((r=r.apply(n,t||[])).next())})},__generator=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=e[0]&2?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[e[0]&2,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i,e;return e={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e},Forguncy;(function(n){var t;(function(n){var t=function(){function t(){}return t.prototype.getCanBeDelegatedInfosAsync=function(){return __awaiter(this,void 0,void 0,function(){var i,t;return __generator(this,function(r){switch(r.label){case 0:return i=new n.GetCanBeDelegatedInfosApi,[4,i.invokeAsync()];case 1:if(t=r.sent(),!t||t.code!==200)throw new Error(t===null||t===void 0?void 0:t.message);return[2,t.data]}})})},t.prototype.getUserInfosAsync=function(t){return __awaiter(this,void 0,void 0,function(){var r,i;return __generator(this,function(u){switch(u.label){case 0:return r=new n.GetUserInfosApi,r.userNames=t,[4,r.invokeAsync()];case 1:if(i=u.sent(),!i||i.code!==200)throw new Error(i===null||i===void 0?void 0:i.message);return[2,i.data]}})})},t.prototype.queryConfigurationInfoAsync=function(t){return __awaiter(this,void 0,void 0,function(){var u,r,i;return __generator(this,function(f){switch(f.label){case 0:return u=t!==null&&t!==void 0?t:new n.DelegationConfigurationEntity,r=new n.ListConfigurationApi,r.id=u.id,r.delegationProcessType=u.delegationProcessType,r.enabled=u.enabled,r.startTime=u.startTime,r.endTime=u.endTime,[4,r.invokeAsync()];case 1:if(i=f.sent(),!i||i.code!==200)throw new Error(i===null||i===void 0?void 0:i.message);return[2,i===null||i===void 0?void 0:i.data]}})})},t.prototype.enableConfigurationAsync=function(t){return __awaiter(this,void 0,void 0,function(){var r,i;return __generator(this,function(u){switch(u.label){case 0:return r=new n.UpdateConfigStatusApi,r.id=t,r.isEnabled=!0,[4,r.invokeAsync()];case 1:if(i=u.sent(),!i||i.code!==200)throw new Error(i===null||i===void 0?void 0:i.message);return[2,i===null||i===void 0?void 0:i.data]}})})},t.prototype.disableConfigurationAsync=function(t){return __awaiter(this,void 0,void 0,function(){var r,i;return __generator(this,function(u){switch(u.label){case 0:return r=new n.UpdateConfigStatusApi,r.id=t,r.isEnabled=!1,[4,r.invokeAsync()];case 1:if(i=u.sent(),!i||i.code!==200)throw new Error(i===null||i===void 0?void 0:i.message);return[2,i===null||i===void 0?void 0:i.data]}})})},t.prototype.deleteConfigurationAsync=function(t){return __awaiter(this,void 0,void 0,function(){var r,i;return __generator(this,function(u){switch(u.label){case 0:return r=new n.DeleteConfigStatusApi,r.id=t,[4,r.invokeAsync()];case 1:if(i=u.sent(),!i||i.code!==200)throw new Error(i===null||i===void 0?void 0:i.message);return[2,i===null||i===void 0?void 0:i.data]}})})},t.prototype.createConfigurationAsync=function(t){return __awaiter(this,void 0,void 0,function(){var r,i;return __generator(this,function(u){switch(u.label){case 0:return r=new n.CreateConfigurationApi,r.delegationProcessType=t.delegationProcessType,r.delegateToDetails=t.delegateToDetails,r.delegateProcessDetails=t.delegateProcessDetails,r.startTime=t.startTime,r.endTime=t.endTime,r.description=t.description,[4,r.invokeAsync()];case 1:if(i=u.sent(),!i||i.code!==200)throw new Error(i===null||i===void 0?void 0:i.message);return[2,i===null||i===void 0?void 0:i.data]}})})},t.prototype.updateConfigurationAsync=function(t){return __awaiter(this,void 0,void 0,function(){var i,r;return __generator(this,function(u){switch(u.label){case 0:return i=new n.UpdateConfigurationApi,i.id=t.id,i.delegationProcessType=t.delegationProcessType,i.delegateToDetails=t.delegateToDetails,i.delegateProcessDetails=t.delegateProcessDetails,i.startTime=t.startTime,i.endTime=t.endTime,i.description=t.description,[4,i.invokeAsync()];case 1:if(r=u.sent(),!r||r.code!==200)throw new Error(r===null||r===void 0?void 0:r.message);return[2,r===null||r===void 0?void 0:r.data]}})})},t}();n.DelegationConfigurationService=t})(t=n.BPM||(n.BPM={}))})(Forguncy||(Forguncy={}))
;var __awaiter=this&&this.__awaiter||function(n,t,i,r){function u(n){return n instanceof i?n:new i(function(t){t(n)})}return new(i||(i=Promise))(function(i,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?i(n.value):u(n.value).then(o,s)}e((r=r.apply(n,t||[])).next())})},__generator=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=e[0]&2?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[e[0]&2,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i,e;return e={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e},Forguncy;(function(n){var t;(function(n){var t=function(){function t(){}return t.prototype.getProcessDefinitionResourceNameAsync=function(t){return __awaiter(this,void 0,void 0,function(){var r,i;return __generator(this,function(u){switch(u.label){case 0:return r=new n.GetProcessDefinitionResourceNameApi,r.processDefinitionId=t,[4,r.invokeAsync()];case 1:if(i=u.sent(),!i||i.code!==200)throw new Error(i===null||i===void 0?void 0:i.message);return[2,i.data]}})})},t.prototype.getProcessDefinitionDeploymentAsync=function(){return __awaiter(this,void 0,void 0,function(){var i,t;return __generator(this,function(r){switch(r.label){case 0:return i=new n.ListByDeploymentApi,[4,i.invokeAsync()];case 1:if(t=r.sent(),!t||t.code!==200)throw new Error(t===null||t===void 0?void 0:t.message);return[2,t.data]}})})},t}();n.ProcessDefinitionService=t})(t=n.BPM||(n.BPM={}))})(Forguncy||(Forguncy={}))
;var __awaiter=this&&this.__awaiter||function(n,t,i,r){function u(n){return n instanceof i?n:new i(function(t){t(n)})}return new(i||(i=Promise))(function(i,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?i(n.value):u(n.value).then(o,s)}e((r=r.apply(n,t||[])).next())})},__generator=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=e[0]&2?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[e[0]&2,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i,e;return e={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e},Forguncy;(function(n){var t;(function(n){var t=function(){function t(){}return t.prototype.startProcessAsync=function(t,i){return __awaiter(this,void 0,void 0,function(){var u,f,r;return __generator(this,function(e){switch(e.label){case 0:return u=new n.StartProcessInstanceApi,u.processDefinitionId=t,f=i===null||i===void 0?void 0:i.processInstanceName,f&&(u.processName=f),i.businessKey&&(u.businessKey=i.businessKey),[4,u.invokeAsync()];case 1:if(r=e.sent(),!r||r.code!==200)throw new Error(r===null||r===void 0?void 0:r.message);return[2,r===null||r===void 0?void 0:r.data]}})})},t.prototype.startProcessFormNameAsync=function(t,i){return __awaiter(this,void 0,void 0,function(){var u,f,r;return __generator(this,function(e){switch(e.label){case 0:return u=new n.StartProcessInstanceApi,u.processDefinitionResourceName=t,f=i===null||i===void 0?void 0:i.processInstanceName,f&&(u.processName=f),i.businessKey&&(u.businessKey=i.businessKey),[4,u.invokeAsync()];case 1:if(r=e.sent(),!r||r.code!==200)throw new Error(r===null||r===void 0?void 0:r.message);return[2,r===null||r===void 0?void 0:r.data]}})})},t}();n.ProcessInstanceService=t})(t=n.BPM||(n.BPM={}))})(Forguncy||(Forguncy={}))
;var __awaiter=this&&this.__awaiter||function(n,t,i,r){function u(n){return n instanceof i?n:new i(function(t){t(n)})}return new(i||(i=Promise))(function(i,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?i(n.value):u(n.value).then(o,s)}e((r=r.apply(n,t||[])).next())})},__generator=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=e[0]&2?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[e[0]&2,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i,e;return e={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e},Forguncy;(function(n){var t;(function(n){var t=function(){function t(){}return t.prototype.describeDetailAsync=function(t){return __awaiter(this,void 0,void 0,function(){var r,i;return __generator(this,function(u){switch(u.label){case 0:return r=new n.TaskDetailApi,r.taskId=t,[4,r.invokeAsync()];case 1:if(i=u.sent(),!i||i.code!==200)throw new Error(i===null||i===void 0?void 0:i.message);return[2,i.data]}})})},t.prototype.describeBusinessKeyInfoAsync=function(t){return __awaiter(this,void 0,void 0,function(){var r,i;return __generator(this,function(u){switch(u.label){case 0:return r=new n.BusinessKeyInfoApi,r.taskId=t,[4,r.invokeAsync()];case 1:if(i=u.sent(),!i||i.code!==200)throw new Error(i===null||i===void 0?void 0:i.message);return[2,i.data]}})})},t.prototype.getProcessNotificationNumAsync=function(){return __awaiter(this,void 0,void 0,function(){var i,t;return __generator(this,function(r){switch(r.label){case 0:return i=new n.ProcessNotificationNumApi,[4,i.invokeAsync()];case 1:if(t=r.sent(),!t||t.code!==200)throw new Error(t===null||t===void 0?void 0:t.message);return[2,t.data]}})})},t}();n.TaskQueryService=t})(t=n.BPM||(n.BPM={}))})(Forguncy||(Forguncy={}))
;var __awaiter=this&&this.__awaiter||function(n,t,i,r){function u(n){return n instanceof i?n:new i(function(t){t(n)})}return new(i||(i=Promise))(function(i,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?i(n.value):u(n.value).then(o,s)}e((r=r.apply(n,t||[])).next())})},__generator=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=e[0]&2?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[e[0]&2,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i,e;return e={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e},Forguncy;(function(n){var t;(function(n){var t=function(){function t(){}return t.prototype.getMoveInfoWithUsersAsync=function(t,i){return __awaiter(this,void 0,void 0,function(){var u,r;return __generator(this,function(f){switch(f.label){case 0:return u=new n.GetMoveInfoWithUsersApi,u.taskId=t,u.takeSequenceFlowId=i,[4,u.invokeAsync()];case 1:if(r=f.sent(),!r||r.code!==200)throw new Error(r===null||r===void 0?void 0:r.message);return[2,r.data]}})})},t.prototype.getDispatchMoveInfoWithUsersAsync=function(t,i){return __awaiter(this,void 0,void 0,function(){var u,r;return __generator(this,function(f){switch(f.label){case 0:return u=new n.GetDispatchMoveInfoWithUsersApi,u.taskId=t,u.actionKey=i,[4,u.invokeAsync()];case 1:if(r=f.sent(),!r||r.code!==200)throw new Error(r===null||r===void 0?void 0:r.message);return[2,r.data]}})})},t.prototype.getDelegateInfoAsync=function(){return __awaiter(this,void 0,void 0,function(){var i,t;return __generator(this,function(r){switch(r.label){case 0:return i=new n.GetDelegateUsersApi,[4,i.invokeAsync()];case 1:if(t=r.sent(),!t||t.code!==200)throw new Error(t===null||t===void 0?void 0:t.message);return[2,t.data]}})})},t.prototype.getAddOnSignInfoAsync=function(){return __awaiter(this,void 0,void 0,function(){var i,t;return __generator(this,function(r){switch(r.label){case 0:return i=new n.GetAddOnSignUsersApi,[4,i.invokeAsync()];case 1:if(t=r.sent(),!t||t.code!==200)throw new Error(t===null||t===void 0?void 0:t.message);return[2,t.data]}})})},t.prototype.getCarbonCopyInfoAsync=function(){return __awaiter(this,void 0,void 0,function(){var i,t;return __generator(this,function(r){switch(r.label){case 0:return i=new n.GetCarbonCopyUsersApi,[4,i.invokeAsync()];case 1:if(t=r.sent(),!t||t.code!==200)throw new Error(t===null||t===void 0?void 0:t.message);return[2,t.data]}})})},t.prototype.getSavedSignaturePadAsync=function(){return __awaiter(this,void 0,void 0,function(){var i,t;return __generator(this,function(r){switch(r.label){case 0:return i=new n.GetSavedSignaturePadApi,[4,i.invokeAsync()];case 1:if(t=r.sent(),!t||t.code!==200)throw new Error(t===null||t===void 0?void 0:t.message);return[2,t.data]}})})},t.prototype.updateSignaturePadAsync=function(t){return __awaiter(this,void 0,void 0,function(){var r,i;return __generator(this,function(u){switch(u.label){case 0:return r=new n.UpdateSignaturePadApi,r.signaturePad=t,[4,r.invokeAsync()];case 1:if(i=u.sent(),!i||i.code!==200)throw new Error(i===null||i===void 0?void 0:i.message);return[2,i.data]}})})},t.prototype.commitAsync=function(t,i,r){return __awaiter(this,void 0,void 0,function(){var u,f;return __generator(this,function(e){switch(e.label){case 0:return u=new n.CommitTaskApi,u.taskId=t,u.comment=r===null||r===void 0?void 0:r.comment,u.actionKey=i,u.selectedUserInfos=r===null||r===void 0?void 0:r.selectedUserInfos,u.signaturePad=r===null||r===void 0?void 0:r.signaturePad,[4,u.invokeAsync()];case 1:if(f=e.sent(),!f||f.code!==200)throw new Error(f===null||f===void 0?void 0:f.message);return[2,f.data]}})})},t.prototype.terminateAsync=function(t,i,r){return __awaiter(this,void 0,void 0,function(){var f,u;return __generator(this,function(e){switch(e.label){case 0:return f=new n.TerminateTaskApi,f.taskId=t,f.comment=r===null||r===void 0?void 0:r.comment,f.actionKey=i,f.signaturePad=r===null||r===void 0?void 0:r.signaturePad,[4,f.invokeAsync()];case 1:if(u=e.sent(),!u||u.code!==200)throw new Error(u===null||u===void 0?void 0:u.message);return[2,u.data]}})})},t.prototype.rollbackAsync=function(t,i,r){return __awaiter(this,void 0,void 0,function(){var f,u;return __generator(this,function(e){switch(e.label){case 0:return f=new n.RollbackTaskApi,f.taskId=t,f.comment=r===null||r===void 0?void 0:r.comment,f.actionKey=i,f.signaturePad=r===null||r===void 0?void 0:r.signaturePad,[4,f.invokeAsync()];case 1:if(u=e.sent(),!u||u.code!==200)throw new Error(u===null||u===void 0?void 0:u.message);return[2,u.data]}})})},t.prototype.getBackAsync=function(t,i,r){return __awaiter(this,void 0,void 0,function(){var f,u;return __generator(this,function(e){switch(e.label){case 0:return f=new n.GetBackTaskApi,f.taskId=t,f.comment=r===null||r===void 0?void 0:r.comment,f.actionKey=i,f.signaturePad=r===null||r===void 0?void 0:r.signaturePad,[4,f.invokeAsync()];case 1:if(u=e.sent(),!u||u.code!==200)throw new Error(u===null||u===void 0?void 0:u.message);return[2,u.data]}})})},t.prototype.dispatchAsync=function(t,i,r){return __awaiter(this,void 0,void 0,function(){var u,f;return __generator(this,function(e){switch(e.label){case 0:return u=new n.DispatchTaskApi,u.taskId=t,u.comment=r===null||r===void 0?void 0:r.comment,u.actionKey=i,u.selectedUserInfos=r===null||r===void 0?void 0:r.selectedUserInfos,u.signaturePad=r===null||r===void 0?void 0:r.signaturePad,[4,u.invokeAsync()];case 1:if(f=e.sent(),!f||f.code!==200)throw new Error(f===null||f===void 0?void 0:f.message);return[2,f.data]}})})},t.prototype.delegateAsync=function(t,i,r){return __awaiter(this,void 0,void 0,function(){var u,f;return __generator(this,function(e){switch(e.label){case 0:return u=new n.DelegateTaskApi,u.taskId=t,u.comment=r===null||r===void 0?void 0:r.comment,u.actionKey=i,u.delegateTo=r===null||r===void 0?void 0:r.delegateTo,u.signaturePad=r===null||r===void 0?void 0:r.signaturePad,[4,u.invokeAsync()];case 1:if(f=e.sent(),u.signaturePad=r===null||r===void 0?void 0:r.signaturePad,!f||f.code!==200)throw new Error(f===null||f===void 0?void 0:f.message);return[2,f.data]}})})},t.prototype.cancelDelegateAsync=function(t,i,r){return __awaiter(this,void 0,void 0,function(){var f,u;return __generator(this,function(e){switch(e.label){case 0:return f=new n.CancelDelegateTaskApi,f.taskId=t,f.comment=r===null||r===void 0?void 0:r.comment,f.actionKey=i,[4,f.invokeAsync()];case 1:if(u=e.sent(),!u||u.code!==200)throw new Error(u===null||u===void 0?void 0:u.message);return[2,u.data]}})})},t.prototype.addOnSignAsync=function(t,i,r){return __awaiter(this,void 0,void 0,function(){var u,f;return __generator(this,function(e){switch(e.label){case 0:return u=new n.AddOnSignTaskApi,u.taskId=t,u.comment=r===null||r===void 0?void 0:r.comment,u.actionKey=i,u.addOnSignTos=r===null||r===void 0?void 0:r.addOnSignTos,u.addOnSignCustomType=r===null||r===void 0?void 0:r.addOnSignCustomType,u.signaturePad=r===null||r===void 0?void 0:r.signaturePad,[4,u.invokeAsync()];case 1:if(f=e.sent(),!f||f.code!==200)throw new Error(f===null||f===void 0?void 0:f.message);return[2,f.data]}})})},t.prototype.carbonCopyAsync=function(t,i,r){return __awaiter(this,void 0,void 0,function(){var u,f;return __generator(this,function(e){switch(e.label){case 0:return u=new n.CarbonCopyTaskApi,u.taskId=t,u.comment=r===null||r===void 0?void 0:r.comment,u.actionKey=i,u.carbonCopyTos=r===null||r===void 0?void 0:r.carbonCopyTos,u.signaturePad=r===null||r===void 0?void 0:r.signaturePad,[4,u.invokeAsync()];case 1:if(f=e.sent(),!f||f.code!==200)throw new Error(f===null||f===void 0?void 0:f.message);return[2,f.data]}})})},t.prototype.readCarbonCopyAsync=function(t,i,r){return __awaiter(this,void 0,void 0,function(){var f,u;return __generator(this,function(e){switch(e.label){case 0:return f=new n.ReadCarbonCopyTaskApi,f.taskId=t,f.comment=r===null||r===void 0?void 0:r.comment,f.actionKey=i,[4,f.invokeAsync()];case 1:if(u=e.sent(),!u||u.code!==200)throw new Error(u===null||u===void 0?void 0:u.message);return[2,u.data]}})})},t}(),i;n.TaskActionService=t,function(n){n[n.Text=1]="Text";n[n.SignaturePad=2]="SignaturePad"}(i=n.RemarkKeys||(n.RemarkKeys={}))})(t=n.BPM||(n.BPM={}))})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var t;(function(n){var t=function(){function t(){this.taskActionService=new n.TaskActionService;this.taskQueryService=new n.TaskQueryService;this.processDefinitionService=new n.ProcessDefinitionService;this.processInstanceService=new n.ProcessInstanceService;this.delegationConfigurationService=new n.DelegationConfigurationService}return t}();n.Engine=new t})(t=n.BPM||(n.BPM={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__awaiter=this&&this.__awaiter||function(n,t,i,r){function u(n){return n instanceof i?n:new i(function(t){t(n)})}return new(i||(i=Promise))(function(i,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?i(n.value):u(n.value).then(o,s)}e((r=r.apply(n,t||[])).next())})},__generator=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=e[0]&2?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[e[0]&2,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i,e;return e={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e},__spreadArray=this&&this.__spreadArray||function(n,t,i){if(i||arguments.length===2)for(var r=0,f=t.length,u;r<f;r++)!u&&r in t||(u||(u=Array.prototype.slice.call(t,0,r)),u[r]=t[r]);return n.concat(u||Array.prototype.slice.call(t))},Forguncy;(function(n){var t=function(){function t(){}return t.actionCommand=function(t,i,r,u){var f,e,o,s,h,c;return __awaiter(this,void 0,void 0,function(){var l,p,a,v,it,b,rt,k,tt,d,ut,g,ft,nt,et,y,ot,w;return __generator(this,function(st){switch(st.label){case 0:return st.trys.push([0,53,,54]),[4,n.BPM.Engine.taskQueryService.describeDetailAsync(i)];case 1:l=st.sent();p=new n.CommandLogHelper;p.tryStartNewRoot();p.suspend();p.log(n.Common.format(n.RS.BPM_LogText_ExecuteTaskNodeAction,u,i));p.startChild();a={taskInfo:l,action:r,cell:t,logHelper:p};v=r.key;it=r.type;switch(it){case 100:return[3,2];case 200:return[3,8];case 300:return[3,11];case 301:return[3,14];case 400:return[3,17];case 500:return[3,23];case 501:return[3,29];case 600:return[3,32];case 800:return[3,38];case 801:return[3,44];case 1e3:return[3,46];case 2e3:return[3,48]}return[3,50];case 2:return(b=(f=r===null||r===void 0?void 0:r.commitOption)===null||f===void 0?void 0:f.autoSave,!b)?[3,4]:[4,this.saveBusinessData(a)];case 3:b=st.sent();st.label=4;case 4:return b,[4,n.BPM.Engine.taskActionService.getMoveInfoWithUsersAsync(l.taskId,undefined)];case 5:return rt=st.sent(),[4,this.openTaskActionDialog(u,[new n.BPM.TaskActionDialog_Row_Commit({moveInfo:rt}),new n.BPM.TaskActionDialog_Row_Remark({taskInfo:l,actionKey:v}),new n.BPM.TaskActionDialog_Row_Signature({taskInfo:l,actionKey:v}),])];case 6:return y=st.sent(),[4,this.executeActionCommand(a,y)];case 7:return st.sent(),[3,51];case 8:return[4,this.openTaskActionDialog(u,[new n.BPM.TaskActionDialog_Row_Remark({taskInfo:l,actionKey:v}),new n.BPM.TaskActionDialog_Row_Signature({taskInfo:l,actionKey:v}),])];case 9:return y=st.sent(),[4,this.executeActionCommand(a,y)];case 10:return st.sent(),[3,51];case 11:return[4,this.openTaskActionDialog(u,[new n.BPM.TaskActionDialog_Row_Remark({taskInfo:l,actionKey:v}),new n.BPM.TaskActionDialog_Row_Signature({taskInfo:l,actionKey:v}),])];case 12:return y=st.sent(),[4,this.executeActionCommand(a,y)];case 13:return st.sent(),[3,51];case 14:return[4,this.openTaskActionDialog(u,[new n.BPM.TaskActionDialog_Row_Remark({taskInfo:l,actionKey:v}),new n.BPM.TaskActionDialog_Row_Signature({taskInfo:l,actionKey:v}),])];case 15:return y=st.sent(),[4,this.executeActionCommand(a,y)];case 16:return st.sent(),[3,51];case 17:return(k=(e=r===null||r===void 0?void 0:r.dispatchOption)===null||e===void 0?void 0:e.autoSave,!k)?[3,19]:[4,this.saveBusinessData(a)];case 18:k=st.sent();st.label=19;case 19:return k,[4,n.BPM.Engine.taskActionService.getDispatchMoveInfoWithUsersAsync(i,v)];case 20:return tt=st.sent(),[4,this.openTaskActionDialog(u,[new n.BPM.TaskActionDialog_Row_Commit({moveInfo:tt,initTrackPath:tt.TrackInfo.activityId}),new n.BPM.TaskActionDialog_Row_Remark({taskInfo:l,actionKey:v}),new n.BPM.TaskActionDialog_Row_Signature({taskInfo:l,actionKey:v}),])];case 21:return y=st.sent(),[4,this.executeActionCommand(a,y)];case 22:return st.sent(),[3,51];case 23:return(d=(o=r===null||r===void 0?void 0:r.delegateOption)===null||o===void 0?void 0:o.autoSave,!d)?[3,25]:[4,this.saveBusinessData(a)];case 24:d=st.sent();st.label=25;case 25:return d,[4,n.BPM.Engine.taskActionService.getDelegateInfoAsync()];case 26:return ut=st.sent(),[4,this.openTaskActionDialog(u,[new n.BPM.TaskActionDialog_Row_Delegate({delegateInfo:ut}),new n.BPM.TaskActionDialog_Row_Remark({taskInfo:l,actionKey:v}),new n.BPM.TaskActionDialog_Row_Signature({taskInfo:l,actionKey:v}),])];case 27:return y=st.sent(),[4,this.executeActionCommand(a,y)];case 28:return st.sent(),[3,51];case 29:return[4,this.openTaskActionDialog(u,[new n.BPM.TaskActionDialog_Row_Remark({taskInfo:l,actionKey:v}),])];case 30:return y=st.sent(),[4,this.executeActionCommand(a,y)];case 31:return st.sent(),[3,51];case 32:return(g=(s=r===null||r===void 0?void 0:r.addOnSignOption)===null||s===void 0?void 0:s.autoSave,!g)?[3,34]:[4,this.saveBusinessData(a)];case 33:g=st.sent();st.label=34;case 34:return g,[4,n.BPM.Engine.taskActionService.getAddOnSignInfoAsync()];case 35:return ft=st.sent(),[4,this.openTaskActionDialog(u,[new n.BPM.TaskActionDialog_Row_AddOnSign({addOnSignInfo:ft,type:(h=r.addOnSignOption)===null||h===void 0?void 0:h.type}),new n.BPM.TaskActionDialog_Row_Remark({taskInfo:l,actionKey:v}),new n.BPM.TaskActionDialog_Row_Signature({taskInfo:l,actionKey:v}),])];case 36:return y=st.sent(),[4,this.executeActionCommand(a,y)];case 37:return st.sent(),[3,51];case 38:return(nt=(c=r===null||r===void 0?void 0:r.carbonCopyOption)===null||c===void 0?void 0:c.autoSave,!nt)?[3,40]:[4,this.saveBusinessData(a)];case 39:nt=st.sent();st.label=40;case 40:return nt,[4,n.BPM.Engine.taskActionService.getCarbonCopyInfoAsync()];case 41:return et=st.sent(),[4,this.openTaskActionDialog(u,[new n.BPM.TaskActionDialog_Row_CarbonCopy({carbonCopyInfo:et}),new n.BPM.TaskActionDialog_Row_Remark({taskInfo:l,actionKey:v}),new n.BPM.TaskActionDialog_Row_Signature({taskInfo:l,actionKey:v}),])];case 42:return y=st.sent(),[4,this.executeActionCommand(a,y)];case 43:return st.sent(),[3,51];case 44:return[4,this.executeActionCommand(a,null)];case 45:return st.sent(),[3,51];case 46:return[4,this.executeActionCommand(a,null)];case 47:return st.sent(),[3,51];case 48:return[4,this.executeActionCommand(a,null)];case 49:return st.sent(),[3,51];case 50:throw"error action type";case 51:return n.NormalCellBindingManager.reloadData(null,!1),[4,this.executePostCommand(a)];case 52:return(ot=st.sent(),p.endChild(),p.resume(),p.consoleLog(),!ot)?[2]:(n.Page.reloadBindingData(),t.debounceLoad(),[3,54]);case 53:return(w=st.sent(),w&&w.noAlert)?[2]:(n.Common.IsEmpty(w.message)?alert(w):alert(w.message),[3,54]);case 54:return[2]}})})},t.openTaskActionDialog=function(t,i){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(u){switch(u.label){case 0:return[4,new Promise(function(r){var u=new n.BPM.TaskActionDialog(i);u.title=t||n.RS.ProcessPanelCellType_UnnamedAction;u.on("Confirm",function(n,t){if(!u.verify())return t&&(t.cancel=!0),null;r(u.dialogResult)});u.on("Close",function(n,t){if(!u.canClose()){t&&(t.cancel=!0);return}r(null)});u.on("Cancel",function(){r(null)});if(!u.hasContent){u.dispatch("Confirm");return}u.appendExtraPopup();u.show()})];case 1:if(r=u.sent(),!r)throw{message:"dialog isn't confirmed",noAlert:!0};return[2,r]}})})},t.executePreCommand=function(n){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(i){switch(i.label){case 0:return[4,this.executeForguncyCommand("processprecommand",n)];case 1:if(t=i.sent(),!t){n.logHelper.endChild();n.logHelper.resume();n.logHelper.consoleLog();throw{message:"".concat("processprecommand"," isn't completed"),noAlert:!0};}return[2]}})})},t.executePostCommand=function(n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.executeForguncyCommand("processpostcommand",n)];case 1:return[2,t.sent()]}})})},t.executeForguncyCommand=function(t,i){var u=i.taskInfo,f=i.action,r=i.cell,e=i.logHelper;return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,new Promise(function(i){var s,h,c,l,o;switch(t){case"processprecommand":o=(h=(s=r===null||r===void 0?void 0:r.CellElement)===null||s===void 0?void 0:s.CellType)===null||h===void 0?void 0:h.PreCommands;break;case"processpostcommand":o=(l=(c=r===null||r===void 0?void 0:r.CellElement)===null||c===void 0?void 0:c.CellType)===null||l===void 0?void 0:l.PostCommands;break;default:throw"don't support other eventType";}if(!o||o.length===0){i(!0);return}n.ForguncyData.commandExecutor.executeCommand(o,{runTimePageName:r.runTimePageName,commandTrigger:r,commandID:r.ID,eventType:t,callbackOnCommandCompleted:i,initParams:{Process:{Id:u.processInstanceId,Name:u.processName,DefinitionId:u.processDefinitionId,DefinitionTitle:u.processDefinitionTitle},Task:{Id:u.taskId,Name:u.name,Description:u.description,Assignee:u.assignee},Action:{Name:f.title}},locationString:n.FormulaHelper.getCellLogLocationString(r.ID,r.Name,r.runTimePageName),logHelper:e})})];case 1:return[2,i.sent()]}})})},t.saveBusinessData=function(t){return __awaiter(this,void 0,void 0,function(){var f,s,r,u,h,e,o,c,i,l;return __generator(this,function(a){switch(a.label){case 0:return(f=t.taskInfo,s=t.logHelper,r=f.businessKey,u=f.extensionElement.generalSetting.tables,h=JSON.parse(r!==null&&r!==void 0?r:"[]"),e=h.map(function(n){return n.tableName}),o=new Set(e.concat(u!==null&&u!==void 0?u:[])),o.size===0)?[2]:(c=new Set(e),i=[],o.forEach(function(t){var r,u;n.Common.isBuiltInDataBaseView(t)||(r=n.ForguncyData.pageInfo.normalCellBindingManager.getEditedBindingValues(t),r&&r.length)&&(u=n.ForguncyData.pageInfo.currentRowInfoCollection.getCurrentRowInfo(t),c.has(t)?u&&i.push({tableName:t,UpdateType:"edit"}):u||i.push({tableName:t,UpdateType:"add"}))}),i.length>0&&s.log(n.RS.BPM_LogText_SaveBussinessData+JSON.stringify(i)),[4,this.executeUpdateDataTableCommand(t,i)]);case 1:if(l=a.sent(),l===!1)throw{message:"save data isn't completed",noAlert:!0};return[2]}})})},t.executeUpdateDataTableCommand=function(t,i){var r=t.cell,f=t.logHelper,u;if(i&&i.length!==0)return u=i.map(function(t){var i=t.tableName,r=t.UpdateType;return{$type:"Forguncy.Model.UpdateDataTableCommand, ServerDesignerCommon",ConfirmText:n.RS.ProcessPanelCellType_UpdateCurrentRowsClosure_ConfirmText,RowsToUpdate:0,TableName:i,UpdateType:r,UpdateBindingValues:[],CheckDataValidation:!0,ReloadAfterSucceed:!0}}),new Promise(function(t){n.ForguncyData.commandExecutor.executeCommand(u,{runTimePageName:r.runTimePageName,commandTrigger:r,commandID:r.ID,eventType:"processsavebusinessdatacommand",callbackOnCommandCompleted:t,logHelper:f})})},t.executeActionCommand=function(t,i){return __awaiter(this,void 0,void 0,function(){var u,o,f,e,s,r;return __generator(this,function(h){switch(h.label){case 0:n.PageBuilder.pageCover.show();h.label=1;case 1:return h.trys.push([1,,28,29]),[4,this.executePreCommand(t)];case 2:h.sent();u=t.taskInfo.taskId;o=t.action;f=t.logHelper;e=o.key;s=o.type;switch(s){case 100:return[3,3];case 200:return[3,5];case 300:return[3,7];case 301:return[3,9];case 400:return[3,11];case 500:return[3,13];case 501:return[3,15];case 600:return[3,17];case 800:return[3,19];case 801:return[3,21];case 1e3:return[3,23];case 2e3:return[3,25]}return[3,26];case 3:return[4,n.BPM.Engine.taskActionService.commitAsync(u,e,i)];case 4:return r=h.sent(),this.log(f,n.RS.BPM_LogText_CommitTitle,r===null||r===void 0?void 0:r.logText),[3,27];case 5:return[4,n.BPM.Engine.taskActionService.terminateAsync(u,e,i)];case 6:return r=h.sent(),this.log(f,n.RS.BPM_LogText_TerminateTitle,r===null||r===void 0?void 0:r.logText),[3,27];case 7:return[4,n.BPM.Engine.taskActionService.rollbackAsync(u,e,i)];case 8:return r=h.sent(),this.log(f,n.RS.BPM_LogText_RollbackTitle,r===null||r===void 0?void 0:r.logText),[3,27];case 9:return[4,n.BPM.Engine.taskActionService.getBackAsync(u,e,i)];case 10:return r=h.sent(),this.log(f,n.RS.BPM_LogText_GetBackTitle,r===null||r===void 0?void 0:r.logText),[3,27];case 11:return[4,n.BPM.Engine.taskActionService.dispatchAsync(u,e,i)];case 12:return r=h.sent(),this.log(f,n.RS.BPM_LogText_DispatchTitle,r===null||r===void 0?void 0:r.logText),[3,27];case 13:return[4,n.BPM.Engine.taskActionService.delegateAsync(u,e,i)];case 14:return r=h.sent(),this.log(f,n.RS.BPM_LogText_DelegateTitle,r===null||r===void 0?void 0:r.logText),[3,27];case 15:return[4,n.BPM.Engine.taskActionService.cancelDelegateAsync(u,e,i)];case 16:return r=h.sent(),this.log(f,n.RS.BPM_LogText_CancelDelegateTitle,r===null||r===void 0?void 0:r.logText),[3,27];case 17:return[4,n.BPM.Engine.taskActionService.addOnSignAsync(u,e,i)];case 18:return r=h.sent(),this.log(f,n.RS.BPM_LogText_AddOnSignTitle,r===null||r===void 0?void 0:r.logText),[3,27];case 19:return[4,n.BPM.Engine.taskActionService.carbonCopyAsync(u,e,i)];case 20:return r=h.sent(),this.log(f,n.RS.BPM_LogText_CarbonCopyTitle,r===null||r===void 0?void 0:r.logText),[3,27];case 21:return[4,n.BPM.Engine.taskActionService.readCarbonCopyAsync(u,e,i)];case 22:return r=h.sent(),this.log(f,n.RS.BPM_LogText_ReadCarbonCopyTitle,r===null||r===void 0?void 0:r.logText),[3,27];case 23:return[4,this.saveBusinessData(t)];case 24:return h.sent(),[3,27];case 25:return[3,27];case 26:throw"error type of send action service";case 27:return[3,29];case 28:return n.PageBuilder.pageCover.hide(),[7];case 29:return[2]}})})},t.log=function(n,t,i){n.log(t);i&&(n.startChild(),n.logGroupedText(i),n.endChild())},t.setHorizontalAlignment=function(t,i){switch(i){case n.CellHorizontalAlignment.General:case n.CellHorizontalAlignment.Left:t.css("justify-content","flex-start");break;case n.CellHorizontalAlignment.Center:t.css("justify-content","center");break;case n.CellHorizontalAlignment.Right:t.css("justify-content","flex-end")}},t.setVerticalAlignment=function(t,i){switch(i){case n.CellVerticalAlignment.Top:t.css("align-items","flex-start");break;case n.CellVerticalAlignment.Center:t.css("align-items","center");break;case n.CellVerticalAlignment.Bottom:t.css("align-items","flex-end")}},t.setLineSpacingToControl=function(t,i,r,u){if(i.length!==0)switch(r){case n.CellVerticalAlignment.Top:i.forEach(function(n){return n.css("margin-bottom",u)});break;case n.CellVerticalAlignment.Center:i.forEach(function(n){return n.css("margin-bottom",u)});t.css("margin-bottom","-".concat(u,"px"));break;case n.CellVerticalAlignment.Bottom:i.forEach(function(n){return n.css("margin-top",u)})}},t.setIndentToControl=function(t,i){var r=i.TextIndent,u=i.HorizontalAlignment;if(r&&!(r<0))switch(u){case n.CellHorizontalAlignment.General:case n.CellHorizontalAlignment.Left:t.css("padding-left",r);break;case n.CellHorizontalAlignment.Right:t.css("padding-right",r)}},t}(),i,r;n.ProcessPanelHelper=t;i=function(n){function t(){var t=n.call(this)||this;return t.CellTypeString="Forguncy.ProcessPanelCellType",t.TemplateNameParts=["PROCESS_PANEL"],t}return __extends(t,n),t.prototype.MapPartsNameToDom=function(n){return{PROCESS_PANEL:n}},t}(n.CellTypeStyleTemplateHelperBase);n.ProcessPanelCellTypeStyleTemplateHelper=i;r=function(r){function u(){var n=r!==null&&r.apply(this,arguments)||this;return n._collapsedIndex=-1,n.actionButtonsInfos=[],n}return __extends(u,r),Object.defineProperty(u.prototype,"isWrap",{get:function(){return this.CellElement.StyleInfo.WordWrap},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"collapsedIndex",{get:function(){return this._collapsedIndex},set:function(n){this._collapsedIndex=n;this.updateButtons();t.setHorizontalAlignment(this.getContainer(),this.CellElement.StyleInfo.HorizontalAlignment);this.updateMoreButtonContextMenu()},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"isCollapsed",{get:function(){return this.collapsedIndex>-1},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"contentContainer",{get:function(){return $("#"+this.ID)},enumerable:!1,configurable:!0}),u.prototype.Refresh=function(){this.debounceLoad()},u.prototype.create=function(n){r.prototype.create.call(this,n);n.css({display:"flex"});t.setVerticalAlignment(n,this.CellElement.StyleInfo.VerticalAlignment)},u.prototype.createContent=function(){var t=n.DomUtilities.createJqueryDomElement("div").attr("id",this.ID);return t.css({display:"flex",flexWrap:"nowrap"}),t},u.prototype.onLoad=function(){var t=this;this.debounceLoad();n.ForguncyData.pageInfo.currentRowInfoCollection.bind("currentprocessinfochanged",function(){t.debounceLoad()});n.DependenceCellValueChangeHelper.listenFormulaRefChanged(this.CellElement.DependenceCells,function(){t.debounceLoad()},this.runTimePageName)},u.prototype.onWindowResized=function(){this.updatePanelLayout()},u.prototype.getStyleTemplateHelper=function(){return u.StyleTemplateHelper},u.prototype.applyTemplateStyle=function(){var u=this,i;if(this.actionButtonsInfos.length!==0){var r=__spreadArray(__spreadArray([],this.actionButtonsInfos,!0),[this.moreButtonInfo],!1),s=r.length,f=this.CellElement.CellType,h=f.ActionButtonStyleTemplateInfos,o=f.ButtonGap,c=f.TemplateKey,e=this.getStyleTemplateHelper();e!==null&&(i=n.ForguncyData.GlobalSettings.CellTypeStyleTemplates[e.CellTypeString],i&&r.forEach(function(n){var r,f,s=n.title,l=n.container,t=(f=(r=h.find(function(n){var t=n.ActionTitle;return t===s}))===null||r===void 0?void 0:r.TemplateKey)!==null&&f!==void 0?f:c,o;t&&Object.prototype.hasOwnProperty.call(i,t)&&(o=i[t],Object.prototype.hasOwnProperty.call(i,t)&&e.ApplyTemplateStyle(o,l,u.validateError))}));r.forEach(function(t,i){var r=t.container;n.DomUtilities.setPropertyToDom(u.CellElement,r,u._getDomCreateInfo(),[0]);i<s-2&&r.css("margin-right",o)});this.isWrap&&t.setLineSpacingToControl(this.contentContainer,r.map(function(n){return n.container}),this.CellElement.StyleInfo.VerticalAlignment,o);t.setIndentToControl(this.getContainer(),this.CellElement.StyleInfo)}},u.prototype.debounceLoad=function(){var t=this;this.debounceTimer&&(n.DelayRefresh.clearTimeout(this.debounceTimer),this.debounceTimer=null);this.debounceTimer=n.DelayRefresh.setTimeout(function(){window.requestAnimationFrame(function(){return __awaiter(t,void 0,void 0,function(){var t,i,r;return __generator(this,function(u){switch(u.label){case 0:if(t=n.ForguncyData.pageInfo.currentRowInfoCollection.getTaskId(),!t)return this.clearActionButtons(),[2];u.label=1;case 1:return u.trys.push([1,3,,4]),[4,n.BPM.Engine.taskQueryService.describeDetailAsync(t)];case 2:return i=u.sent(),this.clearActionButtons(),this.createButtons(i),this.updatePanelLayout(!0),[3,4];case 3:return r=u.sent(),alert(r.message),[3,4];case 4:return[2]}})})})},20)},u.prototype.clearActionButtons=function(){this.actionButtonsInfos=[];this.moreButtonInfo=null;this.contentContainer.empty()},u.prototype.calculateCollapsedIndex=function(){if(this.isWrap||this.actionButtonsInfos.length===0)return-1;var n=this.getContainer().width(),t=this.actionButtonsInfos[this.actionButtonsInfos.length-1].arrivedWidth,i=t>n?n-(this.moreButtonInfo.arrivedWidth-t):n;return this.actionButtonsInfos.findIndex(function(n){var t=n.arrivedWidth;return t>i})},u.prototype.updatePanelLayout=function(n){n===void 0&&(n=!1);var t=this.calculateCollapsedIndex();(n||t!==this.collapsedIndex)&&(this.collapsedIndex=t)},u.prototype.createButtons=function(i){var r,u,f=i.extensionElement,e=i.taskId,o=i.isSuspend;return __awaiter(this,void 0,void 0,function(){var c,i,h,s=this;return __generator(this,function(){return c=o?[]:(u=(r=f===null||f===void 0?void 0:f.generalSetting)===null||r===void 0?void 0:r.actions)!==null&&u!==void 0?u:[],i=!1,this.actionButtonsInfos=c.filter(function(n){return n.enable}).map(function(r){var f=r.title||n.RS.ProcessPanelCellType_UnnamedAction,u=f,o=s.CellElement.CellType.CustomizeButtonDisplayText;return n.Common.IsEmpty(o)||(u=s.evaluateFormula(o.replace("{{Title}}",f))),{title:f,displayText:u,container:n.DomUtilities.createJqueryDomElement("div").addClass("fgc-bpm-panel-actionbutton").text(u).click(function(){return __awaiter(s,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return!i?(i=!0,[4,t.actionCommand(this,e,r,u)]):[3,2];case 1:n.sent();i=!1;n.label=2;case 2:return[2]}})})})}}),this.moreButtonInfo={title:"···",displayText:"...",container:n.DomUtilities.createJqueryDomElement("div").addClass("fgc-bpm-panel-morebutton").append($('<svg t="1637914159908" class="icon" viewBox="0 0 1024 1024" version="1.1" fill="currentColor" xmlns="http://www.w3.org/2000/svg" p-id="1337" width="200" height="200"><path d="M227.14123 413.647995c-52.14973 0-94.587262 42.439578-94.587262 94.587262 0 52.14973 42.437531 94.587262 94.587262 94.587262 52.147684 0 94.587262-42.437531 94.587262-94.587262C321.728492 456.087573 279.288914 413.647995 227.14123 413.647995z" p-id="1338"><\/path><path d="M510.903016 413.647995c-52.14973 0-94.587262 42.439578-94.587262 94.587262 0 52.14973 42.437531 94.587262 94.587262 94.587262 52.147684 0 94.587262-42.437531 94.587262-94.587262C605.490278 456.087573 563.051723 413.647995 510.903016 413.647995z" p-id="1339"><\/path><path d="M794.665825 413.647995c-52.14973 0-94.587262 42.439578-94.587262 94.587262 0 52.14973 42.437531 94.587262 94.587262 94.587262 52.147684 0 94.587262-42.437531 94.587262-94.587262C889.253086 456.087573 846.813508 413.647995 794.665825 413.647995z" p-id="1340"><\/path><\/svg>')).click(function(){s.createMoreButtonContextMenu()})},h=__spreadArray(__spreadArray([],this.actionButtonsInfos,!0),[this.moreButtonInfo],!1),this.contentContainer.append(h.map(function(n){return n.container})),this.applyTemplateStyle(),h.forEach(function(n){var t=n.container[0];n.arrivedWidth=t.offsetLeft+t.offsetWidth}),this.moreButtonInfo.arrivedWidth+=this.CellElement.CellType.ButtonGap,[2]})})},u.prototype.updateButtons=function(){var i=this,n,t;this.isCollapsed?(this.actionButtonsInfos.forEach(function(n,t){var r=n.container;t<i.collapsedIndex?r.show():r.hide()}),(n=this.moreButtonInfo)===null||n===void 0?void 0:n.container.show()):(this.actionButtonsInfos.forEach(function(n){var t=n.container;t.show()}),(t=this.moreButtonInfo)===null||t===void 0?void 0:t.container.hide())},u.prototype.createMoreButtonContextMenu=function(){var t,i;this.isCollapsed&&(t=new n.UI.ContextMenu,this.moreButtonContextMenu=t,this.updateMoreButtonContextMenu(),n.ForguncyData.pageInfo.appendExtralPopup(t),i=t.createUI(),n.PageBuilder.pagesContainer.append(i.container),i.applyModifier(new n.UI.AutoLocateModifier(i,new n.UI.Anchor(this.moreButtonInfo.container))),t.show())},u.prototype.updateMoreButtonContextMenu=function(){var r=this,t,i;this.moreButtonContextMenu&&(this.isCollapsed?(t=this.actionButtonsInfos.slice(this.collapsedIndex),i=t.map(function(t){var f=t.title,i=t.displayText,u=t.container;return new n.UI.ContextMenuItem(new n.UI.ContextMenuButton(i).on("Clicked",function(){u.click();r.moreButtonContextMenu.dispose()}))}),this.moreButtonContextMenu.refill(i),this.moreButtonContextMenu.show()):(this.moreButtonContextMenu.refill([]),this.moreButtonContextMenu.hide()))},u.StyleTemplateHelper=new i,u}(n.CellTypeBase);n.ProcessPanelCellType=r;n.CellTypeHelper.registerCellType("Forguncy.ProcessPanelCellType, ServerDesignerCommon",r)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t=function(t){function i(){var n=t!==null&&t.apply(this,arguments)||this;return n.localStorageKey="FGC_PROCESS_TRACKER_INSTANCEKEY",n._iframe=undefined,n.instanceId="",n.Refresh=function(){var t,i;((i=(t=n._iframe)===null||t===void 0?void 0:t.contentWindow)===null||i===void 0?void 0:i.FGC_refresh)?n._iframe.contentWindow.FGC_refresh():n._iframe.contentWindow.location.reload()},n}return __extends(i,t),Object.defineProperty(i.prototype,"contentContainer",{get:function(){return $("#"+this.ID)},enumerable:!1,configurable:!0}),i.prototype.create=function(n){t.prototype.create.call(this,n);this.createIframe(n)},i.prototype.createIframe=function(t){var r=n.PageInfo.getCurrentPageInfo(),u="instId=".concat(this.instanceId),f="lang=".concat(n.RS.Culture),e="font=".concat(n.LocaleFonts.default),o="ID=".concat(r.pageName+"_"+this.ID),s="UserInfoDisplayMode=".concat(n.ForguncyData.GlobalSettings.ProcessUserInfoDisplayMode),h="".concat(n.ForguncyData.ForguncyRoot,"BPM/Portal/tracker.html?").concat(u,"&").concat(f,"&").concat(o,"&").concat(s,"&").concat(e),i=document.createElement("iframe");i.title="tracker";i.width="100%";i.height="100%";i.src=h;i.style.border="none";t[0].innerHTML="";t[0].appendChild(i);this._iframe=i},i.prototype.setValueToElement=function(n,t){var i,r;this.instanceId=t;((r=(i=this._iframe)===null||i===void 0?void 0:i.contentWindow)===null||r===void 0?void 0:r.setTrackerInstaceId)?this._iframe.contentWindow.setTrackerInstaceId(this.instanceId):this.createIframe(n)},i.prototype.getValueFromElement=function(){return this.instanceId},i}(n.CellTypeBase);n.ProcessTrackerCellType=t;n.CellTypeHelper.registerCellType("Forguncy.ProcessTrackerCellType, ServerDesignerCommon",t)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t;(function(t){var r=function(t){function i(i){var r=t.call(this)||this;return r.options=[],r.options=i,r.layouts=new n.UI.FlexLayout(1),r.attrs.popuptype="dialog",r.createContent(),n.Platform.isMobile()?(r.identify("fgc-bpm-task-action-dialog-mobile"),r.defaultUI=f):(r.identify("fgc-bpm-task-action-dialog"),r.defaultUI=u),r}return __extends(i,t),Object.defineProperty(i.prototype,"hasContent",{get:function(){return this.layouts.items.length!==0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"dialogResult",{get:function(){return this.options.reduce(function(n,t){return Object.assign(n,t.result())},{})},enumerable:!1,configurable:!0}),i.prototype.createContent=function(){var n=this;this.options.forEach(function(t){t.generate(n.layouts)})},i.prototype.verify=function(){return this.options.every(function(n){return n.verify()})},i}(t.BPMDialog);t.TaskActionDialog=r;var u=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),Object.defineProperty(t.prototype,"content",{get:function(){return new i(this.target)},enumerable:!1,configurable:!0}),t}(n.UI.DialogUI),f=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),Object.defineProperty(t.prototype,"header",{get:function(){return new e(this.target)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"content",{get:function(){return new i(this.target)},enumerable:!1,configurable:!0}),t}(n.UI.DialogUI),i=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.createChildren=function(){this.addChild(this.target.layouts.createUI())},t}(n.UI.DialogContentUI),e=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.createChildren=function(){n.prototype.createChildren.call(this);this.container.empty();this.addChild(this.target.closeButton.createUI());this.container.append(this.titleContainer)},t}(n.UI.DialogHeaderUI)})(t=n.BPM||(n.BPM={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Forguncy;(function(n){var t;(function(t){var r=function(t){function r(r){var u=t.call(this)||this,f;return u.contentContainer=new n.UI.TextArea({placeholder:n.RS.TaskActionDialog_CommentTextRow_PlaceHolder,autosize:{minRows:5,maxRows:5}}).addAttrs({AutomationId:"remarkRow_TextArea"}),u.defaultUI=i,u.addClass("fgc-bpm-form-row"),n.Platform.isMobile()?(f=new n.UI.TextBlock(n.RS.TaskActionDialog_CommentTextRow_Label).addClass("fgc-bpm-form-row-title"),r&&f.addClass("fgc-bpm-form-field-name-required"),u.principalLayout=new n.UI.FlexLayout(1).addClass("fgc-bpm-form-field-remark").add(f,u.contentContainer)):(f=new n.UI.TextBlock(n.RS.TaskActionDialog_CommentTextRow_Label).addClass("fgc-bpm-form-field-name"),r&&f.addClass("fgc-bpm-form-field-name-required"),u.principalLayout=(new n.UI.FlexLayout).add(f,u.contentContainer)),u}return __extends(r,t),r.prototype.getValue=function(){return this.contentContainer.text.trim()},r}(n.UI.UserControl),i;t.TaskActionDialog_Component_Remark=r;i=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.createChildren=function(){this.addChild(this.target.principalLayout.createUI())},t}(n.UI.ControlUIBase)})(t=n.BPM||(n.BPM={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__awaiter=this&&this.__awaiter||function(n,t,i,r){function u(n){return n instanceof i?n:new i(function(t){t(n)})}return new(i||(i=Promise))(function(i,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?i(n.value):u(n.value).then(o,s)}e((r=r.apply(n,t||[])).next())})},__generator=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=e[0]&2?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[e[0]&2,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i,e;return e={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e},Forguncy;(function(n){var t;(function(t){var r=function(r){function u(){var n=r.call(this)||this;return n.defaultUI=i,n.initUI(),n.initEvents(),n}return __extends(u,r),u.prototype.initUI=function(){this.addClass("fgc-bpm-form-row");this.signaturePad=new n.UI.SignaturePadControl({width:u.SIGNATURE_PAD_WIDTH});this.useSavedSignature=new n.UI.TextBlock(n.RS.TaskActionDialog_Component_Signature_UseSavedSignature).addClass("fgc-bpm-form-field-signature-useSavedSignature");this.saveSignature=new n.UI.Button(n.RS.TaskActionDialog_Component_Signature_SaveSignatureButtonText).addClass("FUI-button-primary").addClass("fgc-bpm-form-field-signature-saveSignature");this.clearSignature=new n.UI.Button(n.RS.TaskActionDialog_Component_Signature_ClearSignatureButtonText).addClass("fgc-bpm-form-field-signature-clearsignature");this.outerContainer=(new n.UI.FlexLayout).addClass("fgc-bpm-form-field-signature").add(new n.UI.TextBlock(n.RS.TaskActionDialog_Component_Signature_SignatureLabel).addClass("fgc-bpm-form-field-name").addClass("fgc-bpm-form-field-name-required"),new n.UI.FlexLayout(0,{wrap:!0}).addCss({width:"100%"}).add(this.signaturePad,new n.UI.FlexLayout(0).addClass("fgc-bpm-form-field-signature-operationalContainer").add(this.useSavedSignature,(new n.UI.FlexLayout).add(this.saveSignature,this.clearSignature))));this.outerContainer.addAttrs({AutomationId:"signatureRow"});this.signaturePad.addAttrs({AutomationId:"signatureRow_signaturePanel"});this.useSavedSignature.addAttrs({AutomationId:"signatureRow_useSavedSignature"});this.saveSignature.addAttrs({AutomationId:"signatureRow_saveSignature"});this.clearSignature.addAttrs({AutomationId:"signatureRow_clearSignature"});n.ForguncyData.AuthenticationType!==3&&(this.useSavedSignature.hide(),this.saveSignature.hide())},u.prototype.initEvents=function(){var i=this;this.useSavedSignature.on("ContainerClicked",function(){return __awaiter(i,void 0,void 0,function(){var i;return __generator(this,function(r){switch(r.label){case 0:return[4,t.Engine.taskActionService.getSavedSignaturePadAsync()];case 1:return i=r.sent(),n.Common.IsEmpty(i)?alert(n.RS.TaskActionDialog_Component_Signature_NoSavedSignature):this.signaturePad.update(i),[2]}})})});this.saveSignature.on("Clicked",function(){return __awaiter(i,void 0,void 0,function(){var i,r;return __generator(this,function(u){switch(u.label){case 0:return i=this.signaturePad.getValue(),[4,t.Engine.taskActionService.updateSignaturePadAsync(i)];case 1:return r=u.sent(),r?n.Common.IsEmpty(i)?alert(n.RS.TaskActionDialog_Component_Signature_SaveSignatureSuccessfullyText_ButValueIsEmpty):alert(n.RS.TaskActionDialog_Component_Signature_SaveSignatureSuccessfullyText):alert(n.RS.TaskActionDialog_Component_Signature_SaveSignatureFailedText),[2]}})})});this.clearSignature.on("Clicked",function(){i.signaturePad.clear()})},u.prototype.isEmpty=function(){return this.signaturePad.isEmpty},u.prototype.getValue=function(){return this.signaturePad.getValue()},u.SIGNATURE_PAD_WIDTH=450,u}(n.UI.UserControl),i;t.TaskActionDialog_Component_Signature=r;i=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.createChildren=function(){this.addChild(this.target.outerContainer.createUI())},t}(n.UI.ControlUIBase)})(t=n.BPM||(n.BPM={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__awaiter=this&&this.__awaiter||function(n,t,i,r){function u(n){return n instanceof i?n:new i(function(t){t(n)})}return new(i||(i=Promise))(function(i,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?i(n.value):u(n.value).then(o,s)}e((r=r.apply(n,t||[])).next())})},__generator=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=e[0]&2?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[e[0]&2,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i,e;return e={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e},Forguncy;(function(n){var t;(function(t){var i=function(i){function r(){var n=i.call(this)||this;return n.initUI(),n.initEvents(),n}return __extends(r,i),r.prototype.initUI=function(){this.addClass("fgc-bpm-form-row");this.signaturePadPlaceHolder=new n.UI.TextBlock(n.RS.TaskActionDialog_Component_Signature_MobileSignaturePadPlaceHolder).addClass("fgc-bpm-form-field-signature-signaturePadPlaceHolder");var f=t.TaskActionDialog_Component_Signature.SIGNATURE_PAD_WIDTH,e=r.fgcBpmTaskActionDialogMobile_fgcBpmFormRow_LeftOrRightPadding,i=r.signatureCanvasBorderWidth,u=Math.min(Math.min(screen.width,screen.height)-(e+i)*2,f);this.signaturePad=new n.UI.SignaturePadControl({canDraw:!1,width:u});this.useSavedSignature=new n.UI.TextBlock(n.RS.TaskActionDialog_Component_Signature_UseSavedSignature).addClass("fgc-bpm-form-field-signature-useSavedSignature");this.openSignatureDialog=new n.UI.Button("",'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="64px" height="64px" viewBox="0 0 64 64" version="1.1" style="width: 16px; height: 16px;" focusable="false" ><g fill-rule="evenodd" fill="currentColor" style="fill: currentcolor;"><path d="M49.8932,5.5338 C48.2432,3.78925155 45.5573,3.78925155 43.9076,5.5338 L40.5142,9.1399 L48.4923,17.5965 L51.8859,13.9916 C53.554,12.2461 53.554,9.4089 51.8859,7.6633 L49.8932,5.5338 L49.8932,5.5338 Z M38.9035,10.8271 L16.6967,34.4155 L16.6967,34.9134 L18.6142,34.9134 L18.6142,36.8312 L20.532,36.8312 L20.532,38.749 L22.4498,38.749 L22.4498,40.6666 L24.3674,40.6666 L24.3674,43.408 L46.9005,19.284 L38.9035,10.8271 L38.9035,10.8271 Z M14.7789,36.4671 L13.954,37.3297 L10.9435,48.8752 L22.6987,45.2123 L23.3505,44.5022 L22.4499,44.5022 L22.4499,42.5846 L20.5321,42.5846 L20.5321,40.6668 L18.6143,40.6668 L18.6143,38.7493 L16.6967,38.7493 L16.6967,36.8315 L14.7789,36.8315 L14.7789,36.4671 L14.7789,36.4671 Z M12.4773,54.3023 L12.4773,57.926 L52.4231,57.926 L52.4231,54.3023 L12.4773,54.3023 Z" fill-rule="nonzero" fill="currentColor" style="fill: currentcolor;"><\/path><\/g><\/svg>').addClass("fgc-bpm-form-field-signature-openSignatureDialog");this.outerContainer=new n.UI.FlexLayout(0,{wrap:!0}).addCss({height:"100%;"}).addClass("fgc-bpm-form-field-signature").add(new n.UI.TextBlock(n.RS.TaskActionDialog_Component_Signature_SignatureLabel).addClass("fgc-bpm-form-field-name").addClass("fgc-bpm-form-field-name-required"),new n.UI.FlexLayout(0,{wrap:!0}).addCss({width:"100%",position:"relative"}).add(this.signaturePadPlaceHolder,this.signaturePad,new n.UI.FlexLayout(0).addClass("fgc-bpm-form-field-signature-operationalContainer").addCss({width:u+i*2}).add(this.useSavedSignature,this.openSignatureDialog)));this.outerContainer.addAttrs({AutomationId:"signatureRow"});this.signaturePad.addAttrs({AutomationId:"signatureRow_signaturePanel"});this.useSavedSignature.addAttrs({AutomationId:"signatureRow_useSavedSignature"});this.openSignatureDialog.addAttrs({AutomationId:"signatureRow_clearSignature"});n.ForguncyData.AuthenticationType!==3&&this.useSavedSignature.hide()},r.prototype.initEvents=function(){var i=this;this.useSavedSignature.on("ContainerClicked",function(){return __awaiter(i,void 0,void 0,function(){var i;return __generator(this,function(r){switch(r.label){case 0:return[4,t.Engine.taskActionService.getSavedSignaturePadAsync()];case 1:return i=r.sent(),n.Common.IsEmpty(i)?(alert(n.RS.TaskActionDialog_Component_Signature_NoSavedSignature),this.updateValue("")):this.updateValue(i),[2]}})})});this.openSignatureDialog.on("Clicked",function(){var t=new u(i.getValue());t.title=n.RS.TaskActionDialog_Component_Signature_MobileDialogTitle;t.on("Confirm",function(){return __awaiter(i,void 0,void 0,function(){var n;return __generator(this,function(i){switch(i.label){case 0:return[4,t.getValueAsync()];case 1:return n=i.sent(),this.updateValue(n),[2]}})})});t.appendExtraPopup();t.show()});this.signaturePad.on("updated",function(){i.signaturePad.isEmpty?i.signaturePadPlaceHolder.show():i.signaturePadPlaceHolder.hide()})},r.prototype.updateValue=function(t){this.signaturePadValue=t;n.Common.IsEmpty(t)?this.signaturePad.clear():this.signaturePad.update(t)},r.prototype.isEmpty=function(){return this.signaturePad.isEmpty},r.prototype.getValue=function(){return this.signaturePadValue},r.fgcBpmTaskActionDialogMobile_fgcBpmFormRow_LeftOrRightPadding=16,r.signatureMobileDialogHeaderHeight=50,r.signatureMobileDialogContentPadding=10,r.signatureMobileButtonWidth=33,r.signatureOperationalAndCanvasSpace=10,r.signatureCanvasBorderWidth=1,r}(t.TaskActionDialog_Component_Signature),u,r;t.TaskActionDialog_Component_Signature_Mobile=i;u=function(i){function u(n){var t=i.call(this)||this;return t.defaultUI=e,t.initUI(n),t.initEvents(),t}return __extends(u,i),u.prototype.initUI=function(i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return this.identify("fgc-bpm-signature-pad-dialog-mobile"),this.addClass("fgc-bpm-form-row"),this.signaturePad=new r({ratioOfWidthToHeight:1/2,initValue:i,width:t.TaskActionDialog_Component_Signature.SIGNATURE_PAD_WIDTH}),this.saveSignature=new n.UI.Button(n.RS.TaskActionDialog_Component_Signature_SaveSignatureButtonText).addClass("FUI-button-primary").addClass("fgc-bpm-form-field-signature-saveSignature"),this.clearSignature=new n.UI.Button(n.RS.TaskActionDialog_Component_Signature_ClearSignatureButtonText).addClass("fgc-bpm-form-field-signature-clearsignature"),this.confirmSignature=new n.UI.Button(n.RS.TaskActionDialog_Component_Signature_ComfirmSignatureButtonText).addClass("FUI-button-primary").addClass("fgc-bpm-form-field-signature-confirmsignature"),this.portraitOperationalContainer=(new n.UI.FlexLayout).addClass("fgc-bpm-form-field-signature-portraitOperationalContainer").add((new n.UI.FlexLayout).add(this.confirmSignature,this.clearSignature),this.saveSignature),this.landscapeOperationalContainer=new n.UI.FlexLayout(1).addClass("fgc-bpm-form-field-signature-landscapeOperationalContainer").add(this.saveSignature,new n.UI.FlexLayout(1).add(this.clearSignature,this.confirmSignature)),this.outerContainer=new n.UI.FlexLayout(1).addClass("fgc-bpm-form-field-signature").add((new n.UI.FlexLayout).add(this.signaturePad,this.landscapeOperationalContainer),this.portraitOperationalContainer),n.UI.SignaturePadControlHelper.screenIsPortrait()?(this.portraitOperationalContainer.show(),this.landscapeOperationalContainer.hide()):(this.portraitOperationalContainer.hide(),this.landscapeOperationalContainer.show()),this.outerContainer.addAttrs({AutomationId:"signatureRow"}),this.signaturePad.addAttrs({AutomationId:"signatureRow_signaturePanel"}),this.saveSignature.addAttrs({AutomationId:"signatureRow_saveSignature"}),this.clearSignature.addAttrs({AutomationId:"signatureRow_clearSignature"}),this.confirmSignature.addAttrs({AutomationId:"signatureRow_mobile_confirmSignature"}),n.ForguncyData.AuthenticationType!==3&&this.saveSignature.hide(),[2]})})},u.prototype.initEvents=function(){var i=this;this.saveSignature.on("Clicked",function(){return __awaiter(i,void 0,void 0,function(){var i,r;return __generator(this,function(u){switch(u.label){case 0:return[4,this.getValueAsync()];case 1:return i=u.sent(),[4,t.Engine.taskActionService.updateSignaturePadAsync(i)];case 2:return r=u.sent(),r?n.Common.IsEmpty(i)?alert(n.RS.TaskActionDialog_Component_Signature_SaveSignatureSuccessfullyText_ButValueIsEmpty):alert(n.RS.TaskActionDialog_Component_Signature_SaveSignatureSuccessfullyText):alert(n.RS.TaskActionDialog_Component_Signature_SaveSignatureFailedText),[2]}})})});this.clearSignature.on("Clicked",function(){i.signaturePad.clear()});this.confirmSignature.on("Clicked",function(){return __awaiter(i,void 0,void 0,function(){return __generator(this,function(){return this.confirm(),[2]})})})},u.prototype.isEmpty=function(){return this.signaturePad.isEmpty},u.prototype.getValueAsync=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.signaturePad.getValueAsync()];case 1:return[2,n.sent()]}})})},u}(t.BPMDialog);t.SignatureMobileDialog=u;r=function(t){function i(){var n=t!==null&&t.apply(this,arguments)||this;return n.defaultUI=f,n}return __extends(i,t),i.prototype.getValueAsync=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return n.Common.IsEmpty(this.result)?[2,""]:[4,i.getDirectionValueAsync({screenIsPortrait:!n.UI.SignaturePadControlHelper.screenIsPortrait(),canvasIsPortrait:!0,signatureValue:this.result})];case 1:return[2,t.sent()]}})})},i.getDirectionValueAsync=function(t){var u=t.screenIsPortrait,r=t.canvasIsPortrait,i=t.signatureValue;return __awaiter(this,void 0,void 0,function(){var t,f;return __generator(this,function(e){switch(e.label){case 0:return n.Common.IsEmpty(i)?[2,""]:u?r?(t=i,[3,3]):[3,1]:[3,4];case 1:return[4,n.UI.SignaturePadControlHelper.clockwise(i)];case 2:t=e.sent();e.label=3;case 3:return[2,t];case 4:return r?[4,n.UI.SignaturePadControlHelper.anti_clockwise(i)]:[3,6];case 5:return f=e.sent(),[3,7];case 6:f=i;e.label=7;case 7:return[2,f]}})})},i}(n.UI.SignaturePadControl);t.SignatureMobileDialogPadControl=r;var f=function(t){function u(){return t!==null&&t.apply(this,arguments)||this}return __extends(u,t),u.prototype.createContainer=function(){var i=this;t.prototype.createContainer.call(this);this.orientationChangeHandler=function(){window.requestAnimationFrame(function(){return __awaiter(i,void 0,void 0,function(){var t=this;return __generator(this,function(){return this.debounceTimer&&(n.DelayRefresh.clearTimeout(this.debounceTimer),this.debounceTimer=null),this.debounceTimer=n.DelayRefresh.setTimeout(function(){t.resizeCanvas()},100),[2]})})})};$(window).on("resize",this.orientationChangeHandler)},u.prototype.dispose=function(){this.orientationChangeHandler&&$(window).off("resize",this.orientationChangeHandler)},u.prototype.getFormatInitValueAsync=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,r.getDirectionValueAsync({screenIsPortrait:n.UI.SignaturePadControlHelper.screenIsPortrait(),canvasIsPortrait:!1,signatureValue:this.target.initValue})];case 1:return[2,t.sent()]}})})},u.prototype.resizeCanvas=function(){return __awaiter(this,void 0,void 0,function(){var t,u,s,h,f,e,a,v,y,p,c,w,o,l;return __generator(this,function(b){switch(b.label){case 0:return this.canvas?(t=this.target.ratioOfWidthToHeight,u=this.canvas[0],s=n.UI.SignaturePadControlHelper.screenIsPortrait(),h=n.UI.SignaturePadControlHelper.canvasIsPortrait(u),f=0,e=0,this.target.width>-1?s?(f=this.target.width/t,e=this.target.width):(f=this.target.width,e=this.target.width/t):(a=$("body").width(),v=$("body").height(),y=i.signatureMobileButtonWidth,p=i.signatureOperationalAndCanvasSpace,c=i.signatureMobileDialogContentPadding,w=i.signatureMobileDialogHeaderHeight,f=a-y-p-c*2,e=v-w-c*2),s?(o=Math.min(f/t,e),u.width=o*t,u.height=o):(o=Math.min(f,e/t),u.width=o,u.height=o*t),!this.signaturePad)?[3,4]:(this.signaturePad.clear(),[4,r.getDirectionValueAsync({screenIsPortrait:n.UI.SignaturePadControlHelper.screenIsPortrait(),canvasIsPortrait:h,signatureValue:this.target.getValue()})]):[2];case 1:return(l=b.sent(),!!n.Common.IsEmpty(l))?[3,3]:[4,this.signaturePad.fromDataURL(l,{ratio:1})];case 2:b.sent();b.label=3;case 3:this.updateResult();b.label=4;case 4:return s?h||($("#".concat("fgc-bpm-signature-pad-dialog-mobile"," .").concat("fgc-bpm-form-field-signature-portraitOperationalContainer")).show(),$("#".concat("fgc-bpm-signature-pad-dialog-mobile"," .").concat("fgc-bpm-form-field-signature-landscapeOperationalContainer")).hide()):h&&($("#".concat("fgc-bpm-signature-pad-dialog-mobile"," .").concat("fgc-bpm-form-field-signature-portraitOperationalContainer")).hide(),$("#".concat("fgc-bpm-signature-pad-dialog-mobile"," .").concat("fgc-bpm-form-field-signature-landscapeOperationalContainer")).show()),[2]}})})},u}(n.UI.SignaturePadControlUI),e=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),Object.defineProperty(t.prototype,"header",{get:function(){return new s(this.target)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"content",{get:function(){return new o(this.target)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"footer",{get:function(){return new h(this.target)},enumerable:!1,configurable:!0}),t}(n.UI.DialogUI),o=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.createChildren=function(){this.addChild(this.target.outerContainer.createUI())},t}(n.UI.DialogContentUI),s=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.createChildren=function(){n.prototype.createChildren.call(this);this.container.empty();this.addChild(this.target.closeButton.createUI());this.container.append(this.titleContainer)},t}(n.UI.DialogHeaderUI),h=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.createContainer=function(){this.container=$("<div><\/div>")},t.prototype.createChildren=function(){},t}(n.UI.DialogFooterUI),c=function(){function n(){}return n}()})(t=n.BPM||(n.BPM={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__spreadArray=this&&this.__spreadArray||function(n,t,i){if(i||arguments.length===2)for(var r=0,f=t.length,u;r<f;r++)!u&&r in t||(u||(u=Array.prototype.slice.call(t,0,r)),u[r]=t[r]);return n.concat(u||Array.prototype.slice.call(t))},Forguncy;(function(n){var t;(function(t){var r=function(r){function u(t){var u=r.call(this)||this,f,e,o;return u.selectedUserNames=[],u.defaultUI=i,f=t.selectableUserInfos&&t.selectableUserInfos.length>0,f?(e=function(){return{isMultiSelect:t.isMultiSelect,selectableUserInfos:t.selectableUserInfos,organizationNodeInfos:t.organizationNodeInfos,selectedUserNames:__spreadArray([],u.selectedUserNames,!0)}},o=function(n){u.selectedUserNames=n.map(function(n){return n.UserName})},u.principalLayout=u.generateUserSelectRow(e,o)):u.principalLayout=new n.UI.TextBlock(n.RS.TaskActionDialog_AssigneesRow_Error_NoUserInfo).addAttrs({AutomationId:"moveInfoRow_noselectedInfo"}),u}return __extends(u,r),u.prototype.getValue=function(){return this.selectedUserNames.join(",")},u.prototype.generateUserSelectRow=function(i,r){var f=new n.UI.Button("",n.Platform.isMobile()?'<?xml version="1.0" encoding="UTF-8"?><svg width="8px" height="12px" viewBox="0 0 8 12" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="Designer-Icon" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><path d="M4.54726758,2.31385803 C4.53447812,2.2990491 4.51692479,2.2944275 4.50336287,2.28056285 C4.50018695,2.27688545 4.49937153,2.27131968 4.49619562,2.26764229 C4.18242368,1.90894768 3.67706884,1.91078789 3.36647295,2.27320806 L-1.76856402,8.4247363 C-2.0791175,8.78805311 -2.0767548,9.3723113 -1.76375725,9.73189857 C-1.60809479,9.9103015 -1.40449282,10 -1.2017077,10 C-0.996518206,10 -0.790556287,9.90846273 -0.634850421,9.72638255 L3.94454148,4.22563179 L8.63967301,9.68567826 C8.79533547,9.86408119 8.99816401,9.95377969 9.20172256,9.95377969 C9.40768448,9.95377969 9.61287397,9.86224242 9.76857984,9.68016224 C10.0791333,9.31774097 10.0767282,8.73253813 9.76377304,8.37295085 L4.54726758,2.31385803 Z" fill="#6B6B6B" transform="translate(4.000000, 6.000000) scale(1, -1) rotate(-270.000000) translate(-4.000000, -6.000000) "><\/path><\/g><\/svg>':'<?xml version="1.0" encoding="utf-8"?><svg version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg"><g transform="matrix(1 0 0 1 -320 -109 )"><path d="M 11 4.000720307931644  C 11 5.070091464100898  10.58420909175021 6.074266749035218  9.827959920080218 6.829189478502059  C 9.630733270899157 7.026073327943607  9.41665703364805 7.199895715734783  9.188994866188807 7.349294356860256  C 9.369802956612034 7.408994278921696  9.54856544721838 7.476299087671891  9.725049281339125 7.551171917176049  C 10.03068835974392 7.680561654988082  10.3247812505914 7.830382004394863  10.606411363392112 8  L 10 8  L 10.000003421276915 8.713608725536616  C 9.146746832375698 8.256671053560197  8.134050113607827 8.006070657625173  7.000716356881469 8.006070657625173  C 3.456649524798763 8.006070657625173  1.0576066635126153 10.454686450525159  1.0576066635126153 14  C 1.0576066635126153 14  0 14  0 14  C 0 13.052671099558637  0.1848701412330911 12.144265281024445  0.550310501413037 11.280193583170785  C 0.9028530736205198 10.444822995862324  1.4073048613040555 9.697006552489668  2.050769461711809 9.052542647649588  C 2.6942320832330893 8.408072796857454  3.4423124927382105 7.904266333711462  4.2763834324237 7.551171917176049  C 4.452610833891185 7.476407242661665  4.6311105538151764 7.409188765542439  4.811650545160887 7.349553176840558  C 4.5835752579369 7.199761042453417  4.369251783882362 7.025378236571171  4.172040079919782 6.827748862638785  C 3.417241267213626 6.072814128039738  3 5.0671982272421445  3 3.999279692068356  C 3.000000000200032 2.9313571551838464  3.4157909082497895 1.9271938753817326  4.172040079919782 1.1722511373612292  C 4.926838892625938 0.4158657826220775  5.930823378786272 0  7 0  C 8.06773026324015 0  9.073173110344783 0.4158657826220775  9.827959920080218 1.1722511373612292  C 10.582758732786374 1.927185871960262  11 2.9313511526177507  11 4.000720307931644  Z M 11.000005605509386 12  L 9 12  L 9 11  L 10.999999999999773 10.999999999997485  L 10.999999999999773 9  L 11.999999999999773 9  L 11.999994394490159 11  L 14 11  L 14 12  L 11.999999999999773 12.000000000002515  L 11.999999999999773 14  L 10.999999999999773 14  L 11.000005605509386 12  Z M 7 1  C 5.345617985413753 1  4 2.3456144762929654  4 4  C 4 5.654382014586247  5.345614476292951 7  7 7  C 8.653111712860323 6.998729354380259  10 5.653115221981139  10 4  C 10 2.346888287139663  8.653115221981125 1  7 1  Z M 13.929498276515346 13.000000003986898  C 13.976412363887789 13.328203127915629  14 13.661618452205573  14 14  C 14 14  12.907256252035495 14  13 13.999999993969809  L 13 12.999999987939617  L 13.929498276515346 13.000000003986898  Z " fill-rule="nonzero" fill="currentColor" stroke="none" transform="matrix(1 0 0 1 320 109 )" /><\/g><\/svg>').addAttrs({AutomationId:"moveInfoRow_editUserButton","fgc-bpm-id":"edit_user_btn"}),u=new n.UI.TextBlock("",n.RS.BPM_AssigneesRow_SelectByUser_Placeholder).addAttrs({AutomationId:"moveInfoRow_selectedInfo"}),e=function(){var e=i(),f=n.Platform.isMobile()?new t.UserSelectorDialogMobile(e):new t.UserSelectorDialog(e);f.on("Confirm",function(){var t=f.dialogResult.selectedUserInfos;r===null||r===void 0?void 0:r(t);u.text=t.map(function(t){return n.Common.IsEmpty(t.FullName)?t.UserName:t.FullName}).join(",")});f.on("Close",function(n,t){if(!f.canClose()){t&&(t.cancel=!0);return}});f.appendExtraPopup();f.show()};f.on("Clicked",function(){e()});u.on("ContainerClicked",function(){e()});return(new n.UI.FlexLayout).add(u,f)},u}(n.UI.UserControl),i;t.TaskActionDialog_Component_UserSelect=r;i=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.createContainer=function(){this.container=$(document.createElement("div")).addClass("fgc-bpm-form-field-selectuser")},t.prototype.createChildren=function(){this.addChild(this.target.principalLayout.createUI())},t}(n.UI.ControlUIBase)})(t=n.BPM||(n.BPM={}))})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var t;(function(t){var i=function(){function i(n){this.payload=n}return i.prototype.generate=function(i){var u=this.payload,f=u.addOnSignInfo,r=u.type;this.taskRow=new t.TaskActionDialog_Component_UserSelect({isMultiSelect:!0,selectableUserInfos:f.SelectableUserInfos,organizationNodeInfos:f.OrganizationNodeInfos});r===undefined||r===1?i.add(new n.UI.TextBlock(n.RS.TaskActionDialog_AssigneesRow_AddOnSignTypePre).addClass("fgc-bpm-textblock-quote")).addAttrs({AutomationId:"addOnSignTypePre"}):r===2?i.add(new n.UI.TextBlock(n.RS.TaskActionDialog_AssigneesRow_AddOnSignTypePost).addClass("fgc-bpm-textblock-quote")).addAttrs({AutomationId:"addOnSignTypePost"}):(this.radioGroup=new n.UI.RadioGroup(1).add(new n.UI.Radio(n.RS.TaskActionDialog_AssigneesRow_AddOnSignTypePre,"FGC_AddOnSignType_Radio").addAttrs({AutomationId:"addOnSignTypePre"}),new n.UI.Radio(n.RS.TaskActionDialog_AssigneesRow_AddOnSignTypePost,"FGC_AddOnSignType_Radio").addAttrs({AutomationId:"addOnSignTypePost"})).addClass("fgc-bpm-radiogroup"),this.radioGroup.items[0].isChecked=!0,i.add(new n.UI.FlexLayout(1).addClass("fgc-bpm-form-row").addAttrs({AutomationId:"addOnSignTypeRow"}).add((new n.UI.FlexLayout).add(new n.UI.TextBlock(n.RS.TaskActionDialog_AssigneesRow_AddOnSignTypeLabel).addClass("fgc-bpm-form-field-name").addClass("fgc-bpm-form-field-name-required"),this.radioGroup))));i.add(new n.UI.FlexLayout(1).addClass("fgc-bpm-form-row").addAttrs({AutomationId:"moveInfoRow"}).add((new n.UI.FlexLayout).add(new n.UI.TextBlock(n.RS.TaskActionDialog_AssigneesRow_AddOnSignToLabel).addClass("fgc-bpm-form-field-name").addClass("fgc-bpm-form-field-name-required"),this.taskRow)))},i.prototype.verify=function(){var t=this.result();return n.Common.IsEmpty(t.addOnSignTos)?(alert(n.RS.TaskActionDialog_AssigneesRow_AddOnSignToCannotBeEmpty),!1):!0},i.prototype.result=function(){var n={addOnSignTos:this.taskRow.getValue()};return this.radioGroup&&(n.addOnSignCustomType=this.radioGroup.items[0].isChecked?1:2),n},i}();t.TaskActionDialog_Row_AddOnSign=i})(t=n.BPM||(n.BPM={}))})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var t;(function(t){var i=function(){function i(n){this.payload=n}return i.prototype.generate=function(i){var r=this.payload.carbonCopyInfo;this.taskRow=new t.TaskActionDialog_Component_UserSelect({isMultiSelect:!0,selectableUserInfos:r.SelectableUserInfos,organizationNodeInfos:r.OrganizationNodeInfos});i.add(new n.UI.FlexLayout(1).addClass("fgc-bpm-form-row").addAttrs({AutomationId:"moveInfoRow"}).add((new n.UI.FlexLayout).add(new n.UI.TextBlock(n.RS.TaskActionDialog_AssigneesRow_CarbonCopyToLabel).addClass("fgc-bpm-form-field-name").addClass("fgc-bpm-form-field-name-required"),this.taskRow)))},i.prototype.verify=function(){var t=this.result();return n.Common.IsEmpty(t.carbonCopyTos)?(alert(n.RS.TaskActionDialog_AssigneesRow_CarbonCopyToCannotBeEmpty),!1):!0},i.prototype.result=function(){return{carbonCopyTos:this.taskRow.getValue()}},i}();t.TaskActionDialog_Row_CarbonCopy=i})(t=n.BPM||(n.BPM={}))})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var t;(function(t){var r=function(){function r(n){this.selectedUserInfos={};this.payload=n}return r.prototype.generate=function(r){var f=this,e=this.payload,u=e.moveInfo,o=e.initTrackPath,h=o===void 0?"":o,s;(u===null||u===void 0?void 0:u.TrackInfo)&&(s=i.getLoopInfos(u,h),s.forEach(function(i){var o=i.trackInfo,e=o.activityId,s=o.activityName,l=o.trackTaskType,c=i.trackPath,h;f.selectedUserInfos[e]||(f.selectedUserInfos[e]={});f.selectedUserInfos[e][c]=new t.TaskActionDialog_Component_UserSelect({isMultiSelect:u.ActivityPropertyInfos[e].userSetting.isMultiple,selectableUserInfos:u.SelectableUserInfos[e],organizationNodeInfos:u.OrganizationNodeInfos});switch(l){case t.TrackTaskType.UserTask:h=n.RS.TaskActionDialog_AssigneesRow_AssginToLabel;break;case t.TrackTaskType.CarbonCopyTask:h=n.RS.TaskActionDialog_AssigneesRow_CarbonCopyToLabel;break;default:throw new Error("error track task type");}r.add(new n.UI.FlexLayout(1).addClass("fgc-bpm-form-row").addAttrs({AutomationId:"moveInfoRow"}).add(new n.UI.TextBlock(s!==null&&s!==void 0?s:n.RS.BPM_UserSetting_UnnamedNode).addClass("fgc-bpm-form-row-title").addAttrs({AutomationId:"moveInfoRow_activityName"}),(new n.UI.FlexLayout).add(new n.UI.TextBlock(h).addClass("fgc-bpm-form-field-name").addClass("fgc-bpm-form-field-name-required"),f.selectedUserInfos[e][c])))}))},r.prototype.verify=function(){var u=this.result(),t=u.selectedUserInfos,i,r;for(i in t)for(r in t[i])if(n.Common.IsEmpty(t[i][r]))return alert(n.RS.TaskActionDialog_AssigneesRow_AssignToCannotBeEmpty),!1;return!0},r.prototype.result=function(){var t=this,n={};return Object.keys(this.selectedUserInfos).forEach(function(i){n[i]={};Object.keys(t.selectedUserInfos[i]).forEach(function(r){n[i][r]=t.selectedUserInfos[i][r].getValue()})}),{selectedUserInfos:n}},r}(),i;t.TaskActionDialog_Row_Commit=r;i=function(){function i(){}return i.getLoopInfos=function(n,i){var r=[];return this.loopTrackInfo(n.TrackInfo,i,function(i,u){var f=n.ActivityPropertyInfos[i===null||i===void 0?void 0:i.activityId],e;f&&(e=f.userSetting.assigneeTarget===t.AssigneeTarget.SelectByUser,e)&&r.push({trackInfo:i,trackPath:u})}),r},i.loopTrackInfo=function(i,r,u){var e=this,f;switch(i===null||i===void 0?void 0:i.trackTaskType){case t.TrackTaskType.UserTask:case t.TrackTaskType.CarbonCopyTask:u(i,r)}(f=i.next)===null||f===void 0?void 0:f.forEach(function(t){e.loopTrackInfo(t,"".concat(n.Common.IsEmpty(r)?"":"".concat(r,"&")).concat(t.activityId),u)})},i}();t.MoveInfoHelper=i})(t=n.BPM||(n.BPM={}))})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var t;(function(t){var i=function(){function i(n){this.payload=n}return i.prototype.generate=function(i){var r=this.payload.delegateInfo;this.taskRow=new t.TaskActionDialog_Component_UserSelect({isMultiSelect:!1,selectableUserInfos:r.SelectableUserInfos,organizationNodeInfos:r.OrganizationNodeInfos});i.add(new n.UI.FlexLayout(1).addClass("fgc-bpm-form-row").addAttrs({AutomationId:"moveInfoRow"}).add((new n.UI.FlexLayout).add(new n.UI.TextBlock(n.RS.TaskActionDialog_AssigneesRow_DelegateToLabel).addClass("fgc-bpm-form-field-name").addClass("fgc-bpm-form-field-name-required"),this.taskRow)))},i.prototype.verify=function(){var t=this.result();return n.Common.IsEmpty(t.delegateTo)?(alert(n.RS.TaskActionDialog_AssigneesRow_DelegateToCannotBeEmpty),!1):!0},i.prototype.result=function(){return{delegateTo:this.taskRow.getValue()}},i}();t.TaskActionDialog_Row_Delegate=i})(t=n.BPM||(n.BPM={}))})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var t;(function(t){var i=function(){function i(n){this.payload=n}return i.prototype.generate=function(n){var i,r,f=this.payload,e=f.taskInfo,o=f.actionKey,u=e.extensionElement.generalSetting.actions.find(function(n){return n.key===o});(this._remark=(i=u===null||u===void 0?void 0:u.remarks)===null||i===void 0?void 0:i.find(function(n){return n.key===t.RemarkKeys.Text}),this._remark&&this._remark.enable)&&(this.taskRow=new t.TaskActionDialog_Component_Remark((r=this._remark)===null||r===void 0?void 0:r.required),n.add(this.taskRow))},i.prototype.verify=function(){var t;return((t=this._remark)===null||t===void 0?void 0:t.required)&&this.taskRow?this.taskRow.getValue().length>0?!0:(alert(n.RS.TaskActionDialog_Component_Remark_CantbeEmpty),!1):!0},i.prototype.result=function(){var n;return{comment:(n=this.taskRow)===null||n===void 0?void 0:n.getValue()}},i}();t.TaskActionDialog_Row_Remark=i})(t=n.BPM||(n.BPM={}))})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var t;(function(t){var i=function(){function i(n){this.payload=n}return i.prototype.generate=function(i){var r,f=this.payload,o=f.taskInfo,s=f.actionKey,u=o.extensionElement.generalSetting.actions.find(function(n){return n.key===s}),e=(r=u===null||u===void 0?void 0:u.remarks)===null||r===void 0?void 0:r.find(function(n){return n.key===t.RemarkKeys.SignaturePad});e&&e.enable&&(this.taskRow=n.Platform.isMobile()?new t.TaskActionDialog_Component_Signature_Mobile:new t.TaskActionDialog_Component_Signature,i.add(this.taskRow))},i.prototype.verify=function(){var t=!n.Common.IsEmpty(this.taskRow);return t?this.taskRow.isEmpty()?(alert(n.RS.TaskActionDialog_Component_Signature_SignatureCannotBeEmpty),!1):!0:!0},i.prototype.result=function(){var n;return{signaturePad:(n=this.taskRow)===null||n===void 0?void 0:n.getValue()}},i}();t.TaskActionDialog_Row_Signature=i})(t=n.BPM||(n.BPM={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__awaiter=this&&this.__awaiter||function(n,t,i,r){function u(n){return n instanceof i?n:new i(function(t){t(n)})}return new(i||(i=Promise))(function(i,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?i(n.value):u(n.value).then(o,s)}e((r=r.apply(n,t||[])).next())})},__generator=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=e[0]&2?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[e[0]&2,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i,e;return e={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e},Forguncy;(function(n){var t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.execute=function(){return __awaiter(this,void 0,void 0,function(){var i,l,f,o,r,s,t,h,e,u,c;return __generator(this,function(a){switch(a.label){case 0:if(i=this.CommandParam,l=i.ProcessDefinitionId,f=i.ReturnResultName,o=this.evaluateFormula(l),r=this.evaluateFormula(i.ProcessInstanceName),r&&r._error){alert(n.RS.ProcessInstanceName_EvaluteError);throw n.RS.ProcessInstanceName_EvaluteError;}return(s=this.getBusinessKeyQuery(i),h=r!==null&&r!==void 0?r:n.RS.BPM_LogText_CallStartProcessCommand_Empty,!(i.StartType===1))?[3,3]:(this.CommandExecutingInfo.logHelper.log(n.Common.format(n.RS.BPM_LogText_CallStartProcessCommand_ByDefinitionID,o,h)),this.CommandExecutingInfo.logHelper.startChild(),[4,this.resolveBusinessKeyAsync(s)]);case 1:return e=a.sent(),[4,this.startAsync(o,e,r)];case 2:return t=a.sent(),[3,6];case 3:return this.CommandExecutingInfo.logHelper.log(n.Common.format(n.RS.BPM_LogText_CallStartProcessCommand_ByName,i.ProcessDefinitionResourceName,h)),this.CommandExecutingInfo.logHelper.startChild(),[4,this.resolveBusinessKeyAsync(s)];case 4:return e=a.sent(),[4,this.startFromNameAsync(i.ProcessDefinitionResourceName,e,r)];case 5:t=a.sent();a.label=6;case 6:t.logText&&this.CommandExecutingInfo.logHelper.logGroupedText(t.logText);this.CommandExecutingInfo.logHelper.endChild();n.NormalCellBindingManager.reloadData(null,!1);u={};t.success?t.page&&t.page!=="%NULL%"?u[f]={ID:t.processInstanceId,Page:t.page,TaskExists:t.taskExists,ErrorMessage:""}:t.page&&t.page!=="%NULL%"||(u[f]={ID:t.processInstanceId,Page:null,TaskExists:t.taskExists,ErrorMessage:""}):u[f]={Page:null,ErrorMessage:t.message,TaskExists:!1};for(c in u)n.ForguncyData.parameterManager.setValue(c,u[c],this.CommandExecutingInfo.logHelper);return[2,n.CommandResult.completed]}})})},i.prototype.getBusinessKeyQuery=function(n){return{queries:[{tableName:n===null||n===void 0?void 0:n.SelectedTable,rowMode:n===null||n===void 0?void 0:n.RowsToUpdate,sqlCondition:n===null||n===void 0?void 0:n.RowsToUpdateCondition,listviewName:n===null||n===void 0?void 0:n.ListViewName,runtimePageName:this.CommandExecutingInfo.runTimePageName,rowOffset:this.CommandParam.rowOffset,columnOffset:this.CommandParam.columnOffset,formulaListRowInfo:this.CommandParam.formulaListRowInfo}]}},i.prototype.resolveBusinessKeyAsync=function(t){return __awaiter(this,void 0,void 0,function(){var r,f,o,i,u,e;return __generator(this,function(s){switch(s.label){case 0:if(!t||!t.queries||t.queries.length===0)return[2,null];r=[];f=0;o=t.queries;s.label=1;case 1:if(!(f<o.length))return[3,6];if(i=o[f],i.tableName===undefined)return[3,5];if(!(i.rowMode===0))return[3,2];if(u=n.ForguncyData.pageInfo.currentRowInfoCollection.getCurrentRowInfo(i.tableName),!u||!u.query)throw n.RS.CurrentRow_NotExist;return r.push({tableName:u.currentTable,primaryKeys:[u.query]}),[3,5];case 2:return(i.rowMode===1)?(i.sqlCondition=n.ConditionHelper.getComputedSqlConditionFormula(i.sqlCondition,i.runtimePageName,n.NullFormulaValueQueryPolicy.EmptyDatas,i.rowOffset,i.columnOffset,i.formulaListRowInfo,!0),[4,n.Common.forguncyPOSTAsync("Home/GetTableDataPrimaryKey",i)]):[3,4];case 3:return e=s.sent(),e&&e.length!==0&&r.push({tableName:i.tableName,primaryKeys:[e[0]]}),[3,5];case 4:throw n.RS.RowMode_NotExist;case 5:return f++,[3,1];case 6:return r.length>0?[2,JSON.stringify(r)]:[2,null]}})})},i.prototype.startAsync=function(t,i,r){return __awaiter(this,void 0,void 0,function(){var u;return __generator(this,function(f){switch(f.label){case 0:return u={},[4,n.BPM.Engine.processInstanceService.startProcessAsync(t,{businessKey:i,processInstanceName:r}).then(function(t){var r,f,i=t.taskList[0];u.success=!0;u.processInstanceId=t.processInstanceId;u.page=(f=(r=i===null||i===void 0?void 0:i.extensionElement)===null||r===void 0?void 0:r.generalSetting)===null||f===void 0?void 0:f.page;u.taskExists=!1;u.logText=t.logText;i&&(u.taskExists=!0,n.ForguncyData.pageInfo.currentRowInfoCollection.setProcessInfo(i.isEnd,i.taskId,i.processInstanceId))}).catch(function(n){var t;u.success=!1;u.message=(t=n===null||n===void 0?void 0:n.message)!==null&&t!==void 0?t:n})];case 1:return f.sent(),[2,u]}})})},i.prototype.startFromNameAsync=function(t,i,r){return __awaiter(this,void 0,void 0,function(){var u;return __generator(this,function(f){switch(f.label){case 0:return u={},[4,n.BPM.Engine.processInstanceService.startProcessFormNameAsync(t,{businessKey:i,processInstanceName:r}).then(function(t){var r,f,i=t.taskList[0];u.taskExists=!1;i&&(u.taskExists=!0,n.ForguncyData.pageInfo.currentRowInfoCollection.setProcessInfo(i.isEnd,i.taskId,i.processInstanceId));u.success=!0;u.processInstanceId=t.processInstanceId;u.page=(f=(r=i===null||i===void 0?void 0:i.extensionElement)===null||r===void 0?void 0:r.generalSetting)===null||f===void 0?void 0:f.page;u.logText=t.logText}).catch(function(n){var t;u.success=!1;u.message=(t=n===null||n===void 0?void 0:n.message)!==null&&t!==void 0?t:n})];case 1:return f.sent(),[2,u]}})})},i}(n.CommandBase);n.ProcessStartCommand=t;n.CommandFactory.registerCommand("Forguncy.Model.ProcessStartCommand, ServerDesignerCommon",t)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__awaiter=this&&this.__awaiter||function(n,t,i,r){function u(n){return n instanceof i?n:new i(function(t){t(n)})}return new(i||(i=Promise))(function(i,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?i(n.value):u(n.value).then(o,s)}e((r=r.apply(n,t||[])).next())})},__generator=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=e[0]&2?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[e[0]&2,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i,e;return e={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e},Forguncy;(function(n){var t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.execute=function(){var t;return __awaiter(this,void 0,void 0,function(){var r,f,i,u,e,o,s,h;return __generator(this,function(c){switch(c.label){case 0:return(r=this.CommandParam,f=r.StartType,i="",!(f===0))?[3,1]:(i=r.ProcessName,[3,3]);case 1:if(!(f===1))return[3,3];if(u=this.evaluateFormula(r.ProcessDefinitionId),u&&u._error){alert(n.RS.ProcessDefinitionId_EvaluteError);throw n.RS.ProcessDefinitionId_EvaluteError;}return[4,n.BPM.Engine.processDefinitionService.getProcessDefinitionResourceNameAsync(u)];case 2:e=c.sent();i=e.substring(0,e.lastIndexOf("."));c.label=3;case 3:return o="".concat(n.ForguncyData.ForguncyRoot,"BPM/Portal/modeler?template=").concat(i,".bpmn&lang=").concat(n.RS.Culture),s=n.ForguncyData.pageInfo.pageID,((t=window===null||window===void 0?void 0:window.TabManager)===null||t===void 0?void 0:t.TabContainer.getCurrentInstance(window,s))?(h=new TabManager.Tab(!1,"",window.location.origin+o,i,0),TabManager.TabContainer.addTab(h,s)):n.Common.openWindow(o),[2,n.CommandResult.completed]}})})},i}(n.CommandBase);n.ProcessOpenOnlineCommand=t;n.CommandFactory.registerCommand("Forguncy.Model.ProcessOpenOnlineCommand, ServerDesignerCommon",t)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__awaiter=this&&this.__awaiter||function(n,t,i,r){function u(n){return n instanceof i?n:new i(function(t){t(n)})}return new(i||(i=Promise))(function(i,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?i(n.value):u(n.value).then(o,s)}e((r=r.apply(n,t||[])).next())})},__generator=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=e[0]&2?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[e[0]&2,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i,e;return e={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e},Forguncy;(function(n){var t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.execute=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.openDelegationListDialog()];case 1:return t.sent(),[2,n.CommandResult.completed]}})})},i.prototype.openDelegationListDialog=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(){return t=new n.BPM.Delegation.DelegationListDialog,t.appendExtraPopup(),t.show(),[2]})})},i}(n.CommandBase);n.ProcessDelegateSettingCommand=t;n.CommandFactory.registerCommand("Forguncy.Model.ProcessDelegateSettingCommand, ServerDesignerCommon",t)})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__awaiter=this&&this.__awaiter||function(n,t,i,r){function u(n){return n instanceof i?n:new i(function(t){t(n)})}return new(i||(i=Promise))(function(i,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?i(n.value):u(n.value).then(o,s)}e((r=r.apply(n,t||[])).next())})},__generator=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=e[0]&2?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[e[0]&2,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i,e;return e={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e},Forguncy;(function(n){var t;(function(t){var i;(function(i){var r=function(){function i(){}return i.getUserInfos=function(n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){switch(i.label){case 0:return[4,t.Engine.delegationConfigurationService.getUserInfosAsync(n)];case 1:return[2,i.sent()||[]]}})})},i.dateFormatValue=function(t){return n.FormatHelper.formatValue(new Date(t),"YYYY-MM-DD hh:mm:ss")},i.delegationToNames=function(i,r){return r.map(function(r){var f,o=r.delegateTo,u=i.find(function(n){var t=n.UserName;return t===o}),e,s;return u?(e=t.BPMCommon.getUserDisplayName(u.UserName,u.FullName),s=(f=u===null||u===void 0?void 0:u.IsEnabled)!==null&&f!==void 0?f:!0,!s)?"(".concat(n.RS.CreateDelegateDialog_User_Disabled,")").concat(e):e:"(".concat(n.RS.CreateDelegateDialog_User_NotExist,")").concat(o)}).join(",")},i.delegationProcessNames=function(i,r){var u=i.delegationProcessType,f=i.delegateProcessDetails;switch(u){case t.DelegationProcessType.Select:return f.map(function(t){var i=t.processDefinitionKey,u=r.find(function(n){var t=n.key;return t===i});return u?u.name:"(".concat(n.RS.CreateDelegateDialog_User_NotExist,")").concat(i)}).join(",");case t.DelegationProcessType.All:return n.RS.DelegationListDialog_Table_AllProcesses;default:throw new Error("error delegation process type");}},i.deletgationListTable=function(t,r,u){var f=t.id,s=t.delegateToDetails,e=t.startTime,o=t.endTime,h=t.createDate,c=t.description,l=t.enabled;return{key:f,id:f,delegationToNames:i.delegationToNames(u,s),delegationProcessNames:i.delegationProcessNames(t,r),startTime:n.Common.IsEmpty(e)?n.RS.DelegationListDialog_Table_EmptyTime:i.dateFormatValue(e),endTime:n.Common.IsEmpty(o)?n.RS.DelegationListDialog_Table_EmptyTime:i.dateFormatValue(o),createDate:i.dateFormatValue(h),description:c,enabled:!!l}},i}(),u=function(u){function e(){var t=u.call(this)||this;return t.defaultUI=f,t.identify("fgc-bpm-delegate-list-dialog"),t.title=n.RS.DelegationListDialog_Title,t.initUI(),t.initUIEvents(),t.initDataAsync(),t}return __extends(e,u),e.prototype.initUI=function(){this.createDelegateButton=new n.UI.Button(n.RS.DelegationListDialog_CreateDelegation).addCss({height:"30px","margin-bottom":"15px",color:"#fff","border-color":"var(--FGC_ButtonPrimary)",background:"var(--FGC_ButtonPrimary)",border:"4px"}).addAttrs({AutomationId:"create_delegate_button"});this.deletgationListTable=new o({isNeedIndex:!0,columns:[{key:"delegationToNames",label:n.RS.DelegationListDialog_Table_DataColumn_Agent,width:"180px",align:"left"},{key:"delegationProcessNames",label:n.RS.DelegationListDialog_Table_DataColumn_DelegatedProcess,width:"180px",align:"left"},{key:"startTime",label:n.RS.DelegationListDialog_Table_DataColumn_StartTime,width:"150px",align:"left"},{key:"endTime",label:n.RS.DelegationListDialog_Table_DataColumn_EndTime,width:"150px",align:"left"},{key:"createDate",label:n.RS.DelegationListDialog_Table_DataColumn_CreateDate,width:"150px",align:"left"},{key:"description",label:n.RS.DelegationListDialog_Table_DataColumn_Description,width:"100px",align:"left"},{key:"status",label:n.RS.DelegationListDialog_Table_DataColumn_Enable,type:"Custom",width:"100px"},{key:"update",label:n.RS.DelegationListDialog_Table_DataColumn_Update,type:"Action"},{key:"delete",label:n.RS.DelegationListDialog_Table_DataColumn_Delete,type:"Action"},]}).addAttrs({AutomationId:"deletgation_list_table"});this.outerlayout=new n.UI.FlexLayout(1).add((new n.UI.FlexLayout).add(this.createDelegateButton),this.deletgationListTable)},e.prototype.initUIEvents=function(){var n=this;this.createDelegateButton.on("Clicked",function(){n.openCreateDelegateDialog()})},e.prototype.initDataAsync=function(){var n;return __awaiter(this,void 0,void 0,function(){var f,i,u,e,o;return __generator(this,function(s){switch(s.label){case 0:return s.trys.push([0,4,,5]),[4,t.Engine.processDefinitionService.getProcessDefinitionDeploymentAsync()];case 1:return f=s.sent()||[],[4,t.Engine.delegationConfigurationService.queryConfigurationInfoAsync()];case 2:return(i=s.sent(),!i)?[2]:(u=new Set,i.forEach(function(n){var t=n.delegateToDetails;t&&t.forEach(function(n){var t=n.delegateTo;return u.add(t)})}),[4,r.getUserInfos(Array.from(u))]);case 3:return e=s.sent(),this.deletgationListTable.dataSource=i.map(function(n){return r.deletgationListTable(n,f,e)}),((n=this.deletgationListTable.dataSource)===null||n===void 0?void 0:n.length)>0&&(this.deletgationListTable.selectedKeys.clear(),this.deletgationListTable.selectedKeys.add(this.deletgationListTable.dataSource[0].key)),this.deletgationListTable.refresh(),[3,5];case 4:return o=s.sent(),console.log(o),[3,5];case 5:return[2]}})})},e.prototype.openCreateDelegateDialog=function(){var r=this,n=new i.CreateDelegateDialog;n.on("Confirm",function(i,u){return __awaiter(r,void 0,void 0,function(){var i;return __generator(this,function(r){switch(r.label){case 0:if(u&&(u.cancel=!0),!n.verify())return[2,null];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,t.Engine.delegationConfigurationService.createConfigurationAsync(n.getDialogResult())];case 2:return r.sent(),u&&(u.cancel=!1),n.dispose(),this.initDataAsync(),[3,4];case 3:return i=r.sent(),console.log(i),alert(i),[3,4];case 4:return[2]}})})});n.appendExtraPopup();n.show()},e}(t.BPMDialog);i.DelegationListDialog=u;var f=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),Object.defineProperty(t.prototype,"content",{get:function(){return new e(this.target)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"footer",{get:function(){return null},enumerable:!1,configurable:!0}),t}(n.UI.DialogUI),e=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.createChildren=function(){this.addChild(this.target.outerlayout.createUI())},t}(n.UI.DialogContentUI),o=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.defaultUI=s,t}return __extends(t,n),t}(n.UI.Table),s=function(u){function f(){return u!==null&&u.apply(this,arguments)||this}return __extends(f,u),f.prototype.getDataColumnCustomTemplate=function(n){var t=n.key;switch(t){case"status":return'<td><input type="checkbox" role="'.concat(t,'"><\/td>');default:return""}},f.prototype.setChildrenCellData=function(n,t,i){return u.prototype.setChildrenCellData.call(this,n,t,i),t.enabled?n.find("[role=status]").prop("checked",!0):n.find("[role=status]").prop("checked",!1),n},f.prototype.updateRowData=function(i,u){return __awaiter(this,void 0,void 0,function(){var s,f,e,h,c,l,o;return __generator(this,function(a){switch(a.label){case 0:return s=this.target.dataSource[i],[4,t.Engine.delegationConfigurationService.queryConfigurationInfoAsync({id:s.id})];case 1:return(f=a.sent(),!f||f.length!==1)?(alert(n.RS.DelegationListDialog_Error_DelegationConfigurationIsEmpty),[2]):(e=f[0],[4,t.Engine.processDefinitionService.getProcessDefinitionDeploymentAsync()]);case 2:return h=a.sent()||[],c=e.delegateToDetails.map(function(n){return n.delegateTo}),[4,r.getUserInfos(c)];case 3:return l=a.sent(),o=r.deletgationListTable(e,h,l),this.target.dataSource[i]=o,this.setChildrenRowData(u,o),[2]}})})},f.prototype.actionExecute=function(r,u,f,e){return __awaiter(this,void 0,void 0,function(){var c,l,h,o,a,v,y,p,w,s,b,k=this;return __generator(this,function(d){switch(d.label){case 0:c=u;switch(c){case"update":return[3,1];case"delete":return[3,5];case"status":return[3,10]}return[3,23];case 1:return d.trys.push([1,3,,4]),l=this.target.dataSource[r],[4,t.Engine.delegationConfigurationService.queryConfigurationInfoAsync({id:l.id})];case 2:if(h=d.sent(),!h||h.length!==1)return alert(n.RS.DelegationListDialog_Error_DelegationConfigurationIsEmpty),[2];o=new i.UpdateDelegateDialog(h[0]);o.on("Confirm",function(n,i){return __awaiter(k,void 0,void 0,function(){var n;return __generator(this,function(u){switch(u.label){case 0:if(i&&(i.cancel=!0),!o.verify())return[2,null];u.label=1;case 1:return u.trys.push([1,4,,5]),[4,t.Engine.delegationConfigurationService.updateConfigurationAsync(o.getDialogResult())];case 2:return u.sent(),i&&(i.cancel=!1),[4,this.updateRowData(r,f)];case 3:return u.sent(),o.dispose(),[3,5];case 4:return n=u.sent(),alert(n),[3,5];case 5:return[2]}})})});return o.appendExtraPopup(),o.show(),[3,4];case 3:return a=d.sent(),alert(a),[2];case 4:return[3,23];case 5:if(s=confirm(n.RS.DelegationListDialog_Comfirm_DeleteConfuguration),!s)return[2];d.label=6;case 6:return d.trys.push([6,8,,9]),[4,t.Engine.delegationConfigurationService.deleteConfigurationAsync(e)];case 7:return d.sent(),f.empty(),[3,9];case 8:return v=d.sent(),alert(v.message),[3,9];case 9:return[3,23];case 10:y=f.find("[role=status]").is(":checked")?"enabled":"disable";p=y;switch(p){case"disable":return[3,11];case"enabled":return[3,17]}return[3,23];case 11:if(s=confirm(n.RS.DelegationListDialog_Comfirm_DisabledConfuguration),!s)return event.preventDefault(),[2];d.label=12;case 12:return d.trys.push([12,15,,16]),[4,t.Engine.delegationConfigurationService.disableConfigurationAsync(e)];case 13:return d.sent(),[4,this.updateRowData(r,f)];case 14:return d.sent(),[3,16];case 15:return w=d.sent(),alert(w.message),[3,16];case 16:return[3,23];case 17:if(s=confirm(n.RS.DelegationListDialog_Comfirm_EnabledConfuguration),!s)return event.preventDefault(),[2];d.label=18;case 18:return d.trys.push([18,21,,22]),[4,t.Engine.delegationConfigurationService.enableConfigurationAsync(e)];case 19:return d.sent(),[4,this.updateRowData(r,f)];case 20:return d.sent(),[3,22];case 21:return b=d.sent(),alert(b.message),[3,22];case 22:return[3,23];case 23:return[2]}})})},f}(n.UI.TableUI)})(i=t.Delegation||(t.Delegation={}))})(t=n.BPM||(n.BPM={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__awaiter=this&&this.__awaiter||function(n,t,i,r){function u(n){return n instanceof i?n:new i(function(t){t(n)})}return new(i||(i=Promise))(function(i,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?i(n.value):u(n.value).then(o,s)}e((r=r.apply(n,t||[])).next())})},__generator=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=e[0]&2?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[e[0]&2,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i,e;return e={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e},Forguncy;(function(n){var t;(function(t){var i;(function(i){var r=function(i){function r(t){t===void 0&&(t={});var r=i.call(this)||this;return r.tableDataSourceConvert={processTable:function(n){var i=n.key,r=n.name,t=n.description;return{key:i,id:i,name:r,description:t!==null&&t!==void 0?t:""}},agentsTable:function(t,i){var u,r=i.find(function(n){var i=n.UserName;return i===t});if(!r)return{key:t,UserName:"(".concat(n.RS.CreateDelegateDialog_User_NotExist,")").concat(t),FullName:"(".concat(n.RS.CreateDelegateDialog_User_NotExist,")"),Email:""};var f=r.UserName,e=r.FullName,o=r.Email,s=(u=r===null||r===void 0?void 0:r.IsEnabled)!==null&&u!==void 0?u:!0;return s?{key:t,UserName:f,FullName:e,Email:o}:{key:t,UserName:"(".concat(n.RS.CreateDelegateDialog_User_Disabled,")").concat(f),FullName:"(".concat(n.RS.CreateDelegateDialog_User_Disabled,")").concat(e),Email:o}}},r.defaultUI=u,r.identify("fgc-bpm-create-delegate-dialog"),r.title=n.RS.CreateDelegateDialog_Title,r.configurationInfo=t,r.initUI(),r.initUIEvents(),r.initDataAsync(),r}return __extends(r,i),r.prototype.initUI=function(){return __awaiter(this,void 0,void 0,function(){var r,u,i=this;return __generator(this,function(){return this.startTimePicker=(new n.UI.DateTimePicker).addAttrs({AutomationId:"start_time_picker"}),this.endTimePicker=(new n.UI.DateTimePicker).addAttrs({AutomationId:"end_time_picker"}),this.selectAgentsButton=new n.UI.Button(n.RS.CreateDelegateDialog_Agent_SelectAgent).addCss({color:"#fff","border-color":"var(--FGC_ButtonPrimary)",background:"var(--FGC_ButtonPrimary)",border:"4px",width:"100px",height:"26px","line-height":"26px",padding:0,"text-align":"center","font-size":"13.33px"}).addAttrs({AutomationId:"select_agents_button"}),r=n.ForguncyData.GlobalSettings.ProcessUserInfoDisplayMode===1,this.agentsTable=new o({columns:[{key:"UserName",label:n.RS.ForguncyUserAvator_UserName,width:r?"0px":"180px"},{key:"FullName",label:n.RS.ForguncyUserAvator_FullName,width:"180px"},{key:"Email",label:n.RS.ForguncyUserAvator_Email,width:"180px"},{key:"delete",label:n.RS.CreateDelegateDialog_Agent_DeleteAgent,type:"Action"}]}).addAttrs({AutomationId:"agents_table"}),this.radios={all:{ui:new n.UI.Radio(n.RS.CreateDelegateDialog_DelegatedProcess_AllProcesses,"delegationProcessType").addAttrs({role:"all",AutomationId:"delegation_process_type_all"}),delegationProcessType:t.DelegationProcessType.All,checkedEvent:function(){i.processTable.hide()}},select:{ui:new n.UI.Radio(n.RS.CreateDelegateDialog_DelegatedProcess_SelectProcesses,"delegationProcessType").addAttrs({role:"select",AutomationId:"delegation_process_type_select"}),delegationProcessType:t.DelegationProcessType.Select,checkedEvent:function(){i.processTable.show()}}},this.processTable=new e({isMultiSelect:!0,columns:[{key:"name",label:n.RS.CreateDelegateDialog_ProcessTable_Title,width:"280px"},{key:"description",label:n.RS.CreateDelegateDialog_ProcessTable_Description,width:"290px"},]}).addAttrs({AutomationId:"process_table"}),this.descriptionTextArea=new n.UI.TextArea({autosize:{minRows:3,maxRows:3},placeholder:n.RS.CreateDelegateDialog_Description_Placeholder}).addAttrs({AutomationId:"description_text_area"}),this.outerlayout=new n.UI.FlexLayout(1).add((new n.UI.FlexLayout).add(new n.UI.TextBlock(n.RS.CreateDelegateDialog_Tip).addCss({height:"auto","line-height":"1.2",margin:"16px 0",color:"#D2A417","font-size":"14.67px"})),new n.UI.FlexLayout(1).add(new n.UI.TextBlock(n.RS.CreateDelegateDialog_DelegatedTime_Title).addClass("fgc-bpm-create-delegate-dialog-group-title"),(new n.UI.FlexLayout).addClass("fgc-bpm-create-delegate-dialog-group-content").addClass("fgc-bpm-create-delegate-dialog-group-item-delegate-time").add((new n.UI.FlexLayout).add(new n.UI.TextBlock(n.RS.CreateDelegateDialog_DelegatedTime_StartTime),this.startTimePicker),(new n.UI.FlexLayout).addCss({"margin-left":"40px"}).add(new n.UI.TextBlock(n.RS.CreateDelegateDialog_DelegatedTime_EndTime),this.endTimePicker))),new n.UI.FlexLayout(1).add(new n.UI.TextBlock(n.RS.CreateDelegateDialog_Agent_Title).addClass("fgc-bpm-create-delegate-dialog-group-title"),new n.UI.FlexLayout(1).addClass("fgc-bpm-create-delegate-dialog-group-content").add((new n.UI.FlexLayout).add(this.selectAgentsButton),new n.UI.TextBlock(n.RS.CreateDelegateDialog_Agent_Tip).addClass("fgc-bpm-create-delegate-dialog-group-tip"),this.agentsTable.addCss({height:"160px","margin-bottom":"30px"}))),new n.UI.FlexLayout(1).add(new n.UI.TextBlock(n.RS.CreateDelegateDialog_DelegatedProcess_Title).addClass("fgc-bpm-create-delegate-dialog-group-title"),new n.UI.FlexLayout(1).addClass("fgc-bpm-create-delegate-dialog-group-content").add((new n.UI.FlexLayout).addClass("fgc-bpm-create-delegate-dialog-group-item-delegate-process").add(new n.UI.TextBlock(n.RS.CreateDelegateDialog_DelegatedProcess_Type),(u=new n.UI.RadioGroup).add.apply(u,Object.keys(this.radios).map(function(n){return i.radios[n].ui}))),new n.UI.TextBlock(n.RS.CreateDelegateDialog_DelegatedProcess_Tip).addClass("fgc-bpm-create-delegate-dialog-group-tip"),this.processTable.addCss({height:"180px"}))),new n.UI.FlexLayout(1).addClass("fgc-bpm-create-delegate-dialog-group-item-description").add(new n.UI.TextBlock(n.RS.CreateDelegateDialog_Description_Title).addClass("fgc-bpm-create-delegate-dialog-group-title"),new n.UI.FlexLayout(1).addClass("fgc-bpm-create-delegate-dialog-group-content").add(this.descriptionTextArea))),[2]})})},r.prototype.initUIEvents=function(){var n=this;this.selectAgentsButton.on("Clicked",function(){return __awaiter(n,void 0,void 0,function(){return __generator(this,function(){return this.openSelectAgentsDialog(),[2]})})});Object.keys(this.radios).forEach(function(t){var i=n.radios[t],r=i.ui,u=i.checkedEvent,f=i.delegationProcessType;r.on("Checked",function(){u();n.delegationProcessType=f})})},r.prototype.initDataAsync=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return this.radios.all.ui.isChecked=!0,this.radios.all.ui.dispatch("Checked"),[4,this.initProcessTableData()];case 1:return n.sent(),[2]}})})},r.prototype.initProcessTableData=function(){return __awaiter(this,void 0,void 0,function(){var n,i,r=this;return __generator(this,function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,t.Engine.processDefinitionService.getProcessDefinitionDeploymentAsync()];case 1:return n=u.sent()||[],this.processTable.dataSource=n.map(function(n){return r.tableDataSourceConvert.processTable(n)}),this.processTable.refresh(),[3,3];case 2:return i=u.sent(),console.log(i),[3,3];case 3:return[2]}})})},r.prototype.openSelectAgentsDialog=function(){return __awaiter(this,void 0,void 0,function(){var r,n,i=this;return __generator(this,function(u){switch(u.label){case 0:return!this.canBeDelegatedUserInfos?[4,t.Engine.delegationConfigurationService.getCanBeDelegatedInfosAsync()]:[3,2];case 1:r=u.sent();this.canBeDelegatedUserInfos=r.SelectableUserInfos||[];this.organizationNodeInfos=r.OrganizationNodeInfos;u.label=2;case 2:n=new t.UserSelectorDialog({selectableUserInfos:this.canBeDelegatedUserInfos,organizationNodeInfos:this.organizationNodeInfos});n.on("Confirm",function(){var t=n.dialogResult.selectedUserInfos,f=t&&t.length>0,r,u;f&&((r=t[0].UserName,u=i.agentsTable.dataSource.some(function(n){var t=n.key;return t===r}),u)||(i.agentsTable.dataSource.push(i.tableDataSourceConvert.agentsTable(r,i.canBeDelegatedUserInfos)),i.agentsTable.refresh()))});return n.appendExtraPopup(),n.show(),[2]}})})},r.prototype.getDialogResult=function(){var r=this.agentsTable.dataSource.map(function(n){return n.key}),u=this.processTable.selectedKeys,t=this.startTimePicker.getValue(),i=this.endTimePicker.getValue();return{startTime:n.Common.IsEmpty(t)?"":t.toISOString(),endTime:n.Common.IsEmpty(i)?"":i.toISOString(),description:this.descriptionTextArea.text,delegationProcessType:this.delegationProcessType,delegateToDetails:r.map(function(n){return{delegateTo:n}}),delegateProcessDetails:Array.from(u).map(function(n){return{processDefinitionKey:n}})}},r.prototype.verify=function(){var i=this.getDialogResult(),r=i.startTime,u=i.endTime,f=i.delegateToDetails,o=i.delegationProcessType,e=i.delegateProcessDetails,s=n.Common.IsEmpty(r),h=n.Common.IsEmpty(u);return!s&&!h&&new Date(u).valueOf()<=new Date(r).valueOf()?(alert(n.RS.CreateDelegateDialog_DelegatedTime_Error_EndTimeMustEarilerStartTime),!1):(f&&f.length>0)?o===t.DelegationProcessType.Select&&(!e||e.length===0)?(alert(n.RS.CreateDelegateDialog_DelegatedProcess_Error_ProcessCannotBeEmpty),!1):!0:(alert(n.RS.CreateDelegateDialog_Agent_Error_AgentCannotBeEmpty),!1)},r}(t.BPMDialog);i.CreateDelegateDialog=r;var u=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),Object.defineProperty(t.prototype,"content",{get:function(){return new f(this.target)},enumerable:!1,configurable:!0}),t}(n.UI.DialogUI),f=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.createChildren=function(){this.addChild(this.target.outerlayout.createUI())},t}(n.UI.DialogContentUI),e=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t}(n.UI.Table),o=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.defaultUI=s,t}return __extends(t,n),t}(n.UI.Table),s=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.actionExecute=function(n,t,i,r){switch(t){case"delete":var u=confirm("确定删除代理人".concat($(i).find('td[data-key="'.concat(r,'"]')).text(),"吗？"));if(!u)return;this.target.dataSource.splice(n,1);$(i).remove()}},t}(n.UI.TableUI)})(i=t.Delegation||(t.Delegation={}))})(t=n.BPM||(n.BPM={}))})(Forguncy||(Forguncy={}))
;var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__assign=this&&this.__assign||function(){return __assign=Object.assign||function(n){for(var t,r,i=1,u=arguments.length;i<u;i++){t=arguments[i];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},__assign.apply(this,arguments)},__awaiter=this&&this.__awaiter||function(n,t,i,r){function u(n){return n instanceof i?n:new i(function(t){t(n)})}return new(i||(i=Promise))(function(i,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?i(n.value):u(n.value).then(o,s)}e((r=r.apply(n,t||[])).next())})},__generator=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=e[0]&2?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[e[0]&2,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i,e;return e={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e},__spreadArray=this&&this.__spreadArray||function(n,t,i){if(i||arguments.length===2)for(var r=0,f=t.length,u;r<f;r++)!u&&r in t||(u||(u=Array.prototype.slice.call(t,0,r)),u[r]=t[r]);return n.concat(u||Array.prototype.slice.call(t))},Forguncy;(function(n){var t;(function(t){var i;(function(i){var r=function(i){function r(t){var r=i.call(this,t)||this;return r.title=n.RS.UpdateDelegateDialog_Title,r}return __extends(r,i),r.prototype.getDialogResult=function(){var n=i.prototype.getDialogResult.call(this);return __assign({id:this.configurationInfo.id},n)},r.prototype.initProcessTableData=function(){return __awaiter(this,void 0,void 0,function(){var i,u,f,r,e,o,s,h,c=this;return __generator(this,function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),i=this.configurationInfo,u=i.delegationProcessType,f=i.delegateProcessDetails,[4,t.Engine.processDefinitionService.getProcessDefinitionDeploymentAsync()];case 1:return r=l.sent()||[],e=u===t.DelegationProcessType.Select,o=e&&f||[],s=o.filter(function(n){var t=n.processDefinitionKey;return r.findIndex(function(n){var i=n.key;return i===t})===-1}).map(function(t){var i=t.processDefinitionKey;return{key:i,name:"(".concat(n.RS.CreateDelegateDialog_User_NotExist,")").concat(i),description:""}}),this.processTable.dataSource=__spreadArray(__spreadArray([],s,!0),r,!0).map(function(n){return c.tableDataSourceConvert.processTable(n)}),this.processTable.refresh(),[3,3];case 2:return h=l.sent(),console.log(h),[3,3];case 3:return[2]}})})},r.prototype.initDataAsync=function(){return __awaiter(this,void 0,void 0,function(){var n,r,u,f,e,o,s,h,c,l,a=this;return __generator(this,function(v){switch(v.label){case 0:return[4,i.prototype.initDataAsync.call(this)];case 1:return v.sent(),n=this.configurationInfo,r=n.startTime,u=n.endTime,f=n.delegateToDetails,e=n.delegationProcessType,o=n.delegateProcessDetails,s=n.description,this.startTimePicker.setValue(r),this.endTimePicker.setValue(u),h=this.configurationInfo.delegateToDetails.map(function(n){return n.delegateTo}),[4,t.Engine.delegationConfigurationService.getUserInfosAsync(h)];case 2:c=v.sent();this.agentsTable.dataSource=f.map(function(n){var t=n.delegateTo;return a.tableDataSourceConvert.agentsTable(t,c)});this.agentsTable.refresh();switch(e){case t.DelegationProcessType.Select:this.radios.select.ui.isChecked=!0;this.radios.select.ui.dispatch("Checked");l=o.map(function(n){return n.processDefinitionKey});this.processTable.selectedKeys=new Set(l);this.processTable.refresh();break;case t.DelegationProcessType.All:this.radios.all.ui.isChecked=!0;this.radios.all.ui.dispatch("Checked");break;default:throw new Error("error delegation process type");}return this.descriptionTextArea.text=s,[2]}})})},r}(i.CreateDelegateDialog);i.UpdateDelegateDialog=r})(i=t.Delegation||(t.Delegation={}))})(t=n.BPM||(n.BPM={}))})(Forguncy||(Forguncy={}))
;var __awaiter=this&&this.__awaiter||function(n,t,i,r){function u(n){return n instanceof i?n:new i(function(t){t(n)})}return new(i||(i=Promise))(function(i,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?i(n.value):u(n.value).then(o,s)}e((r=r.apply(n,t||[])).next())})},__generator=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=e[0]&2?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[e[0]&2,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i,e;return e={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e},Forguncy;(function(n){var i,r,t,u;(function(n){n.css="css";n.js="js"})(t||(t={}));u=function(){function n(){}Object.defineProperty(n,"hiddenProperty",{get:function(){return["hidden","webkitHidden","mozHidden"].find(function(n){return n in document})},enumerable:!1,configurable:!0});Object.defineProperty(n,"isActivated",{get:function(){return!document[this.hiddenProperty]},enumerable:!1,configurable:!0});n.updateUrlVersion=function(n){var i=(new Date).getTime().toString(),r=n.split("?"),f=r[0],u=r[1],t;return u?(t=new URLSearchParams(u),t.has("v")?t.set("v",i):t.append("v",i),f+"?"+t.toString()):n+"?v="+i};n.handleCssChanged=function(t){var r=document.querySelector("link[href*='".concat(t,"']")),i;r!=null&&(i=r,i.href=n.updateUrlVersion(i.href),console.log("[hot-update]: "+t))};n.handleJsChanged=function(n){var t=document.querySelector("script[src*='".concat(n,"']"));t!=null&&window.location.reload()};n.ensureHasVisibilityChangeListener=function(){var i=this,n,t;this._hasVisibilityChangeListener||(n=this.hiddenProperty.replace(/hidden/i,"visibilitychange"),t=function(){return __awaiter(i,void 0,void 0,function(){return __generator(this,function(){return(document.removeEventListener(n,t),this._hasVisibilityChangeListener=!1,!this.isActivated)?[2]:(this._unprocessedJsFiles.forEach(this.handleJsChanged.bind(this)),this._unprocessedCssFiles.forEach(this.handleCssChanged.bind(this)),this._unprocessedCssFiles.clear(),this._unprocessedJsFiles.clear(),[2])})})},document.addEventListener(n,t),this._hasVisibilityChangeListener=!0)};n.handleChanged=function(t){var i,f,r,u=t.replace(/\\/g,"/"),e=(i=u.split(".").pop())===null||i===void 0?void 0:i.toLowerCase();if(this.isActivated){(r=(f=n._updateHandler)[e])===null||r===void 0?void 0:r.call(f,u);return}this._unprocessedFiles[e].add(u);this.ensureHasVisibilityChangeListener()};var u;return u=n,n._unprocessedCssFiles=new Set,n._unprocessedJsFiles=new Set,n._hasVisibilityChangeListener=!1,n._updateHandler=(i={},i[t.css]=u.handleCssChanged.bind(u),i[t.js]=u.handleJsChanged.bind(u),i),n._unprocessedFiles=(r={},r[t.css]=u._unprocessedCssFiles,r[t.js]=u._unprocessedJsFiles,r),n}();n.StaticFileHotUpdate=u})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var f=function(){function i(){}return Object.defineProperty(i,"NotificationHub",{get:function(){var n;return(n=i.notificationHub)!==null&&n!==void 0?n:new r},enumerable:!1,configurable:!0}),i.Init=function(){var u,f;if(!i.notificationHub)try{t.Init();((f=(u=n.ForguncyData)===null||u===void 0?void 0:u.GlobalSettings)===null||f===void 0?void 0:f.HasNotification)===!0||n.ForguncyData.isDebugMode()?i.Create():i.notificationHub=new r}catch(e){n.HubManager.notificationHub=null}},i.Create=function(){var u=n.ForguncyData.ForguncyRoot+"ForguncyHub/SR",r=(new signalR.HubConnectionBuilder).withUrl(u).configureLogging(signalR.LogLevel.None).withAutomaticReconnect({nextRetryDelayInMilliseconds:function(){return 5e3}}).build();r.on("ExecuteCommand",function(n){i.ExecuteCommand(n)});r.on("AskClientSubscribeInfoClient",function(r,u){var f,e;u.isSubscribed=t.CurrentSubscribeNotification.UserName===n.ForguncyData.userInfo.UserName&&((e=(f=t.CurrentSubscribeNotification.MessageInfo)===null||f===void 0?void 0:f.get(u===null||u===void 0?void 0:u.notificationName))===null||e===void 0?void 0:e.length)>0;i.NotificationHub.invoke("ReturnToServerSubscribeInfoClient",r,u)});r.on("StaticFileChanged",n.StaticFileHotUpdate.handleChanged.bind(n.StaticFileHotUpdate));r.onreconnected(function(){n.HubManager.ClearSubscribeState();n.HubManager.ConnectionSuccess()});r.start().then(function(){n.HubManager.ConnectionSuccess()});i.notificationHub=r},i.ExecuteCommand=function(r){var f,e=r.messageDic[i.NotificationHub.connectionId],u;e!==null&&(u=null,r.params&&r.params.length>0&&(u={},r.params.forEach(function(n){u[n.name]=n.value})),(f=t.CurrentSubscribeNotification.MessageInfo.get(r.messageName))===null||f===void 0?void 0:f.forEach(function(t){var r=t.CommandParam,f="",e;r.MergeCommand||(f=i.uuid());e=t.ID+t.RuntimePageName+f;n.ForguncyData.commandExecutor.executeCommand(r.CommandList,{runTimePageName:t.RuntimePageName,commandTrigger:null,commandID:e,eventType:"NotificationCommand",initParams:u,locationString:n.RS.NotificationLocationString})}))},i.ClearSubscribeState=function(){t.CurrentSubscribeNotification.MessageInfo.forEach(function(n){n===null||n===void 0?void 0:n.forEach(function(n){n.Subscribed=!1})})},i.ConnectionSuccess=function(){var n;i.notificationHub.invoke("GetClientId").then(function(n){i.clientId=n});i.UpdateUserName();(n=i.waitSubscribeNotification)===null||n===void 0?void 0:n.forEach(function(n){n.Subscribe===!0?i.SubscribeNotification(n.Name,n.CommandParam,n.RuntimePageName):i.UnSubscribeNotification(n.Name)});t.CurrentSubscribeNotification.MessageInfo.forEach(function(n,t){n===null||n===void 0?void 0:n.forEach(function(n){var r,u;n.Subscribed!==!0&&(u=(r=i.waitSubscribeNotification)===null||r===void 0?void 0:r.filter(function(t){return t.Subscribe&&t.ID===n.ID&&t.RuntimePageName===n.RuntimePageName?!0:!1}),(u===undefined||u.length===0)&&i.SubscribeNotification(t,n.CommandParam,n.RuntimePageName))})});i.waitSubscribeNotification=[]},i.UpdateUserName=function(){i.NotificationHub.state===signalR.HubConnectionState.Connected&&i.NotificationHub.invoke("UpdateConnectionNameAsync",i.NotificationHub.connectionId,n.ForguncyData.userInfo.UserName)},i.SubscribeNotification=function(r,f,o){var c,h,s;i.NotificationHub.state===signalR.HubConnectionState.Connected?(i.NotificationHub.invoke("SubscribeCommand",r,f.ID).catch(function(){alert(n.RS.NotificationUnauthorized)}),h=new e,h.ID=f.ID,h.RuntimePageName=o,h.CommandParam=f,h.Subscribed=!0,t.SetStorgeItem(r,!1,h)):(i.waitSubscribeNotification=(c=i.waitSubscribeNotification)!==null&&c!==void 0?c:[],s=new u,s.Name=r,s.ID=f.ID,s.Subscribe=!0,s.CommandParam=f,s.RuntimePageName=o,i.waitSubscribeNotification.push(s))},i.UnSubscribeNotification=function(n){var f,r;i.NotificationHub.state===signalR.HubConnectionState.Connected?(i.NotificationHub.invoke("UnSubscribeCommand",n),t.SetStorgeItem(n,!0,null)):(i.waitSubscribeNotification=(f=i.waitSubscribeNotification)!==null&&f!==void 0?f:[],r=new u,r.Name=n,r.Subscribe=!1,i.waitSubscribeNotification.push(r))},i.GetconnectionId=function(){return i.clientId},i.uuid=function(){for(var n=[],t=0;t<36;t++)n[t]="0123456789abcdefghijklmnopqrstuvwxyz".substr(Math.floor(Math.random()*36),1);return n[8]=n[13]=n[18]=n[23]="-",n.join("")},i.destroyRunTimePage=function(n){t.DestroyRunTimePage(n)},i.GetSubscribeStack=function(){return t.GetSubscribeStack()},i}();n.HubManager=f;var r=function(){function n(){this.connectionId="";this.state=signalR.HubConnectionState.Disconnected}return n.prototype.invoke=function(){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return new Promise(function(){})},n.prototype.on=function(){},n}(),t=function(){function t(){}return Object.defineProperty(t,"_storageName",{get:function(){var n="C8CAE81063DA4293BE3D4BA79EEE8258";try{window.self!==window.top&&(n+=window.name,window.addEventListener("unload",function(){sessionStorage.removeItem(n)}))}catch(t){}return n},enumerable:!1,configurable:!0}),Object.defineProperty(t,"CurrentSubscribeNotification",{get:function(){return t.AdjustCache(),t._storageItem[t._storageItem.length-1]},enumerable:!1,configurable:!0}),t.AdjustCache=function(){for(var r,n;t._storageItem.length>0;)if(n=t._storageItem[t._storageItem.length-1],n.Equal(new i)){(r=n===null||n===void 0?void 0:n.MessageInfo)===null||r===void 0?void 0:r.forEach(function(n){n.forEach(function(i,r){t.RunTimePageExist(i.RuntimePageName)===!1&&n.splice(r,1)})});break}else t._storageItem.pop();t._storageItem.length===0&&t._storageItem.push(new i);t.SaveToStorage()},t.RunTimePageExist=function(t){var i=[n.ForguncyData.pageInfo.runTimeNormalPage,n.ForguncyData.pageInfo.runTimeMasterPage];return i.indexOf(t)>=0?!0:n.PageManager.getNestedRunTimePageNames(i).indexOf(t)>=0},t.Init=function(){t._storageItem=[];$(document).on("forguncyPageloaded",function(){t._storageItem.length>0?(n.ForguncyData.pageInfo.isPopup!==!0&&(t._storageItem=[]),t._storageItem.push(new i),t.SaveToStorage()):t._storageItem.push(t.LoadStorage())});n.Page.bind("popupclosed",null,function(){t.AdjustCache()})},t.GetSubscribeStack=function(){return t._storageItem},t.SaveToStorage=function(){if(t._storageItem.length>0){var n=t._storageItem[0].GetJsonObjectString();sessionStorage.setItem(t._storageName,window.btoa(unescape(encodeURIComponent(n))))}else sessionStorage.removeItem(t._storageName)},t.LoadStorage=function(){var n=new i,u=sessionStorage.getItem(t._storageName),r;return u?(r=decodeURIComponent(escape(window.atob(sessionStorage.getItem(t._storageName)))),n.LoadJsonObject(r),n):n},t.SetStorgeItem=function(n,i,r){var f,u;i===!0?t.CurrentSubscribeNotification.MessageInfo.delete(n):(u=(f=t.CurrentSubscribeNotification.MessageInfo.get(n))!==null&&f!==void 0?f:[],u.filter(function(n){return n.ID===r.ID&&n.RuntimePageName===r.RuntimePageName}).length===0&&u.push(r),t.CurrentSubscribeNotification.MessageInfo.set(n,u));t.SaveToStorage()},t.DestroyRunTimePage=function(n){var i=t.CurrentSubscribeNotification;i.MessageInfo.forEach(function(t,i,r){t=t.filter(function(t){return n.indexOf(t.RuntimePageName)===-1});t&&t.length===0?r.delete(i):r.set(i,t)});t.SaveToStorage()},t}(),o=function(){function n(){}return n}(),u=function(){function n(){}return n}(),s=function(){function n(){}return n}(),e=function(){function n(){}return n}(),i=function(){function t(){this.PageName=n.ForguncyData.pageInfo.isPopup===!0?n.ForguncyData.pageInfo.pageName+n.ForguncyData.pageInfo.pageID:n.ForguncyData.pageInfo.pageName;this.UserName=n.ForguncyData.userInfo.UserName;this.MessageInfo=new Map;this.MetaDataVersion=n.StaticData.MetaDataVersion}return t.prototype.GetJsonObjectString=function(){var n={};return n.UserName=this.UserName,n.PageName=this.PageName,n.MetaDataVersion=this.MetaDataVersion,n.MessageInfo=Array.from(this.MessageInfo.entries()),JSON.stringify(n)},t.prototype.LoadJsonObject=function(n){var t=JSON.parse(n);this.MessageInfo=t.MessageInfo&&!jQuery.isEmptyObject(t.MessageInfo)?new Map(t.MessageInfo):new Map;this.PageName=t.PageName;this.UserName=t.UserName;this.MetaDataVersion=t.MetaDataVersion},t.prototype.Equal=function(n){return this.PageName===n.PageName&&this.UserName===n.UserName&&this.MetaDataVersion===n.MetaDataVersion},t}(),h=function(){function n(){}return n}()})(Forguncy||(Forguncy={}))
;+function(n){"use strict";var t=function(n,t){this.type=this.options=this.enabled=this.timeout=this.hoverState=this.$element=null;this.init("tooltip",n,t)};t.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip"><div class="tooltip-arrow"><\/div><div class="tooltip-inner"><\/div><\/div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1};t.prototype.init=function(t,i,r){var f,e,u,o,s;for(this.enabled=!0,this.type=t,this.$element=n(i),this.options=this.getOptions(r),f=this.options.trigger.split(" "),e=f.length;e--;)if(u=f[e],u=="click")this.$element.on("click."+this.type,this.options.selector,n.proxy(this.toggle,this));else if(u!="manual"){o=u=="hover"?"mouseenter":"focusin";s=u=="hover"?"mouseleave":"focusout";this.$element.on(o+"."+this.type,this.options.selector,n.proxy(this.enter,this));this.$element.on(s+"."+this.type,this.options.selector,n.proxy(this.leave,this))}this.options.selector?this._options=n.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()};t.prototype.getDefaults=function(){return t.DEFAULTS};t.prototype.getOptions=function(t){return t=n.extend({},this.getDefaults(),this.$element.data(),t),t.delay&&typeof t.delay=="number"&&(t.delay={show:t.delay,hide:t.delay}),t};t.prototype.getDelegateOptions=function(){var t={},i=this.getDefaults();return this._options&&n.each(this._options,function(n,r){i[n]!=r&&(t[n]=r)}),t};t.prototype.enter=function(t){var i=t instanceof this.constructor?t:n(t.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type);if(clearTimeout(i.timeout),i.hoverState="in",!i.options.delay||!i.options.delay.show)return i.show();i.timeout=setTimeout(function(){i.hoverState=="in"&&i.show()},i.options.delay.show)};t.prototype.leave=function(t){var i=t instanceof this.constructor?t:n(t.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type);if(clearTimeout(i.timeout),i.hoverState="out",!i.options.delay||!i.options.delay.hide)return i.hide();i.timeout=setTimeout(function(){i.hoverState=="out"&&i.hide()},i.options.delay.hide)};t.prototype.show=function(){var h=n.Event("show.bs."+this.type),u,i,v,s;if(this.hasContent()&&this.enabled){if(this.$element.trigger(h),h.isDefaultPrevented())return;u=this;i=this.tip();this.setContent();this.options.animation&&i.addClass("fade");var t=typeof this.options.placement=="function"?this.options.placement.call(this,i[0],this.$element[0]):this.options.placement,c=/\s?auto?\s?/i,l=c.test(t);l&&(t=t.replace(c,"")||"top");i.detach().css({top:0,left:0,display:"block"}).addClass(t);this.options.container?i.appendTo(this.options.container):i.insertAfter(this.$element);var r=this.getPosition(),f=i[0].offsetWidth,e=i[0].offsetHeight;if(l){var o=this.$element.parent(),y=t,a=document.documentElement.scrollTop||document.body.scrollTop,p=this.options.container=="body"?window.innerWidth:o.outerWidth(),w=this.options.container=="body"?window.innerHeight:o.outerHeight(),b=this.options.container=="body"?0:o.offset().left;t=t=="bottom"&&r.top+r.height+e-a>w?"top":t=="top"&&r.top-a-e<0?"bottom":t=="right"&&r.right+f>p?"left":t=="left"&&r.left-f<b?"right":t;i.removeClass(y).addClass(t)}v=this.getCalculatedOffset(t,r,f,e);this.applyPlacement(v,t);this.hoverState=null;s=function(){u.$element.trigger("shown.bs."+u.type)};n.support.transition&&this.$tip.hasClass("fade")?i.one(n.support.transition.end,s).emulateTransitionEnd(150):s()}};t.prototype.applyPlacement=function(t,i){var c,r=this.tip(),l=r[0].offsetWidth,e=r[0].offsetHeight,o=parseInt(r.css("margin-top"),10),s=parseInt(r.css("margin-left"),10),f,u,h;isNaN(o)&&(o=0);isNaN(s)&&(s=0);t.top=t.top+o;t.left=t.left+s;n.offset.setOffset(r[0],n.extend({using:function(n){r.css({top:Math.round(n.top),left:Math.round(n.left)})}},t),0);r.addClass("in");f=r[0].offsetWidth;u=r[0].offsetHeight;i=="top"&&u!=e&&(c=!0,t.top=t.top+e-u);/bottom|top/.test(i)?(h=0,t.left<0&&(h=t.left*-2,t.left=0,r.offset(t),f=r[0].offsetWidth,u=r[0].offsetHeight),this.replaceArrow(h-l+f,f,"left")):this.replaceArrow(u-e,u,"top");c&&r.offset(t)};t.prototype.replaceArrow=function(n,t,i){this.arrow().css(i,n?50*(1-n/t)+"%":"")};t.prototype.setContent=function(){var n=this.tip(),t=this.getTitle();n.find(".tooltip-inner")[this.options.html?"html":"text"](t);n.removeClass("fade in top bottom left right")};t.prototype.hide=function(){function u(){t.hoverState!="in"&&i.detach();t.$element.trigger("hidden.bs."+t.type)}var t=this,i=this.tip(),r=n.Event("hide.bs."+this.type);if(this.$element.trigger(r),!r.isDefaultPrevented())return i.removeClass("in"),n.support.transition&&this.$tip.hasClass("fade")?i.one(n.support.transition.end,u).emulateTransitionEnd(150):u(),this.hoverState=null,this};t.prototype.fixTitle=function(){var n=this.$element;(n.attr("title")||typeof n.attr("data-original-title")!="string")&&n.attr("data-original-title",n.attr("title")||"").attr("title","")};t.prototype.hasContent=function(){return this.getTitle()};t.prototype.getPosition=function(){var t=this.$element[0];return n.extend({},typeof t.getBoundingClientRect=="function"?t.getBoundingClientRect():{width:t.offsetWidth,height:t.offsetHeight},this.$element.offset())};t.prototype.getCalculatedOffset=function(n,t,i,r){return n=="bottom"?{top:t.top+t.height,left:t.left+t.width/2-i/2}:n=="top"?{top:t.top-r,left:t.left+t.width/2-i/2}:n=="left"?{top:t.top+t.height/2-r/2,left:t.left-i}:{top:t.top+t.height/2-r/2,left:t.left+t.width}};t.prototype.getTitle=function(){var t=this.$element,n=this.options;return t.attr("data-original-title")||(typeof n.title=="function"?n.title.call(t[0]):n.title)};t.prototype.tip=function(){return this.$tip=this.$tip||n(this.options.template)};t.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")};t.prototype.validate=function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)};t.prototype.enable=function(){this.enabled=!0};t.prototype.disable=function(){this.enabled=!1};t.prototype.toggleEnabled=function(){this.enabled=!this.enabled};t.prototype.toggle=function(t){var i=t?n(t.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type):this;i.tip().hasClass("in")?i.leave(i):i.enter(i)};t.prototype.destroy=function(){clearTimeout(this.timeout);this.hide().$element.off("."+this.type).removeData("bs."+this.type)};Forguncy&&(Forguncy.Tooltip=t)}(jQuery,Forguncy)
;+function(n){"use strict";function r(i){n(f).remove();n(t).each(function(){var t=u(n(this)),r={relatedTarget:this};t.hasClass("open")&&((t.trigger(i=n.Event("hide.bs.dropdown",r)),i.isDefaultPrevented())||t.removeClass("open").trigger("hidden.bs.dropdown",r))})}function u(t){var i=t.attr("data-target"),r;return i||(i=t.attr("href"),i=i&&/#[A-Za-z]/.test(i)&&i.replace(/.*(?=#[^\s]*$)/,"")),r=i&&n(i),r&&r.length?r:t.parent()}var f=".dropdown-backdrop",t="[data-toggle=_dropdown]",i=function(t){n(t).on("click.bs.dropdown",this.toggle)};i.prototype.toggle=function(t){var f=n(this),i,o,e;if(!f.is(".disabled, :disabled")){if(i=u(f),o=i.hasClass("open"),r(),!o){if("ontouchstart"in document.documentElement&&!i.closest(".navbar-nav").length)n('<div class="dropdown-backdrop"/>').insertAfter(n(this)).on("click",r);if(e={relatedTarget:this},i.trigger(t=n.Event("show.bs.dropdown",e)),t.isDefaultPrevented())return;i.toggleClass("open").trigger("shown.bs.dropdown",e);f.focus()}return!1}};i.prototype.keydown=function(i){var e,o,s,h,f,r;if(/(38|40|27)/.test(i.keyCode)&&(e=n(this),i.preventDefault(),i.stopPropagation(),!e.is(".disabled, :disabled"))){if(o=u(e),s=o.hasClass("open"),!s||s&&i.keyCode==27)return i.which==27&&o.find(t).focus(),e.click();(h=" li:not(.divider):visible a",f=o.find("[role=menu]"+h+", [role=listbox]"+h),f.length)&&(r=f.index(f.filter(":focus")),i.keyCode==38&&r>0&&r--,i.keyCode==40&&r<f.length-1&&r++,~r||(r=0),f.eq(r).focus())}};n(document).on("click.bs.dropdown.data-api",r).on("click.bs.dropdown.data-api",".dropdown form",function(n){n.stopPropagation()}).on("click.bs.dropdown.data-api",t,i.prototype.toggle).on("keydown.bs.dropdown.data-api",t+", [role=menu], [role=listbox]",i.prototype.keydown)}(jQuery)
;+function(n){"use strict";var t=function(t){this.element=n(t)};t.prototype.show=function(){var t=this.element,e=t.closest("ul:not(.dropdown-menu)"),i=t.data("target"),r,u,f;(i||(i=t.attr("href"),i=i&&i.replace(/.*(?=#[^\s]*$)/,"")),t.parent("li").hasClass("active"))||(r=e.find(".active:last a")[0],u=n.Event("show.bs.tab",{relatedTarget:r}),t.trigger(u),u.isDefaultPrevented())||(f=n(i),this.activate(t.parent("li"),e),this.activate(f,f.parent(),function(){t.trigger({type:"shown.bs.tab",relatedTarget:r})}))};t.prototype.activate=function(t,i,r){function e(){u.removeClass("active").find("> .dropdown-menu > .active").removeClass("active");t.addClass("active");f?(t[0].offsetWidth,t.addClass("in")):t.removeClass("fade");t.parent(".dropdown-menu")&&t.closest("li.dropdown").addClass("active");r&&r()}var u=i.find("> .active"),f=r&&n.support.transition&&u.hasClass("fade");f?u.one(n.support.transition.end,e).emulateTransitionEnd(150):e();u.removeClass("in")};Forguncy&&(Forguncy.Tab=t)}(jQuery)
;var t,e;t=self,e=function(){return(()=>{var t={d:(e,s)=>{for(var n in s)t.o(s,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:s[n]})}};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),t.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),t.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"t",{value:!0})};var e,s={};t.r(s),t.d(s,{AbortError:()=>r,DefaultHttpClient:()=>H,HttpClient:()=>d,HttpError:()=>n,HttpResponse:()=>u,HttpTransportType:()=>M,HubConnection:()=>N,HubConnectionBuilder:()=>Q,HubConnectionState:()=>R,JsonHubProtocol:()=>G,LogLevel:()=>e,MessageType:()=>A,NullLogger:()=>f,Subject:()=>U,TimeoutError:()=>i,TransferFormat:()=>W,VERSION:()=>p});class n extends Error{constructor(t,e){const s=new.target.prototype;super(`${t}: Status code '${e}'`),this.statusCode=e,this.__proto__=s}}class i extends Error{constructor(t="A timeout occurred."){const e=new.target.prototype;super(t),this.__proto__=e}}class r extends Error{constructor(t="An abort occurred."){const e=new.target.prototype;super(t),this.__proto__=e}}class o extends Error{constructor(t,e){const s=new.target.prototype;super(t),this.transport=e,this.errorType="UnsupportedTransportError",this.__proto__=s}}class h extends Error{constructor(t,e){const s=new.target.prototype;super(t),this.transport=e,this.errorType="DisabledTransportError",this.__proto__=s}}class c extends Error{constructor(t,e){const s=new.target.prototype;super(t),this.transport=e,this.errorType="FailedToStartTransportError",this.__proto__=s}}class a extends Error{constructor(t){const e=new.target.prototype;super(t),this.errorType="FailedToNegotiateWithServerError",this.__proto__=e}}class l extends Error{constructor(t,e){const s=new.target.prototype;super(t),this.innerErrors=e,this.__proto__=s}}class u{constructor(t,e,s){this.statusCode=t,this.statusText=e,this.content=s}}class d{get(t,e){return this.send({...e,method:"GET",url:t})}post(t,e){return this.send({...e,method:"POST",url:t})}delete(t,e){return this.send({...e,method:"DELETE",url:t})}getCookieString(t){return""}}!function(t){t[t.Trace=0]="Trace",t[t.Debug=1]="Debug",t[t.Information=2]="Information",t[t.Warning=3]="Warning",t[t.Error=4]="Error",t[t.Critical=5]="Critical",t[t.None=6]="None"}(e||(e={}));class f{constructor(){}log(t,e){}}f.instance=new f;const p="6.0.7";class w{static isRequired(t,e){if(null==t)throw new Error(`The '${e}' argument is required.`)}static isNotEmpty(t,e){if(!t||t.match(/^\s*$/))throw new Error(`The '${e}' argument should not be empty.`)}static isIn(t,e,s){if(!(t in e))throw new Error(`Unknown ${s} value: ${t}.`)}}class g{static get isBrowser(){return"object"==typeof window&&"object"==typeof window.document}static get isWebWorker(){return"object"==typeof self&&"importScripts"in self}static get isReactNative(){return"object"==typeof window&&void 0===window.document}static get isNode(){return!this.isBrowser&&!this.isWebWorker&&!this.isReactNative}}function y(t,e){let s="";return m(t)?(s=`Binary data of length ${t.byteLength}`,e&&(s+=`. Content: '${function(t){const e=new Uint8Array(t);let s="";return e.forEach((t=>{s+=`0x${t<16?"0":""}${t.toString(16)} `})),s.substr(0,s.length-1)}(t)}'`)):"string"==typeof t&&(s=`String data of length ${t.length}`,e&&(s+=`. Content: '${t}'`)),s}function m(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}async function b(t,s,n,i,r,o,h){let c={};if(r){const t=await r();t&&(c={Authorization:`Bearer ${t}`})}const[a,l]=$();c[a]=l,t.log(e.Trace,`(${s} transport) sending data. ${y(o,h.logMessageContent)}.`);const u=m(o)?"arraybuffer":"text",d=await n.post(i,{content:o,headers:{...c,...h.headers},responseType:u,timeout:h.timeout,withCredentials:h.withCredentials});t.log(e.Trace,`(${s} transport) request complete. Response status: ${d.statusCode}.`)}class v{constructor(t,e){this.i=t,this.h=e}dispose(){const t=this.i.observers.indexOf(this.h);t>-1&&this.i.observers.splice(t,1),0===this.i.observers.length&&this.i.cancelCallback&&this.i.cancelCallback().catch((t=>{}))}}class E{constructor(t){this.l=t,this.out=console}log(t,s){if(t>=this.l){const n=`[${(new Date).toISOString()}] ${e[t]}: ${s}`;switch(t){case e.Critical:case e.Error:this.out.error(n);break;case e.Warning:this.out.warn(n);break;case e.Information:this.out.info(n);break;default:this.out.log(n)}}}}function $(){let t="X-SignalR-User-Agent";return g.isNode&&(t="User-Agent"),[t,C(p,S(),g.isNode?"NodeJS":"Browser",k())]}function C(t,e,s,n){let i="Microsoft SignalR/";const r=t.split(".");return i+=`${r[0]}.${r[1]}`,i+=` (${t}; `,i+=e&&""!==e?`${e}; `:"Unknown OS; ",i+=`${s}`,i+=n?`; ${n}`:"; Unknown Runtime Version",i+=")",i}function S(){if(!g.isNode)return"";switch(process.platform){case"win32":return"Windows NT";case"darwin":return"macOS";case"linux":return"Linux";default:return process.platform}}function k(){if(g.isNode)return process.versions.node}function P(t){return t.stack?t.stack:t.message?t.message:`${t}`}class T extends d{constructor(e){if(super(),this.u=e,"undefined"==typeof fetch){const t=require;this.p=new(t("tough-cookie").CookieJar),this.m=t("node-fetch"),this.m=t("fetch-cookie")(this.m,this.p)}else this.m=fetch.bind(function(){if("undefined"!=typeof globalThis)return globalThis;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t.g)return t.g;throw new Error("could not find global")}());if("undefined"==typeof AbortController){const t=require;this.v=t("abort-controller")}else this.v=AbortController}async send(t){if(t.abortSignal&&t.abortSignal.aborted)throw new r;if(!t.method)throw new Error("No method defined.");if(!t.url)throw new Error("No url defined.");const s=new this.v;let o;t.abortSignal&&(t.abortSignal.onabort=()=>{s.abort(),o=new r});let h,c=null;if(t.timeout){const n=t.timeout;c=setTimeout((()=>{s.abort(),this.u.log(e.Warning,"Timeout from HTTP request."),o=new i}),n)}try{h=await this.m(t.url,{body:t.content,cache:"no-cache",credentials:!0===t.withCredentials?"include":"same-origin",headers:{"Content-Type":"text/plain;charset=UTF-8","X-Requested-With":"XMLHttpRequest",...t.headers},method:t.method,mode:"cors",redirect:"follow",signal:s.signal})}catch(t){if(o)throw o;throw this.u.log(e.Warning,`Error from HTTP request. ${t}.`),t}finally{c&&clearTimeout(c),t.abortSignal&&(t.abortSignal.onabort=null)}if(!h.ok){const t=await I(h,"text");throw new n(t||h.statusText,h.status)}const a=I(h,t.responseType),l=await a;return new u(h.status,h.statusText,l)}getCookieString(t){let e="";return g.isNode&&this.p&&this.p.getCookies(t,((t,s)=>e=s.join("; "))),e}}function I(t,e){let s;switch(e){case"arraybuffer":s=t.arrayBuffer();break;case"text":s=t.text();break;case"blob":case"document":case"json":throw new Error(`${e} is not supported.`);default:s=t.text()}return s}class _ extends d{constructor(t){super(),this.u=t}send(t){return t.abortSignal&&t.abortSignal.aborted?Promise.reject(new r):t.method?t.url?new Promise(((s,o)=>{const h=new XMLHttpRequest;h.open(t.method,t.url,!0),h.withCredentials=void 0===t.withCredentials||t.withCredentials,h.setRequestHeader("X-Requested-With","XMLHttpRequest"),h.setRequestHeader("Content-Type","text/plain;charset=UTF-8");const c=t.headers;c&&Object.keys(c).forEach((t=>{h.setRequestHeader(t,c[t])})),t.responseType&&(h.responseType=t.responseType),t.abortSignal&&(t.abortSignal.onabort=()=>{h.abort(),o(new r)}),t.timeout&&(h.timeout=t.timeout),h.onload=()=>{t.abortSignal&&(t.abortSignal.onabort=null),h.status>=200&&h.status<300?s(new u(h.status,h.statusText,h.response||h.responseText)):o(new n(h.response||h.responseText||h.statusText,h.status))},h.onerror=()=>{this.u.log(e.Warning,`Error from HTTP request. ${h.status}: ${h.statusText}.`),o(new n(h.statusText,h.status))},h.ontimeout=()=>{this.u.log(e.Warning,"Timeout from HTTP request."),o(new i)},h.send(t.content||"")})):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}}class H extends d{constructor(t){if(super(),"undefined"!=typeof fetch||g.isNode)this.$=new T(t);else{if("undefined"==typeof XMLHttpRequest)throw new Error("No usable HttpClient found.");this.$=new _(t)}}send(t){return t.abortSignal&&t.abortSignal.aborted?Promise.reject(new r):t.method?t.url?this.$.send(t):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}getCookieString(t){return this.$.getCookieString(t)}}class D{static write(t){return`${t}${D.RecordSeparator}`}static parse(t){if(t[t.length-1]!==D.RecordSeparator)throw new Error("Message is incomplete.");const e=t.split(D.RecordSeparator);return e.pop(),e}}D.RecordSeparatorCode=30,D.RecordSeparator=String.fromCharCode(D.RecordSeparatorCode);class x{writeHandshakeRequest(t){return D.write(JSON.stringify(t))}parseHandshakeResponse(t){let e,s;if(m(t)){const n=new Uint8Array(t),i=n.indexOf(D.RecordSeparatorCode);if(-1===i)throw new Error("Message is incomplete.");const r=i+1;e=String.fromCharCode.apply(null,Array.prototype.slice.call(n.slice(0,r))),s=n.byteLength>r?n.slice(r).buffer:null}else{const n=t,i=n.indexOf(D.RecordSeparator);if(-1===i)throw new Error("Message is incomplete.");const r=i+1;e=n.substring(0,r),s=n.length>r?n.substring(r):null}const n=D.parse(e),i=JSON.parse(n[0]);if(i.type)throw new Error("Expected a handshake response from the server.");return[s,i]}}var A,R;!function(t){t[t.Invocation=1]="Invocation",t[t.StreamItem=2]="StreamItem",t[t.Completion=3]="Completion",t[t.StreamInvocation=4]="StreamInvocation",t[t.CancelInvocation=5]="CancelInvocation",t[t.Ping=6]="Ping",t[t.Close=7]="Close"}(A||(A={}));class U{constructor(){this.observers=[]}next(t){for(const e of this.observers)e.next(t)}error(t){for(const e of this.observers)e.error&&e.error(t)}complete(){for(const t of this.observers)t.complete&&t.complete()}subscribe(t){return this.observers.push(t),new v(this,t)}}!function(t){t.Disconnected="Disconnected",t.Connecting="Connecting",t.Connected="Connected",t.Disconnecting="Disconnecting",t.Reconnecting="Reconnecting"}(R||(R={}));class N{constructor(t,s,n,i){this.C=0,this.S=()=>{this.u.log(e.Warning,"The page is being frozen, this will likely lead to the connection being closed and messages being lost. For more information see the docs at https://docs.microsoft.com/aspnet/core/signalr/javascript-client#bsleep")},w.isRequired(t,"connection"),w.isRequired(s,"logger"),w.isRequired(n,"protocol"),this.serverTimeoutInMilliseconds=3e4,this.keepAliveIntervalInMilliseconds=15e3,this.u=s,this.k=n,this.connection=t,this.P=i,this.T=new x,this.connection.onreceive=t=>this.I(t),this.connection.onclose=t=>this._(t),this.H={},this.D={},this.A=[],this.R=[],this.U=[],this.N=0,this.L=!1,this.q=R.Disconnected,this.j=!1,this.M=this.k.writeMessage({type:A.Ping})}static create(t,e,s,n){return new N(t,e,s,n)}get state(){return this.q}get connectionId(){return this.connection&&this.connection.connectionId||null}get baseUrl(){return this.connection.baseUrl||""}set baseUrl(t){if(this.q!==R.Disconnected&&this.q!==R.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!t)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=t}start(){return this.W=this.O(),this.W}async O(){if(this.q!==R.Disconnected)return Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."));this.q=R.Connecting,this.u.log(e.Debug,"Starting HubConnection.");try{await this.F(),g.isBrowser&&window.document.addEventListener("freeze",this.S),this.q=R.Connected,this.j=!0,this.u.log(e.Debug,"HubConnection connected successfully.")}catch(t){return this.q=R.Disconnected,this.u.log(e.Debug,`HubConnection failed to start successfully because of error '${t}'.`),Promise.reject(t)}}async F(){this.B=void 0,this.L=!1;const t=new Promise(((t,e)=>{this.X=t,this.J=e}));await this.connection.start(this.k.transferFormat);try{const s={protocol:this.k.name,version:this.k.version};if(this.u.log(e.Debug,"Sending handshake request."),await this.V(this.T.writeHandshakeRequest(s)),this.u.log(e.Information,`Using HubProtocol '${this.k.name}'.`),this.G(),this.K(),this.Y(),await t,this.B)throw this.B}catch(t){throw this.u.log(e.Debug,`Hub handshake failed with error '${t}' during start(). Stopping HubConnection.`),this.G(),this.Z(),await this.connection.stop(t),t}}async stop(){const t=this.W;this.tt=this.et(),await this.tt;try{await t}catch(t){}}et(t){return this.q===R.Disconnected?(this.u.log(e.Debug,`Call to HubConnection.stop(${t}) ignored because it is already in the disconnected state.`),Promise.resolve()):this.q===R.Disconnecting?(this.u.log(e.Debug,`Call to HttpConnection.stop(${t}) ignored because the connection is already in the disconnecting state.`),this.tt):(this.q=R.Disconnecting,this.u.log(e.Debug,"Stopping HubConnection."),this.st?(this.u.log(e.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this.st),this.st=void 0,this.nt(),Promise.resolve()):(this.G(),this.Z(),this.B=t||new Error("The connection was stopped before the hub handshake could complete."),this.connection.stop(t)))}stream(t,...e){const[s,n]=this.it(e),i=this.rt(t,e,n);let r;const o=new U;return o.cancelCallback=()=>{const t=this.ot(i.invocationId);return delete this.H[i.invocationId],r.then((()=>this.ht(t)))},this.H[i.invocationId]=(t,e)=>{e?o.error(e):t&&(t.type===A.Completion?t.error?o.error(new Error(t.error)):o.complete():o.next(t.item))},r=this.ht(i).catch((t=>{o.error(t),delete this.H[i.invocationId]})),this.ct(s,r),o}V(t){return this.Y(),this.connection.send(t)}ht(t){return this.V(this.k.writeMessage(t))}send(t,...e){const[s,n]=this.it(e),i=this.ht(this.at(t,e,!0,n));return this.ct(s,i),i}invoke(t,...e){const[s,n]=this.it(e),i=this.at(t,e,!1,n);return new Promise(((t,e)=>{this.H[i.invocationId]=(s,n)=>{n?e(n):s&&(s.type===A.Completion?s.error?e(new Error(s.error)):t(s.result):e(new Error(`Unexpected message type: ${s.type}`)))};const n=this.ht(i).catch((t=>{e(t),delete this.H[i.invocationId]}));this.ct(s,n)}))}on(t,e){t&&e&&(t=t.toLowerCase(),this.D[t]||(this.D[t]=[]),-1===this.D[t].indexOf(e)&&this.D[t].push(e))}off(t,e){if(!t)return;t=t.toLowerCase();const s=this.D[t];if(s)if(e){const n=s.indexOf(e);-1!==n&&(s.splice(n,1),0===s.length&&delete this.D[t])}else delete this.D[t]}onclose(t){t&&this.A.push(t)}onreconnecting(t){t&&this.R.push(t)}onreconnected(t){t&&this.U.push(t)}I(t){if(this.G(),this.L||(t=this.lt(t),this.L=!0),t){const s=this.k.parseMessages(t,this.u);for(const t of s)switch(t.type){case A.Invocation:this.ut(t);break;case A.StreamItem:case A.Completion:{const s=this.H[t.invocationId];if(s){t.type===A.Completion&&delete this.H[t.invocationId];try{s(t)}catch(t){this.u.log(e.Error,`Stream callback threw error: ${P(t)}`)}}break}case A.Ping:break;case A.Close:{this.u.log(e.Information,"Close message received from server.");const s=t.error?new Error("Server returned an error on close: "+t.error):void 0;!0===t.allowReconnect?this.connection.stop(s):this.tt=this.et(s);break}default:this.u.log(e.Warning,`Invalid message type: ${t.type}.`)}}this.K()}lt(t){let s,n;try{[n,s]=this.T.parseHandshakeResponse(t)}catch(t){const s="Error parsing handshake response: "+t;this.u.log(e.Error,s);const n=new Error(s);throw this.J(n),n}if(s.error){const t="Server returned handshake error: "+s.error;this.u.log(e.Error,t);const n=new Error(t);throw this.J(n),n}return this.u.log(e.Debug,"Server handshake complete."),this.X(),n}Y(){this.connection.features.inherentKeepAlive||(this.C=(new Date).getTime()+this.keepAliveIntervalInMilliseconds,this.Z())}K(){if(!(this.connection.features&&this.connection.features.inherentKeepAlive||(this.dt=setTimeout((()=>this.serverTimeout()),this.serverTimeoutInMilliseconds),void 0!==this.ft))){let t=this.C-(new Date).getTime();t<0&&(t=0),this.ft=setTimeout((async()=>{if(this.q===R.Connected)try{await this.V(this.M)}catch{this.Z()}}),t)}}serverTimeout(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))}ut(t){const s=this.D[t.target.toLowerCase()];if(s){try{s.forEach((e=>e.apply(this,t.arguments)))}catch(s){this.u.log(e.Error,`A callback for the method ${t.target.toLowerCase()} threw error '${s}'.`)}if(t.invocationId){const t="Server requested a response, which is not supported in this version of the client.";this.u.log(e.Error,t),this.tt=this.et(new Error(t))}}else this.u.log(e.Warning,`No client method with the name '${t.target}' found.`)}_(t){this.u.log(e.Debug,`HubConnection.connectionClosed(${t}) called while in state ${this.q}.`),this.B=this.B||t||new Error("The underlying connection was closed before the hub handshake could complete."),this.X&&this.X(),this.wt(t||new Error("Invocation canceled due to the underlying connection being closed.")),this.G(),this.Z(),this.q===R.Disconnecting?this.nt(t):this.q===R.Connected&&this.P?this.gt(t):this.q===R.Connected&&this.nt(t)}nt(t){if(this.j){this.q=R.Disconnected,this.j=!1,g.isBrowser&&window.document.removeEventListener("freeze",this.S);try{this.A.forEach((e=>e.apply(this,[t])))}catch(s){this.u.log(e.Error,`An onclose callback called with error '${t}' threw error '${s}'.`)}}}async gt(t){const s=Date.now();let n=0,i=void 0!==t?t:new Error("Attempting to reconnect due to a unknown error."),r=this.yt(n++,0,i);if(null===r)return this.u.log(e.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),void this.nt(t);if(this.q=R.Reconnecting,t?this.u.log(e.Information,`Connection reconnecting because of error '${t}'.`):this.u.log(e.Information,"Connection reconnecting."),0!==this.R.length){try{this.R.forEach((e=>e.apply(this,[t])))}catch(s){this.u.log(e.Error,`An onreconnecting callback called with error '${t}' threw error '${s}'.`)}if(this.q!==R.Reconnecting)return void this.u.log(e.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.")}for(;null!==r;){if(this.u.log(e.Information,`Reconnect attempt number ${n} will start in ${r} ms.`),await new Promise((t=>{this.st=setTimeout(t,r)})),this.st=void 0,this.q!==R.Reconnecting)return void this.u.log(e.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting.");try{if(await this.F(),this.q=R.Connected,this.u.log(e.Information,"HubConnection reconnected successfully."),0!==this.U.length)try{this.U.forEach((t=>t.apply(this,[this.connection.connectionId])))}catch(t){this.u.log(e.Error,`An onreconnected callback called with connectionId '${this.connection.connectionId}; threw error '${t}'.`)}return}catch(t){if(this.u.log(e.Information,`Reconnect attempt failed because of error '${t}'.`),this.q!==R.Reconnecting)return this.u.log(e.Debug,`Connection moved to the '${this.q}' from the reconnecting state during reconnect attempt. Done reconnecting.`),void(this.q===R.Disconnecting&&this.nt());i=t instanceof Error?t:new Error(t.toString()),r=this.yt(n++,Date.now()-s,i)}}this.u.log(e.Information,`Reconnect retries have been exhausted after ${Date.now()-s} ms and ${n} failed attempts. Connection disconnecting.`),this.nt()}yt(t,s,n){try{return this.P.nextRetryDelayInMilliseconds({elapsedMilliseconds:s,previousRetryCount:t,retryReason:n})}catch(n){return this.u.log(e.Error,`IRetryPolicy.nextRetryDelayInMilliseconds(${t}, ${s}) threw error '${n}'.`),null}}wt(t){const s=this.H;this.H={},Object.keys(s).forEach((n=>{const i=s[n];try{i(null,t)}catch(s){this.u.log(e.Error,`Stream 'error' callback called with '${t}' threw error: ${P(s)}`)}}))}Z(){this.ft&&(clearTimeout(this.ft),this.ft=void 0)}G(){this.dt&&clearTimeout(this.dt)}at(t,e,s,n){if(s)return 0!==n.length?{arguments:e,streamIds:n,target:t,type:A.Invocation}:{arguments:e,target:t,type:A.Invocation};{const s=this.N;return this.N++,0!==n.length?{arguments:e,invocationId:s.toString(),streamIds:n,target:t,type:A.Invocation}:{arguments:e,invocationId:s.toString(),target:t,type:A.Invocation}}}ct(t,e){if(0!==t.length){e||(e=Promise.resolve());for(const s in t)t[s].subscribe({complete:()=>{e=e.then((()=>this.ht(this.bt(s))))},error:t=>{let n;n=t instanceof Error?t.message:t&&t.toString?t.toString():"Unknown error",e=e.then((()=>this.ht(this.bt(s,n))))},next:t=>{e=e.then((()=>this.ht(this.vt(s,t))))}})}}it(t){const e=[],s=[];for(let n=0;n<t.length;n++){const i=t[n];if(this.Et(i)){const r=this.N;this.N++,e[r]=i,s.push(r.toString()),t.splice(n,1)}}return[e,s]}Et(t){return t&&t.subscribe&&"function"==typeof t.subscribe}rt(t,e,s){const n=this.N;return this.N++,0!==s.length?{arguments:e,invocationId:n.toString(),streamIds:s,target:t,type:A.StreamInvocation}:{arguments:e,invocationId:n.toString(),target:t,type:A.StreamInvocation}}ot(t){return{invocationId:t,type:A.CancelInvocation}}vt(t,e){return{invocationId:t,item:e,type:A.StreamItem}}bt(t,e,s){return e?{error:e,invocationId:t,type:A.Completion}:{invocationId:t,result:s,type:A.Completion}}}const L=[0,2e3,1e4,3e4,null];class q{constructor(t){this.$t=void 0!==t?[...t,null]:L}nextRetryDelayInMilliseconds(t){return this.$t[t.previousRetryCount]}}class j{}var M,W;j.Authorization="Authorization",j.Cookie="Cookie",function(t){t[t.None=0]="None",t[t.WebSockets=1]="WebSockets",t[t.ServerSentEvents=2]="ServerSentEvents",t[t.LongPolling=4]="LongPolling"}(M||(M={})),function(t){t[t.Text=1]="Text",t[t.Binary=2]="Binary"}(W||(W={}));class O{constructor(){this.Ct=!1,this.onabort=null}abort(){this.Ct||(this.Ct=!0,this.onabort&&this.onabort())}get signal(){return this}get aborted(){return this.Ct}}class F{constructor(t,e,s,n){this.$=t,this.St=e,this.u=s,this.kt=new O,this.Pt=n,this.Tt=!1,this.onreceive=null,this.onclose=null}get pollAborted(){return this.kt.aborted}async connect(t,s){if(w.isRequired(t,"url"),w.isRequired(s,"transferFormat"),w.isIn(s,W,"transferFormat"),this.It=t,this.u.log(e.Trace,"(LongPolling transport) Connecting."),s===W.Binary&&"undefined"!=typeof XMLHttpRequest&&"string"!=typeof(new XMLHttpRequest).responseType)throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");const[i,r]=$(),o={[i]:r,...this.Pt.headers},h={abortSignal:this.kt.signal,headers:o,timeout:1e5,withCredentials:this.Pt.withCredentials};s===W.Binary&&(h.responseType="arraybuffer");const c=await this._t();this.Ht(h,c);const a=`${t}&_=${Date.now()}`;this.u.log(e.Trace,`(LongPolling transport) polling: ${a}.`);const l=await this.$.get(a,h);200!==l.statusCode?(this.u.log(e.Error,`(LongPolling transport) Unexpected response code: ${l.statusCode}.`),this.Dt=new n(l.statusText||"",l.statusCode),this.Tt=!1):this.Tt=!0,this.xt=this.At(this.It,h)}async _t(){return this.St?await this.St():null}Ht(t,e){t.headers||(t.headers={}),e?t.headers[j.Authorization]=`Bearer ${e}`:t.headers[j.Authorization]&&delete t.headers[j.Authorization]}async At(t,s){try{for(;this.Tt;){const r=await this._t();this.Ht(s,r);try{const i=`${t}&_=${Date.now()}`;this.u.log(e.Trace,`(LongPolling transport) polling: ${i}.`);const r=await this.$.get(i,s);204===r.statusCode?(this.u.log(e.Information,"(LongPolling transport) Poll terminated by server."),this.Tt=!1):200!==r.statusCode?(this.u.log(e.Error,`(LongPolling transport) Unexpected response code: ${r.statusCode}.`),this.Dt=new n(r.statusText||"",r.statusCode),this.Tt=!1):r.content?(this.u.log(e.Trace,`(LongPolling transport) data received. ${y(r.content,this.Pt.logMessageContent)}.`),this.onreceive&&this.onreceive(r.content)):this.u.log(e.Trace,"(LongPolling transport) Poll timed out, reissuing.")}catch(t){this.Tt?t instanceof i?this.u.log(e.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this.Dt=t,this.Tt=!1):this.u.log(e.Trace,`(LongPolling transport) Poll errored after shutdown: ${t.message}`)}}}finally{this.u.log(e.Trace,"(LongPolling transport) Polling complete."),this.pollAborted||this.Rt()}}async send(t){return this.Tt?b(this.u,"LongPolling",this.$,this.It,this.St,t,this.Pt):Promise.reject(new Error("Cannot send until the transport is connected"))}async stop(){this.u.log(e.Trace,"(LongPolling transport) Stopping polling."),this.Tt=!1,this.kt.abort();try{await this.xt,this.u.log(e.Trace,`(LongPolling transport) sending DELETE request to ${this.It}.`);const t={},[s,n]=$();t[s]=n;const i={headers:{...t,...this.Pt.headers},timeout:this.Pt.timeout,withCredentials:this.Pt.withCredentials},r=await this._t();this.Ht(i,r),await this.$.delete(this.It,i),this.u.log(e.Trace,"(LongPolling transport) DELETE request sent.")}finally{this.u.log(e.Trace,"(LongPolling transport) Stop finished."),this.Rt()}}Rt(){if(this.onclose){let t="(LongPolling transport) Firing onclose event.";this.Dt&&(t+=" Error: "+this.Dt),this.u.log(e.Trace,t),this.onclose(this.Dt)}}}class B{constructor(t,e,s,n){this.$=t,this.St=e,this.u=s,this.Pt=n,this.onreceive=null,this.onclose=null}async connect(t,s){if(w.isRequired(t,"url"),w.isRequired(s,"transferFormat"),w.isIn(s,W,"transferFormat"),this.u.log(e.Trace,"(SSE transport) Connecting."),this.It=t,this.St){const e=await this.St();e&&(t+=(t.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(e)}`)}return new Promise(((n,i)=>{let r,o=!1;if(s===W.Text){if(g.isBrowser||g.isWebWorker)r=new this.Pt.EventSource(t,{withCredentials:this.Pt.withCredentials});else{const e=this.$.getCookieString(t),s={};s.Cookie=e;const[n,i]=$();s[n]=i,r=new this.Pt.EventSource(t,{withCredentials:this.Pt.withCredentials,headers:{...s,...this.Pt.headers}})}try{r.onmessage=t=>{if(this.onreceive)try{this.u.log(e.Trace,`(SSE transport) data received. ${y(t.data,this.Pt.logMessageContent)}.`),this.onreceive(t.data)}catch(t){return void this.Ut(t)}},r.onerror=t=>{o?this.Ut():i(new Error("EventSource failed to connect. The connection could not be found on the server, either the connection ID is not present on the server, or a proxy is refusing/buffering the connection. If you have multiple servers check that sticky sessions are enabled."))},r.onopen=()=>{this.u.log(e.Information,`SSE connected to ${this.It}`),this.Nt=r,o=!0,n()}}catch(t){return void i(t)}}else i(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"))}))}async send(t){return this.Nt?b(this.u,"SSE",this.$,this.It,this.St,t,this.Pt):Promise.reject(new Error("Cannot send until the transport is connected"))}stop(){return this.Ut(),Promise.resolve()}Ut(t){this.Nt&&(this.Nt.close(),this.Nt=void 0,this.onclose&&this.onclose(t))}}class X{constructor(t,e,s,n,i,r){this.u=s,this.St=e,this.Lt=n,this.qt=i,this.$=t,this.onreceive=null,this.onclose=null,this.jt=r}async connect(t,s){if(w.isRequired(t,"url"),w.isRequired(s,"transferFormat"),w.isIn(s,W,"transferFormat"),this.u.log(e.Trace,"(WebSockets transport) Connecting."),this.St){const e=await this.St();e&&(t+=(t.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(e)}`)}return new Promise(((n,i)=>{let r;t=t.replace(/^http/,"ws");const o=this.$.getCookieString(t);let h=!1;if(g.isNode){const e={},[s,n]=$();e[s]=n,o&&(e[j.Cookie]=`${o}`),r=new this.qt(t,void 0,{headers:{...e,...this.jt}})}r||(r=new this.qt(t)),s===W.Binary&&(r.binaryType="arraybuffer"),r.onopen=s=>{this.u.log(e.Information,`WebSocket connected to ${t}.`),this.Mt=r,h=!0,n()},r.onerror=t=>{let s=null;s="undefined"!=typeof ErrorEvent&&t instanceof ErrorEvent?t.error:"There was an error with the transport",this.u.log(e.Information,`(WebSockets transport) ${s}.`)},r.onmessage=t=>{if(this.u.log(e.Trace,`(WebSockets transport) data received. ${y(t.data,this.Lt)}.`),this.onreceive)try{this.onreceive(t.data)}catch(t){return void this.Ut(t)}},r.onclose=t=>{if(h)this.Ut(t);else{let e=null;e="undefined"!=typeof ErrorEvent&&t instanceof ErrorEvent?t.error:"WebSocket failed to connect. The connection could not be found on the server, either the endpoint may not be a SignalR endpoint, the connection ID is not present on the server, or there is a proxy blocking WebSockets. If you have multiple servers check that sticky sessions are enabled.",i(new Error(e))}}}))}send(t){return this.Mt&&this.Mt.readyState===this.qt.OPEN?(this.u.log(e.Trace,`(WebSockets transport) sending data. ${y(t,this.Lt)}.`),this.Mt.send(t),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")}stop(){return this.Mt&&this.Ut(void 0),Promise.resolve()}Ut(t){this.Mt&&(this.Mt.onclose=()=>{},this.Mt.onmessage=()=>{},this.Mt.onerror=()=>{},this.Mt.close(),this.Mt=void 0),this.u.log(e.Trace,"(WebSockets transport) socket closed."),this.onclose&&(!this.Wt(t)||!1!==t.wasClean&&1e3===t.code?t instanceof Error?this.onclose(t):this.onclose():this.onclose(new Error(`WebSocket closed with status code: ${t.code} (${t.reason||"no reason given"}).`)))}Wt(t){return t&&"boolean"==typeof t.wasClean&&"number"==typeof t.code}}class J{constructor(t,s={}){var n;if(this.Ot=()=>{},this.features={},this.Ft=1,w.isRequired(t,"url"),this.u=void 0===(n=s.logger)?new E(e.Information):null===n?f.instance:void 0!==n.log?n:new E(n),this.baseUrl=this.Bt(t),(s=s||{}).logMessageContent=void 0!==s.logMessageContent&&s.logMessageContent,"boolean"!=typeof s.withCredentials&&void 0!==s.withCredentials)throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");s.withCredentials=void 0===s.withCredentials||s.withCredentials,s.timeout=void 0===s.timeout?1e5:s.timeout;let i=null,r=null;if(g.isNode){const t=require;i=t("ws"),r=t("eventsource")}g.isNode||"undefined"==typeof WebSocket||s.WebSocket?g.isNode&&!s.WebSocket&&i&&(s.WebSocket=i):s.WebSocket=WebSocket,g.isNode||"undefined"==typeof EventSource||s.EventSource?g.isNode&&!s.EventSource&&void 0!==r&&(s.EventSource=r):s.EventSource=EventSource,this.$=s.httpClient||new H(this.u),this.q="Disconnected",this.j=!1,this.Pt=s,this.onreceive=null,this.onclose=null}async start(t){if(t=t||W.Binary,w.isIn(t,W,"transferFormat"),this.u.log(e.Debug,`Starting connection with transfer format '${W[t]}'.`),"Disconnected"!==this.q)return Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."));if(this.q="Connecting",this.Xt=this.F(t),await this.Xt,"Disconnecting"===this.q){const t="Failed to start the HttpConnection before stop() was called.";return this.u.log(e.Error,t),await this.tt,Promise.reject(new Error(t))}if("Connected"!==this.q){const t="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!";return this.u.log(e.Error,t),Promise.reject(new Error(t))}this.j=!0}send(t){return"Connected"!==this.q?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this.Jt||(this.Jt=new z(this.transport)),this.Jt.send(t))}async stop(t){return"Disconnected"===this.q?(this.u.log(e.Debug,`Call to HttpConnection.stop(${t}) ignored because the connection is already in the disconnected state.`),Promise.resolve()):"Disconnecting"===this.q?(this.u.log(e.Debug,`Call to HttpConnection.stop(${t}) ignored because the connection is already in the disconnecting state.`),this.tt):(this.q="Disconnecting",this.tt=new Promise((t=>{this.Ot=t})),await this.et(t),void await this.tt)}async et(t){this.zt=t;try{await this.Xt}catch(t){}if(this.transport){try{await this.transport.stop()}catch(t){this.u.log(e.Error,`HttpConnection.transport.stop() threw error '${t}'.`),this.Vt()}this.transport=void 0}else this.u.log(e.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.")}async F(t){let s=this.baseUrl;this.St=this.Pt.accessTokenFactory;try{if(this.Pt.skipNegotiation){if(this.Pt.transport!==M.WebSockets)throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");this.transport=this.Gt(M.WebSockets),await this.Kt(s,t)}else{let e=null,n=0;do{if(e=await this.Qt(s),"Disconnecting"===this.q||"Disconnected"===this.q)throw new Error("The connection was stopped during negotiation.");if(e.error)throw new Error(e.error);if(e.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");if(e.url&&(s=e.url),e.accessToken){const t=e.accessToken;this.St=()=>t}n++}while(e.url&&n<100);if(100===n&&e.url)throw new Error("Negotiate redirection limit exceeded.");await this.Yt(s,this.Pt.transport,e,t)}this.transport instanceof F&&(this.features.inherentKeepAlive=!0),"Connecting"===this.q&&(this.u.log(e.Debug,"The HttpConnection connected successfully."),this.q="Connected")}catch(t){return this.u.log(e.Error,"Failed to start the connection: "+t),this.q="Disconnected",this.transport=void 0,this.Ot(),Promise.reject(t)}}async Qt(t){const s={};if(this.St){const t=await this.St();t&&(s[j.Authorization]=`Bearer ${t}`)}const[i,r]=$();s[i]=r;const o=this.Zt(t);this.u.log(e.Debug,`Sending negotiation request: ${o}.`);try{const t=await this.$.post(o,{content:"",headers:{...s,...this.Pt.headers},timeout:this.Pt.timeout,withCredentials:this.Pt.withCredentials});if(200!==t.statusCode)return Promise.reject(new Error(`Unexpected status code returned from negotiate '${t.statusCode}'`));const e=JSON.parse(t.content);return(!e.negotiateVersion||e.negotiateVersion<1)&&(e.connectionToken=e.connectionId),e}catch(t){let s="Failed to complete negotiation with the server: "+t;return t instanceof n&&404===t.statusCode&&(s+=" Either this is not a SignalR endpoint or there is a proxy blocking the connection."),this.u.log(e.Error,s),Promise.reject(new a(s))}}te(t,e){return e?t+(-1===t.indexOf("?")?"?":"&")+`id=${e}`:t}async Yt(t,s,n,i){let r=this.te(t,n.connectionToken);if(this.ee(s))return this.u.log(e.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=s,await this.Kt(r,i),void(this.connectionId=n.connectionId);const o=[],h=n.availableTransports||[];let a=n;for(const n of h){const h=this.se(n,s,i);if(h instanceof Error)o.push(`${n.transport} failed:`),o.push(h);else if(this.ee(h)){if(this.transport=h,!a){try{a=await this.Qt(t)}catch(t){return Promise.reject(t)}r=this.te(t,a.connectionToken)}try{return await this.Kt(r,i),void(this.connectionId=a.connectionId)}catch(t){if(this.u.log(e.Error,`Failed to start the transport '${n.transport}': ${t}`),a=void 0,o.push(new c(`${n.transport} failed: ${t}`,M[n.transport])),"Connecting"!==this.q){const t="Failed to select transport before stop() was called.";return this.u.log(e.Debug,t),Promise.reject(new Error(t))}}}}return o.length>0?Promise.reject(new l(`Unable to connect to the server with any of the available transports. ${o.join(" ")}`,o)):Promise.reject(new Error("None of the transports supported by the client are supported by the server."))}Gt(t){switch(t){case M.WebSockets:if(!this.Pt.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new X(this.$,this.St,this.u,this.Pt.logMessageContent,this.Pt.WebSocket,this.Pt.headers||{});case M.ServerSentEvents:if(!this.Pt.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new B(this.$,this.St,this.u,this.Pt);case M.LongPolling:return new F(this.$,this.St,this.u,this.Pt);default:throw new Error(`Unknown transport: ${t}.`)}}Kt(t,e){return this.transport.onreceive=this.onreceive,this.transport.onclose=t=>this.Vt(t),this.transport.connect(t,e)}se(t,s,n){const i=M[t.transport];if(null==i)return this.u.log(e.Debug,`Skipping transport '${t.transport}' because it is not supported by this client.`),new Error(`Skipping transport '${t.transport}' because it is not supported by this client.`);if(!function(t,e){return!t||0!=(e&t)}(s,i))return this.u.log(e.Debug,`Skipping transport '${M[i]}' because it was disabled by the client.`),new h(`'${M[i]}' is disabled by the client.`,i);if(!(t.transferFormats.map((t=>W[t])).indexOf(n)>=0))return this.u.log(e.Debug,`Skipping transport '${M[i]}' because it does not support the requested transfer format '${W[n]}'.`),new Error(`'${M[i]}' does not support ${W[n]}.`);if(i===M.WebSockets&&!this.Pt.WebSocket||i===M.ServerSentEvents&&!this.Pt.EventSource)return this.u.log(e.Debug,`Skipping transport '${M[i]}' because it is not supported in your environment.'`),new o(`'${M[i]}' is not supported in your environment.`,i);this.u.log(e.Debug,`Selecting transport '${M[i]}'.`);try{return this.Gt(i)}catch(t){return t}}ee(t){return t&&"object"==typeof t&&"connect"in t}Vt(t){if(this.u.log(e.Debug,`HttpConnection.stopConnection(${t}) called while in state ${this.q}.`),this.transport=void 0,t=this.zt||t,this.zt=void 0,"Disconnected"!==this.q){if("Connecting"===this.q)throw this.u.log(e.Warning,`Call to HttpConnection.stopConnection(${t}) was ignored because the connection is still in the connecting state.`),new Error(`HttpConnection.stopConnection(${t}) was called while the connection is still in the connecting state.`);if("Disconnecting"===this.q&&this.Ot(),t?this.u.log(e.Error,`Connection disconnected with error '${t}'.`):this.u.log(e.Information,"Connection disconnected."),this.Jt&&(this.Jt.stop().catch((t=>{this.u.log(e.Error,`TransportSendQueue.stop() threw error '${t}'.`)})),this.Jt=void 0),this.connectionId=void 0,this.q="Disconnected",this.j){this.j=!1;try{this.onclose&&this.onclose(t)}catch(s){this.u.log(e.Error,`HttpConnection.onclose(${t}) threw error '${s}'.`)}}}else this.u.log(e.Debug,`Call to HttpConnection.stopConnection(${t}) was ignored because the connection is already in the disconnected state.`)}Bt(t){if(0===t.lastIndexOf("https://",0)||0===t.lastIndexOf("http://",0))return t;if(!g.isBrowser)throw new Error(`Cannot resolve '${t}'.`);const s=window.document.createElement("a");return s.href=t,this.u.log(e.Information,`Normalizing '${t}' to '${s.href}'.`),s.href}Zt(t){const e=t.indexOf("?");let s=t.substring(0,-1===e?t.length:e);return"/"!==s[s.length-1]&&(s+="/"),s+="negotiate",s+=-1===e?"":t.substring(e),-1===s.indexOf("negotiateVersion")&&(s+=-1===e?"?":"&",s+="negotiateVersion="+this.Ft),s}}class z{constructor(t){this.ne=t,this.ie=[],this.re=!0,this.oe=new V,this.he=new V,this.ce=this.ae()}send(t){return this.le(t),this.he||(this.he=new V),this.he.promise}stop(){return this.re=!1,this.oe.resolve(),this.ce}le(t){if(this.ie.length&&typeof this.ie[0]!=typeof t)throw new Error(`Expected data to be of type ${typeof this.ie} but was of type ${typeof t}`);this.ie.push(t),this.oe.resolve()}async ae(){for(;;){if(await this.oe.promise,!this.re){this.he&&this.he.reject("Connection stopped.");break}this.oe=new V;const t=this.he;this.he=void 0;const e="string"==typeof this.ie[0]?this.ie.join(""):z.ue(this.ie);this.ie.length=0;try{await this.ne.send(e),t.resolve()}catch(e){t.reject(e)}}}static ue(t){const e=t.map((t=>t.byteLength)).reduce(((t,e)=>t+e)),s=new Uint8Array(e);let n=0;for(const e of t)s.set(new Uint8Array(e),n),n+=e.byteLength;return s.buffer}}class V{constructor(){this.promise=new Promise(((t,e)=>[this.de,this.fe]=[t,e]))}resolve(){this.de()}reject(t){this.fe(t)}}class G{constructor(){this.name="json",this.version=1,this.transferFormat=W.Text}parseMessages(t,s){if("string"!=typeof t)throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!t)return[];null===s&&(s=f.instance);const n=D.parse(t),i=[];for(const t of n){const n=JSON.parse(t);if("number"!=typeof n.type)throw new Error("Invalid payload.");switch(n.type){case A.Invocation:this.pe(n);break;case A.StreamItem:this.we(n);break;case A.Completion:this.ge(n);break;case A.Ping:case A.Close:break;default:s.log(e.Information,"Unknown message type '"+n.type+"' ignored.");continue}i.push(n)}return i}writeMessage(t){return D.write(JSON.stringify(t))}pe(t){this.ye(t.target,"Invalid payload for Invocation message."),void 0!==t.invocationId&&this.ye(t.invocationId,"Invalid payload for Invocation message.")}we(t){if(this.ye(t.invocationId,"Invalid payload for StreamItem message."),void 0===t.item)throw new Error("Invalid payload for StreamItem message.")}ge(t){if(t.result&&t.error)throw new Error("Invalid payload for Completion message.");!t.result&&t.error&&this.ye(t.error,"Invalid payload for Completion message."),this.ye(t.invocationId,"Invalid payload for Completion message.")}ye(t,e){if("string"!=typeof t||""===t)throw new Error(e)}}const K={trace:e.Trace,debug:e.Debug,info:e.Information,information:e.Information,warn:e.Warning,warning:e.Warning,error:e.Error,critical:e.Critical,none:e.None};class Q{configureLogging(t){if(w.isRequired(t,"logging"),void 0!==t.log)this.logger=t;else if("string"==typeof t){const e=function(t){const e=K[t.toLowerCase()];if(void 0!==e)return e;throw new Error(`Unknown log level: ${t}`)}(t);this.logger=new E(e)}else this.logger=new E(t);return this}withUrl(t,e){return w.isRequired(t,"url"),w.isNotEmpty(t,"url"),this.url=t,this.httpConnectionOptions="object"==typeof e?{...this.httpConnectionOptions,...e}:{...this.httpConnectionOptions,transport:e},this}withHubProtocol(t){return w.isRequired(t,"protocol"),this.protocol=t,this}withAutomaticReconnect(t){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return t?Array.isArray(t)?this.reconnectPolicy=new q(t):this.reconnectPolicy=t:this.reconnectPolicy=new q,this}build(){const t=this.httpConnectionOptions||{};if(void 0===t.logger&&(t.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");const e=new J(this.url,t);return N.create(e,this.logger||f.instance,this.protocol||new G,this.reconnectPolicy)}}return Uint8Array.prototype.indexOf||Object.defineProperty(Uint8Array.prototype,"indexOf",{value:Array.prototype.indexOf,writable:!0}),Uint8Array.prototype.slice||Object.defineProperty(Uint8Array.prototype,"slice",{value:function(t,e){return new Uint8Array(Array.prototype.slice.call(this,t,e))},writable:!0}),Uint8Array.prototype.forEach||Object.defineProperty(Uint8Array.prototype,"forEach",{value:Array.prototype.forEach,writable:!0}),s})()},"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.signalR=e():t.signalR=e();
 //@microsoft/signalr 6.0.7;