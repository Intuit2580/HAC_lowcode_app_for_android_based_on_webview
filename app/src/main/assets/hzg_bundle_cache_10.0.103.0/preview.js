var Forguncy;(function(n){var t;(function(t){var i=function(){function i(){}return i.mockRequestRemote=function(){$.get=function(){return null};$.post=function(){return null};$.ajax=function(){return null}},i.createImage=function(r,u,f){var e,c,v,y,o,p,w,a;u===void 0&&(u=null);f===void 0&&(f=null);try{n.ListViewHelper.PreviewHelper.ForPreview=!0;n.DelayRefresh.DisableDelayRun();i.mockRequestRemote();n.ForguncyData.pageInfo.ConditionalFormattingMetadata&&(n.ForguncyData.pageInfo.ConditionalFormattingMetadata.Rules=[],n.ForguncyData.pageInfo.ConditionalFormattingMetadata.DependenceCells={});e=r;typeof r=="string"&&(e=JSON.parse(r));c=e.MetaData;c.metaDataObj=JSON.parse(c.metaData);v=n.MetadataHelper.createPageMetadata(c);n.PageBuilder.createPage(v,null);this.createSpread(u,"rowlistview");this.createSpread(f,"collistview");var l=e.ListViewElement,b=l.Width,k=l.Height,s=$("#listview");return s.css("width",b),s.css("height",k),s.css("position","relative"),y=new n.ListviewData(l.Data,n.StaticValues.RunTimeNormalPagePrefix,"Page1"),o=n.ForguncyData.pageInfo.pageElementManager.listviewCollection.addSpreadJSView(s[0],y,n.StaticValues.RunTimeNormalPagePrefix,"Page1",l.Layout),o.initSpread(s[0]),o.initConditionFormatFormula(),p={table:{Data:e.PreviewData,AllRowLoaded:!0,TotalRowValues:e.TotalRowData},editor:e.Editors},t.RequestHelper.FillServerListviewData(o,p,!1,100,!1),o.showHorizontalScrollBar(!1),o.showVerticalScrollBar(!1),w=$("canvas",s)[0].toDataURL(),o.dispose(),w}catch(h){return console.error(h),a="Error:"+h,(h===null||h===void 0?void 0:h.stack)&&(a=a+"\r\n"+h.stack),a}finally{n.ListViewHelper.PreviewHelper.ForPreview=!1}},i.createSpread=function(i,r){var u,f,s;if(i){u=i;typeof i=="string"&&(u=JSON.parse(i));f=u.ListViewElement;f.Data.IsColumnHeaderVisible=!0;var o=$("<div id='#"+r+"'><\/div>"),h=new n.ListviewData(f.Data,n.StaticValues.RunTimeNormalPagePrefix,"Page1"),e=n.ForguncyData.pageInfo.pageElementManager.listviewCollection.addSpreadJSView(o[0],h,n.StaticValues.RunTimeNormalPagePrefix,"Page1",f.Layout);e.initSpread(o[0]);e.initConditionFormatFormula();s={table:{Data:u.PreviewData,AllRowLoaded:!0,TotalRowValues:u.TotalRowData},editor:u.Editors};t.RequestHelper.FillServerListviewData(e,s,!1,100,!1)}},i}();t.PreviewHelper=i})(t=n.ListViewHelper||(n.ListViewHelper={}))})(Forguncy||(Forguncy={}))
;var Forguncy;(function(n){var t;(function(t){function r(){$.ajaxSetup({"async":!1});n.ForguncyData.ForguncyRoot=n.StaticData.ForguncyRoot;$("head").append($('<base href="'.concat(n.StaticData.WebsiteBase,'">')));n.ColorHelper.Colors=n.StaticData.ThemeData.Colors;n.ColorHelper.ColorCache={};n.MetadataHelper.applyGlobalFontFamilyAndTextColor(n.StaticData.ThemeData.EnFontFamily);var t=n.StaticData.CellTypeStyleTemplates;n.CellTypeStyleTemplateUtils.PrepareTemplateStyles(t);$(document.body).append($('<div id="pageLoadingCover"><\/div>'));$(document.head).append($("<style>.listViewButton{background:linear-gradient(180deg, #ECECEC 0.00%, #D5D5D5 100.00%);} <\/style>"))}function u(t,i){var u=new n.PageInfo,r,e,f,o,s,h,c,l;u.dataModel=new n.DataModel;u.formulaManager=new n.FormulaManager(u.dataModel);u.normalCellBindingManager=new n.NormalCellBindingManager(u.dataModel.normalCellDataModel);u.currentRowInfoCollection=new n.CurrentRowInfoCollection(u.normalCellBindingManager);u.pageElementManager=new n.PageElementManager(u.currentRowInfoCollection,u.dataModel);n.ForguncyData.pageInfo=u;r=$(document.createElement("div"));e=n.PageBuilder.pagesContainer;e.empty().append(r);e.attr("fgc-exporting","true");f=t;try{f=JSON.parse(t)}catch(a){}return f.CellType.IsInvisible=!1,o=f.Value,s=n.Presentation.CellContentElementPresenter.createCellForPreview(r,f,u.pageName),s.setValue(o),n.DelayRefresh.RunNow(),h=f.Height,c=f.Width,r.css("width",c),r.css("height",h),r.css("left",0),r.css("top",0),r.css("overflow","hidden"),r.find("*").css("transition","none"),i&&f.CellType.$type.indexOf("Forguncy.ButtonCellType")>=0&&(r.find("button").addClass("listViewButton"),r.find("*").css("opacity","1"),r.find("*").css("box-shadow","none")),l="myId",r.attr("id","myId"),l}function f(t,i){var r=n.DomUtilities.createJqueryDomElement("div"),a=n.PageBuilder.pagesContainer,c,f,e,o,l;a.empty().append(r);var u=i?JSON.parse(t):JSON.parse(t),s=u.Height,h=u.Width;return r.css("width",h),r.css("height",s),r.css("left",0),r.css("top",0),r.css("overflow","hidden"),c={},n.Presentation.ImageElementPresenter.setImageContainerStyle(c,u),f=n.DomUtilities.createJqueryDomElement("div"),e=i?{flex:"1"}:{flexGrow:"1"},i&&(u.FitToBrowserHeight&&r.attr("FitToBrowserHeight","true"),u.FitToBrowserWidth&&r.attr("FitToBrowserWidth","true")),o=u.ImageSrc||u.PictureName,n.Presentation.ImageElementPresenter.setBackground(r,e,u),i?n.Presentation.ImageElementPresenter.applyBackgroundLayoutProperties(e,u.Repeat,u.Stretch):o&&n.Presentation.ImageElementPresenter.applyBackgroundLayoutProperties(e,!1,2),o&&n.Presentation.ImageElementPresenter.applyImageSource(u,e),f.addClass(n.CSSHelper.getClassName(e)),f.css("width",h),f.css("height",s),f.css("left",0),f.css("top",0),r.append(f),l="svgImgId",r.attr("id","svgImgId"),l}function e(){var t=n.PageBuilder.pagesContainer.find("img").toArray();return t.every(function(n){return n.complete===!0})}function o(t){return n.ListViewHelper.PreviewHelper.createImage(t)}function s(t){var f,e,s,h,o;try{n.DelayRefresh.DisableDelayRun();var i=typeof t=="string"?JSON.parse(t):t,c=i.GlobalSettings,l=i.PivotTablePreviewID,a=i.ListViewMetaData,v=i.RowMasterListViewMetaData,y=i.ColumnMasterListViewMetaData,u=i.PivotTableMetaData,p=i.StyleTemplate,w=i.StyleInfo;return u.CellType.PivotTableSetting.IsPreviewing=!0,u.StyleTemplate=p,u.StyleInfo=w,n.ListViewHelper.PreviewHelper.createImage(a,v,y),n.ForguncyData.initGlobalSettings(c),f=new n.PivotTableCellType(u,0,l,null),e=f.createContent(),n.PageBuilder.pagesContainer.append(e),f.paintPivotTable(),s=e.find("canvas"),h=s.length>0?s[0].toDataURL():"",e.remove(),f.destroy(),h}catch(r){return console.error(r),o="Error:"+r,(r===null||r===void 0?void 0:r.stack)&&(o=o+"\r\n"+r.stack),o}}function i(t){n.ColorHelper.Colors=t.ThemeColors;n.ColorHelper.ColorCache={};n.ForguncyData=n.ForguncyData;n.ForguncyData.pageInfo=new n.PageInfo;n.ForguncyData.pageInfo.formulaManager=new n.FormulaManager(new n.DataModel);n.ForguncyData.pageInfo.formulaManager.evaluateFormula=function(n){return n}}function h(t,r){var u,l,a,f,s,v,w,h;try{r||(r=1);u=JSON.parse(t);i(u);var y=u.Width,p=u.Height,o=$("#chart");return o.css("width",y),o.css("height",p),l=$("canvas",o),l.css("width",y),l.css("height",p),a=window.echarts.init(o[0]),f=u.ChartGeoJsonMetadata,(f===null||f===void 0?void 0:f.GeoAreaJsonFileName)&&(s=f.GeoAreaJsonFileName,s=s.replace(/\\/g,"_"),window.echarts.registerMap(s,f.GeoAreaJsonContent)),v="transparent",w=c(u,a),w||(v=n.ConvertChartHelper.convertBackgoundColor(u.ChartJson.backgroundColor,!0)),a.getDataURL({pixelRatio:r,backgroundColor:v})}catch(e){return console.error(e),h="Error:"+e,(e===null||e===void 0?void 0:e.stack)&&(h=h+"\r\n"+e.stack),h}}function c(t,i){var r=n.ConvertChartHelper.convertChartModelToECharts(t.ChartJson,t.ChartDataMapping,null,t.ChartGeoJsonMetadata);r.animation=!1;try{return i.clear(),i.setOption(r),i.resize(),!0}catch(u){return console.log(u),!1}}t.setLocale=function(t){var i=JSON.parse(t.multiLanguageMetaDataString);n.Common.IsEmpty(n.ForguncyData.GlobalSettings)&&(n.ForguncyData.GlobalSettings={});n.ForguncyData.GlobalSettings.MultipleLanguageSettings=i;n.ForguncyData.GlobalSettings.ThemeFont=t.themeFont;n.SetBuiltInResource(t.culture,JSON.parse(t.builtInResourceString));n.Resource.PublicResource=JSON.parse(t.publicResourceString);n.Plugin.LocalizationResourceHelper.clearCache();n.SpreadJSModifier.resetCulture()};t.prepareForCellTypeExporting=r;t.getCellTypePreviewImage=u;t.getSvgPreviewImage=f;t.getCellTypeImageLoaded=e;t.getListviewPreviewImage=o;t.getPivotTablePreviewImage=s;t.AddLoadChartMissedContext=i;t.getChartPreviewImage=h})(t=n.Preview||(n.Preview={}))})(Forguncy||(Forguncy={}))
;var __assign=this&&this.__assign||function(){return __assign=Object.assign||function(n){for(var t,r,i=1,u=arguments.length;i<u;i++){t=arguments[i];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},__assign.apply(this,arguments)},__awaiter=this&&this.__awaiter||function(n,t,i,r){function u(n){return n instanceof i?n:new i(function(t){t(n)})}return new(i||(i=Promise))(function(i,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?i(n.value):u(n.value).then(o,s)}e((r=r.apply(n,t||[])).next())})},__generator=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=e[0]&2?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[e[0]&2,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i,e;return e={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e},Forguncy;(function(n){var t;(function(t){function a(t,u){var f=$(document.createElement("div")),s=n.PageBuilder.pagesContainer,e,o;s.append(f);s.attr("fgc-exporting","true");t.CellType.IsInvisible=!1;t.StyleInfo=t.StyleInfo||{};e=t.Value||t.CellType.DefaultValue;e=n.Common.getMultiLanguageWord(e);o=n.Presentation.CellContentElementPresenter.createCellForPreview(f,t,i.pageInfo.pageName,u.customArgs);r(function(){return o.onLoad()});r(function(){return o.setValue(e)});r(function(){return n.DelayRefresh.RunNow()});var h=u.position.split(","),c=h[0],l=h[1],a=t.Height,v=t.Width;return f.css("position","absolute"),f.css("width",v),f.css("height",a),f.css("left",Number(c)),f.css("top",Number(l)),f.attr("data-preview-cell",""),f.find("*").css("transition","none"),f.attr("id",u.domId),o}function v(n){var t=this;return new Promise(function(i){return __awaiter(t,void 0,void 0,function(){var t;return __generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,n()];case 1:return r.sent(),[3,3];case 2:return t=r.sent(),console.error(t),[3,3];case 3:return i(null),[2]}})})})}function r(n){try{n()}catch(t){console.error(t)}}var u=this,i={pageInfo:null,timerCount:0,uniqueIdCellMap:new Map,cellLayoutPointsMap:new Map,themeChaneListeners:[]},o=function(n,t,i,r){return[[n,t],[n+i,t],[n,t+r],[n+i,t+r],]},s=function(n){return n.split(",").map(Number)},h=function(n,t){return n[0][0]<t[1][0]&&n[1][0]>t[0][0]&&n[0][1]<t[3][1]&&n[3][1]>t[0][1]},c=function(){i.pageInfo||(i.pageInfo=new n.PageInfo,i.pageInfo.dataModel=new n.DataModel,i.pageInfo.formulaManager=new n.FormulaManager(i.pageInfo.dataModel),i.pageInfo.normalCellBindingManager=new n.NormalCellBindingManager(i.pageInfo.dataModel.normalCellDataModel),i.pageInfo.currentRowInfoCollection=new n.CurrentRowInfoCollection(i.pageInfo.normalCellBindingManager),i.pageInfo.pageElementManager=new n.PageElementManager(i.pageInfo.currentRowInfoCollection,i.pageInfo.dataModel),n.ForguncyData.pageInfo=i.pageInfo,n.PageBuilder.pagesContainer.empty())},l=function(n){i.cellLayoutPointsMap.forEach(function(t,u){var f;h(n,t)&&(console.warn("The cell is overlapping with other cells, it will be removed.",u.id),r(function(){return u.dispose()}),(f=document.querySelector("[innerid='".concat(u.id,"']")))===null||f===void 0?void 0:f.remove(),i.cellLayoutPointsMap.delete(u))})},f,e;t.resetPage=function(){i.cellLayoutPointsMap.forEach(function(n,t){return r(function(){return t.dispose()})});n.PageBuilder.pagesContainer.empty();i.cellLayoutPointsMap.clear();i.pageInfo=null};t.loadDependenceRuntimeModules=function(){for(var i=[],t=0;t<arguments.length;t++)i[t]=arguments[t];return __awaiter(u,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,n.ModuleLoader.LoadModels(i,n.StaticData.ForguncyRoot)];case 1:return t.sent(),[2]}})})};t.setThemeData=function(t){n.StaticData.ThemeData={Colors:t.colors,Font:t.font,EnFontFamily:t.enFontFamily,ThemeBasePath:t.themeBasePath};n.ColorHelper.Colors=n.StaticData.ThemeData.Colors;n.ColorHelper.ColorCache={};n.MetadataHelper.applyGlobalFontFamilyAndTextColor(n.StaticData.ThemeData.EnFontFamily,!0);i.themeChaneListeners.forEach(function(n){return n()})};t.loadPlugin=function(t){return __awaiter(u,void 0,void 0,function(){var u,i,r,e,f;return __generator(this,function(o){switch(o.label){case 0:return u="file:///"+t.rootPath.replace(/\\/g,"/")+"/",n.ModuleLoader.nameModuleMap[t.identifier]=t.guid,n.ModuleLoader.addPluginModules((f={},f[t.guid]={js:t.javascript,css:t.css,pluginRoot:u,localeLoadMap:t.localeLoadMap},f),{}),n.Plugin.LocalizationResource[t.guid]=JSON.parse(t.pluginResource),i=[],r=t.localeLoadMap[n.StaticData.Lang],(r===null||r===void 0?void 0:r.length)&&(e="file:///"+t.originalRootPath.replace(/\\/g,"/")+"/",i.push(n.ModuleLoader.LoadJs(r,e))),i.push.apply(i,[n.ModuleLoader.LoadJs(t.javascript,u),n.ModuleLoader.LoadCss(t.css,u)]),[4,Promise.all(i)];case 1:return o.sent(),[2]}})})};t.createPreviewNode=function(t){return __awaiter(u,void 0,void 0,function(){var u,f,h,e,y,w,k,d,b,p;return __generator(this,function(g){switch(g.label){case 0:return u=JSON.parse(t),f=JSON.parse(u.cellTypeMeteDataString),f.StyleInfo=JSON.parse(u.styleMetaDataString),h=u.styleTemplateString?JSON.parse(u.styleTemplateString):undefined,h&&(e=h.key,y=h.styleTemplate,e=e||f.CellType.TemplateKey,f=__assign(__assign({},f),{StyleTemplate:{Category:"_DesignTimePreview",Key:e,StyleTemplateFashionScope:2,Styles:y}}),Object.keys(y||{}).forEach(function(t){var r=n.CellTypeStyleTemplateUtils.FormatTemplateStyleClassName(f.CellType.$type.split(",")[0],e,t),i=document.querySelector("style#"+r);i&&i.parentNode.removeChild(i);n.CellTypeStyleTemplateUtils.ParseAndAppendPartStyle(y[t],r)})),c(),w=s(u.position),k=w[0],d=w[1],b=o(k,d,f.Width,f.Height),console.log("need create cell: "+u.uniqueId),r(function(){return l(b)}),p=a(f,u),i.uniqueIdCellMap.set(u.uniqueId,p),i.cellLayoutPointsMap.set(p,b),[4,v(function(){return p.onPageLoaded()})];case 1:return g.sent(),console.log(u.uniqueId+" has been created."),[2]}})})};t.destroyPreviewNode=function(n){r(function(){var t=i.uniqueIdCellMap.get(n);t&&(t.dispose(),i.uniqueIdCellMap.delete(n),console.log(n+" has been destroyed."))})};t.addThemeChangeListener=function(n){i.themeChaneListeners.push(n)};f=function(){var n=document.styleSheets[0];n.insertRule("* { transition: none !important; }",0);n.insertRule("* { animation: none !important; }",0)};e=function(){window.alert=function(){console.warn("The environment does not support the alert method.")};window.confirm=function(){return console.warn("The environment does not support the confirm method."),!0};window.prompt=function(){return console.warn("The environment does not support the prompt method."),null}};f();e()})(t=n.CellTypePreview||(n.CellTypePreview={}))})(Forguncy||(Forguncy={}))
;